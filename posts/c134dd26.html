<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>云计算方向-2022年云计算技能大赛样题 | GoldY</title><meta name="author" content="GoldY"><meta name="copyright" content="GoldY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2022年云计算技能大赛样题">
<meta property="og:type" content="article">
<meta property="og:title" content="云计算方向-2022年云计算技能大赛样题">
<meta property="og:url" content="https://www.geekgold.xyz/posts/c134dd26.html">
<meta property="og:site_name" content="GoldY">
<meta property="og:description" content="2022年云计算技能大赛样题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.geekgold.xyz/img/cloud-com.jpg">
<meta property="article:published_time" content="2025-05-14T02:47:34.000Z">
<meta property="article:modified_time" content="2025-05-14T03:16:03.867Z">
<meta property="article:author" content="GoldY">
<meta property="article:tag" content="云计算">
<meta property="article:tag" content="云计算职业技能大赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.geekgold.xyz/img/cloud-com.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "云计算方向-2022年云计算技能大赛样题",
  "url": "https://www.geekgold.xyz/posts/c134dd26.html",
  "image": "https://www.geekgold.xyz/img/cloud-com.jpg",
  "datePublished": "2025-05-14T02:47:34.000Z",
  "dateModified": "2025-05-14T03:16:03.867Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoldY",
      "url": "https://www.geekgold.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.geekgold.xyz/posts/c134dd26.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="bing-site-verification" content="E05CD8D6921B8F2AA32324DF2B267557"/><meta name="baidu-site-verification" content="codeva-tCktTl1n17"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '云计算方向-2022年云计算技能大赛样题',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cloud-com.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">GoldY</span></a><a class="nav-page-title" href="/"><span class="site-name">云计算方向-2022年云计算技能大赛样题</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">云计算方向-2022年云计算技能大赛样题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-14T02:47:34.000Z" title="发表于 2025-05-14 10:47:34">2025-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-14T03:16:03.867Z" title="更新于 2025-05-14 11:16:03">2025-05-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E6%B1%87%E6%80%BB/">技能大赛汇总</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">14k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>74分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="A模块：OpenStack平台部署与运维（样题）"><a href="#A模块：OpenStack平台部署与运维（样题）" class="headerlink" title="A模块：OpenStack平台部署与运维（样题）"></a>A模块：OpenStack平台部署与运维（样题）</h1><p><strong>业务场景：</strong></p>
<p>某企业拟使用OpenStack搭建一个企业云平台，用于部署各类企业应用对外对内服务。云平台可实现IT资源池化，弹性分配，集中管理，性能优化以及统一安全认证等。系统结构如下图</p>
<p>企业云平台的搭建使用竞赛平台提供的两台云服务器，配置如下表：</p>
<p>说明:</p>
<p>①选手自行检查工位pc机硬件及网络是否正常;1.选手自行检查工位PC机硬件及网络是否正常；</p>
<p>②竞赛使用集群模式进行，给每个参赛队提供华为云账号和密码及考试系统的账号和密码。选手通过用户名与密码分别登录华为云和考试系统;</p>
<p>③考试用到的软件包都在云主机&#x2F;opt下。</p>
<p>④表1中的公网IP和私网IP以自己云主机显示为准，每个人的公网IP和私网IP不同。使用第三方软件远程连接云主机，使用公网IP连接。</p>
<h2 id="任务1私有云平台环境初始化"><a href="#任务1私有云平台环境初始化" class="headerlink" title="任务1私有云平台环境初始化"></a>任务1私有云平台环境初始化</h2><p><strong>①根据表1中的IP地址规划，设置各服务器节点的IP地址，确保网络正常通信，设置云服务器1主机名为Controller，云服务器2主机名为Compute，并修改hosts文件将IP地址映射为主机名，关闭防火墙并设置为开机不启动，设置SELinux为Permissive 模式。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname controller</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##ip地址映射主机,注意该ip地址为自身环境地址</span></span></span><br><span class="line">[root@localhost ~]# vi /etc/hosts</span><br><span class="line">[root@localhost ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.157.20 controller</span><br><span class="line">192.168.157.21 compute</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##关闭防火墙</span></span></span><br><span class="line">[root@localhost ~]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#关闭安全策略</span></span></span><br><span class="line">[root@localhost ~]# setenforce 0</span><br><span class="line">[root@localhost ~]# cat /etc/selinux/config  | grep -v ^$ | grep -v ^#</span><br><span class="line">SELINUX=permissive</span><br><span class="line">SELINUXTYPE=targeted</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#compute节点修改主机名即可,其他配置相同</span></span></span><br></pre></td></tr></table></figure>

<p><strong>②将提供的CentOS-7-x86_64-DVD-1804.iso和qdkills_cloud_iaas.iso光盘镜像上传到Compute节点的&#x2F;root目录下，然后在&#x2F;opt目录下分别创建centos目录和openstack目录，并将镜像文件CentOS-7-x86_64-DVD-1804.iso挂载到centos目录下，将镜像文件qdkills_cloud_iaas.iso挂载到openstack目录下。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /opt/centos</span><br><span class="line">[root@localhost ~]# mkdir /opt/openstack</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# mount CentOS-7-x86_64-DVD-1804.iso /opt/centos/</span><br><span class="line">mount: /dev/loop0 is write-protected, mounting read-only</span><br><span class="line">[root@localhost ~]# mount chinaskills_cloud_iaas.iso /opt/openstack/</span><br><span class="line">mount: /dev/loop1 is write-protected, mounting read-only</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>③在Compute节点上利用centos目录中的软件包安装vsftpd服务器并设置开机自启动，提供yum仓库服务，并分别设置controller节点和compute节点的yum源文件ftp.repo，其中节点的地址使用IP形式。</strong></p>
<p>在compute节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mv /etc/yum.repos.d/CentOS-* /home/</span><br><span class="line">[root@localhost ~]# vi /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[openstack]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/openstack/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# yum repolist</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#安装并配置vsftp</span></span></span><br><span class="line">[root@localhost ~]# yum install -y vsftpd</span><br><span class="line">[root@localhost ~]# echo &quot;anon_root=/opt&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">[root@localhost ~]# systemctl enable --now vsftpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在controller节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://compute/centos</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[openstack]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://compute/openstack/iaas-repo</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# yum repolist</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>④在Controller节点上部署chrony服务器，允许其他节点同步时间，启动服务并设置为开机启动；并在compute节点上指定controller节点为上游NTP服务器，重启服务并设为开机启动。</strong></p>
<p>controller节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server controller iburst</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Record the rate at <span class="built_in">which</span> the system clock gains/losses <span class="keyword">time</span>.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow the system clock to be stepped <span class="keyword">in</span> the first three updates</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hwtimestamp *</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the system clock.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">minsources 2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow NTP client access from <span class="built_in">local</span> network.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">allow 192.168.0.0/16</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Serve <span class="keyword">time</span> even <span class="keyword">if</span> not synchronized to a <span class="keyword">time</span> <span class="built_in">source</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">local</span> stratum 10</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify file containing keys <span class="keyword">for</span> NTP authentication.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify directory <span class="keyword">for</span> <span class="built_in">log</span> files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Select <span class="built_in">which</span> information is logged.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">log</span> measurements statistics tracking</span></span><br><span class="line">allow 192.168.157.0/24</span><br><span class="line">local stratum 10</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##使配置生效</span></span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line">systemctl enable chronyd</span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<p>compute节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server controller iburst</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Record the rate at <span class="built_in">which</span> the system clock gains/losses <span class="keyword">time</span>.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow the system clock to be stepped <span class="keyword">in</span> the first three updates</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hwtimestamp *</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the system clock.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">minsources 2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow NTP client access from <span class="built_in">local</span> network.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">allow 192.168.0.0/16</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Serve <span class="keyword">time</span> even <span class="keyword">if</span> not synchronized to a <span class="keyword">time</span> <span class="built_in">source</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">local</span> stratum 10</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify file containing keys <span class="keyword">for</span> NTP authentication.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify directory <span class="keyword">for</span> <span class="built_in">log</span> files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Select <span class="built_in">which</span> information is logged.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">log</span> measurements statistics tracking</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##使配置生效</span></span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line">systemctl enable chronyd</span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<p><strong>⑤在compute节点上查看分区情况，并利用空白分区划分2个20G分区。</strong></p>
<p>compute节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看空白分区</span></span></span><br><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   50G  0 disk</span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   49G  0 part</span><br><span class="line">  ├─centos-root 253:0    0   44G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0    5G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0   40G  0 disk</span><br><span class="line">sr0              11:0    1 1024M  0 rom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]# fdisk /dev/sdb</span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x4cacbd86.</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):</span><br><span class="line">Using default response p</span><br><span class="line">Partition number (1-4, default 1):</span><br><span class="line">First sector (2048-83886079, default 2048):</span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-83886079, default 83886079): +20G</span><br><span class="line">Partition 1 of type Linux and of size 20 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):</span><br><span class="line">Using default response p</span><br><span class="line">Partition number (2-4, default 2):</span><br><span class="line">First sector (41945088-83886079, default 41945088):</span><br><span class="line">Using default value 41945088</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (41945088-83886079, default 83886079): +20G</span><br><span class="line">Using default value 83886079</span><br><span class="line">Partition 2 of type Linux and of size 20 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="任务2-OpenStack平台搭建"><a href="#任务2-OpenStack平台搭建" class="headerlink" title="任务2 OpenStack平台搭建"></a>任务2 OpenStack平台搭建</h2><p><strong>①在 controller 节点和 compute 节点分别安装 iaas-xiandian 软件包，修改脚本文件基本变量（脚本文件为&#x2F;etc&#x2F;xiandian&#x2F;openrc.sh），修改完成后使用命令生效该脚本文件。</strong></p>
<p><strong>②在 compute 节点配置&#x2F;etc&#x2F;xiandian&#x2F;openrc.sh 文件，根据环境情况修改参数，块存储服务的后端使用第二块硬盘的第一个分区，生效该参数文件。</strong></p>
<p><strong>controller节点</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum install -y iaas-xiandian</span><br><span class="line">[root@localhost ~]# vi /etc/xiandian/openrc.sh</span><br><span class="line">[root@localhost ~]# cat /etc/xiandian/openrc.sh | grep -v ^$ | grep -v ^#</span><br><span class="line">HOST_IP=192.168.157.20</span><br><span class="line">HOST_PASS=000000</span><br><span class="line">HOST_NAME=controller</span><br><span class="line">HOST_IP_NODE=192.168.157.21</span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line">HOST_NAME_NODE=compute</span><br><span class="line">network_segment_IP=192.168.157.0/24</span><br><span class="line">RABBIT_USER=openstack</span><br><span class="line">RABBIT_PASS=000000</span><br><span class="line">DB_PASS=000000</span><br><span class="line">DOMAIN_NAME=demo</span><br><span class="line">ADMIN_PASS=000000</span><br><span class="line">DEMO_PASS=000000</span><br><span class="line">KEYSTONE_DBPASS=000000</span><br><span class="line">GLANCE_DBPASS=000000</span><br><span class="line">GLANCE_PASS=000000</span><br><span class="line">NOVA_DBPASS=000000</span><br><span class="line">NOVA_PASS=000000</span><br><span class="line">NEUTRON_DBPASS=000000</span><br><span class="line">NEUTRON_PASS=000000</span><br><span class="line">METADATA_SECRET=000000</span><br><span class="line">INTERFACE_IP=192.168.157.20</span><br><span class="line">INTERFACE_NAME=ens34</span><br><span class="line">Physical_NAME=provider</span><br><span class="line">minvlan=101</span><br><span class="line">maxvlan=200</span><br><span class="line">CINDER_DBPASS=000000</span><br><span class="line">CINDER_PASS=000000</span><br><span class="line">BLOCK_DISK=sdb1</span><br><span class="line">SWIFT_PASS=000000</span><br><span class="line">OBJECT_DISK=sdb2</span><br><span class="line">STORAGE_LOCAL_NET_IP=192.168.157.21</span><br><span class="line">HEAT_DBPASS=000000</span><br><span class="line">HEAT_PASS=000000</span><br><span class="line">ZUN_DBPASS=000000</span><br><span class="line">ZUN_PASS=000000</span><br><span class="line">KURYR_DBPASS=000000</span><br><span class="line">KURYR_PASS=000000</span><br><span class="line">CEILOMETER_DBPASS=000000</span><br><span class="line">CEILOMETER_PASS=000000</span><br><span class="line">AODH_DBPASS=000000</span><br><span class="line">AODH_PASS=000000</span><br><span class="line">BARBICAN_DBPASS=000000</span><br><span class="line">BARBICAN_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#将配置文件复制到compute</span></span></span><br><span class="line">[root@localhost ~]# scp /etc/xiandian/openrc.sh root@compute:/etc/xiandian/openrc.sh</span><br><span class="line">The authenticity of host &#x27;compute (192.168.157.21)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:571qhtjNb3asAlUU69GoE8W2Eel7T4VD8/VbitmzBxQ.</span><br><span class="line">ECDSA key fingerprint is MD5:9d:69:e5:7f:58:f8:84:87:9c:d2:1a:39:7b:9f:53:03.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &#x27;compute,192.168.157.21&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@compute&#x27;s password:</span><br><span class="line">openrc.sh                                                                                                                  100% 3819     2.5MB/s   00:00</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>compute节点:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/xiandian/openrc.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------system Config--------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Controller Server Manager IP. example:x.x.x.x</span></span><br><span class="line">HOST_IP=192.168.157.20</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Controller HOST Password. example:000000</span></span><br><span class="line">HOST_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Controller Server hostname. example:controller</span></span><br><span class="line">HOST_NAME=controller</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Compute Node Manager IP. example:x.x.x.x</span></span><br><span class="line">HOST_IP_NODE=192.168.157.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Compute HOST Password. example:000000</span></span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Compute Node hostname. example:compute</span></span><br><span class="line">HOST_NAME_NODE=compute</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Chrony Config-------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Controller network segment IP.  example:x.x.0.0/16(x.x.x.0/24)</span></span><br><span class="line">network_segment_IP=192.168.157.0/24</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Rabbit Config ------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">user <span class="keyword">for</span> rabbit. example:openstack</span></span><br><span class="line">RABBIT_USER=openstack</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> rabbit user .example:000000</span></span><br><span class="line">RABBIT_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------MySQL Config---------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> MySQL root user . exmaple:000000</span></span><br><span class="line">DB_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Keystone Config------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore admin user. exmaple:000000</span></span><br><span class="line">DOMAIN_NAME=demo</span><br><span class="line">ADMIN_PASS=000000</span><br><span class="line">DEMO_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql keystore user. exmaple:000000</span></span><br><span class="line">KEYSTONE_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Glance Config--------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql glance user. exmaple:000000</span></span><br><span class="line">GLANCE_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore glance user. exmaple:000000</span></span><br><span class="line">GLANCE_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Nova Config----------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql nova user. exmaple:000000</span></span><br><span class="line">NOVA_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore nova user. exmaple:000000</span></span><br><span class="line">NOVA_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Neturon Config-------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql neutron user. exmaple:000000</span></span><br><span class="line">NEUTRON_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore neutron user. exmaple:000000</span></span><br><span class="line">NEUTRON_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">metadata secret <span class="keyword">for</span> neutron. exmaple:000000</span></span><br><span class="line">METADATA_SECRET=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Tunnel Network Interface. example:x.x.x.x</span></span><br><span class="line">INTERFACE_IP=192.168.157.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">External Network Interface. example:eth1</span></span><br><span class="line">INTERFACE_NAME=ens34</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">External Network The Physical Adapter. example:provider</span></span><br><span class="line">Physical_NAME=provider</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">First Vlan ID <span class="keyword">in</span> VLAN RANGE <span class="keyword">for</span> VLAN Network. exmaple:101</span></span><br><span class="line">minvlan=101</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Last Vlan ID <span class="keyword">in</span> VLAN RANGE <span class="keyword">for</span> VLAN Network. example:200</span></span><br><span class="line">maxvlan=200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Cinder Config--------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql cinder user. exmaple:000000</span></span><br><span class="line">CINDER_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore cinder user. exmaple:000000</span></span><br><span class="line">CINDER_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Cinder Block Disk. example:md126p3</span></span><br><span class="line">BLOCK_DISK=sdb1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Swift Config---------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore swift user. exmaple:000000</span></span><br><span class="line">SWIFT_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">The NODE Object Disk <span class="keyword">for</span> Swift. example:md126p4.</span></span><br><span class="line">OBJECT_DISK=sdb2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">The NODE IP <span class="keyword">for</span> Swift Storage Network. example:x.x.x.x.</span></span><br><span class="line">STORAGE_LOCAL_NET_IP=192.168.157.21</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Heat Config----------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql heat user. exmaple:000000</span></span><br><span class="line">HEAT_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore heat user. exmaple:000000</span></span><br><span class="line">HEAT_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Zun Config-----------------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql Zun user. exmaple:000000</span></span><br><span class="line">ZUN_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore Zun user. exmaple:000000</span></span><br><span class="line">ZUN_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql Kuryr user. exmaple:000000</span></span><br><span class="line">KURYR_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore Kuryr user. exmaple:000000</span></span><br><span class="line">KURYR_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Ceilometer Config----------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Gnocchi ceilometer user. exmaple:000000</span></span><br><span class="line">CEILOMETER_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore ceilometer user. exmaple:000000</span></span><br><span class="line">CEILOMETER_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------AODH Config----------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql AODH user. exmaple:000000</span></span><br><span class="line">AODH_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore AODH user. exmaple:000000</span></span><br><span class="line">AODH_PASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--------------------Barbican Config----------------##</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Mysql Barbican user. exmaple:000000</span></span><br><span class="line">BARBICAN_DBPASS=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Password <span class="keyword">for</span> Keystore Barbican user. exmaple:000000</span></span><br><span class="line">BARBICAN_PASS=000000</span><br><span class="line">[root@localhost ~]# cat /etc/xiandian/openrc.sh | grep -v ^# | grep -v ^$</span><br><span class="line">HOST_IP=192.168.157.20</span><br><span class="line">HOST_PASS=000000</span><br><span class="line">HOST_NAME=controller</span><br><span class="line">HOST_IP_NODE=192.168.157.21</span><br><span class="line">HOST_PASS_NODE=000000</span><br><span class="line">HOST_NAME_NODE=compute</span><br><span class="line">network_segment_IP=192.168.157.0/24</span><br><span class="line">RABBIT_USER=openstack</span><br><span class="line">RABBIT_PASS=000000</span><br><span class="line">DB_PASS=000000</span><br><span class="line">DOMAIN_NAME=demo</span><br><span class="line">ADMIN_PASS=000000</span><br><span class="line">DEMO_PASS=000000</span><br><span class="line">KEYSTONE_DBPASS=000000</span><br><span class="line">GLANCE_DBPASS=000000</span><br><span class="line">GLANCE_PASS=000000</span><br><span class="line">NOVA_DBPASS=000000</span><br><span class="line">NOVA_PASS=000000</span><br><span class="line">NEUTRON_DBPASS=000000</span><br><span class="line">NEUTRON_PASS=000000</span><br><span class="line">METADATA_SECRET=000000</span><br><span class="line">INTERFACE_IP=192.168.157.21</span><br><span class="line">INTERFACE_NAME=ens34</span><br><span class="line">Physical_NAME=provider</span><br><span class="line">minvlan=101</span><br><span class="line">maxvlan=200</span><br><span class="line">CINDER_DBPASS=000000</span><br><span class="line">CINDER_PASS=000000</span><br><span class="line">BLOCK_DISK=sdb1</span><br><span class="line">SWIFT_PASS=000000</span><br><span class="line">OBJECT_DISK=sdb2</span><br><span class="line">STORAGE_LOCAL_NET_IP=192.168.157.21</span><br><span class="line">HEAT_DBPASS=000000</span><br><span class="line">HEAT_PASS=000000</span><br><span class="line">ZUN_DBPASS=000000</span><br><span class="line">ZUN_PASS=000000</span><br><span class="line">KURYR_DBPASS=000000</span><br><span class="line">KURYR_PASS=000000</span><br><span class="line">CEILOMETER_DBPASS=000000</span><br><span class="line">CEILOMETER_PASS=000000</span><br><span class="line">AODH_DBPASS=000000</span><br><span class="line">AODH_PASS=000000</span><br><span class="line">BARBICAN_DBPASS=000000</span><br><span class="line">BARBICAN_PASS=000000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>③分别在 controller 节点和 compute 节点执行 iaas-pre-host.sh 文件(不需要重启云主机)。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-pre-host.sh</span><br></pre></td></tr></table></figure>

<p><strong>④在 controller 节点执行 iaas-install-mysql.sh 脚本，会自行安装 mariadb、memcached、rabbitmq 等服务和完成相关配置。执行完成后修改配置文件将缓存 CACHESIZE 修改为 128,并重启相应服务。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-mysql.sh</span><br><span class="line">[root@controller ~]# cat /etc/sysconfig/memcached</span><br><span class="line">PORT=&quot;11211&quot;</span><br><span class="line">USER=&quot;memcached&quot;</span><br><span class="line">MAXCONN=&quot;1024&quot;</span><br><span class="line">CACHESIZE=&quot;128&quot;</span><br><span class="line">OPTIONS=&quot;-l 127.0.0.1,::1,controller&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启生效</span></span><br><span class="line">[root@controller ~]# systemctl restart memcached</span><br></pre></td></tr></table></figure>

<p><strong>⑤在 controller 节点执行 iaas-install-keystone.sh 脚本，会自行安装 keystone 服务和完成相关配置。使用 openstack 命令，创建一个名为 tom 的账户，密码为 tompassword123,邮箱为<a href="mailto:tom@example.com">tom@example.com</a></strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-keystone.sh</span><br><span class="line">[root@controller ~]# source /etc/keystone/admin-openrc.sh</span><br><span class="line">[root@controller ~]# openstack user create tom --password tompassword123 --email tom@example.com --domain demo</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | c7a3303c6f7748f2b22f6421149226b5 |</span><br><span class="line">| email               | tom@example.com                  |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | 131e1e035c174fd0a10862fe47844cf1 |</span><br><span class="line">| name                | tom                              |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>⑥在 controller 节点执行 iaas-install-glance.sh 脚本，会自行安装 glance 服务和完成相关配 置 。 完 成 后 使 用 openstack 命 令 , 创 建 一 个 名 为 cirros 的 镜 像 ， 镜 像 文 件 使 用cirros-0.3.4-x86_64-disk.img。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##注意请将镜像文件上传</span></span></span><br><span class="line">[root@controller ~]# iaas-install-glance.sh</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack image create --disk-format qcow2 --container bare --file cirros-0.3.4-x86_64-disk.img  cirros</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2023-04-17T03:13:42Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/c51eee70-1885-4482-9252-d808c2832cdb/file |</span><br><span class="line">| id               | c51eee70-1885-4482-9252-d808c2832cdb                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | 3b0c23a093dd4f11bbd8d7316634b784                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 13287936                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | 2023-04-17T03:13:42Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | shared                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>⑦在 controller 节点执行 iaas-install-nova-controller.sh，compute 节点执行iaas-install-nova-compute.sh，会自行安装 nova 服务和完成相关配置。使用 nova 命令创建一个名为 t,ID 为 5，内存为 2048MB,磁盘容量为 10GB,vCPU 数量为 2 的云主机类型。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]#  iaas-install-nova-controller.sh</span><br><span class="line"></span><br><span class="line">[root@compute ~]# iaas-install-nova-compute.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#注意在compute节点跑完之后运行</span></span></span><br><span class="line">[root@controller ~]# nova flavor-create t 5 2048 10 2</span><br><span class="line">+----+------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line">| ID | Name | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | Description |</span><br><span class="line">+----+------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line">| 5  | t    | 2048      | 10   | 0         |      | 2     | 1.0         | True      | -           |</span><br><span class="line">+----+------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑧在 controller 节点执行 iaas-install-neutron-controller.sh,compute节点执行iaas-install-neutron-compute.sh，会自行安装 neutron 服务并完成配置。创建云主机外部网络 ext-net，子网为 ext-subnet，云主机浮动 IP 可用网段为192.168.10.100 ~ 192. 168.10.200，网关为 192.168.100.1。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# iaas-install-neutron-controller.sh</span><br><span class="line">[root@compute ~]# iaas-install-neutron-compute.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建网络</span></span><br><span class="line">[root@controller ~]# source admin-openrc</span><br><span class="line">[root@controller ~]# openstack network create --external ext-net</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建子网</span></span><br><span class="line">[root@controller ~]# openstack subnet create  --gateway 192.168.100.1 --allocation-pool start=192.168.10.100,end=192.168.10.200 --network ext-net --subnet-range 192.168.10.0/24 ext-subnet</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack subnet show ext-subnet</span><br><span class="line">+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field             | Value                                                                                                                                                   |</span><br><span class="line">+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| allocation_pools  | 192.168.200.100-192.168.200.200                                                                                                                         |</span><br><span class="line">| cidr              | 192.168.200.0/24                                                                                                                                        |</span><br><span class="line">| created_at        | 2023-02-22T16:29:20Z                                                                                                                                    |</span><br><span class="line">| description       |                                                                                                                                                         |</span><br><span class="line">| dns_nameservers   |                                                                                                                                                         |</span><br><span class="line">| enable_dhcp       | True                                                                                                                                                    |</span><br><span class="line">| gateway_ip        | 192.168.200.1                                                                                                                                           |</span><br><span class="line">| host_routes       |                                                                                                                                                         |</span><br><span class="line">| id                | 6ab2ab75-3a82-44d5-9bc8-c2c0a65872d6                                                                                                                    |</span><br><span class="line">| ip_version        | 4                                                                                                                                                       |</span><br><span class="line">| ipv6_address_mode | None                                                                                                                                                    |</span><br><span class="line">| ipv6_ra_mode      | None                                                                                                                                                    |</span><br><span class="line">| location          | cloud=&#x27;&#x27;, project.domain_id=, project.domain_name=&#x27;Default&#x27;, project.id=&#x27;ce21284fd468495995218ea6e1aeea2a&#x27;, project.name=&#x27;admin&#x27;, region_name=&#x27;&#x27;, zone= |</span><br><span class="line">| name              | ext-subnet                                                                                                                                              |</span><br><span class="line">| network_id        | bc39443b-9ef8-4a4d-91b3-fd2637ada43f                                                                                                                    |</span><br><span class="line">| prefix_length     | None                                                                                                                                                    |</span><br><span class="line">| project_id        | ce21284fd468495995218ea6e1aeea2a                                                                                                                        |</span><br><span class="line">| revision_number   | 0                                                                                                                                                       |</span><br><span class="line">| segment_id        | None                                                                                                                                                    |</span><br><span class="line">| service_types     |                                                                                                                                                         |</span><br><span class="line">| subnetpool_id     | None                                                                                                                                                    |</span><br><span class="line">| tags              |                                                                                                                                                         |</span><br><span class="line">| updated_at        | 2023-02-22T16:29:20Z </span><br></pre></td></tr></table></figure>



<p>⑨在 controller 节点执行 iaas-install-dashboard.sh 脚本，会自行安装 dashboard 服务并完成配置。请修改 nova 配置文件，使之能通过公网 IP 访问 dashboard 首页。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack-controller-dashboard.sh</span><br><span class="line">[root@controller ~]# vim /etc/nova/nova.conf</span><br><span class="line">修改内容如下</span><br><span class="line">novncproxy_base_url = http://公网IP:6080/vnc_auto.html</span><br><span class="line"></span><br><span class="line">[root@controller ~]# cat /etc/nova/nova.conf | grep 公网IP</span><br><span class="line">novncproxy_base_url = http://公网IP:6080/vnc_auto.html</span><br></pre></td></tr></table></figure>

<h2 id="任务-3-OpenStack-运维任务"><a href="#任务-3-OpenStack-运维任务" class="headerlink" title="任务 3 OpenStack 运维任务"></a>任务 3 OpenStack 运维任务</h2><p><strong>①使用命令创建名称为 group_web 的安全组该安全组的描述为” Custom security group”，用 openstack 命令为安全组添加 icmp 规则和 ssh 规则允许任意 ip 地址访问 web,完成后查看该安全组的详细信息.</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建描述为Custom security group的安全组</span></span><br><span class="line">[root@controller ~]# openstack security group create --description &quot;Custom security group&quot; group_web</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加访问80</span></span><br><span class="line">[root@controller ~]# openstack security group rule create --ingress --ethertype IPv4 --protocol tcp --dst-port 80:80 group_web</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加访问ssh(22)</span></span><br><span class="line">[root@controller ~]# openstack security group rule create --ingress --ethertype IPv4 --protocol tcp --dst-port 22:22 group_web</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加访问icmp</span></span><br><span class="line">[root@controller ~]# openstack security group rule create --ingress --protocol icmp group_web</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>②在 keystone 中创建 shop 项目添加描述为”Hello shop”，完成后使用 openstack 命令禁用该项目，然后使用 openstack 命令查看该项目的详细信息。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack project create shop --description &quot;Heelo shop&quot; --domain demo</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Heelo shop                       |</span><br><span class="line">| domain_id   | c7a3303c6f7748f2b22f6421149226b5 |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | d610f67035114665b15c367ab4e4d879 |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | shop                             |</span><br><span class="line">| parent_id   | c7a3303c6f7748f2b22f6421149226b5 |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">[root@controller ~]# openstack project set shop --disable</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>③<strong>使用 nova 命令查看 admin 租户的当前配额值，将 admin 租户的实例配额提升到 13。登 录 controller 节 点 ，使用 glance 相 关 命 令 上 传 镜 像 ， 源 使 用CentOS_7.5_x86_64_XD.qcow2，名字为 centos7.5，修改这个镜像为共享状态，并设置最小磁盘为 5G。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack quota set admin --instances 13</span><br><span class="line">[root@controller ~]# openstack quota show admin</span><br><span class="line">+----------------------+----------------------------------+</span><br><span class="line">| Field                | Value                            |</span><br><span class="line">+----------------------+----------------------------------+</span><br><span class="line">| cores                | 20                               |</span><br><span class="line">| fixed-ips            | -1                               |</span><br><span class="line">| floating-ips         | 50                               |</span><br><span class="line">| health_monitors      | None                             |</span><br><span class="line">| injected-file-size   | 10240                            |</span><br><span class="line">| injected-files       | 5                                |</span><br><span class="line">| injected-path-size   | 255                              |</span><br><span class="line">| instances            | 13                               |</span><br><span class="line">| key-pairs            | 100                              |</span><br><span class="line">| l7_policies          | None                             |</span><br><span class="line">| listeners            | None                             |</span><br><span class="line">| load_balancers       | None                             |</span><br><span class="line">| location             | None                             |</span><br><span class="line">| name                 | None                             |</span><br><span class="line">| networks             | 100                              |</span><br><span class="line">| pools                | None                             |</span><br><span class="line">| ports                | 500                              |</span><br><span class="line">| project              | 3b0c23a093dd4f11bbd8d7316634b784 |</span><br><span class="line">| project_name         | admin                            |</span><br><span class="line">| properties           | 128                              |</span><br><span class="line">| ram                  | 51200                            |</span><br><span class="line">| rbac_policies        | 10                               |</span><br><span class="line">| routers              | 10                               |</span><br><span class="line">| secgroup-rules       | 100                              |</span><br><span class="line">| secgroups            | 10                               |</span><br><span class="line">| server-group-members | 10                               |</span><br><span class="line">| server-groups        | 10                               |</span><br><span class="line">| subnet_pools         | -1                               |</span><br><span class="line">| subnets              | 100                              |</span><br><span class="line">+----------------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">[root@controller ~]# glance image-create --disk-format qcow2 --container bare --file CentOS-7-x86_64-DVD-1804.iso --min-disk 5 --name centos7.5</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| Property         | Value                                |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">| checksum         | 660aab9894136872770ecb6e1e370c08     |</span><br><span class="line">| container_format | bare                                 |</span><br><span class="line">| created_at       | 2023-04-17T03:54:50Z                 |</span><br><span class="line">| disk_format      | qcow2                                |</span><br><span class="line">| id               | 84cd8c51-ee79-4591-8a9e-b3d689d34c04 |</span><br><span class="line">| min_disk         | 5                                    |</span><br><span class="line">| min_ram          | 0                                    |</span><br><span class="line">| name             | centos7.5                            |</span><br><span class="line">| owner            | 3b0c23a093dd4f11bbd8d7316634b784     |</span><br><span class="line">| protected        | False                                |</span><br><span class="line">| size             | 4470079488                           |</span><br><span class="line">| status           | active                               |</span><br><span class="line">| tags             | []                                   |</span><br><span class="line">| updated_at       | 2023-04-17T03:55:15Z                 |</span><br><span class="line">| virtual_size     | None                                 |</span><br><span class="line">| visibility       | shared                               |</span><br><span class="line">+------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack image set centos7.5 --share</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>④请修改 glance 后端配置文件，将项目的映像存储限制为 10GB,完成后重启 glance 服务。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# vim /etc/glance/glance-api.conf</span><br><span class="line">user_storage_quota = 10737418240</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启</span></span><br><span class="line">[root@controller ~]# systemctl restart openstack-glance-*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询</span></span><br><span class="line">[root@controller ~]# cat /etc/glance/glance-api.conf |grep _quota</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">``image_property_quota`` configuration option.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">     * image_property_quota</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">image_member_quota = 128</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">image_property_quota = 128</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">image_tag_quota = 128</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">image_location_quota = 10</span></span><br><span class="line">user_storage_quota = 10737418240</span><br></pre></td></tr></table></figure>



<p>⑤在 controller 节点执行 iaas-install-cinder-controller.sh, compute 节点执行iaas-install-cinder-compute.sh，在 controller 和 compute 节点上会自行安装 cinder 服务并完成配置。创建一个名为 lvm 的卷类型，创建该类型规格键值对，要求 lvm 卷类型对应 cinder后端驱动 lvm 所管理的存储资源,名字 lvm_test，大小 1G 的云硬盘并查询该云硬盘的详细信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack-controller-cinder.sh </span><br><span class="line">[root@compute ~]# openstack-compute-cinder.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建卷类型lvm</span></span><br><span class="line">[root@controller ~]# source admin-openrc</span><br><span class="line">[root@controller ~]# openstack volume type create lvm</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| Field       | Value                                |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">| description | None                                 |</span><br><span class="line">| id          | 5a1ac113-b226-4646-9a7c-46eee3f6346f |</span><br><span class="line">| is_public   | True                                 |</span><br><span class="line">| name        | lvm                                  |</span><br><span class="line">+-------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# cinder type-key lvm set volume_backend_name=LVM</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建云硬盘</span></span><br><span class="line">[root@controller ~]# cinder create --volume-type lvm --name lvm_test 1</span><br><span class="line">略                                               </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看详细信息</span></span><br><span class="line">[root@controller ~]# cinder show lvm_test</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| Property                       | Value                                |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| attached_servers               | []                                   |</span><br><span class="line">| attachment_ids                 | []                                   |</span><br><span class="line">| availability_zone              | nova                                 |</span><br><span class="line">| bootable                       | false                                |</span><br><span class="line">| consistencygroup_id            | None                                 |</span><br><span class="line">| created_at                     | 2022-10-25T12:28:55.000000           |</span><br><span class="line">| description                    | None                                 |</span><br><span class="line">| encrypted                      | False                                |</span><br><span class="line">| id                             | 39f131c3-6ee2-432a-8096-e13173307339 |</span><br><span class="line">| metadata                       |                                      |</span><br><span class="line">| migration_status               | None                                 |</span><br><span class="line">| multiattach                    | False                                |</span><br><span class="line">| name                           | lvm_test                             |</span><br><span class="line">| os-vol-host-attr:host          | compute@lvm#LVM                      |</span><br><span class="line">| os-vol-mig-status-attr:migstat | None                                 |</span><br><span class="line">| os-vol-mig-status-attr:name_id | None                                 |</span><br><span class="line">| os-vol-tenant-attr:tenant_id   | 4885b78813a5466d9d6d483026f2067c     |</span><br><span class="line">| replication_status             | None                                 |</span><br><span class="line">| size                           | 1                                    |</span><br><span class="line">| snapshot_id                    | None                                 |</span><br><span class="line">| source_volid                   | None                                 |</span><br><span class="line">| status                         | available                            |</span><br><span class="line">| updated_at                     | 2022-10-25T12:28:56.000000           |</span><br><span class="line">| user_id                        | b4a6c1eb18c247edba11b57be18ec752     |</span><br><span class="line">| volume_type                    | lvm                                  |</span><br></pre></td></tr></table></figure>



<p><strong>⑥请使用数据库命令将所有数据库进行备份,备份文件名为 openstack.sql，完成后使用命令查看文件属性其中文件大小以 mb 显示。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# mysqldump -uroot -p000000 --all-databases &gt; /root/openstack.sql</span><br><span class="line">[root@controller ~]# du -h /root/openstack.sql</span><br><span class="line">1.6M    /root/openstack.sql</span><br></pre></td></tr></table></figure>



<p><strong>⑦进入数据库，创建本地用户 examuser，密码为 000000，然后查询 mysql 数据库中的user 表的 user,host,password 字段。然后赋予这个用户所有数据库的“查询”“删除”“更新”“创建”的权限。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# mysql -uroot -p</span><br><span class="line">MariaDB [(none)]&gt; create user examuser@&#x27;localhost&#x27; identified by &#x27;000000&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.005 sec)</span><br><span class="line">MariaDB [(none)]&gt; use mysql</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [mysql]&gt; select user,host,password from user;</span><br><span class="line">+-----------+------------+-------------------------------------------+</span><br><span class="line">| user      | host       | password                                  |</span><br><span class="line">+-----------+------------+-------------------------------------------+</span><br><span class="line">| root      | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| root      | controller | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| root      | 127.0.0.1  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| root      | ::1        | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| keystone  | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| keystone  | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| glance    | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| glance    | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| nova      | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| nova      | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| placement | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| placement | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| neutron   | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| neutron   | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| cinder    | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| cinder    | %          | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">| examuser  | localhost  | *032197AE5731D4664921A6CCAC7CFCE6A0698693 |</span><br><span class="line">+-----------+------------+-------------------------------------------+</span><br><span class="line">17 rows in set (0.000 sec)</span><br><span class="line">MariaDB [mysql]&gt; grant select,delete,update,create on *.* to examuser@&#x27;localhost&#x27;; </span><br><span class="line">Query OK, 0 rows affected (0.000 sec)</span><br><span class="line">MariaDB [mysql]&gt; select User, Select_priv,Update_priv,Delete_priv,Create_priv from user;</span><br><span class="line">+-----------+-------------+-------------+-------------+-------------+</span><br><span class="line">| User      | Select_priv | Update_priv | Delete_priv | Create_priv |</span><br><span class="line">+-----------+-------------+-------------+-------------+-------------+</span><br><span class="line">| root      | Y           | Y           | Y           | Y           |</span><br><span class="line">| root      | Y           | Y           | Y           | Y           |</span><br><span class="line">| root      | Y           | Y           | Y           | Y           |</span><br><span class="line">| root      | Y           | Y           | Y           | Y           |</span><br><span class="line">| keystone  | N           | N           | N           | N           |</span><br><span class="line">| keystone  | N           | N           | N           | N           |</span><br><span class="line">| glance    | N           | N           | N           | N           |</span><br><span class="line">| glance    | N           | N           | N           | N           |</span><br><span class="line">| nova      | N           | N           | N           | N           |</span><br><span class="line">| nova      | N           | N           | N           | N           |</span><br><span class="line">| placement | N           | N           | N           | N           |</span><br><span class="line">| placement | N           | N           | N           | N           |</span><br><span class="line">| neutron   | N           | N           | N           | N           |</span><br><span class="line">| neutron   | N           | N           | N           | N           |</span><br><span class="line">| examuser  | Y           | Y           | Y           | Y           |</span><br><span class="line">+-----------+-------------+-------------+-------------+-------------+</span><br><span class="line">15 rows in set (0.000 sec)</span><br></pre></td></tr></table></figure>



<p>⑧请使用 openstack 命令创建一个名为 test 的 cinder 卷，卷大小为 5G。完成后使用 cinder命令列出卷列表并查看 test 卷的详细信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack volume create --size 5 test</span><br><span class="line">[root@controller ~]# openstack volume show test</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| Field                          | Value                                |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| attachments                    | []                                   |</span><br><span class="line">| availability_zone              | nova                                 |</span><br><span class="line">| bootable                       | false                                |</span><br><span class="line">| consistencygroup_id            | None                                 |</span><br><span class="line">| created_at                     | 2023-04-17T04:05:21.000000           |</span><br><span class="line">| description                    | None                                 |</span><br><span class="line">| encrypted                      | False                                |</span><br><span class="line">| id                             | 67df96a9-cc9f-4a59-8602-e0e50bdf4f26 |</span><br><span class="line">| migration_status               | None                                 |</span><br><span class="line">| multiattach                    | False                                |</span><br><span class="line">| name                           | test                                 |</span><br><span class="line">| os-vol-host-attr:host          | compute@lvm#LVM                      |</span><br><span class="line">| os-vol-mig-status-attr:migstat | None                                 |</span><br><span class="line">| os-vol-mig-status-attr:name_id | None                                 |</span><br><span class="line">| os-vol-tenant-attr:tenant_id   | 3b0c23a093dd4f11bbd8d7316634b784     |</span><br><span class="line">| properties                     |                                      |</span><br><span class="line">| replication_status             | None                                 |</span><br><span class="line">| size                           | 5                                    |</span><br><span class="line">| snapshot_id                    | None                                 |</span><br><span class="line">| source_volid                   | None                                 |</span><br><span class="line">| status                         | available                            |</span><br><span class="line">| type                           | None                                 |</span><br><span class="line">| updated_at                     | 2023-04-17T04:05:22.000000           |</span><br><span class="line">| user_id                        | 0a6447639e3b44acb584c6b87f194c9e     |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑨为了减缓来自实例的数据访问速度的变慢，OpenStack Block Storage 支持对卷数据复制带宽的速率限制。请修改 cinder 后端配置文件将卷复制带宽限制为最高 100 MiB&#x2F;s。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# vim /etc/cinder/cinder.conf</span><br><span class="line">[lvmdriver-1]</span><br><span class="line">volume_group=cinder-volumes-1</span><br><span class="line">volume_driver=cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">volume_backend_name=LVM</span><br><span class="line">volume_copy_bps_limit=104857600</span><br><span class="line">[root@controller ~]# systemctl restart openstack-cinder-*</span><br><span class="line">[root@controller ~]# cat /etc/cinder/cinder.conf | grep 104857600</span><br><span class="line">volume_copy_bps_limit=104857600</span><br></pre></td></tr></table></figure>



<p><strong>⑩在controller节点执行 iaas-install-swift-controller.sh, compute节点执行iaas-install-swift-compute.sh,在controller和compute节点上会自行安装 swift 服务并完成配置。创建一个名为 file 的容器。</strong></p>
<p><strong>在提供的OpenStack平台上，使用Swift对象存储服务，修改相应的配置文件，使对象存储Swift作为glance镜像服务的后端存储。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack-controller-swift.sh</span><br><span class="line">[root@compute ~]# openstack-compute-swift.sh</span><br><span class="line">[root@controller ~]# swift post file</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##修改配置文件</span></span></span><br><span class="line">[root@controller ~]# vi /etc/glance/glance-api.conf</span><br><span class="line">[glance_store]</span><br><span class="line">stores=glance.store.filesystem.Store,glance.store.swift.Store,glance.store.http.Store</span><br><span class="line">default_store=swift</span><br><span class="line">swift_store_region=RegionOne</span><br><span class="line">swift_store_endpoint_type=internalURL</span><br><span class="line">swift_store_container=glance</span><br><span class="line">swift_store_large_object_size=5120</span><br><span class="line">swift_store_large_object_chunk_size=200</span><br><span class="line">swift_store_create_container_on_put=True</span><br><span class="line">swift_store_multi_tenant=True</span><br><span class="line">swift_store_admin_tenants=service</span><br><span class="line">swift_store_auth_address=http://controller:5000/v3</span><br><span class="line">swift_store_user=glance</span><br><span class="line">swift_store_key=000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#重启 glance 所有组件</span></span></span><br><span class="line"> systemctl restart openstack-glance-*</span><br></pre></td></tr></table></figure>



<p><strong>11用 swift 命令，把 cirros-0.3.4-x86_64-disk.img 上传到 file 容器中。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# swift upload file /root/cirros-0.3.4-x86_64-disk.img</span><br><span class="line">root/cirros-0.3.4-x86_64-disk.img</span><br><span class="line">[root@controller ~]# swift stat file</span><br><span class="line">               Account: AUTH_d23ad8b534f44b02ad30c9f7847267df</span><br><span class="line">             Container: file</span><br><span class="line">               Objects: 1</span><br><span class="line">                 Bytes: 13287936</span><br><span class="line">              Read ACL:</span><br><span class="line">             Write ACL:</span><br><span class="line">               Sync To:</span><br><span class="line">              Sync Key:</span><br><span class="line">         Accept-Ranges: bytes</span><br><span class="line">      X-Storage-Policy: Policy-0</span><br><span class="line">         Last-Modified: Fri, 10 Mar 2023 02:43:07 GMT</span><br><span class="line">           X-Timestamp: 1678416180.44884</span><br><span class="line">            X-Trans-Id: txfdc2fb777c4641d3a9292-00640a9941</span><br><span class="line">          Content-Type: application/json; charset=utf-8</span><br><span class="line">X-Openstack-Request-Id: txfdc2fb777c4641d3a9292-00640a9941</span><br></pre></td></tr></table></figure>



<p>12使用提供的云安全框架组件，将提供的OpenStack云平台的安全策略从http优化至https。</p>
<p>controller节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#安装工具包</span></span></span><br><span class="line">yum install -y mod_wsgi httpd mod_ssl</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##修改/etc/openstack-dashboard/local_settings文件</span></span></span><br><span class="line">vi /etc/openstack-dashboard/local_settings</span><br><span class="line"><span class="meta prompt_">   #</span><span class="language-bash"><span class="comment">#在DEBUG = False下增加4行</span></span></span><br><span class="line">USE_SSL = True</span><br><span class="line">CSRF_COOKIE_SECURE = True		##原文中有，去掉注释即可</span><br><span class="line">SESSION_COOKIE_SECURE = True		##原文中有，去掉注释即可</span><br><span class="line">SESSION_COOKIE_HTTPONLY = True</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#修改/etc/httpd/conf.d/ssl.conf配置文件</span></span></span><br><span class="line">vi /etc/httpd/conf.d/ssl.conf</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="comment">#将SSLProtocol all -SSLv2 -SSLv3改成：</span></span></span><br><span class="line">SSLProtocol all -SSLv2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#重启服务</span></span></span><br><span class="line">systemctl restart httpd</span><br><span class="line">systemctl restart memcached</span><br></pre></td></tr></table></figure>



<p>13在提供的OpenStack平台上，通过修改相关参数对openstack平台进行调优操作，相应的调优操作有：</p>
<p>  设置内存超售比例为1.5倍；</p>
<p> 设置nova服务心跳检查时间为120秒。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/nova/nova.conf</span><br><span class="line">ram_allocation_ratio = 1.5</span><br><span class="line">service_down_time = 120</span><br></pre></td></tr></table></figure>



<h2 id="任务四-OpenStack架构任务"><a href="#任务四-OpenStack架构任务" class="headerlink" title="任务四 OpenStack架构任务"></a>任务四 OpenStack架构任务</h2><p>①在controller节点安装python3环境。安装完之后查看python3版本，使用提供的whl文件安装依赖。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@controller python-depend]# yum install python3 –y</span><br><span class="line">[root@controller python-depend]# pip3 install certifi-2019.11.28-py2.py3-none-any.whl</span><br><span class="line">[root@controller python-depend]# pip3 install urllib3-1.25.11-py3-none-any.whl</span><br><span class="line">[root@controller python-depend]# pip3 install idna-2.8-py2.py3-none-any.whl</span><br><span class="line">[root@controller python-depend]# pip3 install chardet-3.0.4-py2.py3-none-any.whl</span><br><span class="line">[root@controller python-depend]# pip3 install requests-2.24.0-py2.py3-none-any.whl</span><br><span class="line">[root@controller ~]# python3 --version</span><br><span class="line">Python 3.6.8</span><br><span class="line">[root@controller ~]# pip3 list</span><br><span class="line">DEPRECATION: The default format will switch to columns in the future. You can use --format=(legacy|columns) (or define a format=(legacy|columns) in your pip.conf under the [list] section) to disable this warning.</span><br><span class="line">certifi (2019.11.28)</span><br><span class="line">chardet (3.0.4)</span><br><span class="line">idna (2.8)</span><br><span class="line">pip (9.0.3)</span><br><span class="line">requests (2.24.0)</span><br><span class="line">setuptools (39.2.0)</span><br><span class="line">urllib3 (1.25.11)</span><br></pre></td></tr></table></figure>



<p>②编写python代码对接OpenStack API，完成镜像的上传。在controller节点的&#x2F;root目录下创建create_image.py文件，在该文件中编写python代码对接openstack api（需在py文件中获取token），要求在openstack私有云平台中上传镜像cirros-0.3.4-x86_64-disk.img，名字为cirros001，disk_format为qcow2，container_format为bare。执行完代码要求输出“创建镜像成功，id为：xxxxxx”。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[root@controller python3]# python3 create_image.py</span><br><span class="line">请输入访问openstack平台控制节点IP地址：（xx.xx.xx.xx)</span><br><span class="line">192.168.100.x</span><br><span class="line">创建镜像成功，id为：0591f693-a7c7-4e7f-ac6c-957b7bccffc9</span><br><span class="line">镜像文件上传成功</span><br><span class="line">[root@controller ~]# cat create_image.py</span><br><span class="line">import requests,json,time</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">*******************全局变量IP*****************************</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行代码前，请修改controller_ip的IP地址，与指定router，IP可以input，也可以写成静态</span></span><br><span class="line">controller_ip = input(&quot;请输入访问openstack平台控制节点IP地址：（xx.xx.xx.xx)\n&quot;)</span><br><span class="line"></span><br><span class="line">image_name = &quot;cirros001&quot;</span><br><span class="line">file_path = &quot;/root/cirros-0.3.4-x86_64-disk.img&quot;</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    url  = f&quot;http://&#123;controller_ip&#125;:5000/v3/auth/tokens&quot;</span><br><span class="line">    body = &#123;</span><br><span class="line">       &quot;auth&quot;: &#123;</span><br><span class="line">           &quot;identity&quot;: &#123;</span><br><span class="line">              &quot;methods&quot;:[&quot;password&quot;],</span><br><span class="line">              &quot;password&quot;: &#123;</span><br><span class="line">                  &quot;user&quot;: &#123;</span><br><span class="line">                     &quot;domain&quot;:&#123;</span><br><span class="line">                         &quot;name&quot;: &quot;Default&quot;</span><br><span class="line">                     &#125;,</span><br><span class="line">                     &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">                     &quot;password&quot;: &quot;000000&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;,</span><br><span class="line">           &quot;scope&quot;: &#123;</span><br><span class="line">              &quot;project&quot;: &#123;</span><br><span class="line">                  &quot;domain&quot;: &#123;</span><br><span class="line">                     &quot;name&quot;: &quot;Default&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;name&quot;: &quot;admin&quot;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;</span><br><span class="line">    Token = requests.post(url, data=json.dumps(body), headers=headers).headers[&#x27;X-Subject-Token&#x27;]</span><br><span class="line">    headers = &#123;&quot;X-Auth-Token&quot;: Token&#125;</span><br><span class="line">except Exception as e:</span><br><span class="line">    print(f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：&#123;str(e)&#125;&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line"></span><br><span class="line">class glance_api:</span><br><span class="line">    def __init__(self, headers: dict, resUrl: str):</span><br><span class="line">       self.headers = headers</span><br><span class="line">       self.resUrl = resUrl</span><br><span class="line">    #创建glance镜像</span><br><span class="line">    def create_glance(self, container_format=&quot;bare&quot;, disk_format=&quot;qcow2&quot;):</span><br><span class="line">       body = &#123;</span><br><span class="line">           &quot;container_format&quot;: container_format,</span><br><span class="line">           &quot;disk_format&quot;: disk_format,</span><br><span class="line">           &quot;name&quot;: image_name,</span><br><span class="line">        &#125;</span><br><span class="line">       status_code = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers).status_code</span><br><span class="line">       if(status_code == 201):</span><br><span class="line">           return f&quot;创建镜像成功，id为：&#123;glance_api.get_glance_id()&#125;&quot;</span><br><span class="line">       else:</span><br><span class="line">           return &quot;创建镜像失败&quot;</span><br><span class="line">    #获取glance镜像id</span><br><span class="line">    def get_glance_id(self):</span><br><span class="line">       result = json.loads(requests.get(self.resUrl,headers=self.headers).text)</span><br><span class="line">       for item in result[&#x27;images&#x27;]:</span><br><span class="line">           if(item[&#x27;name&#x27;] == image_name):</span><br><span class="line">              return item[&#x27;id&#x27;]</span><br><span class="line">    #上传glance镜像</span><br><span class="line">    def update_glance(self):</span><br><span class="line">       self.resUrl=self.resUrl+&quot;/&quot;+self.get_glance_id()+&quot;/file&quot;</span><br><span class="line">       self.headers[&#x27;Content-Type&#x27;] = &quot;application/octet-stream&quot;</span><br><span class="line">       status_code = requests.put(self.resUrl,data=open(file_path,&#x27;rb&#x27;).read(),headers=self.headers).status_code</span><br><span class="line">       if(status_code == 204):</span><br><span class="line">           return &quot;镜像文件上传成功&quot;</span><br><span class="line">       else:</span><br><span class="line">           return &quot;镜像文件上传失败&quot;</span><br><span class="line">glance_api = glance_api(headers,f&quot;http://&#123;controller_ip&#125;:9292/v2/images&quot;)</span><br><span class="line">print(glance_api.create_glance())  #调用glance-api中创建镜像方法</span><br><span class="line">print(glance_api.update_glance())</span><br></pre></td></tr></table></figure>



<p>③编写python代码对接OpenStack API，完成用户的创建。在controller节点的&#x2F;root目录下创建create_user.py文件，在该文件中编写python代码对接openstack api（需在py文件中获取token），要求在openstack私有云平台中创建用户guojibeisheng。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">[root@controller python3]# python3 create_user.py</span><br><span class="line">请输入访问openstack平台控制节点IP地址：（xx.xx.xx.xx)</span><br><span class="line">192.168.100.x</span><br><span class="line">用户 guojibeisheng 创建成功,ID为dcb0fc7bacf54038b624463921123aed</span><br><span class="line">该平台的用户为：</span><br><span class="line">guojibeisheng</span><br><span class="line">admin</span><br><span class="line">myuser</span><br><span class="line">tom</span><br><span class="line">glance</span><br><span class="line">nova</span><br><span class="line">placement</span><br><span class="line">neutron</span><br><span class="line">heat</span><br><span class="line">heat_domain_admin</span><br><span class="line">cinder</span><br><span class="line">swift</span><br><span class="line">用户 guojibeisheng 已删除！</span><br><span class="line">[root@controller python3]# cat create_user.py</span><br><span class="line">import requests,json,time</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">*******************全局变量IP*****************************</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行代码前，请修改controller_ip的IP地址，与指定router，IP可以input，也可以写成静态</span></span><br><span class="line">controller_ip = input(&quot;请输入访问openstack平台控制节点IP地址：（xx.xx.xx.xx)\n&quot;)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    url  = f&quot;http://&#123;controller_ip&#125;:5000/v3/auth/tokens&quot;</span><br><span class="line">    body = &#123;</span><br><span class="line">       &quot;auth&quot;: &#123;</span><br><span class="line">           &quot;identity&quot;: &#123;</span><br><span class="line">              &quot;methods&quot;:[&quot;password&quot;],</span><br><span class="line">              &quot;password&quot;: &#123;</span><br><span class="line">                  &quot;user&quot;: &#123;</span><br><span class="line">                     &quot;domain&quot;:&#123;</span><br><span class="line">                         &quot;name&quot;: &quot;Default&quot;</span><br><span class="line">                     &#125;,</span><br><span class="line">                      &quot;name&quot;: &quot;admin&quot;,</span><br><span class="line">                     &quot;password&quot;: &quot;000000&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;,</span><br><span class="line">           &quot;scope&quot;: &#123;</span><br><span class="line">              &quot;project&quot;: &#123;</span><br><span class="line">                  &quot;domain&quot;: &#123;</span><br><span class="line">                     &quot;name&quot;: &quot;Default&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;name&quot;: &quot;admin&quot;</span><br><span class="line">              &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;</span><br><span class="line">    Token = requests.post(url, data=json.dumps(body), headers=headers).headers[&#x27;X-Subject-Token&#x27;]</span><br><span class="line">    headers = &#123;&quot;X-Auth-Token&quot;: Token&#125;</span><br><span class="line">except Exception as e:</span><br><span class="line">    print(f&quot;获取Token值失败，请检查访问云主机控制节点IP是否正确？输出错误信息如下：&#123;str(e)&#125;&quot;)</span><br><span class="line">    exit(0)</span><br><span class="line"></span><br><span class="line">class openstack_user_api:</span><br><span class="line">    def __init__(self, handers: dict, resUrl: str):</span><br><span class="line">        self.headers = handers</span><br><span class="line">        self.resUrl = resUrl</span><br><span class="line">    def create_users(self, user_name):</span><br><span class="line">        body = &#123;</span><br><span class="line">            &quot;user&quot;: &#123;</span><br><span class="line">                &quot;description&quot;: &quot;API create user!&quot;,</span><br><span class="line">                &quot;domain_id&quot;: &quot;default&quot;,</span><br><span class="line">                &quot;name&quot;: user_name</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        status_code = requests.post(self.resUrl, data=json.dumps(body), headers=self.headers).text</span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)</span><br><span class="line">        user_name = user_name</span><br><span class="line">        for i in result[&#x27;users&#x27;]:</span><br><span class="line">            if i[&#x27;name&#x27;] == user_name:</span><br><span class="line">                return f&quot;用户 &#123;user_name&#125; 创建成功,ID为&#123;i[&#x27;id&#x27;]&#125;&quot;</span><br><span class="line">    def list_users(self):</span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)</span><br><span class="line">        roles = []</span><br><span class="line">        for i in result[&#x27;users&#x27;]:</span><br><span class="line">            if i[&#x27;name&#x27;] not in roles:</span><br><span class="line">                roles.append(i[&#x27;name&#x27;])</span><br><span class="line">        return &quot;该平台的用户为：\n&quot;+&#x27;\n&#x27;.join(roles)</span><br><span class="line"></span><br><span class="line">    def get_user_id(self, user_name):</span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)</span><br><span class="line">        user_name = user_name</span><br><span class="line">        for i in result[&#x27;users&#x27;]:</span><br><span class="line">            if i[&#x27;name&#x27;] == user_name:</span><br><span class="line">                return (f&quot;用户 &#123;user_name&#125; 的ID为&#123;i[&#x27;id&#x27;]&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    def delete_user(self, user_name):</span><br><span class="line">        result = json.loads(requests.get(self.resUrl, headers=self.headers).text)</span><br><span class="line">        for i in result[&#x27;users&#x27;]:</span><br><span class="line">            if i[&#x27;name&#x27;] == user_name:</span><br><span class="line">                i = i[&#x27;id&#x27;]</span><br><span class="line">                status_code = requests.delete(f&#x27;http://&#123;controller_ip&#125;:5000/v3/users/&#123;i&#125;&#x27;, headers=self.headers)</span><br><span class="line">                return f&quot;用户 &#123;user_name&#125; 已删除！&quot;</span><br><span class="line"></span><br><span class="line">openstack_user_api = openstack_user_api(headers, f&quot;http://&#123;controller_ip&#125;:5000/v3/users&quot;)</span><br><span class="line"></span><br><span class="line">print(openstack_user_api.create_users(&quot;guojibeisheng&quot;))</span><br><span class="line">print(openstack_user_api.list_users())</span><br><span class="line">print(openstack_user_api.delete_user(&quot;guojibeisheng&quot;))</span><br></pre></td></tr></table></figure>

<h1 id="B模块：容器的编排与运维（样题）"><a href="#B模块：容器的编排与运维（样题）" class="headerlink" title="B模块：容器的编排与运维（样题）"></a>B模块：容器的编排与运维（样题）</h1><p>说明：本任务提供有4台服务器master、node1、node2和harbor，都安装了centos7.5操作系统，在&#x2F;opt&#x2F;centos目录下有CentOS-7-x86_64-DVD-1804系统光盘文件所有文件，在&#x2F;opt&#x2F;containerk8s目录下有本次容器云运维所需的所有文件。</p>
<h2 id="任务-1-容器云平台环境初始化"><a href="#任务-1-容器云平台环境初始化" class="headerlink" title="任务 1 容器云平台环境初始化"></a>任务 1 容器云平台环境初始化</h2><p><strong>①master 节点主机名设置为 master、node1 节点主机名设置为 node1、node2 节点主机名设置为 node2、harbor 节点主机名设置为 harbor,所有节点关闭 swap，并配置 hosts 映射。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#设置主机名</span></span></span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname master</span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname node1</span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname node2</span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname harbor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#主机映射</span></span></span><br><span class="line">[root@master ~]# cat /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.157.50 master</span><br><span class="line">192.168.157.51 node1</span><br><span class="line">192.168.157.52 node2</span><br><span class="line">192.168.157.53 harbor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#关闭swap</span></span></span><br><span class="line">[root@localhost ~]# swapoff -a</span><br><span class="line">[root@localhost ~]# vi + /etc/fstab </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># /etc/fstab</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Created by anaconda on Mon Apr 17 08:27:55 2023</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) <span class="keyword">for</span> more info</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">/dev/mapper/centos-root /                       xfs     defaults        0 0</span></span><br><span class="line">UUID=e1892f7d-c16f-47b3-888b-77d0af3521f6 /boot                   xfs     defaults        0 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭防火墙</span></span><br><span class="line">[root@localhost ~]# systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭安全策略</span></span><br><span class="line">[root@localhost ~]# setenforce 0</span><br><span class="line">[root@localhost ~]# vi /etc/selinux/config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This file controls the state of SELinux on the system.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SELINUX= can take one of these three values:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    enforcing - SELinux security policy is enforced.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    permissive - SELinux prints warnings instead of enforcing.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    disabled - No SELinux policy is loaded.</span></span><br><span class="line">SELINUX=permissive</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SELINUXTYPE= can take one of three two values:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    targeted - Targeted processes are protected,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    minimum - Modification of targeted policy. Only selected processes are protected.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    mls - Multi Level Security protection.</span></span><br><span class="line">SELINUXTYPE=targeted</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>②将提供的 CentOS-7-x86_64-DVD-1804.iso 和 qdkills_cloud_paas.iso 光盘镜像文件移动到 master 节点 &#x2F;root 目录下，然后在 &#x2F;opt 目录下使用命令创建 centos 目录和 paas 目录，并将镜像文件 CentOS-7-x86_64-DVD-1804.iso 永久挂载到 centos 目录下，将镜像文件qdskills_cloud_paas.iso 永久挂载到 &#x2F;opt&#x2F;paas 目录下。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /opt/centos</span><br><span class="line">[root@localhost ~]# mkdir /opt/paas</span><br><span class="line">[root@localhost ~]# vi + /etc/fstab</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># /etc/fstab</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Created by anaconda on Mon Apr 17 08:27:55 2023</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Accessible filesystems, by reference, are maintained under &#x27;/dev/disk&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) <span class="keyword">for</span> more info</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">/dev/mapper/centos-root /                       xfs     defaults        0 0</span></span><br><span class="line">UUID=e1892f7d-c16f-47b3-888b-77d0af3521f6 /boot                   xfs     defaults        0 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span></span><br><span class="line">/root/chinaskills_cloud_paas.iso /opt/paas iso9660 defaults 0 0</span><br><span class="line">/root/CentOS-7-x86_64-DVD-1804.iso /opt/centos iso9660 defaults 0 0</span><br><span class="line">[root@localhost ~]# mount -a</span><br><span class="line">mount: /dev/loop0 is write-protected, mounting read-only</span><br><span class="line">mount: /dev/loop1 is write-protected, mounting read-only</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>③在 master 节点首先将系统自带的 yum 源移动到&#x2F;home 目录，然后为 master 节点配置本地 yum 源，yum 源文件名为 local.repo。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mv /etc/yum.repos.d/CentOS-* /home/</span><br><span class="line">[root@master ~]# vi /etc/yum.repos.d/local.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[paas]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[root@master ~]# yum repolist</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>④在 master 节点安装 ftp 服务，将 ftp 共享目录设置为 &#x2F;opt&#x2F;。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y vsftpd</span><br><span class="line">[root@master ~]# echo &quot;anon_root=/opt&quot; &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br><span class="line">[root@master ~]# systemctl enable --now vsftpd</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>⑤为 node1 节点和 node2 节点分别配置 ftp 源，yum 源文件名称为 ftp.repo，其中 ftp 服务器地址为 master 节点,配置 ftp 源时不要写 IP 地址，配置之后，两台机器都安装 kubectl 包作为安装测试。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mv /etc/yum.repos.d/CentOS-* /home/</span><br><span class="line">[root@localhost ~]# cat /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://master/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[paas]</span><br><span class="line">name=paas</span><br><span class="line">baseurl=ftp://master/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# yum install -y kubectl</span><br></pre></td></tr></table></figure>



<p>⑥在 master 节点上部署 chrony 服务器，允许其它节点同步时间，启动服务并设置为开机自启动；在其他节点上指定 master 节点为上游 NTP 服务器，重启服务并设为开机自启动。</p>
<p>master节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@master ~]# vi /etc/chrony.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server master iburst</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Record the rate at <span class="built_in">which</span> the system clock gains/losses <span class="keyword">time</span>.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow the system clock to be stepped <span class="keyword">in</span> the first three updates</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hwtimestamp *</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the system clock.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">minsources 2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow NTP client access from <span class="built_in">local</span> network.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">allow 192.168.0.0/16</span></span><br><span class="line">allow 192.168.157.0/24</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Serve <span class="keyword">time</span> even <span class="keyword">if</span> not synchronized to a <span class="keyword">time</span> <span class="built_in">source</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">local</span> stratum 10</span></span><br><span class="line">local stratum 10</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify file containing keys <span class="keyword">for</span> NTP authentication.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify directory <span class="keyword">for</span> <span class="built_in">log</span> files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Select <span class="built_in">which</span> information is logged.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">log</span> measurements statistics tracking</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#重启服务</span></span></span><br><span class="line">[root@localhost ~]# systemctl restart chronyd</span><br><span class="line">[root@localhost ~]# systemctl enable chronyd</span><br><span class="line">[root@localhost ~]# chronyc sources</span><br></pre></td></tr></table></figure>

<p>node节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/chrony.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server master iburst</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Record the rate at <span class="built_in">which</span> the system clock gains/losses <span class="keyword">time</span>.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow the system clock to be stepped <span class="keyword">in</span> the first three updates</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">if</span> its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">hwtimestamp *</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the system clock.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">minsources 2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Allow NTP client access from <span class="built_in">local</span> network.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">allow 192.168.0.0/16</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Serve <span class="keyword">time</span> even <span class="keyword">if</span> not synchronized to a <span class="keyword">time</span> <span class="built_in">source</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">local</span> stratum 10</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify file containing keys <span class="keyword">for</span> NTP authentication.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">keyfile /etc/chrony.keys</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specify directory <span class="keyword">for</span> <span class="built_in">log</span> files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Select <span class="built_in">which</span> information is logged.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">log</span> measurements statistics tracking</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#重启服务</span></span></span><br><span class="line">[root@localhost ~]# systemctl restart chronyd</span><br><span class="line">[root@localhost ~]# systemctl enable chronyd</span><br><span class="line">[root@localhost ~]# chronyc sources</span><br></pre></td></tr></table></figure>



<p>⑦为四台服务器设置免密登录，保证服务器之间能够互相免密登录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory &#x27;/root/.ssh&#x27;.</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:qveHAExYRiPQVv5rlsI3owC/pO72K9ZK+pOJFPnPfFQ root@node1</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|.o.=*            |</span><br><span class="line">|  ++..           |</span><br><span class="line">| ..o.            |</span><br><span class="line">| o  o.   E       |</span><br><span class="line">|. o  .. S        |</span><br><span class="line">| + o  .=         |</span><br><span class="line">|.o=o* @. .       |</span><br><span class="line">|+*++ @.+. .      |</span><br><span class="line">|B=*++.....       |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br><span class="line">[root@master ~]# ssh-copy-id root@node1</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@node1&#x27;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;root@node1&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">[root@master ~]# ssh-copy-id root@node2</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@node2&#x27;s password:</span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;root@node2&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">[root@master ~]# ssh-copy-id root@harbor</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@harbor&#x27;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;root@harbor&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="任务2-k8s-搭建任务"><a href="#任务2-k8s-搭建任务" class="headerlink" title="任务2  k8s 搭建任务"></a>任务2  k8s 搭建任务</h2><p>①在所有节点上安装dokcer-ce,并设置为开机自启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#所有节点</span></span></span><br><span class="line"></span><br><span class="line">[root@master ~]# yum install -y docker docker-ce</span><br><span class="line">[root@master ~]# systemctl enable --now docker</span><br></pre></td></tr></table></figure>



<p>②所有节点配置阿里云镜像加速地址(<a target="_blank" rel="noopener" href="https://7hw6x2is.mirror.aliyuncs.com)并把启动引擎设置为systemd,配置成功后加载配置文件并重启docker服务./">https://7hw6x2is.mirror.aliyuncs.com)并把启动引擎设置为systemd，配置成功后加载配置文件并重启docker服务。</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.157.53&quot;],</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://7hw6x2is.mirror.aliyuncs.com&quot;],</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@master ~]# systemctl restart docker</span><br></pre></td></tr></table></figure>



<p>③在master节点&#x2F;opt&#x2F;images目录下使用tar归档文件载入镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# for i in $(ls /opt/paas/images | grep tar) ; do docker load -i /opt/paas/images/$i ;done</span><br></pre></td></tr></table></figure>



<p>④在master节点使用 &#x2F;opt&#x2F;docker-compose&#x2F;v2.10.2-docker-compose-linux-x86_64文件安装docker-compose。安装完成后执行docker-compose version命令。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# cp -p /opt/paas/docker-compose/v1.25.5-docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>



<p>⑤在master节点解压&#x2F;opt&#x2F;harbor&#x2F; harbor-offline-installer-v2.5.3.tgz离线安装包，然后安装harbor仓库，并修改相应的yml文件，使各节点默认docker仓库为harbor仓库地址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@localhost opt]# tar -zxvf harbor-offline-installer-v2.1.0.tgz</span><br><span class="line">harbor/harbor.v2.1.0.tar.gz</span><br><span class="line">harbor/prepare</span><br><span class="line">harbor/LICENSE</span><br><span class="line">harbor/install.sh</span><br><span class="line">harbor/common.sh</span><br><span class="line">harbor/harbor.yml.tmpl</span><br><span class="line">[root@localhost opt]# cd harbor</span><br><span class="line">[root@localhost harbor]# ls</span><br><span class="line">common.sh  harbor.v2.1.0.tar.gz  harbor.yml.tmpl  install.sh  LICENSE  prepare</span><br><span class="line">[root@localhost harbor]# mv harbor.yml.tmpl harbor.yml</span><br><span class="line">[root@localhost harbor]# vi harbor.yml</span><br><span class="line">[root@harbor harbor]# cat harbor.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Configuration file of Harbor</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The IP address or hostname to access admin UI and registry service.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span></span><br><span class="line">hostname: 192.168.157.50   ##修改IP地址</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http related config</span></span><br><span class="line">http:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">port <span class="keyword">for</span> http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  port: 80</span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash"><span class="comment">##在此处注释掉https</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https related config</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">https:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">https port <span class="keyword">for</span> harbor, default is 443</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">port: 443</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">The path of cert and key files <span class="keyword">for</span> nginx</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">certificate: /your/certificate/path</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">private_key: /your/private/key/path</span></span><br><span class="line">........</span><br><span class="line">[root@localhost harbor]# ./prepare</span><br><span class="line">[root@harbor harbor]# ./install.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑥在master节点执行&#x2F;opt&#x2F;k8s_image_push.sh将所有镜像上传至docker仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@master paas]# ./k8s_image_push.sh</span><br><span class="line">输入镜像仓库地址(不加http/https): 192.168.157.53</span><br><span class="line">输入镜像仓库用户名: admin</span><br><span class="line">输入镜像仓库用户密码: Harbor12345</span><br><span class="line">您设置的仓库地址为: 192.168.157.53,用户名: admin,密码: xxx</span><br><span class="line">是否确认(Y/N): y</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">镜像仓库 Login Succeeded</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>⑦执行&#x2F;opt&#x2F;k8s_con_ner_bui_install.sh部署Kubeadm、containerd、nerdctl和buildkit。</strong></p>
<p>##此处只安装kubectl kubeadm kubelet即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# yum install -y kubelet kubeadm kubectl</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#开机自启</span></span></span><br><span class="line">[root@localhost ~]# systemctl enable --now kubelet</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kubelet.service to /usr/lib/systemd/system/kubelet.service.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑧在master节点kubeadm命令初始化集群，使用本地Harbor仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubeadm init --apiserver-advertise-address 192.168.157.50 --pod-network-cidr 10.244.0.0/16 --kubernetes-version 1.18.1 --image-repository 192.168.157.50/library/</span><br><span class="line">[root@localhost ~]# mkdir -p $HOME/.kube</span><br><span class="line">[root@localhost ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">[root@localhost ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure>



<p>⑨修改提供的&#x2F;opt&#x2F;yaml&#x2F;flannel&#x2F;kube-flannel.yaml,使其镜像来源为本地Harbor仓库，然后安装kubernetes网络插件，安装完成后使用命令查看节点状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">eval</span> sed -i <span class="string">&#x27;s@docker.io/flannel@192.168.157.50/library@g&#x27;</span> /opt/paas/yaml/flannel/kube-flannel.yaml</span></span><br><span class="line">[root@master ~]# kubectl apply -f /opt/paas/yaml/flannel/kube-flannel.yaml</span><br><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES           AGE     VERSION</span><br><span class="line">master   Ready   control-plane   9m42s   v1.18.1</span><br></pre></td></tr></table></figure>



<p>⑩给kubernetes创建证书,命名空间为kubernetes-dashboard,涉及到的所有文件命名为dashboard例如dashboard.crt。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mkdir dashboard-certs</span><br><span class="line">[root@master ~]# cd dashboard-certs/</span><br><span class="line">[root@master ~]# kubectl create namespace kubernetes-dashboard</span><br><span class="line">[root@master ~]# openssl genrsa -out dashboard.key 2048</span><br><span class="line">[root@master ~]# openssl req -days 36000 -new -out dashboard.csr -key dashboard.key -subj &#x27;/CN=dashboard-cert&#x27;</span><br><span class="line">[root@master ~]# openssl x509 -req -in dashboard.csr -signkey dashboard.key -out dashboard.crt</span><br><span class="line">[root@master ~]# kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard</span><br><span class="line">[root@master ~]# sed -i &quot;s/kubernetesui/$IP\/library/g&quot; /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">[root@master ~]# kubectl apply -f /opt/paas/yaml/dashboard/recommended.yaml</span><br><span class="line">[root@master ~]# kubectl apply -f /opt/paas/yaml/dashboard/dashboard-adminuser.yaml</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>11修改&#x2F;opt&#x2F;yaml&#x2F;dashboard&#x2F;recommended.yaml的镜像来源为本地Harbor仓库，然后使用&#x2F;opt&#x2F;yaml&#x2F;dashboard&#x2F;recommended.yaml和&#x2F;opt&#x2F;yaml&#x2F;dashboard&#x2F;dashboard-adminuser.yaml安装kubernetes dashboard界面，完成后查看首页。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# eval sed -i &quot;s/kubernetesui/192.168.157.50\/library/g&quot; /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">[root@master ~]# kubectl apply -f /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">[root@master ~]# kubectl apply -f /opt/yaml/dashboard/dashadmin-user.yaml</span><br><span class="line">[root@master ~]# kubectl get svc -n kubernetes-dashboard</span><br><span class="line">NAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.105.211.63    &lt;none&gt;        8000/TCP        23m</span><br><span class="line">kubernetes-dashboard        NodePort    10.104.143.162   &lt;none&gt;        443:30001/TCP   23m</span><br></pre></td></tr></table></figure>



<p>12为了能使pod调度到master节点,用命令删除污点。在浏览器访问dashboard（<a href="https://IP:30001）">https://IP:30001）</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe nodes master | grep Taints</span></span><br><span class="line">kubectl taint nodes master node-role.kubernetes.io/control-plane-</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe nodes master | grep Taints</span></span><br><span class="line">Taints:             &lt;none&gt;</span><br></pre></td></tr></table></figure>



<p>13在node节点执行k8s_node_install.sh，将该节点加入kubernetes集群。完成后在master节点上查看所有节点状态。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#此处在kubeadm init 最后一条</span></span></span><br><span class="line">kubeadm join 192.168.157.51:6443 --token s6fq1p.kmluoke4b9qp7hdi \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:1d2867c654a33891b6077357bfb6d1e4babfb2e04f834944fcbad83f05d1bdc3</span><br></pre></td></tr></table></figure>



<h2 id="任务3部署Owncloud网盘服务"><a href="#任务3部署Owncloud网盘服务" class="headerlink" title="任务3部署Owncloud网盘服务"></a>任务3部署Owncloud网盘服务</h2><p>①编写yaml文件(文件名自定义)创建PV和PVC来提供持久化存储，以便保存 ownCloud 服务中的文件和数据。要求：PV（访问模式为读写，只能被单个节点挂载;存储为5Gi;存储类型为hostPath,存储路径自定义）PVC（访问模式为读写，只能被单个节点挂载;申请存储空间大小为5Gi）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> owncloud-pvc.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-pv</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 5Gi</span><br><span class="line">  hostPath:</span><br><span class="line">    path: /data/owncloud</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-pvc</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f /opt/owncloud-pvc.yaml</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get pv,pvc</span></span><br><span class="line">NAME                           CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   REASON   AGE</span><br><span class="line">persistentvolume/owncloud-pv   5Gi        RWO            Retain           Bound    default/owncloud-pvc                           2m41s</span><br><span class="line">NAME                                 STATUS   VOLUME        CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">persistentvolumeclaim/owncloud-pvc   Bound    owncloud-pv   5Gi        RWO                           2m41s</span><br></pre></td></tr></table></figure>



<p>②编写yaml文件(文件名自定义)创建一个configMap对象，指定OwnCloud的环境变量。登录账号对应的环境变量为OWNCLOUD_ADMIN_USERNAME,密码对应的环境变量为OWNCLOUD_ADMIN_PASSWORD。（变量值自定义）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> owncloud-configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-config</span><br><span class="line">data:</span><br><span class="line">  OWNCLOUD_ADMIN_USERNAME: “admin”</span><br><span class="line">  OWNCLOUD_ADMIN_PASSWORD: “123456”</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f  owncloud-configmap.yaml</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl get ConfigMap</span></span><br><span class="line">NAME               DATA   AGE</span><br><span class="line">kube-root-ca.crt   1      20h</span><br><span class="line">owncloud-config    2      2m11s</span><br></pre></td></tr></table></figure>



<p>③编写yaml文件(文件名自定义)创建一个Secret对象，以保存OwnCloud数据库的密码。对原始密码采用base64编码格式进行加密。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> 123456 | <span class="built_in">base64</span></span></span><br><span class="line">MTIzNDU2Cg==</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> owncloud-secret.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-db-password</span><br><span class="line">type: Opaque</span><br><span class="line">data:</span><br><span class="line">  password: MTIzNDU2Cg==</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f /opt/owncloud-secret.yaml</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kubectl get Secret</span></span><br><span class="line">NAME                   TYPE     DATA   AGE</span><br><span class="line">owncloud-db-password   Opaque   1      46s</span><br></pre></td></tr></table></figure>



<p>④编写yaml文件(文件名自定义) 创建Deployment对象, 指定OwnCloud的容器和相关的环境变量。(Deployment资源命名为owncloud-deployment,镜像为Harbor仓库中的owncloud:latest，存储的挂载路径为&#x2F;var&#x2F;www&#x2F;html,其它根据具体情况进行配置)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> owncloud-deploy.yaml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-deployment</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: owncloud</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: owncloud</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: owncloud</span><br><span class="line">        image: 192.168.100.91/library/owncloud:latest</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        envFrom:</span><br><span class="line">        - configMapRef:</span><br><span class="line">            name: owncloud-config</span><br><span class="line">        env:</span><br><span class="line">        - name: OWNCLOUD_DB_PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: owncloud-db-password</span><br><span class="line">              key: password</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: owncloud-pv</span><br><span class="line">          mountPath: /var/www/html</span><br><span class="line">      volumes:</span><br><span class="line">      - name: owncloud-pv</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: owncloud-pvc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f /opt/owncloud-deploy.yaml</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl describe pod</span></span><br><span class="line">Name:             owncloud-deployment-845c85cfcb-6ptqr</span><br><span class="line">Namespace:        default</span><br><span class="line">Priority:         0</span><br><span class="line">Service Account:  default</span><br><span class="line">Node:             node/192.168.100.23</span><br><span class="line">Start Time:       Fri, 17 Mar 2023 02:56:31 +0000</span><br><span class="line">Labels:           app=owncloud</span><br><span class="line">                  pod-template-hash=845c85cfcb</span><br><span class="line">Annotations:      &lt;none&gt;</span><br><span class="line">Status:           Running</span><br><span class="line">IP:               10.244.1.3</span><br><span class="line">IPs:</span><br><span class="line">  IP:           10.244.1.3</span><br><span class="line">Controlled By:  ReplicaSet/owncloud-deployment-845c85cfcb</span><br><span class="line">Containers:</span><br><span class="line">  owncloud:</span><br><span class="line">    Container ID:   containerd://d60dc4426c06cef6525e4e37f0ee37dcef762c2806c19efcd666f951d66a5c84</span><br><span class="line">    Image:          192.168.100.91/library/owncloud:latest</span><br><span class="line">    Image ID:       192.168.100.91/library/owncloud@sha256:5c77bfdf8cfaf99ec94309be2687032629f4f985d6bd388354dfd85475aa5f21</span><br><span class="line">    Port:           80/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 17 Mar 2023 02:56:39 +0000</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment Variables from:</span><br><span class="line">      owncloud-config  ConfigMap  Optional: false</span><br><span class="line">    Environment:</span><br><span class="line">      OWNCLOUD_DB_PASSWORD:  &lt;set to the key &#x27;password&#x27; in secret &#x27;owncloud-db-password&#x27;&gt;  Optional: false</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-vtpd9 (ro)</span><br><span class="line">      /var/www/html from owncloud-pv (rw)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  owncloud-pv:</span><br><span class="line">    Type:       PersistentVolumeClaim (a reference to a PersistentVolumeClaim in the same namespace)</span><br><span class="line">    ClaimName:  owncloud-pvc</span><br><span class="line">    ReadOnly:   false</span><br><span class="line">  kube-api-access-vtpd9:</span><br><span class="line">    Type:                    Projected (a volume that contains injected data from multiple sources)</span><br><span class="line">    TokenExpirationSeconds:  3607</span><br><span class="line">    ConfigMapName:           kube-root-ca.crt</span><br><span class="line">    ConfigMapOptional:       &lt;nil&gt;</span><br><span class="line">    DownwardAPI:             true</span><br><span class="line">QoS Class:                   BestEffort</span><br><span class="line">Node-Selectors:              &lt;none&gt;</span><br><span class="line">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span><br><span class="line">                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  14m   default-scheduler  Successfully assigned default/owncloud-deployment-845c85cfcb-6ptqr to node</span><br><span class="line">  Normal  Pulling    14m   kubelet            Pulling image &quot;192.168.100.91/library/owncloud:latest&quot;</span><br><span class="line">  Normal  Pulled     14m   kubelet            Successfully pulled image &quot;192.168.100.91/library/owncloud:latest&quot; in 7.266482912s</span><br><span class="line">  Normal  Created    14m   kubelet            Created container owncloud</span><br><span class="line">  Normal  Started    14m   kubelet            Started container owncloud</span><br></pre></td></tr></table></figure>



<p>⑤编写yaml文件(文件名自定义)创建一个Service对象将OwnCloud公开到集群外部。通过<a target="_blank" rel="noopener" href="http://ip/">http://IP</a>:端口号可查看owncloud.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> owncloud-svc.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: owncloud-service</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: owncloud</span><br><span class="line">  ports:</span><br><span class="line">    - name: http</span><br><span class="line">      port: 80</span><br><span class="line">  type: NodePort</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubectl apply -f /opt/owncloud-svc.yaml</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kubectl get svc -A</span></span><br><span class="line">NAMESPACE              NAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE</span><br><span class="line">default                kubernetes                  ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP                  24h</span><br><span class="line">default                owncloud-service            NodePort    10.98.228.242    &lt;none&gt;        80:31024/TCP             17m</span><br><span class="line">kube-system            kube-dns                    ClusterIP   10.96.0.10       &lt;none&gt;        53/UDP,53/TCP,9153/TCP   24h</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper   ClusterIP   10.105.211.63    &lt;none&gt;        8000/TCP                 22h</span><br><span class="line">kubernetes-dashboard   kubernetes-dashboard        NodePort    10.104.143.162   &lt;none&gt;        443:30001/TCP            22h</span><br></pre></td></tr></table></figure>

<h1 id="C模块：企业级应用的自动化部署和运维（样题）"><a href="#C模块：企业级应用的自动化部署和运维（样题）" class="headerlink" title="C模块：企业级应用的自动化部署和运维（样题）"></a>C模块：企业级应用的自动化部署和运维（样题）</h1><p>zabbix是一个基于<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/WEB/150564?fromModule=lemma_inlink">WEB</a>界面的提供分布式系统监视以及<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E7%9B%91%E8%A7%86/14894884?fromModule=lemma_inlink">网络监视</a>功能的企业级的开源解决方案。zabbix能监视各种<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E5%8F%82%E6%95%B0/4474943?fromModule=lemma_inlink">网络参数</a>，保证<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%B3%BB%E7%BB%9F/2997788?fromModule=lemma_inlink">服务器系统</a>的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AE%89%E5%85%A8%E8%BF%90%E8%90%A5/59181998?fromModule=lemma_inlink">安全运营</a>；并提供灵活的通知机制以让<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98/1503845?fromModule=lemma_inlink">系统管理员</a><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D/8872413?fromModule=lemma_inlink">快速定位</a>&#x2F;解决存在的各种问题。zabbix由2部分构成，zabbix <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/server/8873208?fromModule=lemma_inlink">server</a>与可选组件zabbix agent。</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>节点</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.157.40</td>
<td>zabbix-server</td>
<td>Server节点</td>
</tr>
<tr>
<td>192.168.157.41</td>
<td>zabbix-agent</td>
<td>Agent节点</td>
</tr>
</tbody></table>
<p>部署方式：监控主机zabbix_server节点采用手动部署，被监控主机zabbix_agent采用Playbook部署。</p>
<p><strong>注意 压缩包需要解压后配置为yum仓库可以使用</strong></p>
<p>①修改主机名zabbix_server节点主机名为zabbix_server,zabbix_agent节点主机名为Zabbix_agent,使用提供的软件包&#x2F;root&#x2F;autoDeployment.tar在zabbix_server节点安装ansible.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname zabbix-server  </span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname zabbix-agent</span><br></pre></td></tr></table></figure>

<p>②在zabbix_server节点配置hosts文件，并将该文件远程发送给zabbix_agent节点，并配置免密登录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:r7ZDne6h3xaK6zVevWSj77paApHMV6RAXHzH2s78cMc root@zabbix-agent</span><br><span class="line">The key&#x27;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|       ooo..o.   |</span><br><span class="line">|       o.o.o. o  |</span><br><span class="line">|        = o. +   |</span><br><span class="line">|         o  . .  |</span><br><span class="line">|        S. . + . |</span><br><span class="line">|        .oo ..= E|</span><br><span class="line">|       . o*.o.=+.|</span><br><span class="line">|        +=oB.+ o.|</span><br><span class="line">|       o**=o==+  |</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line">[root@localhost ~]# ssh-copy-id root@zabbix-agent</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">The authenticity of host &#x27;192.168.157.40 (192.168.157.40)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:EWGohbn7cIhP7AAYHbnuMx/IoLAEybzPJENWQazAFG4.</span><br><span class="line">ECDSA key fingerprint is MD5:81:d6:a5:02:87:4b:13:1b:eb:69:76:1c:5c:aa:80:bf.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@192.168.157.40&#x27;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;root@192.168.157.40&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>③在Zabbix_server节点配置ansible主机清单，在清单中创建agent主机组。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix-server ~]# cat /etc/ansible/hosts</span><br><span class="line">[agent]</span><br><span class="line">zabbix-agent</span><br></pre></td></tr></table></figure>



<p>④配置基础环境，安装nginx和php74（根据实际需要安装相关php74扩展包），并开启相关服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix_server opt]# yum -y install nginx</span><br><span class="line">[root@zabbix_server ~]# systemctl start nginx</span><br><span class="line">[root@zabbix_server ~]# yum -y install php74-php-fpm php74-php-common php74-php-cli php74-php-gd php74-php-ldap php74-php-mbstring php74-php-mysqlnd php74-php-xml php74-php-bcmath php74-php</span><br><span class="line">[root@zabbix_server ~]#systemctl start php74-php-fpm</span><br><span class="line">[root@zabbix_server ~]#  nginx -v &amp;&amp; php74 -v</span><br><span class="line">nginx version: nginx/1.22.1</span><br><span class="line">PHP 7.4.33 (cli) (built: Feb 14 2023 08:49:52) ( NTS )</span><br><span class="line">Copyright (c) The PHP Group</span><br><span class="line">Zend Engine v3.4.0, Copyright (c) Zend Technologies</span><br></pre></td></tr></table></figure>



<p>⑤在zabbix_server节点安装zabbix服务器、代理和web前端，安装前注意查看rpm包的名字,并分别启动zabbix-server和zabbix-agent。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum -y install zabbix-server  zabbix-web-mysql zabbix-agent</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl start zabbix-server&amp;&amp; systemctl start zabbix-agent</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl status zabbix-server&amp;&amp; systemctl status zabbix-agent</span></span><br><span class="line">● zabbix-server-mysql.service - Zabbix Server with MySQL DB</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/zabbix-server-mysql.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2023-03-18 04:36:50 UTC; 4min 5s ago</span><br><span class="line"> Main PID: 20737 (zabbix_server)</span><br><span class="line">   CGroup: /system.slice/zabbix-server-mysql.service</span><br><span class="line">           └─20737 /usr/sbin/zabbix_server -f</span><br><span class="line"></span><br><span class="line">Mar 18 04:36:50 zabbix_server systemd[1]: Started Zabbix Serve...</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line">● zabbix-agent.service - Zabbix Agent</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/zabbix-agent.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2023-03-18 04:37:47 UTC; 3min 8s ago</span><br><span class="line">  Process: 20752 ExecStart=/usr/sbin/zabbix_agentd -c $CONFFILE (code=exited, status=0/SUCCESS)</span><br><span class="line">  Main PID: 20754 (zabbix_agentd)</span><br><span class="line">   CGroup: /system.slice/zabbix-agent.service</span><br><span class="line">           ├─20754 /usr/sbin/zabbix_agentd -c /etc/zabbix/zabb...</span><br><span class="line">           ├─20755 /usr/sbin/zabbix_agentd: collector [idle 1 ...</span><br><span class="line">           ├─20756 /usr/sbin/zabbix_agentd: listener #1 [waiti...</span><br><span class="line">           ├─20757 /usr/sbin/zabbix_agentd: listener #2 [waiti...</span><br><span class="line">           ├─20758 /usr/sbin/zabbix_agentd: listener #3 [waiti...</span><br><span class="line">           └─20759 /usr/sbin/zabbix_agentd: active checks #1 [...</span><br><span class="line"></span><br><span class="line">Mar 18 04:37:47 zabbix_server systemd[1]: Starting Zabbix Agen...</span><br><span class="line">Mar 18 04:37:47 zabbix_server systemd[1]: Started Zabbix Agent.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>



<p>⑥安装数据库MariaDB，启动数据库并设置为开机自启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yum -y install mariadb-server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">enable</span> --now mariadb</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl status mariadb</span></span><br><span class="line">● mariadb.service - MariaDB database server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2023-03-18 04:52:20 UTC; 1min 2s ago</span><br><span class="line">  Process: 20907 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 20822 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 20905 (mysqld_safe)</span><br><span class="line">   CGroup: /system.slice/mariadb.service</span><br><span class="line">           ├─20905 /bin/sh /usr/bin/mysqld_safe --basedir=/usr...</span><br><span class="line">           └─21071 /usr/libexec/mysqld --basedir=/usr --datadi...</span><br><span class="line"></span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: M...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: P...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: T...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: Y...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: h...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: C...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mariadb-prepare-db-dir[20822]: h...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mysqld_safe[20905]: 230318 04:52...</span><br><span class="line">Mar 18 04:52:18 zabbix_server mysqld_safe[20905]: 230318 04:52...</span><br><span class="line">Mar 18 04:52:20 zabbix_server systemd[1]: Started MariaDB data...</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br></pre></td></tr></table></figure>



<p>⑦登录mysql,创建数据库zabbix和用户zabbix密码自定义，并授权zabbix用户拥有zabbix数据库的所有权限。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql -uroot -p</span></span><br><span class="line">MariaDB [(none)]&gt; create database zabbix charset utf8 collate utf8_bin;;</span><br><span class="line">MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &#x27;password&#x27;;</span><br><span class="line">MariaDB [zabbix]&gt; show grants for &#x27;zabbix&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants for zabbix@localhost                                                                                   |</span><br><span class="line">+---------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO &#x27;zabbix&#x27;@&#x27;localhost&#x27; IDENTIFIED BY PASSWORD &#x27;*2470C0C06DEE42FD1618BB99005ADCA2EC9D1E19&#x27; |</span><br><span class="line">| GRANT ALL PRIVILEGES ON `zabbix`.* TO &#x27;zabbix&#x27;@&#x27;localhost&#x27;</span><br></pre></td></tr></table></figure>



<p>⑧分别导入数据库架构及数据，对应的文件分别为schema.sql、images.sql和data.sql（文件顺便不能乱）。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">导入zabbix SQL</span></span><br><span class="line">[root@zabbix-server ~]# zcat /usr/share/doc/zabbix-server-mysql-4.0.24/create.sql.gz | mysql -uroot -p123456 zabbix</span><br></pre></td></tr></table></figure>



<p>⑨配置default.conf。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/default.conf</span><br><span class="line">修改内容如下</span><br><span class="line">root /usr/share/zabbix/;</span><br><span class="line">index index.php index.html index.htm;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">cat</span> /etc/nginx/conf.d/default.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">access_log /var/log/nginx/host.access.log main;</span></span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">root /usr/share/zabbix/;</span><br><span class="line">index index.php index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_page 404 /404.html;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redirect server error pages to the static page /50x.html</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">error_page 500 502 503 504 /50x.html;</span></span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#location ~ \.php$ &#123;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">proxy_pass http://127.0.0.1;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">location ~ \.php$ &#123;</span></span><br><span class="line">	root /usr/share/zabbix;</span><br><span class="line">	fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">	fastcgi_index index.php;</span><br><span class="line">	fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">	include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deny access to .htaccess files, <span class="keyword">if</span> Apache<span class="string">&#x27;s document root</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">concurs with nginx&#x27;</span>s one</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#location ~ /\.ht &#123;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">deny all;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>⑩分别修改配置文件zabbix_server.conf(修改数据库密码)和zabbix_agentd.conf（修改服务器IP，活动服务器IP和主机名），并重启对应服务使配置生效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix_server ~]# vim /etc/zabbix_server.conf</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=password</span><br><span class="line">[root@zabbix_server ~]# vim /etc/zabbix_agentd.conf</span><br><span class="line">Server=192.168.157.40</span><br><span class="line">ServerActive=192.168.157.40</span><br><span class="line">Hostname=zabbix_server</span><br><span class="line">[root@zabbix_server ~]# cat /etc/zabbix_agentd.conf | grep -v &#x27;^#\|^$&#x27;</span><br><span class="line">PidFile=/run/zabbix/zabbix_agentd.pid</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_agentd.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=192.168.100.91</span><br><span class="line">ServerActive=192.168.100.91</span><br><span class="line">Hostname=zabbix_server</span><br><span class="line">[root@master ~]# systemctl restart zabbix-server</span><br><span class="line">[root@master ~]# systemctl restart zabbix-agent</span><br></pre></td></tr></table></figure>



<p>11修改php.ini文件,其中最大POST数据限制为16M,程序执行时间限制为300，PHP页面接受数据所需最大时间限制为300，把时区设为Asia&#x2F;Shanghai,并重启相关服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix_server ~]# vim /etc/php.ini</span><br><span class="line">post_max_size = 16M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">[root@zabbix_server ~]# systemctl restart php74-php-fpm</span><br></pre></td></tr></table></figure>



<p>12修改<a target="_blank" rel="noopener" href="http://www.conf/">www.conf</a>文件,把用户和组都设置为nginx.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> [root@zabbix_server ~]# vim /etc/php-fpm.d/www.conf</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">[root@zabbix_server ~]# cat /etc/php-fpm.d/www.conf | grep -v &#x27;^;\|^$&#x27;</span><br><span class="line">[www]</span><br><span class="line">listen = 127.0.0.1:9000</span><br><span class="line"> </span><br><span class="line">listen.allowed_clients = 127.0.0.1</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">pm = dynamic</span><br><span class="line">pm.max_children = 50</span><br><span class="line">pm.start_servers = 5</span><br><span class="line">pm.min_spare_servers = 5</span><br><span class="line">pm.max_spare_servers = 35</span><br><span class="line">slowlog = /var/log/php-fpm/www-slow.log</span><br><span class="line">php_admin_value[error_log] = /var/log/php-fpm/www-error.log</span><br><span class="line">php_admin_flag[log_errors] = on</span><br><span class="line">php_value[session.save_handler] = files</span><br><span class="line">php_value[session.save_path] = /var/lib/php/session</span><br></pre></td></tr></table></figure>





<p>13修改zabbix.conf文件,把用户和组都设置为nginx,并将index.php所在的目录和php.ini文件拥有者和用户组改为nginx。重启相关服务，在浏览器中输入http:&#x2F;&#x2F;公网IP&#x2F; setup.php即可看到zabbix 6.0界面。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/php-fpm.d/zabbix.conf</span><br><span class="line">[zabbix]</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">[root@zabbix_server ~]# chown -R nginx:nginx /usr/share/zabbix/</span><br><span class="line">[root@zabbix_server ~]# chown -R nginx:nginx /etc/opt/remi/php74/php.ini</span><br><span class="line">[root@zabbix_server ~]# chmod +x /usr/share/zabbix</span><br><span class="line">[root@zabbix_server ~]# systemctl restart nginx</span><br><span class="line">[root@zabbix_server ~]# systemctl restart zabbix-server</span><br><span class="line">[root@zabbix_server ~]# systemctl restart zabbix-agent</span><br><span class="line">[root@zabbix_server ~]# systemctl restart php74-php-fpm </span><br><span class="line">[root@zabbix_server ~]# curl http://123.249.10.60/setup.php</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">       &lt;head&gt;</span><br><span class="line">              &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=Edge&quot;/&gt;</span><br><span class="line">              &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">              &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">              &lt;meta name=&quot;Author&quot; content=&quot;Zabbix SIA&quot; /&gt;</span><br><span class="line">              &lt;title&gt;Installation&lt;/title&gt;</span><br><span class="line">              &lt;link rel=&quot;icon&quot; href=&quot;favicon.ico&quot;&gt;</span><br><span class="line">              &lt;link rel=&quot;apple-touch-icon-precomposed&quot; sizes=&quot;76x76&quot; href=&quot;assets/img/apple-touch-icon-76x76-precomposed.png&quot;&gt;</span><br><span class="line">              &lt;link rel=&quot;apple-touch-icon-precomposed&quot; sizes=&quot;120x120&quot; href=&quot;assets/img/apple-touch-icon-120x120-precomposed.png&quot;&gt;</span><br><span class="line">              &lt;link rel=&quot;apple-touch-icon-precomposed&quot; sizes=&quot;152x152&quot; href=&quot;assets/img/apple-touch-icon-152x152-precomposed.png&quot;&gt;</span><br><span class="line">              &lt;link rel=&quot;apple-touch-icon-precomposed&quot; sizes=&quot;180x180&quot; href=&quot;assets/img/apple-touch-icon-180x180-precomposed.png&quot;&gt;</span><br><span class="line">              &lt;link rel=&quot;icon&quot; sizes=&quot;192x192&quot; href=&quot;assets/img/touch-icon-192x192.png&quot;&gt;</span><br><span class="line">              &lt;meta name=&quot;csrf-token&quot; content=&quot;5d4324e81318a310&quot;/&gt;</span><br><span class="line">              &lt;meta name=&quot;msapplication-TileImage&quot; content=&quot;assets/img/ms-tile-144x144.png&quot;&gt;</span><br><span class="line">              &lt;meta name=&quot;msapplication-TileColor&quot; content=&quot;#d40000&quot;&gt;</span><br><span class="line">              &lt;meta name=&quot;msapplication-config&quot; content=&quot;none&quot;/&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;assets/styles/blue-theme.css?1675235994&quot; /&gt;</span><br><span class="line">&lt;script src=&quot;js/browsers.js?1674462826&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;jsLoader.php?ver=6.0.13&amp;amp;lang=en_US&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=&quot;jsLoader.php?ver=6.0.13&amp;amp;lang=en_US&amp;amp;files%5B0%5D=setup.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;div class=&quot;wrapper&quot;&gt;&lt;main&gt;&lt;form method=&quot;post&quot; action=&quot;setup.php&quot; accept-charset=&quot;utf-8&quot; id=&quot;setup-form&quot;&gt;&lt;div class=&quot;setup-container&quot;&gt;&lt;div class=&quot;setup-left&quot;&gt;&lt;div class=&quot;setup-logo&quot;&gt;&lt;div class=&quot;zabbix-logo&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;ul&gt;&lt;li class=&quot;setup-left-current&quot;&gt;Welcome&lt;/li&gt;&lt;li&gt;Check of pre-requisites&lt;/li&gt;&lt;li&gt;Configure DB connection&lt;/li&gt;&lt;li&gt;Settings&lt;/li&gt;&lt;li&gt;Pre-installation summary&lt;/li&gt;&lt;li&gt;Install&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;div class=&quot;setup-right&quot;&gt;&lt;div class=&quot;setup-right-body&quot;&gt;&lt;div class=&quot;setup-title&quot;&gt;&lt;span&gt;Welcome to&lt;/span&gt;Zabbix 6.0&lt;/div&gt;&lt;ul class=&quot;table-forms&quot;&gt;&lt;li&gt;&lt;div class=&quot;table-forms-td-left&quot;&gt;&lt;label for=&quot;label-default-lang&quot;&gt;Default language&lt;/label&gt;&lt;/div&gt;&lt;div class=&quot;table-forms-td-right&quot;&gt;&lt;z-select id=&quot;default-lang&quot; value=&quot;en_US&quot; focusable-element-id=&quot;label-default-lang&quot; autofocus=&quot;autofocus&quot; name=&quot;default_lang&quot; data-options=&quot;[&#123;&amp;quot;value&amp;quot;:&amp;quot;en_GB&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;English (en_GB)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;en_US&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;English (en_US)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;ca_ES&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Catalan (ca_ES)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;zh_CN&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Chinese (zh_CN)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;cs_CZ&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Czech (cs_CZ)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;fr_FR&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;French (fr_FR)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;de_DE&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;German (de_DE)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;he_IL&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Hebrew (he_IL)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;it_IT&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Italian (it_IT)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;ko_KR&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Korean (ko_KR)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;ja_JP&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Japanese (ja_JP)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;nb_NO&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Norwegian (nb_NO)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;pl_PL&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Polish (pl_PL)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;pt_BR&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Portuguese (pt_BR)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;pt_PT&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Portuguese (pt_PT)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;ro_RO&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Romanian (ro_RO)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;ru_RU&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Russian (ru_RU)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;sk_SK&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Slovak (sk_SK)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;tr_TR&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Turkish (tr_TR)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;uk_UA&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Ukrainian (uk_UA)&amp;quot;&#125;,&#123;&amp;quot;value&amp;quot;:&amp;quot;vi_VN&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;Vietnamese (vi_VN)&amp;quot;&#125;]&quot; tabindex=&quot;-1&quot;&gt;&lt;/z-select&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;setup-footer&quot;&gt;&lt;div&gt;&lt;button type=&quot;submit&quot; id=&quot;next_1&quot; name=&quot;next[1]&quot; value=&quot;Next step&quot;&gt;Next step&lt;/button&gt;&lt;button type=&quot;submit&quot; id=&quot;back_1&quot; name=&quot;back[1]&quot; value=&quot;Back&quot; class=&quot;btn-alt float-left&quot; disabled=&quot;disabled&quot;&gt;Back&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/form&gt;&lt;div class=&quot;signin-links&quot;&gt;Licensed under &lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; class=&quot;grey link-alt&quot; href=&quot;https://www.zabbix.com/license&quot;&gt;GPL v2&lt;/a&gt;&lt;/div&gt;&lt;/main&gt;&lt;footer role=&quot;contentinfo&quot;&gt;Zabbix 6.0.13. &amp;copy; 2001&amp;ndash;2023, &lt;a class=&quot;grey link-alt&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://www.zabbix.com/&quot;&gt;Zabbix SIA&lt;/a&gt;&lt;/footer&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p>14随机找一目录，在其下分别创建tasks和file目录，把autoDeployment.tar、编写好的repo文件和zabbix_agentd.conf传至file目录，在tasks目录下编写agent.yaml文件，要求在被监控机能远程部署zabbix-agent服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@zabbix_server opt]# cat agent.yaml</span><br><span class="line">---</span><br><span class="line">- hosts: agent</span><br><span class="line">  become: true</span><br><span class="line">  tasks:</span><br><span class="line">  - name: copy local.repo</span><br><span class="line">    copy:</span><br><span class="line">      src: local.repo</span><br><span class="line">      dest: /etc/yum.repos.d/local.repo</span><br><span class="line">  - name: Copy autoDeployment.tar</span><br><span class="line">    copy:</span><br><span class="line">      src: autoDeployment.tar</span><br><span class="line">      dest: /opt</span><br><span class="line">  - name: Copy zabbix_agentd.conf file</span><br><span class="line">    copy:</span><br><span class="line">      src: zabbix_agentd.conf</span><br><span class="line">      dest: /etc/zabbix/zabbix_agentd.conf</span><br><span class="line">      owner: zabbix</span><br><span class="line">      group: zabbix</span><br><span class="line">      mode: &#x27;0644&#x27;</span><br><span class="line">  - name: tar autoDeployment.tar</span><br><span class="line">    shell:</span><br><span class="line">      cmd: tar -vxf autoDeployment.tar  -C /opt</span><br><span class="line">  - name: Install Zabbix Agent</span><br><span class="line">    yum:</span><br><span class="line">      name: zabbix-agent</span><br><span class="line">      state: present</span><br><span class="line">  - name: Start and enable Zabbix Agent</span><br><span class="line">    service:</span><br><span class="line">      name: zabbix-agent</span><br><span class="line">      state: started</span><br><span class="line">      enabled: true</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz">GoldY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz/posts/c134dd26.html">https://www.geekgold.xyz/posts/c134dd26.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.geekgold.xyz" target="_blank">GoldY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/">云计算职业技能大赛</a></div><div class="post-share"><div class="social-share" data-image="/img/cloud-com.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.jpg" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/2c8237f4.html" title="云计算方向-2022年云计算技能国赛私有云套题"><img class="cover" src="/img/cloud-com.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">云计算方向-2022年云计算技能国赛私有云套题</div></div><div class="info-2"><div class="info-item-1">第一套私有云运维任务：题目3. OpenStack云平台运维（10分）1.使用提供的云安全框架组件，将提供的OpenStack云平台的安全策略从http优化至https。可能会遇到 mod_ssl 安装不成功的问题，原因是mod_ssl版本不匹配，上传mod_ssl-2.4.6-97.el7.centos.x86_64.rpm ①安装工具包 1yum install -y mod_wsgi httpd mod_ssl  ②修改&#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings文件 123456vi /etc/openstack-dashboard/local_settings##在DEBUG = False下增加4行USE_SSL = TrueCSRF_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_HTTPONLY =...</div></div></div></a><a class="pagination-related" href="/posts/840d388d.html" title="云计算方向-2023年金砖大赛山东选拔题"><img class="cover" src="/img/cloud-com.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">云计算方向-2023年金砖大赛山东选拔题</div></div><div class="info-2"><div class="info-item-1">A场次题目：OpenStack平台部署与运维业务场景： 某企业拟使用OpenStack搭建一个企业云平台，用于部署各类企业应用对外对内服务。云平台可实现IT资源池化，弹性分配，集中管理，性能优化以及统一安全认证等。系统结构如下图： 企业云平台的搭建使用竞赛平台提供的两台云服务器，配置如下表：    设备名称 主机名 接口 ip地址    云服务器1 controller eth0，eth1 私网：192.168.100.10&#x2F;24           私网：192.168.200.10&#x2F;24   云服务器2 compute eth0，eth1 私网：192.168.100.20&#x2F;24        ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/6bf8b7d7.html" title="云计算方向-2022年云计算职业技能大赛国赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2022年云计算职业技能大赛国赛题</div></div><div class="info-2"><div class="info-item-1">第一套【任务 1】私有云服务搭建[10分]【题目 1】基础环境配置[0.5 分]使用提供的用户名密码，登录提供的 OpenStack 私有云平台，在当前租户下，使用CentOS7.9 镜像，创建两台云主机，云主机类型使用 4vCPU&#x2F;12G&#x2F;100G_50G 类型。当前租户下默认存在一张网卡，自行创建第二张网卡并连接至 controller 和 compute 节点（第二张网卡的网段为 10.10.X.0&#x2F;24，X 为工位号，不需要创建路由）。自行检查安全组策略，以确保网络正常通信与 ssh 连接，然后按以下要求配置服务器： （1）设置控制节点主机名为 controller，设置计算节点主机名为 compute；  （2）修改 hosts 文件将 IP 地址映射为主机名； 1231.查看控制节点名字为 controller 正确计 0.2 分2.查看 hosts 文件中有正确的主机名和 IP 映射计 0.2 分3.控制节点正确使用两块网卡计 0.1...</div></div></div></a><a class="pagination-related" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</div></div><div class="info-2"><div class="info-item-1">A场次题目：Openstack 平台部署与运维任务1 私有云平台环境初始化1.初始化操作系统 使用提供的用户名密码，登录竞赛云平台。根据表 1 中的 IP 地址规划，设置各服务器节点的 IP 地址，确保网络正常通信，设置控制节点主机名为 Contro ller，计算节点主机名为 Compute，并修改 hosts 文件将 IP 地址映射为主机名， 关闭防火墙并设置为开机不启动，设置 SELinux 为 Permissive 模式并设置永久 关闭。请查看控制节点和计算节点主机名，使用命令查看 SELinux 状态，使用 head 命令、tail 命令和 cut 命令提取出永久关闭 SELinux 的关键信息。 将以上命令及返回结果提交到答题框  配置host 123456vi /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6...</div></div></div></a><a class="pagination-related" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-Ansible搭建wordpress</div></div><div class="info-2"><div class="info-item-1">一.ansible搭建wordpress基于lamp构建wordpress    master 192.168.200.100 控制节点    node1 192.168.200.101 web服务器   node2 192.168.200.102 mysql服务器   vi &#x2F;etc&#x2F;ansible&#x2F;host 12345678[master]master[web]192.168.200.101node1[database]192.168.200.102node2  vi wordpress.yaml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354---# hosts: 后面可写主机组名或主机名- hosts: all  remote_user: root  # 定义变量  vars:    db_pkgs:      # 以下的-为变量“值”，也就是在引用db_pkgs变量时，可取变量中的值   ...</div></div></div></a><a class="pagination-related" href="/posts/840d388d.html" title="云计算方向-2023年金砖大赛山东选拔题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2023年金砖大赛山东选拔题</div></div><div class="info-2"><div class="info-item-1">A场次题目：OpenStack平台部署与运维业务场景： 某企业拟使用OpenStack搭建一个企业云平台，用于部署各类企业应用对外对内服务。云平台可实现IT资源池化，弹性分配，集中管理，性能优化以及统一安全认证等。系统结构如下图： 企业云平台的搭建使用竞赛平台提供的两台云服务器，配置如下表：    设备名称 主机名 接口 ip地址    云服务器1 controller eth0，eth1 私网：192.168.100.10&#x2F;24           私网：192.168.200.10&#x2F;24   云服务器2 compute eth0，eth1 私网：192.168.100.20&#x2F;24        ...</div></div></div></a><a class="pagination-related" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2023年GZ075 云计算应用赛项赛题</div></div><div class="info-2"><div class="info-item-1">模块一 私有云（30分）企业首先完成私有云平台搭建和运维，私有云平台提供云主机、云网络、云存储等基础架构云服务，并开发自动化运维程序。 任务1 私有云服务搭建（5分）1.1.1 基础环境配置1.控制节点主机名为controller，设置计算节点主机名为compute； 12345678910#控制节点[root@localhost ~]# hostnamectl set-hostname controller[root@localhost ~]# bash[root@controller ~]##计算节点[root@localhost ~]# hostnamectl set-hostname compute[root@localhost ~]# bash[root@compute ~]#    2.hosts文件将IP地址映射为主机名。 123456#全部节点[root@controller ~]# cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4...</div></div></div></a><a class="pagination-related" href="/posts/2c8237f4.html" title="云计算方向-2022年云计算技能国赛私有云套题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2022年云计算技能国赛私有云套题</div></div><div class="info-2"><div class="info-item-1">第一套私有云运维任务：题目3. OpenStack云平台运维（10分）1.使用提供的云安全框架组件，将提供的OpenStack云平台的安全策略从http优化至https。可能会遇到 mod_ssl 安装不成功的问题，原因是mod_ssl版本不匹配，上传mod_ssl-2.4.6-97.el7.centos.x86_64.rpm ①安装工具包 1yum install -y mod_wsgi httpd mod_ssl  ②修改&#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings文件 123456vi /etc/openstack-dashboard/local_settings##在DEBUG = False下增加4行USE_SSL = TrueCSRF_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_HTTPONLY =...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoldY</div><div class="author-info-description">不经一番寒彻骨，怎得梅花扑鼻香。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuwenjin666"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">联系我V：GoldY_66</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#A%E6%A8%A1%E5%9D%97%EF%BC%9AOpenStack%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4%EF%BC%88%E6%A0%B7%E9%A2%98%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">A模块：OpenStack平台部署与运维（样题）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11%E7%A7%81%E6%9C%89%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">任务1私有云平台环境初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-OpenStack%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">任务2 OpenStack平台搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-OpenStack-%E8%BF%90%E7%BB%B4%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">任务 3 OpenStack 运维任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-OpenStack%E6%9E%B6%E6%9E%84%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.4.</span> <span class="toc-text">任务四 OpenStack架构任务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#B%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BC%96%E6%8E%92%E4%B8%8E%E8%BF%90%E7%BB%B4%EF%BC%88%E6%A0%B7%E9%A2%98%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">B模块：容器的编排与运维（样题）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">任务 1 容器云平台环境初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-k8s-%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.2.</span> <span class="toc-text">任务2  k8s 搭建任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A13%E9%83%A8%E7%BD%B2Owncloud%E7%BD%91%E7%9B%98%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.3.</span> <span class="toc-text">任务3部署Owncloud网盘服务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C%E6%A8%A1%E5%9D%97%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4%EF%BC%88%E6%A0%B7%E9%A2%98%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">C模块：企业级应用的自动化部署和运维（样题）</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-Ansible搭建wordpress"/></a><div class="content"><a class="title" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress">云计算方向-Ansible搭建wordpress</a><time datetime="2025-05-14T02:48:38.000Z" title="发表于 2025-05-14 10:48:38">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"/></a><div class="content"><a class="title" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</a><time datetime="2025-05-14T02:48:37.000Z" title="发表于 2025-05-14 10:48:37">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d5ee981d.html" title="云计算方向-2023年一带一路职业技能大赛云计算(样题)"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年一带一路职业技能大赛云计算(样题)"/></a><div class="content"><a class="title" href="/posts/d5ee981d.html" title="云计算方向-2023年一带一路职业技能大赛云计算(样题)">云计算方向-2023年一带一路职业技能大赛云计算(样题)</a><time datetime="2025-05-14T02:48:35.000Z" title="发表于 2025-05-14 10:48:35">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a8884406.html" title="云计算方向-2023年金砖大赛"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖大赛"/></a><div class="content"><a class="title" href="/posts/a8884406.html" title="云计算方向-2023年金砖大赛">云计算方向-2023年金砖大赛</a><time datetime="2025-05-14T02:48:32.000Z" title="发表于 2025-05-14 10:48:32">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年GZ075 云计算应用赛项赛题"/></a><div class="content"><a class="title" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题">云计算方向-2023年GZ075 云计算应用赛项赛题</a><time datetime="2025-05-14T02:47:38.000Z" title="发表于 2025-05-14 10:47:38">2025-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bottom-bg.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By GoldY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=yuwenjin666";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="yuwenjin666";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/about'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>