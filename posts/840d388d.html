<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>云计算方向-2023年金砖大赛山东选拔题 | GoldY</title><meta name="author" content="GoldY"><meta name="copyright" content="GoldY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2023年金砖大赛山东选拔题">
<meta property="og:type" content="article">
<meta property="og:title" content="云计算方向-2023年金砖大赛山东选拔题">
<meta property="og:url" content="https://www.geekgold.xyz/posts/840d388d.html">
<meta property="og:site_name" content="GoldY">
<meta property="og:description" content="2023年金砖大赛山东选拔题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.geekgold.xyz/img/cloud-com.jpg">
<meta property="article:published_time" content="2025-05-14T02:47:35.000Z">
<meta property="article:modified_time" content="2025-05-14T03:16:03.864Z">
<meta property="article:author" content="GoldY">
<meta property="article:tag" content="云计算">
<meta property="article:tag" content="云计算职业技能大赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.geekgold.xyz/img/cloud-com.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "云计算方向-2023年金砖大赛山东选拔题",
  "url": "https://www.geekgold.xyz/posts/840d388d.html",
  "image": "https://www.geekgold.xyz/img/cloud-com.jpg",
  "datePublished": "2025-05-14T02:47:35.000Z",
  "dateModified": "2025-05-14T03:16:03.864Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoldY",
      "url": "https://www.geekgold.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.geekgold.xyz/posts/840d388d.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="bing-site-verification" content="E05CD8D6921B8F2AA32324DF2B267557"/><meta name="baidu-site-verification" content="codeva-tCktTl1n17"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":2,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '云计算方向-2023年金砖大赛山东选拔题',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cloud-com.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">GoldY</span></a><a class="nav-page-title" href="/"><span class="site-name">云计算方向-2023年金砖大赛山东选拔题</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">云计算方向-2023年金砖大赛山东选拔题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-14T02:47:35.000Z" title="发表于 2025-05-14 10:47:35">2025-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-14T03:16:03.864Z" title="更新于 2025-05-14 11:16:03">2025-05-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E6%B1%87%E6%80%BB/">技能大赛汇总</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>60分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="A场次题目：OpenStack平台部署与运维"><a href="#A场次题目：OpenStack平台部署与运维" class="headerlink" title="A场次题目：OpenStack平台部署与运维"></a>A场次题目：OpenStack平台部署与运维</h1><p>业务场景：</p>
<p>某企业拟使用OpenStack搭建一个企业云平台，用于部署各类企业应用对外对内服务。云平台可实现IT资源池化，弹性分配，集中管理，性能优化以及统一安全认证等。系统结构如下图：</p>
<p>企业云平台的搭建使用竞赛平台提供的两台云服务器，配置如下表：</p>
<table>
<thead>
<tr>
<th>设备名称</th>
<th>主机名</th>
<th>接口</th>
<th>ip地址</th>
</tr>
</thead>
<tbody><tr>
<td>云服务器1</td>
<td>controller</td>
<td>eth0，eth1</td>
<td>私网：192.168.100.10&#x2F;24           私网：192.168.200.10&#x2F;24</td>
</tr>
<tr>
<td>云服务器2</td>
<td>compute</td>
<td>eth0，eth1</td>
<td>私网：192.168.100.20&#x2F;24         私网：192.168.200.20&#x2F;24</td>
</tr>
</tbody></table>
<p>说明:</p>
<p>1.选手自行检查工位pc机硬件及网络是否正常;1.选手自行检查工位PC机硬件及网络是否正常；</p>
<p>⒉.竞赛使用集群模式进行，给每个参赛队提供华为云账号和密码及考试系统的账号和密码。选手通过用户名与密码分别登录华为云和考试系统;</p>
<p>3.考试用到的软件包都在云主机&#x2F;opt下。3.考试用到的软件包都在云主机&#x2F;OPT下.</p>
<p>4.表1中的公网IP和私网IP以自己云主机显示为准，每个人的公网IP和私网IP不同。使用第三方软件远程连接云主机，使用公网IP连接。4.表1中的公网IP和私网IP以自己云主机显示为准，每个人的公网IP和私网IP不同。使用第三方软件远程连接云主机，使用公网IP连接.</p>
<h2 id="任务1私有云平台环境初始化-5分"><a href="#任务1私有云平台环境初始化-5分" class="headerlink" title="任务1私有云平台环境初始化(5分)"></a>任务1私有云平台环境初始化(5分)</h2><h3 id="1-初始化操作系统"><a href="#1-初始化操作系统" class="headerlink" title="1.初始化操作系统"></a>1.初始化操作系统</h3><p>控制节点主机名为controller，计算节点主机名为compute，修改hosts文件将IP地址映射为主机名，使用一条命令关闭firewalld并设置开机不自动启动。</p>
<p>请将cat &#x2F;etc&#x2F;hosts命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/hosts</span><br><span class="line">192.168.100.10 controller</span><br><span class="line">192.168.100.20 compute</span><br></pre></td></tr></table></figure>

<p><strong>过程：</strong></p>
<p><strong>controller节点</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname controller</span><br><span class="line"><span class="comment">#修改主机映射</span></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.100.10 controller</span><br><span class="line">192.168.100.20 compute</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭防火墙和关机自启动</span></span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment">#安全策略</span></span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">SELINUX=permissive</span><br></pre></td></tr></table></figure>

<p><strong>compute节点</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname compute</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">修改主机映射</span></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.100.10 controller</span><br><span class="line">192.168.100.20 compute</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">关闭防火墙和关机自启动</span></span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安全策略</span></span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">SELINUX=permissive</span><br></pre></td></tr></table></figure>

<h3 id="⒉-挂载安装光盘镜像"><a href="#⒉-挂载安装光盘镜像" class="headerlink" title="⒉.挂载安装光盘镜像"></a>⒉.挂载安装光盘镜像</h3><p>将提供的CentOS-7-x86_64-DVD-1804.iso和bricsskills_cloud_iaas.iso光盘镜像复制到controller节点&#x2F;root目录下，然后在&#x2F;opt目录下使用命令创建&#x2F;centos目录和&#x2F;iaas目录，并将镜像文件centOS-7-x86_64-DVD-1804.iso挂载到&#x2F;centos目录下，将镜像文件bricsskills_cloud_iaas.iso挂载到&#x2F;iaas目录下</p>
<p>请将ls &#x2F;opt&#x2F;iaas&#x2F;命令的返回结果提交至答题框。【1分】</p>
<p>(镜像未拷贝，用省赛即可)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# <span class="built_in">ls</span> /opt/iaas/</span><br><span class="line">iaas-repo  images</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>过程：</strong></p>
<p><strong>controller节点</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建目录 </span></span><br><span class="line"><span class="built_in">mkdir</span> /opt/centos</span><br><span class="line"><span class="built_in">mkdir</span> /opt/iaas</span><br><span class="line"></span><br><span class="line"><span class="comment">#镜像挂载</span></span><br><span class="line">mount CentOS-7-x86_64-DVD-1804.iso /opt/centos/</span><br><span class="line">mount chinaskills_cloud_iaas.iso /opt/iaas/</span><br></pre></td></tr></table></figure>

<h3 id="3-设置yum源"><a href="#3-设置yum源" class="headerlink" title="3.设置yum源"></a>3.设置yum源</h3><p>将controller节点和compute节点原有的yum源移动到&#x2F;home目录，为controller节点创建本地yum源,yum源文件名为local.repo;为compute节点创建ftp源，yum源文件名为ftp.repo，其中ftp服务器地址为controller节点,配置ftp源时不要写IP地址。</p>
<p>请将ftp.repo的内容提交至答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@compute ~]# <span class="built_in">cat</span> /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://controller/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://controller/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>controller节点</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /home/</span><br><span class="line"><span class="comment">#编写本地yum源</span></span><br><span class="line">vi /etc/yum.repos.d/local.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=file:///opt/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<p><strong>compute节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/* /home/</span><br><span class="line">vi /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://controller/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://controller/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<h3 id="4-搭建文件共享服务器"><a href="#4-搭建文件共享服务器" class="headerlink" title="4.搭建文件共享服务器"></a>4.搭建文件共享服务器</h3><p>在Controller节点上安装vsftp服务并设置开机自启动，将&#x2F;opt目录设为共享目录重启服务生效。</p>
<p>请将vsftp配置文件中修改的行提交至答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# <span class="built_in">cat</span> /etc/vsftpd/vsftpd.conf</span><br><span class="line">anon_root=/opt/</span><br></pre></td></tr></table></figure>

<p><strong>controller节点</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装vsftp</span></span><br><span class="line">yum install -y vsftpd</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line">anon_root=/opt/</span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">systemctl start vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br></pre></td></tr></table></figure>

<h3 id="5-系统调优-脏数据回写"><a href="#5-系统调优-脏数据回写" class="headerlink" title="5.系统调优-脏数据回写"></a>5.系统调优-脏数据回写</h3><p>Linux系统内存中会存在脏数据，一般系统默认脏数据30秒后会回写磁盘,修改配置文件，要求将回写磁盘的时间临时调整为60秒。</p>
<p>请使用sysctl -p命令将返回结果提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# sysctl -p</span><br><span class="line">vm.dirty_expire_centisecs = 6000</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#系统内部数据一般保存在/proc/sys/下,脏数据回写在/proc/sys/vm/vm.dirty_expire_centisecs</span></span><br><span class="line"><span class="comment">#sysctl -p 默认路径是 /etc/sysctl.conf，但是其文件在sys下寻找并修改配置文件，若要修改需要指定</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"> vm.dirty_expire_centisecs= 6000</span><br><span class="line">sysctl -p</span><br><span class="line">vm.dirty_expire_centisecs = 6000</span><br></pre></td></tr></table></figure>

<h2 id="任务2-OpenStack搭建任务（10分）"><a href="#任务2-OpenStack搭建任务（10分）" class="headerlink" title="任务2 OpenStack搭建任务（10分）"></a>任务2 OpenStack搭建任务（10分）</h2><p><strong>root密码以实际为准</strong></p>
<h3 id="1-修改变量文件"><a href="#1-修改变量文件" class="headerlink" title="1.修改变量文件"></a>1.修改变量文件</h3><p>在控制节点和计算节点上分别安装iaas-xiandian软件包，修改配置脚本文件中基本变量（配置脚本文件为&#x2F;etc&#x2F;xiandian&#x2F;openrc.sh)。修改完成后使用命令生效该变量文件，并然后执行echo $INTERFACE_IP命令。</p>
<p>请将echo $INTERFACE_IP命令的返回结果提交至答题框。【0.5分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# echo $INTERFACE_IP</span><br><span class="line">192.168.100.10</span><br><span class="line">[root@compute ~]# echo $INTERFACE_IP</span><br><span class="line">192.168.100.20</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>controller</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y iaas-xiandian</span><br><span class="line">vi /etc/xiandian/openrc.sh</span><br><span class="line"><span class="comment">#将配置文件传到compute目录下</span></span><br><span class="line">scp /etc/xiandian/openrc.sh root@compute:/etc/xiandian/openrc.sh</span><br><span class="line"><span class="comment">#使配置文件生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/xiandian/openrc.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$INTERFACE_IP</span></span><br><span class="line">  192.168.100.10</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y iaas-xiandian</span><br><span class="line">#将配置文件的INTERFACE_IP改为compute的ip</span><br><span class="line">source /etc/xiandian/openrc.sh</span><br><span class="line">echo $INTERFACE_IP</span><br><span class="line">  192.168.100.20</span><br></pre></td></tr></table></figure>

<h3 id="2-controller节点和compute节点分别执行iaas-pre-host-sh脚本"><a href="#2-controller节点和compute节点分别执行iaas-pre-host-sh脚本" class="headerlink" title="2.controller节点和compute节点分别执行iaas-pre-host.sh脚本"></a>2.controller节点和compute节点分别执行iaas-pre-host.sh脚本</h3><p>请将执行sh文件的命令提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-pre-host.sh</span><br></pre></td></tr></table></figure>

<h3 id="3-搭建数据库组件"><a href="#3-搭建数据库组件" class="headerlink" title="3.搭建数据库组件"></a>3.搭建数据库组件</h3><p>执行iaas-install-mysql.sh脚本，在controller节点会自行安装mariadb、memcached、rabbitmq等服务和完成相关配置。执行完成后修改配置文件将memcached最大连接数修改为2048。</p>
<p>请将ps aux | grep memcached命令的返回结果提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller sysconfig]# ps aux | grep memcached</span><br><span class="line">memcach+  25218  0.0  0.1 443040  4212 ?        Ssl  16:36   0:00 /usr/bin/memcached -p 11211 -u memcached -m</span><br><span class="line">root      25232  0.0  0.0 112720   984 pts/1    S+   16:36   0:00 grep --color=auto memcached</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">iaas-install-mysql.sh</span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line"><span class="built_in">cd</span> /etc/sysconfig/</span><br><span class="line">vi memcached</span><br><span class="line">MAXCONN=<span class="string">&quot;2048&quot;</span></span><br><span class="line"><span class="comment">#重启服务</span></span><br><span class="line">systemctl restart memcached</span><br><span class="line"><span class="comment">#查看</span></span><br><span class="line"> ps aux | grep memcached</span><br><span class="line">memcach+  25218  0.0  0.1 443040  4212 ?        Ssl  16:36   0:00 /usr/bin/memcached -p 11211 -u memcached -m 64 -c 2048 -l 127.0.0.1,::1,controller</span><br><span class="line">root      25232  0.0  0.0 112720   984 pts/1    S+   16:36   0:00 grep --color=auto memcached</span><br></pre></td></tr></table></figure>

<h3 id="4-搭建认证服务组件"><a href="#4-搭建认证服务组件" class="headerlink" title="4.搭建认证服务组件"></a>4.搭建认证服务组件</h3><p>执行iaas-install-keystone.sh脚本，在controller节点上会自行安装keystone服务和完成相关配置。完成后使用openstack命令查看当前用户列表。</p>
<p>请将openstack查看用户列表的命令提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@controller sysconfig]# openstack user list</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| c75f855190ab4f50b9b7175ea8a90b44 | admin |</span><br><span class="line">| fb61c950d2874cafaff6e57f406e103b | demo  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装脚本</span></span><br><span class="line">iaas-install-keystone.sh</span><br><span class="line"><span class="comment">#生效身份验证</span></span><br><span class="line"><span class="built_in">source</span> /etc/keystone/admin-openrc.sh</span><br><span class="line"><span class="comment">#查看用户列表</span></span><br><span class="line">openstack user list</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| c75f855190ab4f50b9b7175ea8a90b44 | admin |</span><br><span class="line">| fb61c950d2874cafaff6e57f406e103b | demo  |</span><br><span class="line">+----------------------------------+-------+</span><br></pre></td></tr></table></figure>

<h3 id="5-搭建镜像服务组件"><a href="#5-搭建镜像服务组件" class="headerlink" title="5.搭建镜像服务组件"></a>5.搭建镜像服务组件</h3><p>执行iaas-install-glance.sh脚本，在controller 节点会自行安装glance服务和完成相关配置。完成后使用openstack命令将cirros-0.3.4-x86_64-disk.img上传到controller节点的&#x2F;root目录下，并命名为cirros。</p>
<p>请将镜像上传的操作命令和返回结果提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@controller sysconfig]# openstack image create cirros --disk-format qcow2 --container bare --file /root/cirros-0.3.4-x86_64-disk.img</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | ee1eca47dc88f4879d8a229cc70a07c6                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2022-10-08T08:56:01Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/70344b58-7c4f-43b0-b5de-15dd898d1293/file |</span><br><span class="line">| <span class="built_in">id</span>               | 70344b58-7c4f-43b0-b5de-15dd898d1293                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | e6dc2936211947c3b924187b48ffa8fb                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 13287936                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | 2022-10-08T08:56:01Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | shared                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#执行脚本</span></span><br><span class="line">iaas-install-glance.sh</span><br><span class="line"><span class="comment">#上传镜像</span></span><br><span class="line">openstack image create cirros --disk-format qcow2 --container bare --file /root/cirros-0.3.4-x86_64-disk.img</span><br></pre></td></tr></table></figure>

<h3 id="6-搭建计算服务组件"><a href="#6-搭建计算服务组件" class="headerlink" title="6.搭建计算服务组件"></a>6.搭建计算服务组件</h3><p>在controller节点和compute节点分别执行iaas-install-nova-controller.sh和iaas-install-nova-compute.sh脚本，会自行安装nova服务和完成相关配置。然后使用命令列出能提供计算资源的节点。</p>
<p>请将nova service-list命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@controller sysconfig]# nova service-list</span><br><span class="line">+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+</span><br><span class="line">| Id                                   | Binary           | Host       | Zone     | Status  | State | Updated_at                 | Disabled Reason | Forced down |</span><br><span class="line">+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+</span><br><span class="line">| c6a665b2-2cd7-44ca-9d75-32e7da6f4acf | nova-scheduler   | controller | internal | enabled | up    | 2022-10-08T09:07:15.000000 | -               | False       |</span><br><span class="line">| ce9d4037-9d16-4f16-8bbd-7015ddc74345 | nova-consoleauth | controller | internal | enabled | up    | 2022-10-08T09:07:15.000000 | -               | False       |</span><br><span class="line">| 8697a2e3-e5da-4f53-bc0d-e56f338027a5 | nova-conductor   | controller | internal | enabled | up    | 2022-10-08T09:07:16.000000 | -               | False       |</span><br><span class="line">| fc6eb5ca-c245-47f6-b9d9-24426f269e3f | nova-compute     | compute    | nova     | enabled | up    | 2022-10-08T09:07:19.000000 | -               | False       |</span><br><span class="line">| 1bd34d8c-ff2a-4c64-b426-a41dacf04bc2 | nova-compute     | controller | nova     | enabled | up    | 2022-10-08T09:07:22.000000 | -               | False       |</span><br><span class="line">+--------------------------------------+------------------+------------+----------+---------+-------+----------------------------+-----------------+-------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程</p>
<p><strong>controller</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-nova-controller.sh</span><br><span class="line">#修改配置文件</span><br><span class="line">vi /etc/xiandian/openrc.sh</span><br><span class="line">iaas-install-nova-compute.sh</span><br><span class="line">#修改完配置文件后改回</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-nova-compute</span><br></pre></td></tr></table></figure>

<p><strong>controller：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nova service-list</span><br></pre></td></tr></table></figure>

<h3 id="7-搭建网络组件并初始化网络"><a href="#7-搭建网络组件并初始化网络" class="headerlink" title="7.搭建网络组件并初始化网络"></a>7.搭建网络组件并初始化网络</h3><p>在controller节点和compute节点分别执行iaas-install-neutron-controller.sh和iaas-install-neutron-compute.sh脚本，会自行安装neutron 服务并完成配置。创建云主机外部网络ext-net，子网为ext-subnet，云主机浮动IP可用网段为192.168.10.100<del>192.168.10.200，网关为192.168.10.1。创建云主机内部网络int-net1，子网为int-subnet1，云主机子网IP可用网段为10.0.0.100</del>10.0.0.200，网关为10.0.0.1;创建云主机内部网络int-net2，子网为int-subnet2，云主机子网IP可用网段为10.0.1.100 ~10.0.1.200，网关为10.0.1.1。添加名为ext-router的路由器，添加网关在ext-net网络，添加内部端口到int-net1 网络，完成内部网络int-net1和外部网络的连通。</p>
<p>请使用openstack命令完成以上任务，完成后将命令和返回结果提交至答题框。【3分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在两个节点使用对应的脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建外部网络并绑定网段</span></span><br><span class="line">openstack network create ext-net --provider-physical-network provider --external --enable-port-security --<span class="built_in">enable</span>  --provider-network-type flat</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                   |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2022-10-09T02:59:57Z                 |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| dns_domain                | None                                 |</span><br><span class="line">| <span class="built_in">id</span>                        | 01fb1dc8-66f3-4045-84dc-cdc0cb69bede |</span><br><span class="line">| ipv4_address_scope        | None                                 |</span><br><span class="line">| ipv6_address_scope        | None                                 |</span><br><span class="line">| is_default                | False                                |</span><br><span class="line">| is_vlan_transparent       | None                                 |</span><br><span class="line">| mtu                       | 1500                                 |</span><br><span class="line">| name                      | ext-net                              |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| project_id                | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| provider:network_type     | flat                                 |</span><br><span class="line">| provider:physical_network | provider                             |</span><br><span class="line">| provider:segmentation_id  | None                                 |</span><br><span class="line">| qos_policy_id             | None                                 |</span><br><span class="line">| revision_number           | 5                                    |</span><br><span class="line">| router:external           | External                             |</span><br><span class="line">| segments                  | None                                 |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tags                      |                                      |</span><br><span class="line">| updated_at                | 2022-10-09T02:59:57Z                 |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">openstack subnet create ext-subnet --network ext-net  --dhcp --gateway 192.168.10.1  --subnet-range 192.168.10.0/24 --allocation-pool start=192.168.10.100,end=192.168.10.200</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 192.168.10.100-192.168.10.200        |</span><br><span class="line">| cidr              | 192.168.10.0/24                      |</span><br><span class="line">| created_at        | 2022-10-09T03:01:56Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| dns_nameservers   |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 192.168.10.1                         |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| <span class="built_in">id</span>                | 4b633ced-be54-4af4-a536-8f94f0c694bf |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | ext-subnet                           |</span><br><span class="line">| network_id        | 01fb1dc8-66f3-4045-84dc-cdc0cb69bede |</span><br><span class="line">| project_id        | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| revision_number   | 0                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| tags              |                                      |</span><br><span class="line">| updated_at        | 2022-10-09T03:01:56Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line"><span class="comment">#创建内网1，内网2并绑定</span></span><br><span class="line"></span><br><span class="line">openstack network create --internal int-net1</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                   |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2022-10-09T03:02:27Z                 |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| dns_domain                | None                                 |</span><br><span class="line">| <span class="built_in">id</span>                        | 43b5b4a9-1846-4489-8521-acdf2f96453e |</span><br><span class="line">| ipv4_address_scope        | None                                 |</span><br><span class="line">| ipv6_address_scope        | None                                 |</span><br><span class="line">| is_default                | False                                |</span><br><span class="line">| is_vlan_transparent       | None                                 |</span><br><span class="line">| mtu                       | 1450                                 |</span><br><span class="line">| name                      | int-net1                             |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| project_id                | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| provider:network_type     | vxlan                                |</span><br><span class="line">| provider:physical_network | None                                 |</span><br><span class="line">| provider:segmentation_id  | 161                                  |</span><br><span class="line">| qos_policy_id             | None                                 |</span><br><span class="line">| revision_number           | 2                                    |</span><br><span class="line">| router:external           | Internal                             |</span><br><span class="line">| segments                  | None                                 |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tags                      |                                      |</span><br><span class="line">| updated_at                | 2022-10-09T03:02:27Z                 |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack network create --internal int-net2</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Field                     | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up            | UP                                   |</span><br><span class="line">| availability_zone_hints   |                                      |</span><br><span class="line">| availability_zones        |                                      |</span><br><span class="line">| created_at                | 2022-10-09T03:02:31Z                 |</span><br><span class="line">| description               |                                      |</span><br><span class="line">| dns_domain                | None                                 |</span><br><span class="line">| <span class="built_in">id</span>                        | ea39aff1-bd51-443b-83e9-c573812a1dd7 |</span><br><span class="line">| ipv4_address_scope        | None                                 |</span><br><span class="line">| ipv6_address_scope        | None                                 |</span><br><span class="line">| is_default                | False                                |</span><br><span class="line">| is_vlan_transparent       | None                                 |</span><br><span class="line">| mtu                       | 1450                                 |</span><br><span class="line">| name                      | int-net2                             |</span><br><span class="line">| port_security_enabled     | True                                 |</span><br><span class="line">| project_id                | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| provider:network_type     | vxlan                                |</span><br><span class="line">| provider:physical_network | None                                 |</span><br><span class="line">| provider:segmentation_id  | 195                                  |</span><br><span class="line">| qos_policy_id             | None                                 |</span><br><span class="line">| revision_number           | 2                                    |</span><br><span class="line">| router:external           | Internal                             |</span><br><span class="line">| segments                  | None                                 |</span><br><span class="line">| shared                    | False                                |</span><br><span class="line">| status                    | ACTIVE                               |</span><br><span class="line">| subnets                   |                                      |</span><br><span class="line">| tags                      |                                      |</span><br><span class="line">| updated_at                | 2022-10-09T03:02:31Z                 |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack subnet create int-subnet1 --network int-net1  --dhcp --gateway 10.0.0.1  --subnet-range 10.0.0.0/24 --allocation-pool start=10.0.0.100,end=10.0.0.200</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 10.0.0.100-10.0.0.200                |</span><br><span class="line">| cidr              | 10.0.0.0/24                          |</span><br><span class="line">| created_at        | 2022-10-09T03:05:35Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| dns_nameservers   |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 10.0.0.1                             |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| <span class="built_in">id</span>                | d56b1e12-c37a-4ba1-9323-249b0e74e8b3 |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | int-subnet1                          |</span><br><span class="line">| network_id        | 43b5b4a9-1846-4489-8521-acdf2f96453e |</span><br><span class="line">| project_id        | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| revision_number   | 0                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| tags              |                                      |</span><br><span class="line">| updated_at        | 2022-10-09T03:05:35Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack subnet create int-subnet2 --network int-net2  --dhcp --gateway 10.0.1.1  --subnet-range 10.0.1.0/24 --allocation-pool start=10.0.1.100,end=10.0.1.200</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 10.0.1.100-10.0.1.200                |</span><br><span class="line">| cidr              | 10.0.1.0/24                          |</span><br><span class="line">| created_at        | 2022-10-09T03:06:02Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| dns_nameservers   |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 10.0.1.1                             |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| <span class="built_in">id</span>                | 3c8fbeb8-c4ec-41d4-b2d2-eac146b82eac |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | int-subnet2                          |</span><br><span class="line">| network_id        | ea39aff1-bd51-443b-83e9-c573812a1dd7 |</span><br><span class="line">| project_id        | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| revision_number   | 0                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| tags              |                                      |</span><br><span class="line">| updated_at        | 2022-10-09T03:06:02Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建路由，并联通外部</span></span><br><span class="line">[root@controller ~]# openstack router create ext-router --<span class="built_in">enable</span></span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line">| Field                   | Value                                |</span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line">| admin_state_up          | UP                                   |</span><br><span class="line">| availability_zone_hints |                                      |</span><br><span class="line">| availability_zones      |                                      |</span><br><span class="line">| created_at              | 2022-10-09T03:07:38Z                 |</span><br><span class="line">| description             |                                      |</span><br><span class="line">| distributed             | False                                |</span><br><span class="line">| external_gateway_info   | None                                 |</span><br><span class="line">| flavor_id               | None                                 |</span><br><span class="line">| ha                      | False                                |</span><br><span class="line">| <span class="built_in">id</span>                      | b6ec9db2-2a00-438f-bd07-fa433647d0d4 |</span><br><span class="line">| name                    | ext-router                           |</span><br><span class="line">| project_id              | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| revision_number         | 1                                    |</span><br><span class="line">| routes                  |                                      |</span><br><span class="line">| status                  | ACTIVE                               |</span><br><span class="line">| tags                    |                                      |</span><br><span class="line">| updated_at              | 2022-10-09T03:07:38Z                 |</span><br><span class="line">+-------------------------+--------------------------------------+</span><br><span class="line">[root@controller ~]# openstack router <span class="built_in">set</span> ext-router --external-gateway ext-net  --enable-snat</span><br><span class="line">[root@controller ~]# openstack router  add subnet ext-router int-subnet1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="任务3-OpenStack运维任务"><a href="#任务3-OpenStack运维任务" class="headerlink" title="任务3 OpenStack运维任务"></a>任务3 OpenStack运维任务</h2><h3 id="1-使用openstack图形界面创建镜像，镜像名称为nginx-源使用nginx-centos-qcow2"><a href="#1-使用openstack图形界面创建镜像，镜像名称为nginx-源使用nginx-centos-qcow2" class="headerlink" title="1.使用openstack图形界面创建镜像，镜像名称为nginx,源使用nginx-centos.qcow2"></a>1.使用openstack图形界面创建镜像，镜像名称为nginx,源使用nginx-centos.qcow2</h3><p>请将镜像截图提交至答题框。【1分】</p>
<p><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20221009113129848.png" alt="image-20221009113129848"></p>
<p>操作步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">登录OpenStack，创建镜像，源镜像为nginx-centos.qcow2，名臣为nginx，创建完成</span><br></pre></td></tr></table></figure>

<h3 id="⒉-使用命令创建名称为group-web的安全组该安全组的描述为工位号，为该安全组添加规则允许任意ip地址访问web-并写出添加访问SSH-22-的命令。"><a href="#⒉-使用命令创建名称为group-web的安全组该安全组的描述为工位号，为该安全组添加规则允许任意ip地址访问web-并写出添加访问SSH-22-的命令。" class="headerlink" title="⒉.使用命令创建名称为group_web的安全组该安全组的描述为工位号，为该安全组添加规则允许任意ip地址访问web,并写出添加访问SSH (22)的命令。"></a>⒉.使用命令创建名称为group_web的安全组该安全组的描述为工位号，为该安全组添加规则允许任意ip地址访问web,并写出添加访问SSH (22)的命令。</h3><p>请将添加访问SSH (22)的命令提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack security group rule create group_web --ingress  --dst-port 22:22 --remote-ip 0.0.0.0/24</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| created_at        | 2022-10-09T03:48:08Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| direction         | ingress                              |</span><br><span class="line">| ether_type        | IPv4                                 |</span><br><span class="line">| <span class="built_in">id</span>                | 03c7ce48-4ada-4f9d-bd0c-c80454d57f94 |</span><br><span class="line">| name              | None                                 |</span><br><span class="line">| port_range_max    | 22                                   |</span><br><span class="line">| port_range_min    | 22                                   |</span><br><span class="line">| project_id        | e6dc2936211947c3b924187b48ffa8fb     |</span><br><span class="line">| protocol          | tcp                                  |</span><br><span class="line">| remote_group_id   | None                                 |</span><br><span class="line">| remote_ip_prefix  | 0.0.0.0/24                           |</span><br><span class="line">| revision_number   | 0                                    |</span><br><span class="line">| security_group_id | 9c74fd04-d37a-4501-9632-05d82388ac59 |</span><br><span class="line">| updated_at        | 2022-10-09T03:48:08Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建安全组group_web</span></span><br><span class="line">openstack security group create group_web --project demo --description 31</span><br><span class="line"><span class="comment">#允许任意ip访问web</span></span><br><span class="line">openstack security group rule create group_web --ingress  --dst-port 80:80 --remote-ip 0.0.0.0/24 --protocol tcp</span><br><span class="line">openstack security group rule create group_web --ingress  --dst-port 443:443 --remote-ip 0.0.0.0/24 --protocol tcp</span><br><span class="line"><span class="comment">#允许访问22端口</span></span><br><span class="line">openstack security group rule create group_web --ingress  --dst-port 22:22 --remote-ip 0.0.0.0/24</span><br></pre></td></tr></table></figure>

<h3 id="3-创建名为nginx的云主机类型，要求VCPU-1内存1024M根磁盘10G"><a href="#3-创建名为nginx的云主机类型，要求VCPU-1内存1024M根磁盘10G" class="headerlink" title="3.创建名为nginx的云主机类型，要求VCPU 1内存1024M根磁盘10G"></a>3.创建名为nginx的云主机类型，要求VCPU 1内存1024M根磁盘10G</h3><p>请将openstack命令提交至答题框。【1分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# nova flavor-create nginx 1 1024 10 1</span><br><span class="line">+----+-------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line">| ID | Name  | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | Description |</span><br><span class="line">+----+-------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line">| 1  | nginx | 1024      | 10   | 0         |      | 1     | 1.0         | True      | -           |</span><br><span class="line">+----+-------+-----------+------+-----------+------+-------+-------------+-----------+-------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-修改相关配置，关闭nginx云主机的系统的内存共享，打开透明大页，并且保证nginx云主机的安全，配置禁止其他节点可以ping它"><a href="#5-修改相关配置，关闭nginx云主机的系统的内存共享，打开透明大页，并且保证nginx云主机的安全，配置禁止其他节点可以ping它" class="headerlink" title="5.修改相关配置，关闭nginx云主机的系统的内存共享，打开透明大页，并且保证nginx云主机的安全，配置禁止其他节点可以ping它"></a>5.修改相关配置，关闭nginx云主机的系统的内存共享，打开透明大页，并且保证nginx云主机的安全，配置禁止其他节点可以ping它</h3><p>请将sysctl -p命令的返回结果提交至答题框。【1分】</p>
<p><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20221009143743430.png" alt="image-20221009143743430"></p>
<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line">kernel.shmmax = 0</span><br><span class="line">kernel.shmall = 0</span><br><span class="line">kernel.shmmni = 0 </span><br><span class="line">net.ipv4.icmp_echo_ignore_all = 1</span><br></pre></td></tr></table></figure>

<h3 id="6-通过ceilometer组件，使用命令行查询nginx云主机CPU使用情况。"><a href="#6-通过ceilometer组件，使用命令行查询nginx云主机CPU使用情况。" class="headerlink" title="6.通过ceilometer组件，使用命令行查询nginx云主机CPU使用情况。"></a>6.通过ceilometer组件，使用命令行查询nginx云主机CPU使用情况。</h3><p>请将gnocchi metric list命令的返回结果提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ceilometer meter-list </span><br><span class="line"></span><br><span class="line">+---------------------------------------------+------------+-----------+-----------------------------------------------------------------------+----------------------------------+----------------------------------+</span><br><span class="line">| Name                                        | Type       | Unit      | Resource ID                                                           | User ID                          | Project ID                       |</span><br><span class="line">+---------------------------------------------+------------+-----------+-----------------------------------------------------------------------+----------------------------------+----------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">| cpu                                         | cumulative | ns        | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| cpu_util                                    | gauge      | %         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.allocation                             | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.capacity                               | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.allocation                      | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.capacity                        | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.read.bytes                      | cumulative | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.read.bytes.rate                 | gauge      | B/s       | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.usage                           | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.write.bytes                     | cumulative | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.device.write.bytes.rate                | gauge      | B/s       | 823bf8b4-96b4-4614-ab0e-49fba80bd13d-vda                              | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.read.bytes                             | cumulative | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.read.bytes.rate                        | gauge      | B/s       | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.read.requests                          | cumulative | request   | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.read.requests.rate                     | gauge      | request/s | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.total.size                             | gauge      | GB        | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.usage                                  | gauge      | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.write.bytes                            | cumulative | B         | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.write.bytes.rate                       | gauge      | B/s       | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.write.requests                         | cumulative | request   | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| disk.write.requests.rate                    | gauge      | request/s | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| instance                                    | gauge      | instance  | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| memory                                      | gauge      | MB        | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| memory.usage                                | gauge      | MB        | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.bytes                      | cumulative | B         | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.bytes.rate                 | gauge      | B/s       | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.packets                    | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.packets.drop               | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.packets.error              | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.incoming.packets.rate               | gauge      | packet/s  | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.bytes                      | cumulative | B         | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.bytes.rate                 | gauge      | B/s       | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.packets                    | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.packets.drop               | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.packets.error              | cumulative | packet    | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| network.outgoing.packets.rate               | gauge      | packet/s  | instance-00000067-823bf8b4-96b4-4614-ab0e-49fba80bd13d-ovkb478c1ea-ce | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| poweron                                     | gauge      | N/A       | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br><span class="line">| vcpus                                       | gauge      | vcpu      | 823bf8b4-96b4-4614-ab0e-49fba80bd13d                                  | 6e2f1fdf1e3c4cae95ce8bb09ec99431 | d448a43772e5434592baf9217e9a1b82 |</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#分别安装ceilometer组件</span><br><span class="line">controller： iaas-install-ceilometer-controller.sh</span><br><span class="line">compute: iaas-install-ceilometer-compute.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="7-使用命令行创建云主机nginx快照，命名为nginx-snap-使用qemu相关命令查询该快照磁盘详细属性。"><a href="#7-使用命令行创建云主机nginx快照，命名为nginx-snap-使用qemu相关命令查询该快照磁盘详细属性。" class="headerlink" title="7.使用命令行创建云主机nginx快照，命名为nginx_snap,使用qemu相关命令查询该快照磁盘详细属性。"></a>7.使用命令行创建云主机nginx快照，命名为nginx_snap,使用qemu相关命令查询该快照磁盘详细属性。</h3><p>请将qemu-img info nginx_snap.qcow2命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@controller images]# qemu-img info 5eae1a37-7ae9-4c4a-98c5-f477183eb818</span><br><span class="line">image: 5eae1a37-7ae9-4c4a-98c5-f477183eb818</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 10G (10737418240 bytes)</span><br><span class="line">disk size: 1.7G</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: <span class="literal">false</span></span><br><span class="line">    refcount bits: 16</span><br><span class="line">    corrupt: <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看云主机id</span></span><br><span class="line">nova list</span><br><span class="line"><span class="comment">#创建快照</span></span><br><span class="line">nova image-create b8095ceb-005c-4ca8-88be-dbdd7bec39ac <span class="string">&quot;nginx_snap&quot;</span></span><br><span class="line"><span class="comment">#进入后端</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/glance/images</span><br><span class="line"><span class="comment">#查看快照的id后，查看详细属性</span></span><br><span class="line">qemu-img info 5eae1a37-7ae9-4c4a-98c5-f477183eb818</span><br></pre></td></tr></table></figure>



<h3 id="8-执行iaas-install-cinder-controller-sh和iaas-install-cinder-compute-sh脚本，在controller和compute节点上安装cinder服务并完成配置，创建一个名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源。创建一块带这个卷类型标识的云硬盘lvm-test，查询该云硬盘的详细信息。"><a href="#8-执行iaas-install-cinder-controller-sh和iaas-install-cinder-compute-sh脚本，在controller和compute节点上安装cinder服务并完成配置，创建一个名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源。创建一块带这个卷类型标识的云硬盘lvm-test，查询该云硬盘的详细信息。" class="headerlink" title="8.执行iaas-install-cinder-controller .sh和iaas-install-cinder-compute.sh脚本，在controller和compute节点上安装cinder服务并完成配置，创建一个名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源。创建一块带这个卷类型标识的云硬盘lvm_test，查询该云硬盘的详细信息。"></a>8.执行iaas-install-cinder-controller .sh和iaas-install-cinder-compute.sh脚本，在controller和compute节点上安装cinder服务并完成配置，创建一个名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源。创建一块带这个卷类型标识的云硬盘lvm_test，查询该云硬盘的详细信息。</h3><p>请将cinder show lvm_test命令的返回结果提交至答题框。【2分】</p>
<h3 id="9-将该云硬盘挂载到nginx云主机中，将该云硬盘格式化为xfs。永久挂载至-opt目录，创建一个文件文件名为工位号内容为工位号。"><a href="#9-将该云硬盘挂载到nginx云主机中，将该云硬盘格式化为xfs。永久挂载至-opt目录，创建一个文件文件名为工位号内容为工位号。" class="headerlink" title="9.将该云硬盘挂载到nginx云主机中，将该云硬盘格式化为xfs。永久挂载至&#x2F;opt目录，创建一个文件文件名为工位号内容为工位号。"></a>9.将该云硬盘挂载到nginx云主机中，将该云硬盘格式化为xfs。永久挂载至&#x2F;opt目录，创建一个文件文件名为工位号内容为工位号。</h3><p>请将cat &#x2F;etc&#x2F;fstab的返回结果提交至答题框。【1分】</p>
<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绑定nginx主机</span></span><br><span class="line">openstack server  add volume nginx test_lvm</span><br><span class="line"><span class="comment">#将云硬盘格式化为xfs</span></span><br><span class="line">mkfs.xfs /dev/vdb</span><br><span class="line"><span class="comment">#永久挂在</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/dev/vdb /opt xfs     defaults        0 0</span><br></pre></td></tr></table></figure>



<h3 id="10-编写server-volume-yaml文件，通过heat组件实现自动化部署-发放1台云主机，主机名称为my-server-1，镜像为nginx，云主机类型为nginx，网络为int-net1，创建大小为1G的云硬盘，挂载至my-server-1"><a href="#10-编写server-volume-yaml文件，通过heat组件实现自动化部署-发放1台云主机，主机名称为my-server-1，镜像为nginx，云主机类型为nginx，网络为int-net1，创建大小为1G的云硬盘，挂载至my-server-1" class="headerlink" title="10.编写server_volume.yaml文件，通过heat组件实现自动化部署:发放1台云主机，主机名称为my server_1，镜像为nginx，云主机类型为nginx，网络为int-net1，创建大小为1G的云硬盘，挂载至my_server_1"></a>10.编写server_volume.yaml文件，通过heat组件实现自动化部署:发放1台云主机，主机名称为my server_1，镜像为nginx，云主机类型为nginx，网络为int-net1，创建大小为1G的云硬盘，挂载至my_server_1</h3><p>将server_volume.yaml文件中的内容提交至答题框。【3分】</p>
<h1 id="B场次题目-容器的编排与运维"><a href="#B场次题目-容器的编排与运维" class="headerlink" title="B场次题目:容器的编排与运维"></a>B场次题目:容器的编排与运维</h1><table>
<thead>
<tr>
<th>设备名称</th>
<th>主机名</th>
<th>接口</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>虚拟机1</td>
<td>master</td>
<td>ens33</td>
<td>192.168.200.162</td>
</tr>
<tr>
<td>虚拟机2</td>
<td>node1</td>
<td>ens33</td>
<td>192.168.200.163</td>
</tr>
<tr>
<td>虚拟机3</td>
<td>node2</td>
<td>ens33</td>
<td>192.168.200.164</td>
</tr>
<tr>
<td>虚拟机4</td>
<td>node3</td>
<td>ens33</td>
<td>192.168.200.165</td>
</tr>
</tbody></table>
<h2 id="任务1-容器云平台环境初始化（5分）"><a href="#任务1-容器云平台环境初始化（5分）" class="headerlink" title="任务1 容器云平台环境初始化（5分）"></a>任务1 容器云平台环境初始化（5分）</h2><h3 id="1-容器云平台的初始化"><a href="#1-容器云平台的初始化" class="headerlink" title="1.容器云平台的初始化"></a>1.容器云平台的初始化</h3><p>根据表2中的IP地址规划，创建云服务器，镜像使用CentOS_7.5_x86_64_XD.qcow，确保网络正常通信。按照表1设置主机名节点并关闭swap，同时永久关闭selinux以及防火墙,并修改hosts映射。</p>
<p>请将master节点hosts文件内容提交至答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">192.168.200.162 master</span><br><span class="line">192.168.200.163 node1</span><br><span class="line">192.168.200.164 node2</span><br><span class="line">192.168.200.165 harbor</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>master</strong></p>
<p>其他节点修改主机名即可，其他命令相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master</span><br><span class="line">setenforce 0</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">   SELINUX=disabled</span><br><span class="line">swapoff -a</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld </span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.200.162 master</span><br><span class="line">192.168.200.163 node1</span><br><span class="line">192.168.200.164 node2</span><br><span class="line">192.168.200.165 harbor</span><br></pre></td></tr></table></figure>

<h3 id="2-Yum源数据的持久化挂载"><a href="#2-Yum源数据的持久化挂载" class="headerlink" title="2.Yum源数据的持久化挂载"></a>2.Yum源数据的持久化挂载</h3><p>将提供的CentOS-7-x86_64-DVD-1804.iso和bricsskills_cloud_paas.iso光盘镜像移动到master节点&#x2F;root目录下，然后在&#x2F;opt目录下使用命令创建&#x2F;centos目录和&#x2F;paas目录，并将镜像文件CentOS-7-x86_64-DVD-1804.iso永久挂载到&#x2F;centos目录下，将镜像文件bricsskills_cloud_paas.iso永久挂载到&#x2F;paas目录下。</p>
<p>请将cat &#x2F;etc&#x2F;fstab的返回结果提交到答题框。【1分】</p>
<p><strong>若无bricsskills_cloud_paas.iso使用chinaskil也可以</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/fstab</span><br><span class="line">/root/CentOS-7-x86_64-DVD-1804.iso  /opt/centos iso9660 defaults 0 0</span><br><span class="line">/root/chinaskills_cloud_paas.iso /opt/paas iso9660 defaults 0 0</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/centos</span><br><span class="line"><span class="built_in">mkdir</span> /opt/paas</span><br><span class="line">mount CentOS-7-x86_64-DVD-1804.iso  /opt/centos</span><br><span class="line">mount chinaskills_cloud_paas.iso /opt/paas</span><br><span class="line"></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/root/CentOS-7-x86_64-DVD-1804.iso  /opt/centos iso9660 defaults 0 0</span><br><span class="line">/root/chinaskills_cloud_paas.iso /opt/paas iso9660 defaults 0 0</span><br><span class="line"></span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>

<h3 id="3-Yum源的编写"><a href="#3-Yum源的编写" class="headerlink" title="3.Yum源的编写"></a>3.Yum源的编写</h3><p>为master节点设置本地yum源，yum源文件名为local.repo，安装ftp服务，将ftp仓库设置为&#x2F;opt&#x2F;，为node1节点和node2节点配置ftp源,yum源文件名称为ftp.repo，其中ftp服务器地址为master节点,配置ftp源时不要写IP地址。</p>
<p>请将ftp.repo文件中的内容提交到答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/yum.repos.d/ftp.repo</span><br><span class="line"></span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://master/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[k8s]</span><br><span class="line">name=k8s</span><br><span class="line">baseurl=ftp://master/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>master</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /etc/yum</span><br><span class="line">vi /etc/yum.repos.d/centos.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[k8s]</span><br><span class="line">name=k8s</span><br><span class="line">baseurl=file:///opt/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"><span class="comment">#安装vsftpd服务</span></span><br><span class="line">yum install -y vsftpd</span><br><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line">  anon_root=/opt/</span><br><span class="line">systemctl start vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br><span class="line"></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line">/usr/sbin/iptables-save</span><br></pre></td></tr></table></figure>

<p><strong>其他节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/* /etc/yum</span><br><span class="line">vi /etc/yum.repos.d/ftp.repo</span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://master/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[k8s]</span><br><span class="line">name=k8s</span><br><span class="line">baseurl=ftp://master/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line">/usr/sbin/iptables-save</span><br></pre></td></tr></table></figure>

<h3 id="4-设置时间同步服务器"><a href="#4-设置时间同步服务器" class="headerlink" title="4.设置时间同步服务器"></a>4.设置时间同步服务器</h3><p>在master节点上部署chrony服务器，允许其他节点同步时间，启动服务并设置为开机启动;在其他节点上指定master节点为上游NTP服务器，重启服务并设为开机启动。</p>
<p>请在master节点将cat &#x2F;etc&#x2F;chrony.conf | grep server命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> /etc/chrony.conf | grep server</span><br><span class="line"><span class="comment"># Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server master iburst</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>master</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line"><span class="comment"># Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server master iburst</span><br><span class="line"><span class="comment"># Record the rate at which the system clock gains/losses time.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow the system clock to be stepped in the first three updates</span></span><br><span class="line"><span class="comment"># if its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="comment">#hwtimestamp *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="comment"># the system clock.</span></span><br><span class="line"><span class="comment">#minsources 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow NTP client access from local network.</span></span><br><span class="line"><span class="comment">#allow 192.168.0.0/16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Serve time even if not synchronized to a time source.</span></span><br><span class="line"><span class="comment">#local stratum 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify file containing keys for NTP authentication.</span></span><br><span class="line"><span class="comment">#keyfile /etc/chrony.keys</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify directory for log files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select which information is logged.</span></span><br><span class="line"><span class="comment">#log measurements statistics tracking</span></span><br><span class="line">allow 10.0.0.0/24</span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl restart chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure>

<p><strong>其他节点</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/chrony.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use public servers from the pool.ntp.org project.</span></span><br><span class="line"><span class="comment"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class="line"><span class="comment">#server 0.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 1.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 2.centos.pool.ntp.org iburst</span></span><br><span class="line"><span class="comment">#server 3.centos.pool.ntp.org iburst</span></span><br><span class="line">server master iburst</span><br><span class="line"><span class="comment"># Record the rate at which the system clock gains/losses time.</span></span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow the system clock to be stepped in the first three updates</span></span><br><span class="line"><span class="comment"># if its offset is larger than 1 second.</span></span><br><span class="line">makestep 1.0 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class="line">rtcsync</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable hardware timestamping on all interfaces that support it.</span></span><br><span class="line"><span class="comment">#hwtimestamp *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Increase the minimum number of selectable sources required to adjust</span></span><br><span class="line"><span class="comment"># the system clock.</span></span><br><span class="line"><span class="comment">#minsources 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow NTP client access from local network.</span></span><br><span class="line"><span class="comment">#allow 192.168.0.0/16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Serve time even if not synchronized to a time source.</span></span><br><span class="line"><span class="comment">#local stratum 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify file containing keys for NTP authentication.</span></span><br><span class="line"><span class="comment">#keyfile /etc/chrony.keys</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify directory for log files.</span></span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select which information is logged.</span></span><br><span class="line"><span class="comment">#log measurements statistics tracking</span></span><br><span class="line"></span><br><span class="line">systemctl restart chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure>

<h3 id="5-设置免密登录"><a href="#5-设置免密登录" class="headerlink" title="5.设置免密登录"></a>5.设置免密登录</h3><p>为四台服务器设置免密登录，保证服务器之间能够互相免密登录。</p>
<p>请将免密登录的命令提交到答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen </span><br><span class="line">ssh-copy-id root@192.168.200.163</span><br><span class="line">ssh-copy-id root@192.168.200.164</span><br><span class="line">ssh-copy-id root@192.168.200.165</span><br></pre></td></tr></table></figure>

<h2 id="任务2-k8s搭建任务-10分"><a href="#任务2-k8s搭建任务-10分" class="headerlink" title="任务2 k8s搭建任务(10分)"></a>任务2 k8s搭建任务(10分)</h2><h3 id="1-安装docker应用"><a href="#1-安装docker应用" class="headerlink" title="1.安装docker应用"></a>1.安装docker应用</h3><p>在所有节点上安装dokcer-ce。安装完成后修改docker启动引擎为systemd并配置阿里云镜像加速地址，配置成功重启docker服务器。</p>
<p>请将docker version命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           19.03.13</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        4484c46d9d</span><br><span class="line"> Built:             Wed Sep 16 17:03:45 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.13</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       4484c46d9d</span><br><span class="line">  Built:            Wed Sep 16 17:02:21 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.3.7</span><br><span class="line">  GitCommit:        8fba4e9a7d01810a393d5d25a3621dc101981175</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装依赖</span></span><br><span class="line">yum install -y yum-utils lvm2 device-mapper-*</span><br><span class="line"><span class="comment">#安装docker-ce</span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改相关配置</span></span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://5twf62k1.mirror.aliyuncs.com&quot;</span>],</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="2-安装docker-compose"><a href="#2-安装docker-compose" class="headerlink" title="2.安装docker-compose"></a>2.安装docker-compose</h3><p>在Harbor节点上使用&#x2F;opt&#x2F;paas&#x2F;docker-compose&#x2F;v1.25.5-docker-compose-Linux-x86_6下的文件安装docker-compose。安装完成后执行docker-composeversion命令。</p>
<p>请将docker-compose versio命令返回结果提交到答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# docker-compose version</span><br><span class="line">docker-compose version 1.25.5, build 8a1c60f6</span><br><span class="line">docker-py version: 4.1.0</span><br><span class="line">CPython version: 3.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可将master节点的docker-compose文件传到harbor</span></span><br><span class="line"><span class="built_in">cp</span> -rfv /opt/docker-compose/v1.25.5-docker-compose-Linux-x86_64 /usr/local/bin/docker-compose</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<h3 id="3-搭建horbor仓库"><a href="#3-搭建horbor仓库" class="headerlink" title="3.搭建horbor仓库"></a>3.搭建horbor仓库</h3><p>在Harbor节点使用&#x2F;opt&#x2F;paas&#x2F;harbor&#x2F; harbor-offline-installer-v2.1.0.tgz离线安装包，安装harbor仓库，并修改各节点默认docker仓库为harbor仓库地址。</p>
<p>请将master节点daemon.json中的内容提交到答题框。【2分】</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/docker/daemon.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;insecure-registries&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;192.168.200.165:5000&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;registry-mirrors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https://5twf62k1.mirror.aliyuncs.com&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exec-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;native.cgroupdriver=systemd&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>harbor：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.创建ca证书</span></span><br><span class="line"><span class="built_in">mkdir</span> /cert/ -p</span><br><span class="line"><span class="built_in">cd</span> /cert/ </span><br><span class="line"><span class="comment">#以下命令创建ca证书</span></span><br><span class="line">openssl req  -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt</span><br><span class="line"><span class="comment">#一路回车出现Common Name 输入IP或域名</span></span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:192.168.200.165</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#2.生成证书签名请求</span></span><br><span class="line"><span class="string">openssl req  -newkey rsa:4096 -nodes -sha256 -keyout 192.168.200.165.key -out 192.168.200.165.csr</span></span><br><span class="line"><span class="string">一路回车出现Common Name 输入IP或域名</span></span><br><span class="line"><span class="string">Common Name (eg, your name or your server&#x27;</span>s hostname) []:192.168.200.165</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.生成证书</span></span><br><span class="line"><span class="built_in">echo</span> subjectAltName = IP:192.168.200.165 &gt; extfile.cnf</span><br><span class="line">openssl x509 -req -days 365 -<span class="keyword">in</span> 192.168.200.165.csr -CA ca.crt -CAkey ca.key -CAcreateserial -extfile extfile.cnf -out 192.168.200.165.crt</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.配置harbor.yml</span></span><br><span class="line">tar -zxvf harbor-offline-installer-v2.0.1.tgz</span><br><span class="line"><span class="built_in">cd</span> harbor</span><br><span class="line"><span class="built_in">cp</span> harbor.yml.tmpl harbor.yml</span><br><span class="line">hostname=192.168.200.165</span><br><span class="line">ssl_cert = /cert/192.168.200.165.crt     <span class="comment">#crt位置</span></span><br><span class="line">ssl_cert_key = /cert/192.168.200.165.key  <span class="comment">#key的位置  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.配置使用harbor</span></span><br><span class="line">./prepare</span><br><span class="line">./install.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#将签证证书发送到其他节点</span></span><br><span class="line"><span class="built_in">mkdir</span> –p /etc/docker/certs.d/192.168.200.165</span><br><span class="line"><span class="built_in">cp</span> ca.crt /etc/docker/certs.d/192.168.200.165/ca.crt</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="4-上传docker镜像"><a href="#4-上传docker镜像" class="headerlink" title="4.上传docker镜像"></a>4.上传docker镜像</h3><p>在master节点使用命令将&#x2F;opt&#x2F;paas&#x2F;images目录下所有镜像导入本地。然后使用&#x2F;opt&#x2F;paas&#x2F;k8s_image_push.sh将所有镜像上传至docker仓库,遇到地址配置时请写IP地址。</p>
<p>请将执行k8s_image_push.sh文件的返回结果提交到答题框。</p>
<p>过程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">导入镜像</span></span><br><span class="line">for i in $(ls /opt/paas/images|grep tar)</span><br><span class="line">do</span><br><span class="line">  docker load -i /opt/paas/images/$i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">cd /opt/paas/</span><br><span class="line">./k8s_image_push.sh</span><br></pre></td></tr></table></figure>

<h3 id="5-安装kubeadm工具"><a href="#5-安装kubeadm工具" class="headerlink" title="5.安装kubeadm工具"></a>5.安装kubeadm工具</h3><p>在master及所有node节点安装Kubeadm工具并设置开机自动启动，安装完成后使用rpm命令配合grep查看Kubeadm工具是否正确安装。</p>
<p>请将kubectl get nodes命令的返回结果提交到答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep ku</span><br><span class="line">kubeadm-1.18.1-0.x86_64</span><br><span class="line">kubectl-1.18.1-0.x86_64</span><br><span class="line">kubelet-1.18.1-0.x86_64</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kubeadm-1.18.1 kubectl-1.18.1 kubelet-1.18.1</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure>

<h3 id="6-kubeadm安装master"><a href="#6-kubeadm安装master" class="headerlink" title="6.kubeadm安装master"></a>6.kubeadm安装master</h3><p>使用kubeadm命令生成yaml文件，并修改yaml文件，设置kubernetes虚拟内部网段地址为10.244.0.0&#x2F;16，通过该yaml文件初始化master节点，然后使用kube-flannel.yaml完成控制节点初始化设置，完成后使用命令查看集群状态和所有pod。</p>
<p>请将kubectl get nodes命令的返回结果提交到答题框。【2分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES    AGE   VERSION</span><br><span class="line">master   NotReady   master   13s   v1.18.1</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启路由转发（全部节点）</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/sysctl.d/k8s.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1 </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1 </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1 </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sysctl --system  //生效</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成yaml文件</span></span><br><span class="line">kubeadm config <span class="built_in">print</span> init-defaults  &gt; kubeadm-config.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.修改advertiseAddress,改为本机ip</span></span><br><span class="line">advertiseAddress: 192.168.200.162</span><br><span class="line"><span class="comment">#2.在yaml文件中的networking添加：</span></span><br><span class="line">podSubnet: <span class="string">&quot;10.244.0.0/16&quot;</span></span><br><span class="line"><span class="comment">#3.可以通过修改container地址提高速度</span></span><br><span class="line">--image-repository=registry.aliyuncs.com/google_containers</span><br><span class="line"><span class="comment">#安装master节点</span></span><br><span class="line">kubeadm init --config kubeadm-config.yaml</span><br></pre></td></tr></table></figure>

<h3 id="7-删除污点"><a href="#7-删除污点" class="headerlink" title="7.删除污点"></a>7.删除污点</h3><p>使用命令删除master节点的污点，使得Pod也可以调度到master节点上，操作成功配合grep查看master节点的污点。</p>
<p>请将删除master节点的污点的命令提交到答题框。【1分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes master node-role.kubernetes.io/master-</span><br></pre></td></tr></table></figure>

<p>过程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除污点</span></span><br><span class="line">kubectl taint nodes master node-role.kubernetes.io/master-</span><br><span class="line"><span class="comment">#查看master污点</span></span><br><span class="line">kubectl describe nodes master |grep Taints</span><br><span class="line">Taints:             node.kubernetes.io/not-ready:NoExecute</span><br></pre></td></tr></table></figure>

<h3 id="8-安装kubernetes网络插件"><a href="#8-安装kubernetes网络插件" class="headerlink" title="8.安装kubernetes网络插件"></a>8.安装kubernetes网络插件</h3><p>使用kube-flannel.yaml安装kubernetes网络插件，安装完成后使用命令查看节点状态。</p>
<p>请将kubectl get nodes命令的返回结果提交到答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost paas]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   12m   v1.18.1</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>master</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f /opt/paas/yaml/flannel/kube-flannel.yaml</span><br><span class="line"></span><br><span class="line">[root@localhost paas]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   12m   v1.18.1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9-kubernetes图形化界面的安装"><a href="#9-kubernetes图形化界面的安装" class="headerlink" title="9.kubernetes图形化界面的安装"></a>9.kubernetes图形化界面的安装</h3><p>使用recommended.yaml和dashboard-adminuser.yaml安装kubernetesdashboard界面，完成后查看首页。</p>
<p>请将kubectl get pod,svc -n kubernetes-dashboard命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod,svc -n kubernetes-dashboard</span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/dashboard-metrics-scraper-6b4884c9d5-9g89j   1/1     Running   0          22d</span><br><span class="line">pod/kubernetes-dashboard-5585794759-7h42g        1/1     Running   0          22d</span><br><span class="line"></span><br><span class="line">NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">service/dashboard-metrics-scraper   ClusterIP   10.102.214.55   &lt;none&gt;        8000/TCP        22d</span><br><span class="line">service/kubernetes-dashboard        NodePort    10.99.171.141   &lt;none&gt;        443:30000/TCP   22d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#部署dashboard</span></span><br><span class="line"><span class="built_in">mkdir</span> dashboard-certs</span><br><span class="line"><span class="built_in">cd</span> dashboard-certs/</span><br><span class="line">kubectl create namespace kubernetes-dashboard</span><br><span class="line">openssl genrsa -out dashboard.key 2048</span><br><span class="line">openssl req -days 36000 -new -out dashboard.csr -key dashboard.key -subj <span class="string">&#x27;/CN=dashboard-cert&#x27;</span></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> dashboard.csr -signkey dashboard.key -out dashboard.crt</span><br><span class="line">kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard</span><br><span class="line">sed -i <span class="string">&quot;s/kubernetesui/<span class="variable">$IP</span>\/library/g&quot;</span> /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">kubectl apply -f /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">kubectl apply -f /opt/yaml/dashboard/dashboard-adminuser.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#若pod未成功创建，修改一下镜像的地址</span></span><br></pre></td></tr></table></figure>

<h3 id="10-扩展计算节点"><a href="#10-扩展计算节点" class="headerlink" title="10.扩展计算节点"></a>10.扩展计算节点</h3><p>在所有node节点上使用kubeadm config命令生成yaml文件，并通过yaml文件将node节点加入kubernetes集群。完成后在master节点上查看所有节点状态。</p>
<p>请将kubectl get nodes命令的返回结果提交到答题框。【0.5分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS   ROLES    AGE   VERSION</span><br><span class="line">master   Ready    master   22d   v1.18.1</span><br><span class="line">node1    Ready    &lt;none&gt;   22d   v1.18.1</span><br><span class="line">node2    Ready    &lt;none&gt;   22d   v1.18.1</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成添加节点的配置文件</span></span><br><span class="line">kubeadm config <span class="built_in">print</span> join-defaults &gt; kubeadm-config.yaml</span><br><span class="line"><span class="comment">#需要修改：</span></span><br><span class="line">apiServerEndpoint：连接apiserver的地址，即master的api地址，这里可以改为192.168.200.162:6443,如果master集群部署的话，这里需要改为集群vip地址</span><br><span class="line">token及tlsBootstrapToken：连接master使用的token，这里需要与master上的InitConfiguration中的token配置一致</span><br><span class="line">name：node节点的名称，如果使用主机名，需要确保master节点可以解析该主机名。否则的话可直接使用ip地址</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加节点</span></span><br><span class="line">kubeadm <span class="built_in">join</span> --config kubeadm-config.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看nodes节点是否ready(controller)</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<h2 id="任务三-存储配置-5分"><a href="#任务三-存储配置-5分" class="headerlink" title="任务三 存储配置(5分)"></a>任务三 存储配置(5分)</h2><h3 id="1-NFS配置"><a href="#1-NFS配置" class="headerlink" title="1.NFS配置"></a>1.NFS配置</h3><p>在master节点安装nfs，并配置6个共享目录，启动后查看共享目录。并在各node节点安装nfs客户端并查看共享目录。</p>
<p>请将showmount -e master命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]# showmount -e master</span><br><span class="line">Export list for master:</span><br><span class="line">/nfs6 *</span><br><span class="line">/nfs5 *</span><br><span class="line">/nfs4 *</span><br><span class="line">/nfs3 *</span><br><span class="line">/nfs2 *</span><br><span class="line">/nfs1 *</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>master</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装nfs相关软件</span></span><br><span class="line">yum install -y nfs-utils rpcbind</span><br><span class="line"><span class="comment">#添加6个共享目录</span></span><br><span class="line">vi /etc/exports</span><br><span class="line">/nfs1 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line">/nfs2 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line">/nfs3 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line">/nfs4 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line">/nfs5 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line">/nfs6 *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br><span class="line"></span><br><span class="line">systemctl start nfs-server rpcbind</span><br><span class="line">systemctl <span class="built_in">enable</span> nfs-server rpcbind</span><br></pre></td></tr></table></figure>

<p>其他节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#yum install -y nfs-utils</span><br><span class="line">showmount -e master</span><br></pre></td></tr></table></figure>

<h3 id="2-PV配置"><a href="#2-PV配置" class="headerlink" title="2.PV配置"></a>2.PV配置</h3><p>每一个Redis Pod都需要一个独立的PV来存储自己的数据，创建一个pv.yaml文件,包含6个PV，分别对应nfs中的6个共享目录。</p>
<p>请将yaml文件中的内容提交至答题框。【2分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cat</span> <span class="string">pv.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs1</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs2</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs3</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv4</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs4</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv5</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs5</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv6</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.162</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs6</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteMany&quot;</span>,<span class="string">&quot;ReadOnlyMany&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="3-创建Configmap"><a href="#3-创建Configmap" class="headerlink" title="3.创建Configmap"></a>3.创建Configmap</h3><p>将提供的redis.conf配置文件创建为名称为redis-conf的Configmap对象，创建成功后，查看redis-conf的详细信息。</p>
<p>请将kubectl describe cm redis-conf命令的返回结果提交至答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master yaml]# kubectl describe cm redis-conf                                    Name:         redis-config</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">redis.conf:</span><br><span class="line">----</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file /var/lib/redis/nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line"><span class="built_in">dir</span> /var/lib/redis</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建configMap</span></span><br><span class="line">kubectl create configmap redis-confg --from-file=/root/redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="4-导入镜像"><a href="#4-导入镜像" class="headerlink" title="4.导入镜像"></a>4.导入镜像</h3><p>使用提供的redis.tar导入所需的镜像，并重新修改镜像tag并将镜像上传至harbor镜像仓库中。</p>
<p>请将上述操作的所有命令提交至答题框。【0.5分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# docker load -i redis.tar</span><br><span class="line">9f54eef41275: Loading layer  75.16MB/75.16MB</span><br><span class="line">e9e9d8cf772b: Loading layer  3.584kB/3.584kB</span><br><span class="line">8b504a175fb9: Loading layer  229.7MB/229.7MB</span><br><span class="line">Loaded image: ubuntu:redis-trip</span><br><span class="line">2edcec3590a4: Loading layer  83.86MB/83.86MB</span><br><span class="line">9b24afeb7c2f: Loading layer  338.4kB/338.4kB</span><br><span class="line">4b8e2801e0f9: Loading layer  4.274MB/4.274MB</span><br><span class="line">529cdb636f61: Loading layer   27.8MB/27.8MB</span><br><span class="line">9975392591f2: Loading layer  2.048kB/2.048kB</span><br><span class="line">8e5669d83291: Loading layer  3.584kB/3.584kB</span><br><span class="line">Loaded image: redis:latest</span><br><span class="line">[root@master ~]# docker tag redis:latest 192.168.200.165/library/redis:latest</span><br><span class="line">[root@master ~]# docker push 192.168.200.165/library/redis:latest</span><br><span class="line">The push refers to repository [192.168.200.165/library/redis]</span><br><span class="line">8e5669d83291: Pushed</span><br><span class="line">9975392591f2: Pushed</span><br><span class="line">529cdb636f61: Pushed</span><br><span class="line">4b8e2801e0f9: Pushed</span><br><span class="line">9b24afeb7c2f: Pushed</span><br><span class="line">2edcec3590a4: Pushed</span><br><span class="line">latest: digest: sha256:563888f63149e3959860264a1202ef9a644f44ed6c24d5c7392f9e2262bd3553 size: 1573</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="任务四redis集群部署-10分"><a href="#任务四redis集群部署-10分" class="headerlink" title="任务四redis集群部署(10分)"></a>任务四redis集群部署(10分)</h2><h3 id="1-基于StatefulSet创建Redis集群节点"><a href="#1-基于StatefulSet创建Redis集群节点" class="headerlink" title="1.基于StatefulSet创建Redis集群节点"></a>1.基于StatefulSet创建Redis集群节点</h3><p>编写redis.yml文件，创建statefulset资源，基于redis镜像创建6个pod副本，并且通过pod的亲和性配置保证pod尽量分散在不同的节点上，然后通过volumeMounts将pv及redis-conf的Configmap分别挂载到各个容器中。然后基于该文件创建redis集群节点，完成后查看所有redis的pod资源。</p>
<p>请将kubectl get pods -o wide命令的返回结果提交至答题框。【3分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@master yaml]# kubectl get pods -o wide</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE   IP            NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">redis-app-0     1/1     Running   0          9s    10.244.1.5    node2    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-app-1     1/1     Running   0          8s    10.244.2.10   node1    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-app-2     1/1     Running   0          6s    10.244.0.6    master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-app-3     1/1     Running   0          5s    10.244.1.6    node2    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-app-4     1/1     Running   0          4s    10.244.2.11   node1    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-app-5     1/1     Running   0          2s    10.244.1.7    node2    &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>redis.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">&quot;redis-service&quot;</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">appCluster:</span> <span class="string">redis-cluster</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">100</span></span><br><span class="line">            <span class="attr">podAffinityTerm:</span></span><br><span class="line">              <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.165</span><span class="string">/library/redis:latest</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;redis-server&quot;</span>                  <span class="comment">#redis启动命令</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;/etc/redis/redis.conf&quot;</span>         <span class="comment">#redis-server后面跟的参数,换行代表空格</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;--protected-mode&quot;</span>              <span class="comment">#允许外网访问</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">        <span class="comment"># command: redis-server /etc/redis/redis.conf --protected-mode no</span></span><br><span class="line">        <span class="attr">resources:</span>                          <span class="comment">#资源</span></span><br><span class="line">          <span class="attr">requests:</span>                         <span class="comment">#请求的资源</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span>                     <span class="comment">#m代表千分之,相当于0.1 个cpu资源</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;100Mi&quot;</span>                 <span class="comment">#内存100m大小</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">&quot;TCP&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cluster</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">16379</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">&quot;TCP&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;redis-conf&quot;</span>              <span class="comment">#挂载configmap生成的文件</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">&quot;/etc/redis&quot;</span>         <span class="comment">#挂载到哪个路径下</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;redis-data&quot;</span>              <span class="comment">#挂载持久卷的路径</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">&quot;/var/lib/redis&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;redis-conf&quot;</span>                  <span class="comment">#引用configMap卷</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">&quot;redis-conf&quot;</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;redis.conf&quot;</span>             <span class="comment">#创建configMap指定的名称</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">&quot;redis.conf&quot;</span>            <span class="comment">#里面的那个文件--from-file参数后面的文件</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span>                     <span class="comment">#进行pvc持久卷声明,</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">200M</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-redis集群初始化"><a href="#2-redis集群初始化" class="headerlink" title="2.redis集群初始化"></a>2.redis集群初始化</h3><p>使用ubuntu:redis-trib中的redis-trib工具对redis集群进行初始化，初始化后3个master节点，3个slave节点，3个master节点各对应一个slave节点。初始化成功后查看集群状态。</p>
<p>连结到任意一个Redis Pod将cluster nodes命令的返回结果提交至答题框。【3分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-为redis集群配置service"><a href="#3-为redis集群配置service" class="headerlink" title="3.为redis集群配置service"></a>3.为redis集群配置service</h3><p>编写service.yaml文件创建一个Service，用于为Redis集群提供访问和负载均衡，代理redis集群,在K8S集群中暴露6379端口,创建成功后，查看service状态。</p>
<p>请将kubectl get svc redis-access-service -o wide命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master yaml]# kubectl get svc redis-access-service -o wide</span><br><span class="line">NAME                   TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE   SELECTOR</span><br><span class="line">redis-access-service   ClusterIP   10.104.245.9   &lt;none&gt;        6379/TCP   2s    app=redis,appCluster=redis-cluster</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>vi service.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-access-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-port</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">&quot;TCP&quot;</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">appCluster:</span> <span class="string">redis-cluster</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-集群主从切换"><a href="#4-集群主从切换" class="headerlink" title="4.集群主从切换"></a>4.集群主从切换</h3><p>任意选择一个redis的master节点，进入该pod中查看该节点在集群中的角色信息，然后将该节点pod手动删除，然后查看状态，重新创建后，进入该pod查看节点角色信息及集群信息。查看是否自动完成主从切换。</p>
<p>最后进入该pod将role命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="C场次题目：企业级应用的自动化部署和运维"><a href="#C场次题目：企业级应用的自动化部署和运维" class="headerlink" title="C场次题目：企业级应用的自动化部署和运维"></a>C场次题目：企业级应用的自动化部署和运维</h1><table>
<thead>
<tr>
<th>设备名称</th>
<th>主机名</th>
<th>接口</th>
<th>ip地址</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>云服务器1</td>
<td>monitor</td>
<td>ens33</td>
<td>192.168.200.100</td>
<td>prometheus.grafana,ansible</td>
</tr>
<tr>
<td>云服务器2</td>
<td>slave1</td>
<td>ens33</td>
<td>192.168.200.101</td>
<td>agent</td>
</tr>
<tr>
<td>云服务器3</td>
<td>slave2</td>
<td>ens33</td>
<td>192.168.200.102</td>
<td>agent</td>
</tr>
</tbody></table>
<h2 id="任务1企业级应用的自动化部署-17分"><a href="#任务1企业级应用的自动化部署-17分" class="headerlink" title="任务1企业级应用的自动化部署(17分)"></a>任务1企业级应用的自动化部署(17分)</h2><h3 id="1-ansible自动化运维工具的安装"><a href="#1-ansible自动化运维工具的安装" class="headerlink" title="1.ansible自动化运维工具的安装"></a>1.ansible自动化运维工具的安装</h3><p>请使用提供的软件包在monitor节点安装ansible，安装完成后使用ansible –version命令验证是否安装成功。为所有节点添加test用户，设置用户密码为000000，为test用户设置免密sudo，配置ssh免密登录，使monitor节点能够免密登录所有节点的test用户。</p>
<p>请将ansible –version命令的返回结果提交到答题框。【3分】</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ansible --version</span><br><span class="line">ansible 2.4.6.0</span><br><span class="line">  config file = /etc/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [u<span class="string">&#x27;/root/.ansible/plugins/modules&#x27;</span>, u<span class="string">&#x27;/usr/share/ansible/plugins/modules&#x27;</span>]</span><br><span class="line">  ansible python module location = /usr/lib/python2.7/site-packages/ansible</span><br><span class="line">  executable location = /usr/bin/ansible</span><br><span class="line">  python version = 2.7.5 (default, Apr 11 2018, 07:36:10) [GCC 4.8.5 20150623 (Red Hat 4.8.5-28)]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>monitor</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#安装依赖</span><br><span class="line">yum install -y jinja2 PyYAML cryptography</span><br><span class="line"></span><br><span class="line">rpm -ivh ansible-2.4.6.0-1.el7.ans.noarch.rpm</span><br><span class="line"></span><br><span class="line">ansible --version</span><br></pre></td></tr></table></figure>

<p><strong>全部节点</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd test</span><br><span class="line">passwd test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置免密<span class="built_in">sudo</span> 在root    ALL=(ALL)       ALL下面添加</span></span><br><span class="line">visudo</span><br><span class="line">test ALL=(ALL) NOPASSWD:ALL</span><br></pre></td></tr></table></figure>

<p><strong>monitor</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen </span><br><span class="line">ssh-copy-id test@192.168.200.100</span><br><span class="line">ssh-copy-id test@192.168.200.101</span><br><span class="line">ssh-copy-id test@192.168.200.102</span><br></pre></td></tr></table></figure>

<h3 id="2-ansible-自动化运维工具的初始化【3-分】"><a href="#2-ansible-自动化运维工具的初始化【3-分】" class="headerlink" title="2.ansible 自动化运维工具的初始化【3 分】"></a>2.ansible 自动化运维工具的初始化【3 分】</h3><p>创建 &#x2F;root&#x2F;ansible 目录作为工作目录，在该目录内创建 ansible.cfg 文件并完成以下配置，清单文件位置为 &#x2F;root&#x2F;ansible&#x2F;inventory，登录用户为 test，登录时不需要输入密码。设置并行主机数量为 2，允许 test 用户免密提权到 root。</p>
<p>将 ansible.cfg 文件内容粘贴到答题框。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">inventory=./inventory</span><br><span class="line">forks=2</span><br><span class="line">remote_user=<span class="built_in">test</span></span><br><span class="line">ask_pass=<span class="literal">false</span></span><br><span class="line">[privilege_escalation]</span><br><span class="line">become=<span class="literal">true</span></span><br><span class="line">become_method=<span class="built_in">sudo</span></span><br><span class="line">become_user=root</span><br><span class="line">become_ask_pass=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建工作目录</span></span><br><span class="line">mkdir /root/ansible</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编辑cfg</span></span><br><span class="line">vi ansible.cfg</span><br><span class="line">[defaults]</span><br><span class="line">inventory=./inventory</span><br><span class="line">forks=2</span><br><span class="line">remote_user=test</span><br><span class="line">ask_pass=false</span><br><span class="line">[privilege_escalation]</span><br><span class="line">become=true</span><br><span class="line">become_method=sudo</span><br><span class="line">become_user=root</span><br><span class="line">become_ask_pass=false</span><br></pre></td></tr></table></figure>

<p>3.主机清单的编写。</p>
<p>编写主机清单文件，创建monitor用户组,monitor用户组内添加monitor主机，创建slave用户组, slave组内添加slave1和slave2主机，主机名不得使用IP地址。</p>
<p>请将ansible all -m ping命令的返回结果提交至答题框。【2分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@monitor ansible]# ansible all -m ping</span><br><span class="line"> [WARNING]: Found both group and host with same name: master</span><br><span class="line"></span><br><span class="line">slave2 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;failed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">slave1 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;failed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">monitor | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;failed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#需要在/etc/hosts添加映射</span></span><br><span class="line">192.168.200.100 monitor</span><br><span class="line">192.168.200.101 slave1</span><br><span class="line">192.168.200.102 slave2</span><br><span class="line"></span><br><span class="line"><span class="comment">#在/root/ansible目录下创建inventory</span></span><br><span class="line">vi inventory</span><br><span class="line">[monitor]</span><br><span class="line">monitor</span><br><span class="line">[slave]</span><br><span class="line">slave1</span><br><span class="line">slave2</span><br></pre></td></tr></table></figure>

<h3 id="4-使用自动化工具对-master-节点进行初始化【2-分】"><a href="#4-使用自动化工具对-master-节点进行初始化【2-分】" class="headerlink" title="4.使用自动化工具对 master 节点进行初始化【2 分】"></a>4.使用自动化工具对 master 节点进行初始化【2 分】</h3><p>请编写 prometheus.yml 控制 monitor 主机组，使用对应模块将 SELinux 临时状态和开机启动状态也设置为 disabled。请使用 ansible 对应模块安装时间同步服务，使用文本编辑模块将该服务的作用域设置为 0.0.0.0&#x2F;0，并设置状态为启动和开机自动启动。首先将提供的 prometheus-2.37.0.linux-amd64.tar.gz 使用文件拷贝模块将该压缩包拷贝到目标主机的&#x2F;usr&#x2F;local&#x2F; 下，使用 shell 模块解压该压缩包。</p>
<p>请将prometheus.yml文件中的内容提交至答题框。【4分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SELINUX=disabled</span></span><br><span class="line">      <span class="attr">selinux:</span> <span class="string">state=disabled</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">stop</span> <span class="string">firewalld</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo systemctl stop firewalld &amp;&amp; sudo systemctl disable firewalld&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">chrony</span></span><br><span class="line">      <span class="attr">yum:</span> <span class="string">name=chrony</span> <span class="string">state=present</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">allow</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0</span></span><br><span class="line">      <span class="attr">blockinfile:</span> <span class="string">path=/etc/chrony.conf</span> <span class="string">block=&quot;allow</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">/0&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">chrony</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=chronyd</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">promethus</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/prometheus-2.37.0.linux-amd64.tar.gz</span> <span class="string">dest=/usr/local/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tar</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo tar -zxvf /usr/local/prometheus-2.37.0.linux-amd64.tar.gz -C /usr/local&#x27;</span></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需要上传Prometheus到root目录下，在工作目录下创建prometheus.yml</span><br></pre></td></tr></table></figure>

<p>5.使用自动化运维工具完成企业级应用的部署。</p>
<p>编写prometheus.yml.j2模板文件，将所有slave节点信息添加到该文件中，但是被管节点的主机名信息必须使用变量IP地址可以手动输入。完成后请创建node_exporter.yml文件，编写第一个play，将该play命名为slave，该play控制的主机组为slave，使用ansible模块将node_exporter-1.3.1.linux-amd64.tar.gz发送到slave主机组的&#x2F;usr&#x2F;local&#x2F;下，使用一个shell模块解压该压缩包，并启动该服务。随后编写第二个play，将第二个play命名为monitor，第二个play控制monitor节点，首先使用ansible模块将prometheus.yml.j2文件传输到monitor节点，然后使用script模块将prometheus启动。使用对应模块将grafana-8.1.2-1.x86_64.rpm包发送到被控节点的&#x2F;mnt&#x2F;目录下，然后使用对应模块将该软件包安装，安装完成后设置grafana服务启动并设置开机自动启动。使用浏览器登录prometheus查看prometheus是否成功监控所有slave节点。</p>
<p>请将node_exporteryml文件内容提交到答题框。【5分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">slave</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">slave</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">node_expose</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/node_exporter-1.3.1.linux-amd64.tar.gz</span> <span class="string">dest=/usr/local/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tar</span> <span class="string">node_expose</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo tar -zxvf /usr/local/node_exporter-1.3.1.linux-amd64.tar.gz -C /usr/local/&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">node_export</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo nohup /usr/local/node_exporter-1.3.1.linux-amd64/node_exporter &amp;&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">node1:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">node2:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.102</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">template</span> <span class="string">j2</span></span><br><span class="line">      <span class="attr">template:</span> <span class="string">src=./prometheus.yml.j2</span> <span class="string">dest=/usr/local/prometheus-2.37.0.linux-amd64/prometheus.yml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">script:</span> <span class="string">/root/ansible/nohup.sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">grafana</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/grafana-8.1.2-1.x86_64.rpm</span> <span class="string">dest=/mnt/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">repaired</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo yum install -y fontconfig urw-fonts &#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">grafana</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo rpm -ivh /mnt/grafana-8.1.2-1.x86_64.rpm&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">enable</span> <span class="string">gtafana</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=grafana-server</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>prometheus.yml.j2</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># my global config</span></span><br><span class="line">global:</span><br><span class="line">  scrape_interval: 15s <span class="comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span></span><br><span class="line">  evaluation_interval: 15s <span class="comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span></span><br><span class="line">  <span class="comment"># scrape_timeout is set to the global default (10s).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Alertmanager configuration</span></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">          <span class="comment"># - alertmanager:9093</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span></span><br><span class="line">rule_files:</span><br><span class="line">  <span class="comment"># - &quot;first_rules.yml&quot;</span></span><br><span class="line">  <span class="comment"># - &quot;second_rules.yml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A scrape configuration containing exactly one endpoint to scrape:</span></span><br><span class="line"><span class="comment"># Here it&#x27;s Prometheus itself.</span></span><br><span class="line">scrape_configs:</span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># metrics_path defaults to &#x27;/metrics&#x27;</span></span><br><span class="line">    <span class="comment"># scheme defaults to &#x27;http&#x27;.</span></span><br><span class="line"></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;localhost:9090&quot;</span>]</span><br><span class="line">  - job_name: <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;&#123;&#123;node1&#125;&#125;:9100&quot;</span>,<span class="string">&quot;&#123;&#123;node2&#125;&#125;:9100&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>node_exporter.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">slave</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">slave</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">node_expose</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/node_exporter-1.3.1.linux-amd64.tar.gz</span> <span class="string">dest=/usr/local/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tar</span> <span class="string">node_expose</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo tar -zxvf /usr/local/node_exporter-1.3.1.linux-amd64.tar.gz -C /usr/local/&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">node_export</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo nohup /usr/local/node_exporter-1.3.1.linux-amd64/node_exporter &amp;&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">monitor</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="attr">node1:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">node2:</span> <span class="number">192.168</span><span class="number">.200</span><span class="number">.102</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">template</span> <span class="string">j2</span></span><br><span class="line">      <span class="attr">template:</span> <span class="string">src=./prometheus.yml.j2</span> <span class="string">dest=/usr/local/prometheus-2.37.0.linux-amd64/prometheus.yml</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">prometheus</span></span><br><span class="line">      <span class="attr">script:</span> <span class="string">/root/ansible/nohup.sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">grafana</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/grafana-8.1.2-1.x86_64.rpm</span> <span class="string">dest=/mnt/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">repaired</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo yum install -y fontconfig urw-fonts &#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">grafana</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo rpm -ivh /mnt/grafana-8.1.2-1.x86_64.rpm&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">enable</span> <span class="string">gtafana</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=grafana-server</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#因为启动Prometheus需要使用scrpit模块，所以需要在写一个脚本文件，通过脚本文件启动监控系统</span></span><br><span class="line">nohup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /usr/local/prometheus-2.37.0.linux-amd64/</span><br><span class="line"><span class="built_in">nohup</span> ./prometheus &amp;</span><br></pre></td></tr></table></figure>

<h2 id="任务-2-企业级应用的运维（12-分）"><a href="#任务-2-企业级应用的运维（12-分）" class="headerlink" title="任务 2 企业级应用的运维（12 分）"></a>任务 2 企业级应用的运维（12 分）</h2><h3 id="1-使用-prometheus-监控-mysqld-服务"><a href="#1-使用-prometheus-监控-mysqld-服务" class="headerlink" title="1.使用 prometheus 监控 mysqld 服务"></a>1.使用 prometheus 监控 mysqld 服务</h3><p>将提供的mysqld_exporter-0.14.0.linux-amd64.tar.gz 发送到agent虚拟机&#x2F;usr&#x2F;local&#x2F;目录下解压并安装mariadb服务。进入mariadb数据库中创建mysqld_monitor用户并授权，然后创建mariadb配置文件，内容为数据库用户名密码。启动mysqld_exporter组件确保9104端口启动。回到prometheus节点修改prometheus.yml文件并添加mysql被监控信息。重启prometheus，随后web界面刷新并查看mysqld被控信息。</p>
<p>请将ps -ef | grep prometheus命令的返回结果提交至答题框。【3分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@monitor prometheus-2.37.0.1inuax-amd64]# ps -ef l grep prometheus</span><br><span class="line">root 23115 23073 006:50 pts/5 00:00:00 ./prometheus</span><br><span class="line">root 23125 23073 006:51 pts/5 00:00:00 grep --color=auto prometheus</span><br></pre></td></tr></table></figure>

<p>过程：</p>
<p><strong>vi mysqld_exporter.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">slave</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">slave</span> </span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">mysqld_exporter</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/root/mysqld_exporter-0.14.0.linux-amd64.tar.gz</span> <span class="string">dest=/usr/local/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tar</span> <span class="string">it</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo tar -zxvf /usr/local/mysqld_exporter-0.14.0.linux-amd64.tar.gz -C /usr/local&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">anzhuang</span> <span class="string">mariadb</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&#x27;sudo yum install -y mariadb*&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">mysqld</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=mariadb</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br></pre></td></tr></table></figure>

<p><strong>在agent节点</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#授权</span></span><br><span class="line">mysql</span><br><span class="line">&gt;grant <span class="keyword">select</span>,replication client,process ON *.* to <span class="string">&#x27;mysql_monitor&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">&gt;flush privileges;</span><br><span class="line">&gt; quit</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个mariadb文件，并写上连接的用户和密码</span></span><br><span class="line">vi /usr/local/mysqld_exporter-0.14.0.linux-amd64/.my.cnf</span><br><span class="line">[client]</span><br><span class="line">user=mysql_monitor</span><br><span class="line">password=123</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动mysqld_exporter</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/mysqld_exporter-0.14.0.linux-amd64/mysqld_exporter --config.my-cnf=/usr/local/mysqld_exporter-0.14.0.linux-amd64/.my.cnf &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">#确认是否开启</span></span><br><span class="line">netstat -nltp | grep 9104</span><br></pre></td></tr></table></figure>

<p><strong>回到master节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/prometheus-2.37.0.linux-amd64/prometheus.yml</span><br><span class="line"> - job_name: &#x27;mysql&#x27;</span><br><span class="line">   static_configs:</span><br><span class="line">     - targets: [&#x27;192.168.200.101:9104&#x27;,&#x27;192.168.200.102:9104&#x27;]</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">#重启服务</span><br><span class="line">pkill prometheus</span><br><span class="line">nohup /usr/local/prometheus-2.37.0.linux-amd64/prometheus &amp;</span><br></pre></td></tr></table></figure>

<h3 id="⒉-安装alertmanager报警组件"><a href="#⒉-安装alertmanager报警组件" class="headerlink" title="⒉.安装alertmanager报警组件"></a>⒉.安装alertmanager报警组件</h3><p>将提供的alertmanager-0.21.0.linux-amd64.tar.gz上传到prometheus节点&#x2F;usr&#x2F;local&#x2F;目录下并解压，创建软连接alertmanager-0.23.0.linux-amd64&#x2F;alertmanager。创建service启动文件名为alertmanager.service，然后启动alertmanager查看9093端口。在prometheus.yml配置文件中添加alertmanager信息并重新启动prometheus服务，在agent上停止node_exporter服务。到web界面中查看警报管理器状态是否正常和agent状态是否异常。</p>
<p>请将alertmanager.service添加的内容提交到答题框。【3分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=alertmanager</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/alertmanager-0.21.0.linux-amd64/alertmanager --config.file=/usr/local/alertmanager-0.21.0.linux-amd64/alertmanager.yml</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>过程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf alertmanager-0.21.0.linux-amd64.tar.gz -C /usr/local/</span><br><span class="line"><span class="built_in">ln</span> -s alertmanager-0.23.0.linux-amd64/ alertmanager</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建service启动文件</span></span><br><span class="line">vi /usr/lib/systemd/system/alertmanager.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=alertmanager</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/local/alertmanager-0.21.0.linux-amd64/alertmanager --config.file=/usr/local/alertmanager-0.21.0.linux-amd64/alertmanager.yml</span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start alertmanager</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改Prometheus配置文件</span></span><br><span class="line">  - job_name: <span class="string">&#x27;altermanager&#x27;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&#x27;localhost:9093&#x27;</span>]</span><br><span class="line">      </span><br><span class="line">pkill prometheus</span><br><span class="line"><span class="built_in">nohup</span> /usr/local/prometheus/prometheus.yml &amp;</span><br></pre></td></tr></table></figure>

<p><strong>agent</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkill node_exporter</span><br><span class="line"><span class="built_in">nohup</span> /usr/local/node_exporter-1.3.1.linux-amd64/node_exporter &amp;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20220922101236256.png" alt="image-20220922101236256"></p>
<h3 id="3-alertmanager告警邮件文件编写"><a href="#3-alertmanager告警邮件文件编写" class="headerlink" title="3.alertmanager告警邮件文件编写"></a>3.alertmanager告警邮件文件编写</h3><p>Prometheus虚拟机&#x2F;usr&#x2F;local&#x2F;akertmanager&#x2F;中存在着一个alertmanager.yml文件，请根据提供的地址和模板编写告警所发送到的email邮箱地址信息。</p>
<p>将alertmanager.yml文件修改的内容提交至答题框。【3分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">smtp_auth_username:</span> <span class="string">&quot;1234567890@qq.com&quot;</span> <span class="comment"># 登录用户名</span></span><br><span class="line">  <span class="attr">smtp_auth_password:</span> <span class="string">&quot;auth_pass&quot;</span> <span class="comment"># 此处的auth password是邮箱的第三方登录授权密码，而非用户密码，尽量用QQ来测试。</span></span><br><span class="line">  <span class="attr">smtp_require_tls:</span> <span class="literal">false</span> <span class="comment"># 有些邮箱需要开启此配置，这里使用的是163邮箱，仅做测试，不需要开启此功能。</span></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">30s</span> <span class="comment"># 在组内等待所配置的时间，如果同组内，30秒内出现相同报警，在一个组内出现。</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">5m</span> <span class="comment"># 如果组内内容不变化，合并为一条警报信息，5m后发送。</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">24h</span> <span class="comment"># 发送报警间隔，如果指定时间内没有修复，则重新发送报警。</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">alertname</span>]  <span class="comment"># 报警分组</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">match:</span></span><br><span class="line">          <span class="attr">team:</span> <span class="string">operations</span></span><br><span class="line">        <span class="attr">group_by:</span> [<span class="string">env</span>,<span class="string">dc</span>]</span><br><span class="line">        <span class="attr">receiver:</span> <span class="string">&#x27;ops&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">receiver:</span> <span class="string">ops</span> <span class="comment"># 路由和标签，根据match来指定发送目标，如果 rule的lable 包含 alertname， 使用 ops 来发送</span></span><br><span class="line">        <span class="attr">group_wait:</span> <span class="string">10s</span></span><br><span class="line">        <span class="attr">match:</span></span><br><span class="line">          <span class="attr">team:</span> <span class="string">operations</span></span><br><span class="line"><span class="comment"># 接收器指定发送人以及发送渠道</span></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="comment"># ops分组的定义</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ops</span></span><br><span class="line">  <span class="attr">email_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&#x27;9935226@qq.com,xxxxx@qq.com&#x27;</span> <span class="comment"># 如果想发送多个人就以 &#x27;,&#x27;做分割，写多个邮件人即可。</span></span><br><span class="line">    <span class="attr">send_resolved:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">headers:</span></span><br><span class="line">      <span class="attr">from:</span> <span class="string">&quot;警报中心&quot;</span></span><br><span class="line">      <span class="attr">subject:</span> <span class="string">&quot;[operations] 报警邮件&quot;</span></span><br><span class="line">      <span class="attr">to:</span> <span class="string">&quot;小煜狼皇&quot;</span></span><br></pre></td></tr></table></figure>

<p>4.alertmanager告警规则编写</p>
<p>在prometheus虚拟机的prometheus路径下存在一个&#x2F;rules目录，目录下有一个node_rules.yml文件。请根据提供信息仿照模板编写:</p>
<p>1.内存大于50%报警规则;</p>
<p>2.cpu资源利用率大于75%报警规则;</p>
<p>3.主机磁盘每秒读取数据&gt;5OMB%报警规则;部门名称自定义。</p>
<p>请将上述三项规则的内容提交至答题框。【3分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">groups:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node_health</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighMemoryUsage</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="number">1</span><span class="string">-(node_memory_MemAvailable_bytes</span> <span class="string">/</span> <span class="string">node_memory_MemTotal_bytes)</span> <span class="string">&gt;</span> <span class="number">0.75</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">High</span> <span class="string">memory</span> <span class="string">usage</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighCPUUseage</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="number">1</span><span class="string">-sum(increase(node_cpu_seconds_total&#123;mode=&quot;idle&quot;&#125;[1m]))</span> <span class="string">by</span> <span class="string">(instance)</span> <span class="string">/</span> <span class="string">sum(increase(node_cpu_seconds_total[1m]))</span> <span class="string">by</span> <span class="string">(instance)</span> <span class="string">&gt;</span> <span class="number">0.75</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">High</span> <span class="string">CPU</span> <span class="string">usage</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighReadTime</span></span><br><span class="line">    <span class="attr">expr:</span> <span class="string">sum(irate(node_disk_read_bytes_total[1m]))</span> <span class="string">by</span> <span class="string">(instance)</span> <span class="string">&gt;</span> <span class="number">50</span> <span class="comment">#这个不确定对不对</span></span><br><span class="line">    <span class="attr">for:</span> <span class="string">1m</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">High</span> <span class="string">Read</span> <span class="string">Time</span></span><br></pre></td></tr></table></figure>

<p>过程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在prometheus路径下创建一个/rules目录，并创建yml文件</span><br><span class="line">创建完成后修改prometheus.yml文件</span><br><span class="line">rule_files:</span><br><span class="line">  - <span class="string">&quot;./rules/node_rules.yml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启Prometheus</span></span><br><span class="line">pkill prometheus</span><br><span class="line"><span class="built_in">nohup</span> /usr/local/prometheus-2.37.0.linux-amd64/prometheus &amp;</span><br></pre></td></tr></table></figure>

<p>1.表4中的公网IP和私网IP以自己云主机显示为准，每个人的公网IP和私网IP不同。使用第三方软件远程连接云主机，使用公网IP连接。</p>
<p>2.华为云中云主机名字已命好，直接使用对应名字的云主机即可。</p>
<p>公司在原有的系统集群监控方案中一直使用的是单节点server的zabbix的监控方案但是在使用过程中经常出现server节点宕机等相关问题，公司给技术部下达了解决该问题的通知。经过公司技术部的技术研讨决定使用zabbix+keealived的解决方案决定使用数据库分离以及双节点server的方式去解决该问题,请根据技术部的技术指标完成下列操作。</p>
<h2 id="任务三：-企业级运维（zabbix）"><a href="#任务三：-企业级运维（zabbix）" class="headerlink" title="任务三： 企业级运维（zabbix）"></a>任务三： 企业级运维（zabbix）</h2><h3 id="1-完成zabbix-5-0-LTS版本的安装"><a href="#1-完成zabbix-5-0-LTS版本的安装" class="headerlink" title="1.完成zabbix 5.0 LTS版本的安装"></a>1.完成zabbix 5.0 LTS版本的安装</h3><p>本次zabbix集群决定使用4台主机去实现该功能分别为两台server一台DB服务一台agent服务请按照要求将zabbix搭建完成。</p>
<p>将两台server节点的主页截图黏贴至答题框。【3分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-keepalive的高可用配置"><a href="#2-keepalive的高可用配置" class="headerlink" title="2.keepalive的高可用配置"></a>2.keepalive的高可用配置</h3><p>根据要求完成keepalived的安装与配置要求keepalivedip为10结尾，绑定外网网卡、密码为000000、router_id为100、master节点权重100，backup节点权重80，同时修改相应zabbix监控配置项将所有监控项目引入此ip做到高可用配置。</p>
<p>完成操作后将主页登录界面提交至答题框。【4分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.编写状态切换脚本</p>
<p>在keepalived中编写状态切换脚本(check_zabbix_server)，监控zabbix-server是否正常工作，并可在主机出现故障后迅速切换到backup节点提供服务。</p>
<p>请将cat &#x2F;etc&#x2F;keepalived&#x2F;keepalived.conf内容提交至答题框。【4分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz">GoldY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz/posts/840d388d.html">https://www.geekgold.xyz/posts/840d388d.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.geekgold.xyz" target="_blank">GoldY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a><a class="post-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/">云计算职业技能大赛</a></div><div class="post-share"><div class="social-share" data-image="/img/cloud-com.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.jpg" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/c134dd26.html" title="云计算方向-2022年云计算技能大赛样题"><img class="cover" src="/img/cloud-com.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">云计算方向-2022年云计算技能大赛样题</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题"><img class="cover" src="/img/cloud-com.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">云计算方向-2023年GZ075 云计算应用赛项赛题</div></div><div class="info-2"><div class="info-item-1">模块一 私有云（30分）企业首先完成私有云平台搭建和运维，私有云平台提供云主机、云网络、云存储等基础架构云服务，并开发自动化运维程序。 任务1 私有云服务搭建（5分）1.1.1 基础环境配置1.控制节点主机名为controller，设置计算节点主机名为compute； 12345678910#控制节点[root@localhost ~]# hostnamectl set-hostname controller[root@localhost ~]# bash[root@controller ~]##计算节点[root@localhost ~]# hostnamectl set-hostname compute[root@localhost ~]# bash[root@compute ~]#    2.hosts文件将IP地址映射为主机名。 123456#全部节点[root@controller ~]# cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/6bf8b7d7.html" title="云计算方向-2022年云计算职业技能大赛国赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2022年云计算职业技能大赛国赛题</div></div><div class="info-2"><div class="info-item-1">第一套【任务 1】私有云服务搭建[10分]【题目 1】基础环境配置[0.5 分]使用提供的用户名密码，登录提供的 OpenStack 私有云平台，在当前租户下，使用CentOS7.9 镜像，创建两台云主机，云主机类型使用 4vCPU&#x2F;12G&#x2F;100G_50G 类型。当前租户下默认存在一张网卡，自行创建第二张网卡并连接至 controller 和 compute 节点（第二张网卡的网段为 10.10.X.0&#x2F;24，X 为工位号，不需要创建路由）。自行检查安全组策略，以确保网络正常通信与 ssh 连接，然后按以下要求配置服务器： （1）设置控制节点主机名为 controller，设置计算节点主机名为 compute；  （2）修改 hosts 文件将 IP 地址映射为主机名； 1231.查看控制节点名字为 controller 正确计 0.2 分2.查看 hosts 文件中有正确的主机名和 IP 映射计 0.2 分3.控制节点正确使用两块网卡计 0.1...</div></div></div></a><a class="pagination-related" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</div></div><div class="info-2"><div class="info-item-1">A场次题目：Openstack 平台部署与运维任务1 私有云平台环境初始化1.初始化操作系统 使用提供的用户名密码，登录竞赛云平台。根据表 1 中的 IP 地址规划，设置各服务器节点的 IP 地址，确保网络正常通信，设置控制节点主机名为 Contro ller，计算节点主机名为 Compute，并修改 hosts 文件将 IP 地址映射为主机名， 关闭防火墙并设置为开机不启动，设置 SELinux 为 Permissive 模式并设置永久 关闭。请查看控制节点和计算节点主机名，使用命令查看 SELinux 状态，使用 head 命令、tail 命令和 cut 命令提取出永久关闭 SELinux 的关键信息。 将以上命令及返回结果提交到答题框  配置host 123456vi /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6...</div></div></div></a><a class="pagination-related" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-Ansible搭建wordpress</div></div><div class="info-2"><div class="info-item-1">一.ansible搭建wordpress基于lamp构建wordpress    master 192.168.200.100 控制节点    node1 192.168.200.101 web服务器   node2 192.168.200.102 mysql服务器   vi &#x2F;etc&#x2F;ansible&#x2F;host 12345678[master]master[web]192.168.200.101node1[database]192.168.200.102node2  vi wordpress.yaml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354---# hosts: 后面可写主机组名或主机名- hosts: all  remote_user: root  # 定义变量  vars:    db_pkgs:      # 以下的-为变量“值”，也就是在引用db_pkgs变量时，可取变量中的值   ...</div></div></div></a><a class="pagination-related" href="/posts/c134dd26.html" title="云计算方向-2022年云计算技能大赛样题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2022年云计算技能大赛样题</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2023年GZ075 云计算应用赛项赛题</div></div><div class="info-2"><div class="info-item-1">模块一 私有云（30分）企业首先完成私有云平台搭建和运维，私有云平台提供云主机、云网络、云存储等基础架构云服务，并开发自动化运维程序。 任务1 私有云服务搭建（5分）1.1.1 基础环境配置1.控制节点主机名为controller，设置计算节点主机名为compute； 12345678910#控制节点[root@localhost ~]# hostnamectl set-hostname controller[root@localhost ~]# bash[root@controller ~]##计算节点[root@localhost ~]# hostnamectl set-hostname compute[root@localhost ~]# bash[root@compute ~]#    2.hosts文件将IP地址映射为主机名。 123456#全部节点[root@controller ~]# cat /etc/hosts127.0.0.1   localhost localhost.localdomain localhost4...</div></div></div></a><a class="pagination-related" href="/posts/2c8237f4.html" title="云计算方向-2022年云计算技能国赛私有云套题"><img class="cover" src="/img/cloud-com.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-14</div><div class="info-item-2">云计算方向-2022年云计算技能国赛私有云套题</div></div><div class="info-2"><div class="info-item-1">第一套私有云运维任务：题目3. OpenStack云平台运维（10分）1.使用提供的云安全框架组件，将提供的OpenStack云平台的安全策略从http优化至https。可能会遇到 mod_ssl 安装不成功的问题，原因是mod_ssl版本不匹配，上传mod_ssl-2.4.6-97.el7.centos.x86_64.rpm ①安装工具包 1yum install -y mod_wsgi httpd mod_ssl  ②修改&#x2F;etc&#x2F;openstack-dashboard&#x2F;local_settings文件 123456vi /etc/openstack-dashboard/local_settings##在DEBUG = False下增加4行USE_SSL = TrueCSRF_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_SECURE = True		##原文中有，去掉注释即可SESSION_COOKIE_HTTPONLY =...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoldY</div><div class="author-info-description">不经一番寒彻骨，怎得梅花扑鼻香。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuwenjin666"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">联系我V：GoldY_66</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#A%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE%EF%BC%9AOpenStack%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-number">1.</span> <span class="toc-text">A场次题目：OpenStack平台部署与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11%E7%A7%81%E6%9C%89%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96-5%E5%88%86"><span class="toc-number">1.1.</span> <span class="toc-text">任务1私有云平台环境初始化(5分)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.初始化操作系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%92%89-%E6%8C%82%E8%BD%BD%E5%AE%89%E8%A3%85%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F"><span class="toc-number">1.1.2.</span> <span class="toc-text">⒉.挂载安装光盘镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%BE%E7%BD%AEyum%E6%BA%90"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.设置yum源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BA%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.搭建文件共享服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98-%E8%84%8F%E6%95%B0%E6%8D%AE%E5%9B%9E%E5%86%99"><span class="toc-number">1.1.5.</span> <span class="toc-text">5.系统调优-脏数据回写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-OpenStack%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1%EF%BC%8810%E5%88%86%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">任务2 OpenStack搭建任务（10分）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.修改变量文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-controller%E8%8A%82%E7%82%B9%E5%92%8Ccompute%E8%8A%82%E7%82%B9%E5%88%86%E5%88%AB%E6%89%A7%E8%A1%8Ciaas-pre-host-sh%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.controller节点和compute节点分别执行iaas-pre-host.sh脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%90%AD%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">3.搭建数据库组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BA%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.4.</span> <span class="toc-text">4.搭建认证服务组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%90%AD%E5%BB%BA%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.5.</span> <span class="toc-text">5.搭建镜像服务组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%90%AD%E5%BB%BA%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.6.</span> <span class="toc-text">6.搭建计算服务组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.7.</span> <span class="toc-text">7.搭建网络组件并初始化网络</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A13-OpenStack%E8%BF%90%E7%BB%B4%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">任务3 OpenStack运维任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8openstack%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%EF%BC%8C%E9%95%9C%E5%83%8F%E5%90%8D%E7%A7%B0%E4%B8%BAnginx-%E6%BA%90%E4%BD%BF%E7%94%A8nginx-centos-qcow2"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.使用openstack图形界面创建镜像，镜像名称为nginx,源使用nginx-centos.qcow2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%92%89-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E5%90%8D%E7%A7%B0%E4%B8%BAgroup-web%E7%9A%84%E5%AE%89%E5%85%A8%E7%BB%84%E8%AF%A5%E5%AE%89%E5%85%A8%E7%BB%84%E7%9A%84%E6%8F%8F%E8%BF%B0%E4%B8%BA%E5%B7%A5%E4%BD%8D%E5%8F%B7%EF%BC%8C%E4%B8%BA%E8%AF%A5%E5%AE%89%E5%85%A8%E7%BB%84%E6%B7%BB%E5%8A%A0%E8%A7%84%E5%88%99%E5%85%81%E8%AE%B8%E4%BB%BB%E6%84%8Fip%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AEweb-%E5%B9%B6%E5%86%99%E5%87%BA%E6%B7%BB%E5%8A%A0%E8%AE%BF%E9%97%AESSH-22-%E7%9A%84%E5%91%BD%E4%BB%A4%E3%80%82"><span class="toc-number">1.3.2.</span> <span class="toc-text">⒉.使用命令创建名称为group_web的安全组该安全组的描述为工位号，为该安全组添加规则允许任意ip地址访问web,并写出添加访问SSH (22)的命令。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BAnginx%E7%9A%84%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%A6%81%E6%B1%82VCPU-1%E5%86%85%E5%AD%981024M%E6%A0%B9%E7%A3%81%E7%9B%9810G"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.创建名为nginx的云主机类型，要求VCPU 1内存1024M根磁盘10G</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%85%B3%E9%97%ADnginx%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%86%85%E5%AD%98%E5%85%B1%E4%BA%AB%EF%BC%8C%E6%89%93%E5%BC%80%E9%80%8F%E6%98%8E%E5%A4%A7%E9%A1%B5%EF%BC%8C%E5%B9%B6%E4%B8%94%E4%BF%9D%E8%AF%81nginx%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%9A%84%E5%AE%89%E5%85%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E7%A6%81%E6%AD%A2%E5%85%B6%E4%BB%96%E8%8A%82%E7%82%B9%E5%8F%AF%E4%BB%A5ping%E5%AE%83"><span class="toc-number">1.3.4.</span> <span class="toc-text">5.修改相关配置，关闭nginx云主机的系统的内存共享，打开透明大页，并且保证nginx云主机的安全，配置禁止其他节点可以ping它</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%80%9A%E8%BF%87ceilometer%E7%BB%84%E4%BB%B6%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9F%A5%E8%AF%A2nginx%E4%BA%91%E4%B8%BB%E6%9C%BACPU%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5%E3%80%82"><span class="toc-number">1.3.5.</span> <span class="toc-text">6.通过ceilometer组件，使用命令行查询nginx云主机CPU使用情况。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%9B%E5%BB%BA%E4%BA%91%E4%B8%BB%E6%9C%BAnginx%E5%BF%AB%E7%85%A7%EF%BC%8C%E5%91%BD%E5%90%8D%E4%B8%BAnginx-snap-%E4%BD%BF%E7%94%A8qemu%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%9F%A5%E8%AF%A2%E8%AF%A5%E5%BF%AB%E7%85%A7%E7%A3%81%E7%9B%98%E8%AF%A6%E7%BB%86%E5%B1%9E%E6%80%A7%E3%80%82"><span class="toc-number">1.3.6.</span> <span class="toc-text">7.使用命令行创建云主机nginx快照，命名为nginx_snap,使用qemu相关命令查询该快照磁盘详细属性。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%89%A7%E8%A1%8Ciaas-install-cinder-controller-sh%E5%92%8Ciaas-install-cinder-compute-sh%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%9C%A8controller%E5%92%8Ccompute%E8%8A%82%E7%82%B9%E4%B8%8A%E5%AE%89%E8%A3%85cinder%E6%9C%8D%E5%8A%A1%E5%B9%B6%E5%AE%8C%E6%88%90%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BAlvm%E7%9A%84%E5%8D%B7%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%88%9B%E5%BB%BA%E8%AF%A5%E7%B1%BB%E5%9E%8B%E8%A7%84%E6%A0%BC%E9%94%AE%E5%80%BC%E5%AF%B9%EF%BC%8C%E8%A6%81%E6%B1%82lvm%E5%8D%B7%E7%B1%BB%E5%9E%8B%E5%AF%B9%E5%BA%94cinder%E5%90%8E%E7%AB%AF%E9%A9%B1%E5%8A%A8lvm%E6%89%80%E7%AE%A1%E7%90%86%E7%9A%84%E5%AD%98%E5%82%A8%E8%B5%84%E6%BA%90%E3%80%82%E5%88%9B%E5%BB%BA%E4%B8%80%E5%9D%97%E5%B8%A6%E8%BF%99%E4%B8%AA%E5%8D%B7%E7%B1%BB%E5%9E%8B%E6%A0%87%E8%AF%86%E7%9A%84%E4%BA%91%E7%A1%AC%E7%9B%98lvm-test%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%A5%E4%BA%91%E7%A1%AC%E7%9B%98%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E3%80%82"><span class="toc-number">1.3.7.</span> <span class="toc-text">8.执行iaas-install-cinder-controller .sh和iaas-install-cinder-compute.sh脚本，在controller和compute节点上安装cinder服务并完成配置，创建一个名为lvm的卷类型，创建该类型规格键值对，要求lvm卷类型对应cinder后端驱动lvm所管理的存储资源。创建一块带这个卷类型标识的云硬盘lvm_test，查询该云硬盘的详细信息。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%B0%86%E8%AF%A5%E4%BA%91%E7%A1%AC%E7%9B%98%E6%8C%82%E8%BD%BD%E5%88%B0nginx%E4%BA%91%E4%B8%BB%E6%9C%BA%E4%B8%AD%EF%BC%8C%E5%B0%86%E8%AF%A5%E4%BA%91%E7%A1%AC%E7%9B%98%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%BAxfs%E3%80%82%E6%B0%B8%E4%B9%85%E6%8C%82%E8%BD%BD%E8%87%B3-opt%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%BA%E5%B7%A5%E4%BD%8D%E5%8F%B7%E5%86%85%E5%AE%B9%E4%B8%BA%E5%B7%A5%E4%BD%8D%E5%8F%B7%E3%80%82"><span class="toc-number">1.3.8.</span> <span class="toc-text">9.将该云硬盘挂载到nginx云主机中，将该云硬盘格式化为xfs。永久挂载至&#x2F;opt目录，创建一个文件文件名为工位号内容为工位号。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E7%BC%96%E5%86%99server-volume-yaml%E6%96%87%E4%BB%B6%EF%BC%8C%E9%80%9A%E8%BF%87heat%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2-%E5%8F%91%E6%94%BE1%E5%8F%B0%E4%BA%91%E4%B8%BB%E6%9C%BA%EF%BC%8C%E4%B8%BB%E6%9C%BA%E5%90%8D%E7%A7%B0%E4%B8%BAmy-server-1%EF%BC%8C%E9%95%9C%E5%83%8F%E4%B8%BAnginx%EF%BC%8C%E4%BA%91%E4%B8%BB%E6%9C%BA%E7%B1%BB%E5%9E%8B%E4%B8%BAnginx%EF%BC%8C%E7%BD%91%E7%BB%9C%E4%B8%BAint-net1%EF%BC%8C%E5%88%9B%E5%BB%BA%E5%A4%A7%E5%B0%8F%E4%B8%BA1G%E7%9A%84%E4%BA%91%E7%A1%AC%E7%9B%98%EF%BC%8C%E6%8C%82%E8%BD%BD%E8%87%B3my-server-1"><span class="toc-number">1.3.9.</span> <span class="toc-text">10.编写server_volume.yaml文件，通过heat组件实现自动化部署:发放1台云主机，主机名称为my server_1，镜像为nginx，云主机类型为nginx，网络为int-net1，创建大小为1G的云硬盘，挂载至my_server_1</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#B%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BC%96%E6%8E%92%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-number">2.</span> <span class="toc-text">B场次题目:容器的编排与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%885%E5%88%86%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">任务1 容器云平台环境初始化（5分）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.容器云平台的初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Yum%E6%BA%90%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%8C%82%E8%BD%BD"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.Yum源数据的持久化挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Yum%E6%BA%90%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.Yum源的编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.设置时间同步服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%AE%BE%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">2.1.5.</span> <span class="toc-text">5.设置免密登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A12-k8s%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1-10%E5%88%86"><span class="toc-number">2.2.</span> <span class="toc-text">任务2 k8s搭建任务(10分)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85docker%E5%BA%94%E7%94%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.安装docker应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85docker-compose"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.安装docker-compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%90%AD%E5%BB%BAhorbor%E4%BB%93%E5%BA%93"><span class="toc-number">2.2.3.</span> <span class="toc-text">3.搭建horbor仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%8A%E4%BC%A0docker%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.4.</span> <span class="toc-text">4.上传docker镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85kubeadm%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.5.</span> <span class="toc-text">5.安装kubeadm工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-kubeadm%E5%AE%89%E8%A3%85master"><span class="toc-number">2.2.6.</span> <span class="toc-text">6.kubeadm安装master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9"><span class="toc-number">2.2.7.</span> <span class="toc-text">7.删除污点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%AE%89%E8%A3%85kubernetes%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="toc-number">2.2.8.</span> <span class="toc-text">8.安装kubernetes网络插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-kubernetes%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.9.</span> <span class="toc-text">9.kubernetes图形化界面的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E6%89%A9%E5%B1%95%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-number">2.2.10.</span> <span class="toc-text">10.扩展计算节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%89-%E5%AD%98%E5%82%A8%E9%85%8D%E7%BD%AE-5%E5%88%86"><span class="toc-number">2.3.</span> <span class="toc-text">任务三 存储配置(5分)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NFS%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.1.</span> <span class="toc-text">1.NFS配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-PV%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.PV配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BAConfigmap"><span class="toc-number">2.3.3.</span> <span class="toc-text">3.创建Configmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-number">2.3.4.</span> <span class="toc-text">4.导入镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E5%9B%9Bredis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2-10%E5%88%86"><span class="toc-number">2.4.</span> <span class="toc-text">任务四redis集群部署(10分)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E4%BA%8EStatefulSet%E5%88%9B%E5%BB%BARedis%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.基于StatefulSet创建Redis集群节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-redis%E9%9B%86%E7%BE%A4%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.redis集群初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%BAredis%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEservice"><span class="toc-number">2.4.3.</span> <span class="toc-text">3.为redis集群配置service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%9B%86%E7%BE%A4%E4%B8%BB%E4%BB%8E%E5%88%87%E6%8D%A2"><span class="toc-number">2.4.4.</span> <span class="toc-text">4.集群主从切换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="toc-number">3.</span> <span class="toc-text">C场次题目：企业级应用的自动化部署和运维</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2-17%E5%88%86"><span class="toc-number">3.1.</span> <span class="toc-text">任务1企业级应用的自动化部署(17分)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ansible%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.ansible自动化运维工具的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.ansible 自动化运维工具的初始化【3 分】</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E5%AF%B9-master-%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%902-%E5%88%86%E3%80%91"><span class="toc-number">3.1.3.</span> <span class="toc-text">4.使用自动化工具对 master 节点进行初始化【2 分】</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E7%BB%B4%EF%BC%8812-%E5%88%86%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">任务 2 企业级应用的运维（12 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8-prometheus-%E7%9B%91%E6%8E%A7-mysqld-%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.使用 prometheus 监控 mysqld 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%92%89-%E5%AE%89%E8%A3%85alertmanager%E6%8A%A5%E8%AD%A6%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.2.</span> <span class="toc-text">⒉.安装alertmanager报警组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-alertmanager%E5%91%8A%E8%AD%A6%E9%82%AE%E4%BB%B6%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.alertmanager告警邮件文件编写</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%89%EF%BC%9A-%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%90%E7%BB%B4%EF%BC%88zabbix%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">任务三： 企业级运维（zabbix）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%8C%E6%88%90zabbix-5-0-LTS%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">3.3.1.</span> <span class="toc-text">1.完成zabbix 5.0 LTS版本的安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-keepalive%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.keepalive的高可用配置</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1288cce5.html" title="小迪安全--安全开发下篇(4)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--安全开发下篇(4)"/></a><div class="content"><a class="title" href="/posts/1288cce5.html" title="小迪安全--安全开发下篇(4)">小迪安全--安全开发下篇(4)</a><time datetime="2025-06-12T13:17:11.319Z" title="发表于 2025-06-12 21:17:11">2025-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--安全开发上篇(3)"/></a><div class="content"><a class="title" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)">小迪安全--安全开发上篇(3)</a><time datetime="2025-06-12T13:08:57.606Z" title="发表于 2025-06-12 21:08:57">2025-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dba72746.html" title="小迪安全--信息打点(2)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--信息打点(2)"/></a><div class="content"><a class="title" href="/posts/dba72746.html" title="小迪安全--信息打点(2)">小迪安全--信息打点(2)</a><time datetime="2025-05-18T02:57:49.848Z" title="发表于 2025-05-18 10:57:49">2025-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-Ansible搭建wordpress"/></a><div class="content"><a class="title" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress">云计算方向-Ansible搭建wordpress</a><time datetime="2025-05-14T02:48:38.000Z" title="发表于 2025-05-14 10:48:38">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"/></a><div class="content"><a class="title" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</a><time datetime="2025-05-14T02:48:37.000Z" title="发表于 2025-05-14 10:48:37">2025-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bottom-bg.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By GoldY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=yuwenjin666";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="yuwenjin666";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>